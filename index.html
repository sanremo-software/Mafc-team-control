<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MAFC & FILHO, LDA. - Sistema de Gestão Total</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ============ RESET E VARIÁVEIS ============ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #1a5f7a;
            --secondary: #2d9cdb;
            --accent: #ff9f1c;
            --dark: #003049;
            --light: #f8f9fa;
            --success: #27ae60;
            --warning: #f39c12;
            --danger: #e74c3c;
            --info: #17a2b8;
            --boss: #8e44ad;
            --team: #3498db;
            --purchase: #2ecc71;
            --office: #9b59b6;
            --construction: #e67e22;
            --gray: #6c757d;
            --light-gray: #e9ecef;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: var(--light);
            overflow-x: hidden;
        }

        .container {
            width: 90%;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* ============ PÁGINA PÚBLICA ============ */
        #publicWebsite {
            min-height: 100vh;
        }

        /* Header Público */
        .public-header {
            background: linear-gradient(135deg, var(--dark), var(--primary));
            color: white;
            padding: 1.5rem 0;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        }

        .nav-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo i {
            font-size: 2.8rem;
            color: var(--accent);
        }

        .logo-text h1 {
            font-size: 1.8rem;
            font-weight: 800;
        }

        .logo-text span {
            color: var(--accent);
            font-size: 1rem;
            display: block;
            margin-top: 5px;
        }

        .cta-buttons {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        /* Botões */
        .btn {
            padding: 12px 30px;
            border-radius: 50px;
            font-weight: 600;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            white-space: nowrap;
        }

        .btn-whatsapp {
            background: #25D366;
            color: white;
        }

        .btn-whatsapp:hover {
            background: #1da851;
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(37, 211, 102, 0.4);
        }

        .btn-email {
            background: var(--accent);
            color: var(--dark);
        }

        .btn-email:hover {
            background: #ffb143;
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(255, 159, 28, 0.3);
        }

        .btn-login {
            background: var(--primary);
            color: white;
        }

        .btn-login:hover {
            background: var(--dark);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(26, 95, 122, 0.3);
        }

        /* Hero Section */
        .hero {
            background: linear-gradient(rgba(0, 48, 73, 0.88), rgba(0, 48, 73, 0.92)), 
                        url('https://images.unsplash.com/photo-1504307651254-35680f356dfd?ixlib=rb-4.0.3&auto=format&fit=crop&w=1800&q=80');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            color: white;
            padding: 180px 0 120px;
            text-align: center;
            margin-top: 80px;
        }

        .hero h2 {
            font-size: 3.8rem;
            margin-bottom: 25px;
            font-weight: 900;
            text-transform: uppercase;
            text-shadow: 3px 3px 8px rgba(0,0,0,0.4);
            line-height: 1.2;
        }

        .hero p {
            font-size: 1.4rem;
            max-width: 850px;
            margin: 0 auto 50px;
            opacity: 0.95;
            line-height: 1.8;
        }

        .hero-buttons {
            display: flex;
            gap: 25px;
            justify-content: center;
            margin-top: 40px;
            flex-wrap: wrap;
        }

        /* ============ MODAL LOGIN ============ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: white;
            width: 90%;
            max-width: 500px;
            border-radius: 20px;
            overflow: hidden;
            animation: modalSlideIn 0.4s;
            box-shadow: 0 25px 50px rgba(0,0,0,0.3);
        }

        @keyframes modalSlideIn {
            from { transform: translateY(-50px) scale(0.9); opacity: 0; }
            to { transform: translateY(0) scale(1); opacity: 1; }
        }

        .modal-header {
            background: linear-gradient(135deg, var(--dark), var(--primary));
            color: white;
            padding: 25px;
            text-align: center;
            position: relative;
        }

        .modal-header h2 {
            font-size: 2rem;
            font-weight: 700;
        }

        .close-modal {
            position: absolute;
            top: 20px;
            right: 25px;
            font-size: 1.8rem;
            cursor: pointer;
            color: white;
            transition: color 0.3s;
        }

        .close-modal:hover {
            color: var(--accent);
        }

        .modal-body {
            padding: 50px;
        }

        .form-group {
            margin-bottom: 30px;
        }

        .form-group label {
            display: block;
            margin-bottom: 10px;
            color: var(--dark);
            font-weight: 600;
            font-size: 1.1rem;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 15px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1.1rem;
            transition: all 0.3s;
            background: #f8f9fa;
        }

        .form-group input:focus, .form-group select:focus {
            border-color: var(--primary);
            outline: none;
            background: white;
            box-shadow: 0 0 0 3px rgba(26, 95, 122, 0.1);
        }

        .login-submit {
            background: linear-gradient(135deg, var(--primary), var(--dark));
            color: white;
            border: none;
            padding: 18px 40px;
            border-radius: 12px;
            font-size: 1.2rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .login-submit:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(26, 95, 122, 0.3);
            background: linear-gradient(135deg, var(--dark), var(--primary));
        }

        /* ============ DASHBOARDS ============ */
        .dashboard {
            display: none;
            min-height: 100vh;
            background: #f0f2f5;
        }

        /* Top Bar Horizontal */
        .top-bar {
            background: white;
            padding: 0;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            border-bottom: 5px solid;
        }

        /* Cores diferentes para cada dashboard */
        .boss-dashboard .top-bar {
            border-bottom-color: var(--boss);
            background: linear-gradient(135deg, #9b59b6, var(--boss));
        }

        .team-dashboard .top-bar {
            border-bottom-color: var(--team);
            background: linear-gradient(135deg, #3498db, #2980b9);
        }

        .purchase-dashboard .top-bar {
            border-bottom-color: var(--purchase);
            background: linear-gradient(135deg, #2ecc71, #27ae60);
        }

        .office-dashboard .top-bar {
            border-bottom-color: var(--office);
            background: linear-gradient(135deg, var(--office), #8e44ad);
        }

        .top-bar-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
        }

        .dashboard-brand {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .dashboard-brand i {
            font-size: 2.2rem;
            color: white;
        }

        .dashboard-brand h1 {
            color: white;
            font-size: 1.8rem;
            font-weight: 700;
        }

        .dashboard-info {
            display: flex;
            align-items: center;
            gap: 25px;
            color: white;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
            background: rgba(255,255,255,0.15);
            padding: 10px 20px;
            border-radius: 50px;
            backdrop-filter: blur(10px);
        }

        .user-info i {
            font-size: 1.4rem;
        }

        .logout-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid rgba(255,255,255,0.3);
            padding: 10px 25px;
            border-radius: 50px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
            backdrop-filter: blur(10px);
        }

        .logout-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
            border-color: white;
        }

        /* Conteúdo do Dashboard */
        .dashboard-content {
            margin-top: 70px;
            padding: 20px 30px 80px 30px;
            background: #f0f2f5;
            min-height: calc(100vh - 70px);
        }

        /* MENU NO FUNDO */
        .bottom-menu {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: white;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.1);
            z-index: 1000;
            overflow-x: auto;
        }

        .bottom-menu-container {
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
        }

        .bottom-menu-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px 15px;
            color: #666;
            text-decoration: none;
            font-size: 0.85rem;
            text-align: center;
            min-width: 80px;
            border-radius: 10px;
            transition: all 0.3s;
            position: relative;
        }

        .bottom-menu-item:hover {
            background: #f8f9fa;
            color: var(--primary);
        }

        .bottom-menu-item.active {
            color: var(--primary);
            background: #f0f7ff;
        }

        .bottom-menu-item i {
            font-size: 1.4rem;
            margin-bottom: 5px;
        }

        .bottom-menu-badge {
            position: absolute;
            top: 5px;
            right: 5px;
            background: var(--accent);
            color: white;
            font-size: 0.7rem;
            padding: 2px 5px;
            border-radius: 50%;
            min-width: 18px;
            text-align: center;
        }

        /* Dashboard Sections */
        .dashboard-section {
            display: none;
            animation: fadeIn 0.3s;
        }

        .dashboard-section.active {
            display: block;
        }

        /* Cards de Estatísticas */
        .stats-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .stat-card-horizontal {
            background: white;
            padding: 25px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            gap: 20px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.08);
            border-left: 6px solid;
            transition: transform 0.3s;
        }

        .stat-card-horizontal:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 30px rgba(0,0,0,0.12);
        }

        .boss-dashboard .stat-card-horizontal { border-left-color: var(--boss); }
        .team-dashboard .stat-card-horizontal { border-left-color: var(--team); }
        .purchase-dashboard .stat-card-horizontal { border-left-color: var(--purchase); }
        .office-dashboard .stat-card-horizontal { border-left-color: var(--office); }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            color: white;
        }

        .boss-dashboard .stat-icon { background: linear-gradient(135deg, var(--boss), #9b59b6); }
        .team-dashboard .stat-icon { background: linear-gradient(135deg, var(--team), #3498db); }
        .purchase-dashboard .stat-icon { background: linear-gradient(135deg, var(--purchase), #2ecc71); }
        .office-dashboard .stat-icon { background: linear-gradient(135deg, var(--office), #9b59b6); }

        .stat-info h3 {
            font-size: 2.2rem;
            color: var(--dark);
            margin-bottom: 5px;
            font-weight: 800;
        }

        .stat-info p {
            color: #666;
            font-weight: 600;
            font-size: 1rem;
        }

        /* Grids de Conteúdo */
        .content-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        /* Cards de Conteúdo */
        .content-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.08);
            transition: transform 0.3s;
        }

        .content-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 30px rgba(0,0,0,0.12);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .card-header h3 {
            color: var(--dark);
            font-size: 1.4rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .card-header h3 i {
            color: var(--primary);
        }

        /* Botões Dashboard */
        .btn-dashboard {
            padding: 12px 25px;
            border-radius: 10px;
            font-weight: 600;
            border: none;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
            font-size: 1rem;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--dark);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(26, 95, 122, 0.3);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover {
            background: #219653;
            transform: translateY(-3px);
        }

        .btn-warning {
            background: var(--warning);
            color: white;
        }

        .btn-warning:hover {
            background: #e67e22;
            transform: translateY(-3px);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background: #c0392b;
            transform: translateY(-3px);
        }

        .btn-info {
            background: var(--info);
            color: white;
        }

        .btn-info:hover {
            background: #138496;
            transform: translateY(-3px);
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 0.85rem;
        }

        /* Tabelas */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }

        .data-table th {
            background: var(--primary);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
            font-size: 1rem;
        }

        .data-table td {
            padding: 15px;
            border-bottom: 1px solid #f0f0f0;
        }

        .data-table tr:hover {
            background: #f8f9fa;
        }

        /* Badges */
        .badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 700;
            display: inline-block;
        }

        .badge-success { background: #d5f4e6; color: var(--success); }
        .badge-warning { background: #fff3cd; color: var(--warning); }
        .badge-danger { background: #f8d7da; color: var(--danger); }
        .badge-primary { background: #d1ecf1; color: var(--secondary); }
        .badge-info { background: #d1ecf1; color: #17a2b8; }
        .badge-secondary { background: #e2e3e5; color: #6c757d; }

        /* Formulários */
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group-dashboard {
            margin-bottom: 20px;
        }

        .form-group-dashboard label {
            display: block;
            margin-bottom: 8px;
            color: var(--dark);
            font-weight: 600;
            font-size: 1rem;
        }

        .form-group-dashboard input,
        .form-group-dashboard select,
        .form-group-dashboard textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s;
            background: #f8f9fa;
        }

        .form-group-dashboard input:focus,
        .form-group-dashboard select:focus,
        .form-group-dashboard textarea:focus {
            border-color: var(--primary);
            outline: none;
            background: white;
            box-shadow: 0 0 0 3px rgba(26, 95, 122, 0.1);
        }

        .form-actions {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #f0f0f0;
        }

        /* Time Tracker */
        .time-tracker {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 25px;
        }

        .time-display {
            font-size: 3.5rem;
            font-weight: 800;
            text-align: center;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .time-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        /* GPS Tracker */
        .gps-tracker {
            background: linear-gradient(135deg, #11998e, #38ef7d);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 25px;
        }

        .gps-info {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        .gps-coordinates {
            font-family: monospace;
            font-size: 1.2rem;
            background: rgba(255,255,255,0.15);
            padding: 12px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }

        /* ============ MODAIS ============ */
        .modal-employee, .modal-monthly-report, .modal-document, 
        .modal-purchase-details, .modal-gps, .modal-clear-history {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.85);
            z-index: 2001;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .modal-employee-content, .modal-monthly-report-content, 
        .modal-document-content, .modal-purchase-details-content,
        .modal-gps-content, .modal-clear-history-content {
            background: white;
            width: 90%;
            max-width: 800px;
            border-radius: 15px;
            padding: 30px;
            position: relative;
            max-height: 85vh;
            overflow-y: auto;
        }

        .close-modal-btn {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 1.8rem;
            cursor: pointer;
            color: var(--dark);
            background: none;
            border: none;
        }

        .close-modal-btn:hover {
            color: var(--danger);
        }

        /* Extrato Mensal */
        .monthly-report {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }

        .report-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #eee;
        }

        .report-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        /* Tabela de Horários */
        .time-sheet-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .time-sheet-table th {
            background: #f8f9fa;
            padding: 12px;
            text-align: left;
            border-bottom: 2px solid #ddd;
        }

        .time-sheet-table td {
            padding: 12px;
            border-bottom: 1px solid #eee;
        }

        /* Sistema de Alertas */
        .alert {
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border-left: 5px solid var(--success);
        }

        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border-left: 5px solid var(--warning);
        }

        .alert-danger {
            background: #f8d7da;
            color: #721c24;
            border-left: 5px solid var(--danger);
        }

        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border-left: 5px solid var(--info);
        }

        /* Sistema de Filtros */
        .filter-bar {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Team Location Badge */
        .team-location-badge {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }

        /* GPS Map Container */
        .gps-map-container {
            width: 100%;
            height: 300px;
            background: #e9ecef;
            border-radius: 10px;
            margin: 20px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
        }

        /* History Clear Options */
        .clear-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .clear-option-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .clear-option-card:hover {
            border-color: var(--danger);
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .clear-option-card.selected {
            border-color: var(--danger);
            background: #f8d7da;
        }

        /* Responsividade */
        @media (max-width: 1200px) {
            .content-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 992px) {
            .hero h2 {
                font-size: 2.8rem;
            }
            
            .dashboard-content {
                padding: 15px;
            }
            
            .bottom-menu-item {
                padding: 8px 10px;
                font-size: 0.8rem;
                min-width: 70px;
            }
        }

        @media (max-width: 768px) {
            .hero {
                padding: 150px 0 80px;
            }
            
            .hero h2 {
                font-size: 2.2rem;
            }
            
            .hero p {
                font-size: 1.2rem;
            }
            
            .stats-row {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .top-bar-content {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .dashboard-info {
                flex-direction: column;
                gap: 15px;
            }
            
            .content-card {
                padding: 20px;
            }
            
            .time-display {
                font-size: 2.8rem;
            }
        }

        @media (max-width: 480px) {
            .hero h2 {
                font-size: 1.8rem;
            }
            
            .btn {
                padding: 10px 20px;
                font-size: 0.9rem;
            }
            
            .dashboard-content {
                padding: 10px;
            }
            
            .modal-employee-content,
            .modal-monthly-report-content {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <!-- ============ PÁGINA PÚBLICA ============ -->
    <div id="publicWebsite">
        <!-- Header Público -->
        <header class="public-header">
            <div class="container nav-container">
                <div class="logo">
                    <i class="fas fa-hard-hat"></i>
                    <div class="logo-text">
                        <h1>MAFC & FILHO, LDA.</h1>
                        <span>Construção Civil & Obras Públicas | Desde 2001</span>
                    </div>
                </div>
                <div class="cta-buttons">
                    <a href="https://wa.me/351123456789?text=Olá MAFC,%20gostaria%20de%20solicitar%20um%20orçamento%20para%20uma%20obra" 
                       class="btn btn-whatsapp" target="_blank">
                        <i class="fab fa-whatsapp"></i> WhatsApp
                    </a>
                    <a href="#" class="btn btn-login" id="openLogin">
                        <i class="fas fa-sign-in-alt"></i> Acesso Sistema
                    </a>
                </div>
            </div>
        </header>

        <!-- Hero Section -->
        <section class="hero">
            <div class="container">
                <h2>Sistema de Gestão MAFC</h2>
                <p>Controle total de horas, equipas, compras e escritório. Gestão profissional com marcação obrigatória de entrada/saída e relatórios para contabilidade.</p>
                <div class="hero-buttons">
                    <a href="#" class="btn btn-email" id="openLoginFromHero">
                        <i class="fas fa-sign-in-alt"></i> Acessar Sistema
                    </a>
                </div>
            </div>
        </section>
    </div>

    <!-- ============ MODAL DE LOGIN ============ -->
    <div class="modal" id="loginModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-lock"></i> Acesso ao Sistema MAFC</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="loginForm">
                    <div class="form-group">
                        <label for="username"><i class="fas fa-user"></i> Código de Acesso</label>
                        <input type="text" id="username" placeholder="Digite seu código" required>
                    </div>
                    <div class="form-group">
                        <label for="password"><i class="fas fa-key"></i> Senha</label>
                        <input type="password" id="password" placeholder="Digite sua senha" required>
                    </div>
                    <div class="form-group">
                        <label for="role"><i class="fas fa-user-tag"></i> Tipo de Acesso</label>
                        <select id="role" required>
                            <option value="">Selecione o tipo de acesso</option>
                            <option value="boss">Administração Geral</option>
                            <option value="team">Chefe de Equipa</option>
                            <option value="purchase">Responsável de Compras</option>
                            <option value="office">Escritório</option>
                        </select>
                    </div>
                    <button type="submit" class="login-submit">
                        <i class="fas fa-sign-in-alt"></i> Entrar no Sistema
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- ============ MODAL GESTÃO DE PESSOAL ============ -->
    <div class="modal-employee" id="employeeModal">
        <div class="modal-employee-content">
            <button class="close-modal-btn">&times;</button>
            <h2><i class="fas fa-user-plus"></i> Gestão de Pessoal</h2>
            <div class="employee-form">
                <div class="form-row">
                    <div class="form-group-dashboard">
                        <label>Nome Completo *</label>
                        <input type="text" id="employeeName" placeholder="Nome completo" required>
                    </div>
                    <div class="form-group-dashboard">
                        <label>Número de WhatsApp</label>
                        <input type="tel" id="employeeWhatsApp" placeholder="+351 912 345 678" value="+351 ">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group-dashboard">
                        <label>Cargo/Função *</label>
                        <select id="employeePosition" required>
                            <option value="operario">Operário</option>
                            <option value="chefe_equipa">Chefe de Equipa</option>
                            <option value="administrativo">Administrativo</option>
                            <option value="contabilidade">Contabilidade</option>
                            <option value="rh">Recursos Humanos</option>
                            <option value="gestor">Gestor</option>
                            <option value="assistente">Assistente</option>
                        </select>
                    </div>
                    <div class="form-group-dashboard">
                        <label>Departamento *</label>
                        <select id="employeeDepartment" required>
                            <option value="obra">Obra</option>
                            <option value="escritorio">Escritório</option>
                            <option value="contabilidade">Contabilidade</option>
                            <option value="rh">RH</option>
                            <option value="administracao">Administração</option>
                            <option value="compras">Compras</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group-dashboard">
                        <label>Equipa (se aplicável)</label>
                        <select id="employeeTeam">
                            <option value="">Nenhuma</option>
                            <option value="equipa01">Equipa 01 - Berlin</option>
                            <option value="equipa02">Equipa 02 - Hamburg</option>
                            <option value="equipa03">Equipa 03 - Lisboa</option>
                            <option value="equipa04">Equipa 04 - Porto</option>
                            <option value="equipa05">Equipa 05 - Frankfurt</option>
                        </select>
                    </div>
                    <div class="form-group-dashboard">
                        <label>Estado *</label>
                        <select id="employeeStatus" required>
                            <option value="active">Ativo</option>
                            <option value="inactive">Inativo</option>
                            <option value="ferias">Férias</option>
                            <option value="baixa">Baixa Médica</option>
                        </select>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-dashboard btn-success" onclick="saveEmployee()">
                        <i class="fas fa-save"></i> Guardar
                    </button>
                    <button type="button" class="btn-dashboard btn-danger" onclick="closeModal('employeeModal')">
                        <i class="fas fa-times"></i> Cancelar
                    </button>
                </div>
            </div>
            
            <div style="margin-top: 30px;">
                <h3><i class="fas fa-list"></i> Lista de Pessoal</h3>
                <div class="filter-bar">
                    <input type="text" id="searchEmployeeList" placeholder="Pesquisar nome..." onkeyup="filterEmployeeList()">
                    <select id="filterEmployeeDept" onchange="filterEmployeeList()">
                        <option value="all">Todos Departamentos</option>
                        <option value="obra">Obra</option>
                        <option value="escritorio">Escritório</option>
                        <option value="compras">Compras</option>
                    </select>
                    <select id="filterEmployeeStatus" onchange="filterEmployeeList()">
                        <option value="all">Todos Estados</option>
                        <option value="active">Ativos</option>
                        <option value="inactive">Inativos</option>
                    </select>
                </div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Nome</th>
                            <th>WhatsApp</th>
                            <th>Cargo</th>
                            <th>Departamento</th>
                            <th>Equipa</th>
                            <th>Estado</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody id="employeesList">
                        <!-- Lista de empregados será carregada aqui -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- ============ MODAL GPS/LOCALIZAÇÃO ============ -->
    <div class="modal-gps" id="gpsModal">
        <div class="modal-gps-content">
            <button class="close-modal-btn">&times;</button>
            <h2><i class="fas fa-map-marker-alt"></i> Localização GPS da Obra</h2>
            
            <div class="gps-tracker">
                <div class="gps-info">
                    <i class="fas fa-map-pin fa-2x"></i>
                    <div>
                        <h3>Localização Atual</h3>
                        <div class="gps-coordinates" id="currentGpsCoordinates">
                            41.1579° N, 8.6291° W
                        </div>
                    </div>
                </div>
                <button class="btn-dashboard btn-success" onclick="getCurrentLocation()">
                    <i class="fas fa-crosshairs"></i> Obter Localização Atual
                </button>
            </div>

            <div class="form-row">
                <div class="form-group-dashboard">
                    <label>Nome da Obra *</label>
                    <input type="text" id="gpsWorkName" placeholder="Ex: Pavimentação Avenida Central">
                </div>
                <div class="form-group-dashboard">
                    <label>Equipa Responsável *</label>
                    <select id="gpsTeam" required>
                        <option value="">Selecione a equipa</option>
                        <option value="equipa01">Equipa 01 - Berlin</option>
                        <option value="equipa02">Equipa 02 - Hamburg</option>
                        <option value="equipa03">Equipa 03 - Lisboa</option>
                    </select>
                </div>
            </div>

            <div class="form-group-dashboard">
                <label>Endereço/Descrição</label>
                <textarea id="gpsAddress" rows="3" placeholder="Endereço completo ou pontos de referência..."></textarea>
            </div>

            <div class="gps-map-container">
                <div style="text-align: center;">
                    <i class="fas fa-map fa-3x" style="color: #666; margin-bottom: 10px;"></i>
                    <p>Mapa da localização</p>
                    <p id="mapCoordinates">Coordenadas: 41.1579° N, 8.6291° W</p>
                </div>
            </div>

            <div class="form-actions">
                <button type="button" class="btn-dashboard btn-success" onclick="saveGPSLocation()">
                    <i class="fas fa-save"></i> Guardar Localização
                </button>
                <button type="button" class="btn-dashboard btn-whatsapp" onclick="sendGPSWhatsApp()">
                    <i class="fab fa-whatsapp"></i> Partilhar no WhatsApp
                </button>
                <button type="button" class="btn-dashboard btn-primary" onclick="sendGPSToBoss()">
                    <i class="fas fa-user-tie"></i> Enviar para Patrão
                </button>
            </div>

            <div style="margin-top: 30px;">
                <h3><i class="fas fa-history"></i> Histórico de Localizações</h3>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Data/Hora</th>
                            <th>Obra</th>
                            <th>Equipa</th>
                            <th>Coordenadas</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody id="gpsHistoryTable">
                        <!-- Histórico de GPS será carregado aqui -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- ============ MODAL LIMPAR HISTÓRICO ============ -->
    <div class="modal-clear-history" id="clearHistoryModal">
        <div class="modal-clear-history-content">
            <button class="close-modal-btn">&times;</button>
            <h2><i class="fas fa-broom"></i> Limpar Histórico</h2>
            <div class="alert alert-warning">
                <i class="fas fa-exclamation-triangle"></i>
                <div>
                    <strong>Atenção!</strong>
                    <p>Esta ação não pode ser desfeita. Faça backup dos dados importantes antes de prosseguir.</p>
                </div>
            </div>

            <h3>Selecione o tipo de limpeza:</h3>
            <div class="clear-options">
                <div class="clear-option-card" onclick="selectClearOption('all')" id="clearOptionAll">
                    <i class="fas fa-trash-alt fa-2x" style="color: #e74c3c; margin-bottom: 10px;"></i>
                    <h4>Limpar Tudo</h4>
                    <p>Todos os dados do sistema</p>
                    <small>Todas as tabelas serão limpas</small>
                </div>
                
                <div class="clear-option-card" onclick="selectClearOption('employee')" id="clearOptionEmployee">
                    <i class="fas fa-user-times fa-2x" style="color: #3498db; margin-bottom: 10px;"></i>
                    <h4>Individual</h4>
                    <p>Por pessoa/equipa</p>
                    <small>Selecione quem limpar</small>
                </div>
                
                <div class="clear-option-card" onclick="selectClearOption('period')" id="clearOptionPeriod">
                    <i class="fas fa-calendar-times fa-2x" style="color: #9b59b6; margin-bottom: 10px;"></i>
                    <h4>Por Período</h4>
                    <p>Datas específicas</p>
                    <small>Defina intervalo de datas</small>
                </div>
            </div>

            <!-- Opção Individual -->
            <div id="individualClearSection" style="display: none; margin-top: 20px;">
                <h4><i class="fas fa-users"></i> Limpar por Pessoa/Equipa</h4>
                <div class="form-row">
                    <div class="form-group-dashboard">
                        <label>Tipo</label>
                        <select id="clearType" onchange="toggleClearType()">
                            <option value="person">Pessoa Individual</option>
                            <option value="team">Equipa Completa</option>
                            <option value="department">Departamento</option>
                        </select>
                    </div>
                    <div class="form-group-dashboard" id="clearPersonSelect">
                        <label>Selecionar Pessoa</label>
                        <select id="clearPerson">
                            <option value="">Selecione uma pessoa</option>
                        </select>
                    </div>
                    <div class="form-group-dashboard" id="clearTeamSelect" style="display: none;">
                        <label>Selecionar Equipa</label>
                        <select id="clearTeam">
                            <option value="">Selecione uma equipa</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Opção Período -->
            <div id="periodClearSection" style="display: none; margin-top: 20px;">
                <h4><i class="fas fa-calendar-alt"></i> Limpar por Período</h4>
                <div class="form-row">
                    <div class="form-group-dashboard">
                        <label>Data Início</label>
                        <input type="date" id="clearDateFrom">
                    </div>
                    <div class="form-group-dashboard">
                        <label>Data Fim</label>
                        <input type="date" id="clearDateTo">
                    </div>
                </div>
                <div class="form-group-dashboard">
                    <label>Tipo de Dados</label>
                    <select id="clearDataType" multiple>
                        <option value="time">Registos de Horas</option>
                        <option value="gps">Localizações GPS</option>
                        <option value="requests">Pedidos de Material</option>
                        <option value="documents">Documentos</option>
                    </select>
                </div>
            </div>

            <!-- Resumo -->
            <div id="clearSummary" style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px; display: none;">
                <h4><i class="fas fa-clipboard-list"></i> Resumo da Limpeza</h4>
                <p id="summaryText"></p>
                <p><strong>Itens a serem removidos: <span id="itemCount">0</span></strong></p>
            </div>

            <div class="form-actions">
                <button type="button" class="btn-dashboard btn-danger" onclick="executeClearHistory()" id="executeClearBtn" disabled>
                    <i class="fas fa-broom"></i> EXECUTAR LIMPEZA
                </button>
                <button type="button" class="btn-dashboard btn-warning" onclick="generateBackup()">
                    <i class="fas fa-download"></i> Backup Antes de Limpar
                </button>
                <button type="button" class="btn-dashboard btn-secondary" onclick="closeModal('clearHistoryModal')">
                    <i class="fas fa-times"></i> Cancelar
                </button>
            </div>
        </div>
    </div>

    <!-- ============ DASHBOARD DO PATRÃO/ADMIN ============ -->
    <div class="dashboard boss-dashboard" id="bossDashboard">
        <!-- Top Bar -->
        <div class="top-bar">
            <div class="container top-bar-content">
                <div class="dashboard-brand">
                    <i class="fas fa-crown"></i>
                    <h1>Painel Administrativo - MAFC</h1>
                </div>
                <div class="dashboard-info">
                    <div class="user-info">
                        <i class="fas fa-user-circle"></i>
                        <span id="bossUserName">Administrador</span>
                    </div>
                    <div id="bossCurrentTime" style="font-weight: 600;">10:45 AM</div>
                    <button class="logout-btn" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i> Sair
                    </button>
                </div>
            </div>
        </div>

        <!-- Conteúdo -->
        <div class="dashboard-content">
            <!-- Visão Geral -->
            <div class="dashboard-section active" id="bossOverviewSection">
                <div class="stats-row">
                    <div class="stat-card-horizontal">
                        <div class="stat-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="totalEmployees">0</h3>
                            <p>Total Colaboradores</p>
                        </div>
                    </div>
                    <div class="stat-card-horizontal">
                        <div class="stat-icon">
                            <i class="fas fa-hard-hat"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="activeTeams">0</h3>
                            <p>Equipas Ativas</p>
                        </div>
                    </div>
                    <div class="stat-card-horizontal">
                        <div class="stat-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="todayPresent">0</h3>
                            <p>Presentes Hoje</p>
                        </div>
                    </div>
                    <div class="stat-card-horizontal">
                        <div class="stat-icon">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="pendingItems">0</h3>
                            <p>Pendentes</p>
                        </div>
                    </div>
                </div>

                <div class="content-grid">
                    <!-- Alertas Recentes -->
                    <div class="content-card">
                        <div class="card-header">
                            <h3><i class="fas fa-bell"></i> Alertas Recentes</h3>
                            <button class="btn-dashboard btn-primary" onclick="markAllAlertsRead()">
                                <i class="fas fa-check-double"></i> Marcar Lidas
                            </button>
                        </div>
                        <div id="bossAlerts">
                            <!-- Alertas serão carregados aqui -->
                        </div>
                    </div>

                    <!-- Equipas Online -->
                    <div class="content-card">
                        <div class="card-header">
                            <h3><i class="fas fa-satellite-dish"></i> Equipas em Obra</h3>
                            <button class="btn-dashboard btn-info" onclick="refreshTeamsStatus()">
                                <i class="fas fa-sync-alt"></i> Atualizar
                            </button>
                        </div>
                        <div style="max-height: 300px; overflow-y: auto;">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Equipa</th>
                                        <th>Localização</th>
                                        <th>Status</th>
                                        <th>Último GPS</th>
                                        <th>Ações</th>
                                    </tr>
                                </thead>
                                <tbody id="bossTeamsOnline">
                                    <!-- Equipas online serão carregadas aqui -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Controlo Horas -->
            <div class="dashboard-section" id="bossHoursSection">
                <div class="content-card">
                    <div class="card-header">
                        <h3><i class="fas fa-clock"></i> Controlo de Horas - Todas as Equipas</h3>
                        <button class="btn-dashboard btn-info" onclick="generateHoursReport()">
                            <i class="fas fa-file-excel"></i> Exportar Horas
                        </button>
                        <button class="btn-dashboard btn-danger" onclick="openClearHistoryModal()">
                            <i class="fas fa-broom"></i> Limpar Histórico
                        </button>
                    </div>

                    <div class="filter-bar">
                        <input type="date" id="bossHoursDate" value="<?php echo date('Y-m-d'); ?>" onchange="loadBossHours()">
                        <select id="bossHoursTeam" onchange="loadBossHours()">
                            <option value="all">Todas Equipas</option>
                        </select>
                        <select id="bossHoursDept" onchange="loadBossHours()">
                            <option value="all">Todos Departamentos</option>
                            <option value="obra">Obra</option>
                            <option value="escritorio">Escritório</option>
                        </select>
                    </div>

                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Nome</th>
                                <th>Equipa/Depto</th>
                                <th>Entrada</th>
                                <th>Saída</th>
                                <th>Pausa</th>
                                <th>Total</th>
                                <th>Status</th>
                                <th>WhatsApp</th>
                            </tr>
                        </thead>
                        <tbody id="bossHoursTable">
                            <!-- Horas serão carregadas aqui -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Equipas -->
            <div class="dashboard-section" id="bossTeamsSection">
                <div class="content-card">
                    <div class="card-header">
                        <h3><i class="fas fa-users"></i> Gestão de Equipas</h3>
                        <button class="btn-dashboard btn-primary" onclick="addNewTeam()">
                            <i class="fas fa-plus"></i> Nova Equipa
                        </button>
                    </div>
                    
                    <div class="filter-bar">
                        <input type="text" id="searchTeam" placeholder="Pesquisar equipa..." onkeyup="filterTeams()">
                        <select id="filterTeamLocation" onchange="filterTeams()">
                            <option value="all">Todas Localizações</option>
                            <option value="germany">Alemanha</option>
                            <option value="portugal">Portugal</option>
                        </select>
                        <select id="filterTeamStatus" onchange="filterTeams()">
                            <option value="all">Todos Estados</option>
                            <option value="active">Ativas</option>
                            <option value="inactive">Inativas</option>
                        </select>
                    </div>

                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Equipa</th>
                                <th>Localização</th>
                                <th>Chefe</th>
                                <th>Membros</th>
                                <th>Obra Atual</th>
                                <th>GPS Atual</th>
                                <th>Estado</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="bossTeamsTable">
                            <!-- Equipas serão carregadas aqui -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Pessoal -->
            <div class="dashboard-section" id="bossPeopleSection">
                <div class="content-card">
                    <div class="card-header">
                        <h3><i class="fas fa-user-friends"></i> Gestão de Pessoal</h3>
                        <button class="btn-dashboard btn-success" onclick="openEmployeeModal()">
                            <i class="fas fa-plus"></i> Adicionar Pessoa
                        </button>
                    </div>

                    <div class="filter-bar">
                        <input type="text" id="bossSearchPerson" placeholder="Pesquisar nome..." onkeyup="searchBossPeople()">
                        <select id="bossFilterDept" onchange="searchBossPeople()">
                            <option value="all">Todos Departamentos</option>
                            <option value="obra">Obra</option>
                            <option value="escritorio">Escritório</option>
                            <option value="compras">Compras</option>
                        </select>
                        <select id="bossFilterStatus" onchange="searchBossPeople()">
                            <option value="all">Todos Estados</option>
                            <option value="active">Ativos</option>
                            <option value="inactive">Inativos</option>
                        </select>
                    </div>

                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Nome</th>
                                <th>WhatsApp</th>
                                <th>Cargo</th>
                                <th>Departamento</th>
                                <th>Equipa</th>
                                <th>Estado</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="bossPeopleTable">
                            <!-- Pessoal será carregado aqui -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Compras -->
            <div class="dashboard-section" id="bossPurchasesSection">
                <div class="content-card">
                    <div class="card-header">
                        <h3><i class="fas fa-shopping-cart"></i> Controle de Compras</h3>
                        <button class="btn-dashboard btn-info" onclick="generatePurchaseReport()">
                            <i class="fas fa-file-excel"></i> Exportar Excel
                        </button>
                    </div>

                    <div class="filter-bar">
                        <select id="filterPurchaseStatus" onchange="filterPurchases()">
                            <option value="all">Todos Estados</option>
                            <option value="pending">Pendentes</option>
                            <option value="approved">Aprovadas</option>
                            <option value="completed">Completadas</option>
                        </select>
                        <input type="date" id="filterPurchaseDateFrom" onchange="filterPurchases()">
                        <input type="date" id="filterPurchaseDateTo" onchange="filterPurchases()">
                        <input type="text" id="searchPurchase" placeholder="Pesquisar..." onkeyup="filterPurchases()">
                    </div>

                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Nº Pedido</th>
                                <th>Equipa</th>
                                <th>Material</th>
                                <th>Quantidade</th>
                                <th>Valor</th>
                                <th>Data Pedido</th>
                                <th>Estado</th>
                                <th>Responsável</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="bossPurchasesTable">
                            <!-- Compras serão carregadas aqui -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- GPS Localizações -->
            <div class="dashboard-section" id="bossGPSSection">
                <div class="content-card">
                    <div class="card-header">
                        <h3><i class="fas fa-map-marker-alt"></i> Localizações GPS das Obras</h3>
                        <button class="btn-dashboard btn-primary" onclick="refreshGPSLocations()">
                            <i class="fas fa-sync-alt"></i> Atualizar
                        </button>
                    </div>

                    <div class="filter-bar">
                        <select id="filterGPSTeam" onchange="filterGPSLocations()">
                            <option value="all">Todas Equipas</option>
                        </select>
                        <input type="date" id="filterGPSDate" onchange="filterGPSLocations()" value="<?php echo date('Y-m-d'); ?>">
                    </div>

                    <div id="bossGPSLocations">
                        <!-- Localizações serão carregadas aqui -->
                    </div>
                </div>
            </div>

            <!-- Auditoria -->
            <div class="dashboard-section" id="bossAuditSection">
                <div class="content-card">
                    <div class="card-header">
                        <h3><i class="fas fa-shield-alt"></i> Log de Auditoria</h3>
                        <button class="btn-dashboard btn-danger" onclick="clearAuditLog()">
                            <i class="fas fa-trash"></i> Limpar Log
                        </button>
                    </div>

                    <div class="filter-bar">
                        <input type="date" id="auditDateFrom" onchange="filterAudit()">
                        <input type="date" id="auditDateTo" onchange="filterAudit()">
                        <select id="auditUserFilter" onchange="filterAudit()">
                            <option value="all">Todos Utilizadores</option>
                        </select>
                        <select id="auditActionFilter" onchange="filterAudit()">
                            <option value="all">Todas Ações</option>
                            <option value="login">Login</option>
                            <option value="logout">Logout</option>
                            <option value="time_entry">Entrada</option>
                            <option value="time_exit">Saída</option>
                            <option value="gps">GPS</option>
                        </select>
                    </div>

                    <div style="max-height: 500px; overflow-y: auto;">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Data/Hora</th>
                                    <th>Utilizador</th>
                                    <th>Ação</th>
                                    <th>Detalhes</th>
                                    <th>Módulo</th>
                                </tr>
                            </thead>
                            <tbody id="bossAuditTable">
                                <!-- Log de auditoria será carregado aqui -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- MENU NO FUNDO PARA PATRÃO -->
        <nav class="bottom-menu">
            <div class="bottom-menu-container">
                <a href="#" class="bottom-menu-item active" data-section="bossOverview">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Visão Geral</span>
                </a>
                <a href="#" class="bottom-menu-item" data-section="bossHours">
                    <i class="fas fa-clock"></i>
                    <span>Controlo Horas</span>
                    <span class="bottom-menu-badge" id="hoursBadge">0</span>
                </a>
                <a href="#" class="bottom-menu-item" data-section="bossTeams">
                    <i class="fas fa-users"></i>
                    <span>Equipas</span>
                    <span class="bottom-menu-badge" id="teamsBadge">0</span>
                </a>
                <a href="#" class="bottom-menu-item" data-section="bossPeople">
                    <i class="fas fa-user-friends"></i>
                    <span>Pessoal</span>
                </a>
                <a href="#" class="bottom-menu-item" data-section="bossGPS">
                    <i class="fas fa-map-marker-alt"></i>
                    <span>GPS Obras</span>
                </a>
                <a href="#" class="bottom-menu-item" data-section="bossAudit">
                    <i class="fas fa-shield-alt"></i>
                    <span>Auditoria</span>
                </a>
            </div>
        </nav>
    </div>

    <!-- ============ DASHBOARD ESCRITÓRIO ============ -->
    <div class="dashboard office-dashboard" id="officeDashboard">
        <!-- Top Bar -->
        <div class="top-bar">
            <div class="container top-bar-content">
                <div class="dashboard-brand">
                    <i class="fas fa-building"></i>
                    <h1>Escritório - MAFC</h1>
                </div>
                <div class="dashboard-info">
                    <div class="user-info">
                        <i class="fas fa-user-tie"></i>
                        <span id="officeUserName">Escritório</span>
                    </div>
                    <div id="officeCurrentTime" style="font-weight: 600;">10:45 AM</div>
                    <button class="logout-btn" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i> Sair
                    </button>
                </div>
            </div>
        </div>

        <!-- Conteúdo -->
        <div class="dashboard-content">
            <!-- Dashboard Escritório -->
            <div class="dashboard-section active" id="officeDashboardSection">
                <div class="stats-row">
                    <div class="stat-card-horizontal">
                        <div class="stat-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="officePeopleCount">0</h3>
                            <p>Pessoal Escritório</p>
                        </div>
                    </div>
                    <div class="stat-card-horizontal">
                        <div class="stat-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="officeTodayHours">0</h3>
                            <p>Horas Hoje</p>
                        </div>
                    </div>
                    <div class="stat-card-horizontal">
                        <div class="stat-icon">
                            <i class="fas fa-file-alt"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="officeDocumentsCount">0</h3>
                            <p>Documentos</p>
                        </div>
                    </div>
                    <div class="stat-card-horizontal">
                        <div class="stat-icon">
                            <i class="fas fa-print"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="officePrintsToday">0</h3>
                            <p>Impressões</p>
                        </div>
                    </div>
                </div>

                <!-- Sistema de Marcação de Horas OBRIGATÓRIA -->
                <div class="content-card" style="margin-top: 30px;">
                    <div class="card-header">
                        <h3><i class="fas fa-clock"></i> Marcação de Horas - OBRIGATÓRIA</h3>
                        <div class="time-display" id="officeClock">08:45:23</div>
                    </div>

                    <div class="time-tracker">
                        <div class="time-buttons">
                            <button class="btn-dashboard btn-success" onclick="markAllEntry()">
                                <i class="fas fa-sign-in-alt"></i> Entrada Geral
                            </button>
                            <button class="btn-dashboard btn-warning" onclick="markAllBreak()">
                                <i class="fas fa-coffee"></i> Pausa Geral
                            </button>
                            <button class="btn-dashboard btn-danger" onclick="markAllExit()">
                                <i class="fas fa-sign-out-alt"></i> Saída Geral
                            </button>
                        </div>
                    </div>

                    <div style="margin-top: 20px;">
                        <h4><i class="fas fa-list-check"></i> Estado Atual das Marcações (OBRIGATÓRIO)</h4>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Nome</th>
                                    <th>Entrada</th>
                                    <th>Saída</th>
                                    <th>Pausa</th>
                                    <th>Total</th>
                                    <th>Status</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody id="allEmployeesTime">
                                <!-- Todos os funcionários serão listados aqui -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Gestão de Pessoal -->
            <div class="dashboard-section" id="officePeopleSection">
                <div class="content-card">
                    <div class="card-header">
                        <h3><i class="fas fa-user-plus"></i> Gestão de Pessoal (Adicionar/Remover)</h3>
                        <button class="btn-dashboard btn-success" onclick="openEmployeeModal()">
                            <i class="fas fa-plus"></i> Adicionar Pessoa
                        </button>
                    </div>

                    <div class="filter-bar">
                        <input type="text" id="officeSearchPerson" placeholder="Pesquisar nome..." onkeyup="searchOfficePeople()">
                        <select id="officeFilterDept" onchange="searchOfficePeople()">
                            <option value="all">Todos Departamentos</option>
                            <option value="escritorio">Escritório</option>
                            <option value="contabilidade">Contabilidade</option>
                            <option value="rh">RH</option>
                        </select>
                        <select id="officeFilterStatus" onchange="searchOfficePeople()">
                            <option value="all">Todos Estados</option>
                            <option value="active">Ativos</option>
                            <option value="inactive">Inativos</option>
                        </select>
                    </div>

                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Nome</th>
                                <th>WhatsApp</th>
                                <th>Cargo</th>
                                <th>Departamento</th>
                                <th>Estado</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="officePeopleTable">
                            <!-- Pessoal será carregado aqui -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Marcar Horas Individual OBRIGATÓRIA -->
            <div class="dashboard-section" id="officeTimeSection">
                <div class="content-card">
                    <div class="card-header">
                        <h3><i class="fas fa-clock"></i> Marcação Individual de Horas (OBRIGATÓRIA)</h3>
                        <div class="time-display" style="font-size: 2.5rem; color: var(--office);" id="officeClockIndividual">
                            08:45:23
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group-dashboard">
                            <label>Selecione a Pessoa *</label>
                            <select id="officePersonSelect" onchange="loadPersonWhatsApp()" required>
                                <option value="">Selecione uma pessoa</option>
                            </select>
                        </div>
                        <div class="form-group-dashboard">
                            <label>WhatsApp</label>
                            <input type="text" id="officePersonWhatsApp" readonly placeholder="Selecione uma pessoa">
                        </div>
                        <div class="form-group-dashboard">
                            <label>Tipo de Marcação *</label>
                            <select id="officeTimeType" required>
                                <option value="entry">Entrada</option>
                                <option value="exit">Saída</option>
                                <option value="break_start">Início Pausa</option>
                                <option value="break_end">Fim Pausa</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button class="btn-dashboard btn-success" onclick="registerOfficeTime()">
                            <i class="fas fa-check"></i> Registar Marcação (OBRIGATÓRIO)
                        </button>
                        <button class="btn-dashboard btn-whatsapp" onclick="sendTimeWhatsApp()">
                            <i class="fab fa-whatsapp"></i> Notificar WhatsApp (OPCIONAL)
                        </button>
                    </div>

                    <div style="margin-top: 30px;">
                        <h3><i class="fas fa-history"></i> Marcações do Dia</h3>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Nome</th>
                                    <th>Entrada</th>
                                    <th>Saída</th>
                                    <th>Pausa</th>
                                    <th>Total</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody id="officeDailyMarks">
                                <!-- Marcações diárias serão carregadas aqui -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Meu Extrato com Impressão para Contabilidade OBRIGATÓRIA -->
            <div class="dashboard-section" id="officeReportsSection">
                <div class="content-card">
                    <div class="card-header">
                        <h3><i class="fas fa-file-invoice"></i> Extrato Mensal para Contabilidade (OBRIGATÓRIO)</h3>
                        <button class="btn-dashboard btn-primary" onclick="generateOfficeReport()">
                            <i class="fas fa-sync-alt"></i> Gerar Extrato
                        </button>
                    </div>

                    <div class="form-row">
                        <div class="form-group-dashboard">
                            <label>Mês/Ano *</label>
                            <select id="officeReportMonth" required>
                                <option value="">Selecione mês/ano</option>
                                <option value="<?php echo date('m-Y'); ?>"><?php echo date('m/Y'); ?> (Atual)</option>
                                <option value="<?php echo date('m-Y', strtotime('-1 month')); ?>"><?php echo date('m/Y', strtotime('-1 month')); ?></option>
                                <option value="<?php echo date('m-Y', strtotime('-2 month')); ?>"><?php echo date('m/Y', strtotime('-2 month')); ?></option>
                            </select>
                        </div>
                        <div class="form-group-dashboard">
                            <label>Pessoa *</label>
                            <select id="officeReportPerson" required>
                                <option value="all">Todas as Pessoas</option>
                            </select>
                        </div>
                        <div class="form-group-dashboard">
                            <label>Formato *</label>
                            <select id="reportFormat" required>
                                <option value="print">Imprimir</option>
                                <option value="pdf">PDF</option>
                                <option value="excel">Excel</option>
                            </select>
                        </div>
                    </div>

                    <div class="monthly-report">
                        <div class="report-header">
                            <h4 id="officeReportTitle">Selecione mês e pessoa</h4>
                            <span class="badge badge-info" id="officeTotalHours">-- horas</span>
                        </div>
                        
                        <table class="time-sheet-table" id="officeTimeSheet">
                            <thead>
                                <tr>
                                    <th>Data</th>
                                    <th>Nome</th>
                                    <th>Entrada</th>
                                    <th>Saída</th>
                                    <th>Horas Normais</th>
                                    <th>Horas Extra</th>
                                    <th>Total</th>
                                </tr>
                            </thead>
                            <tbody id="officeReportBody">
                                <!-- Dados do extrato serão carregados aqui -->
                            </tbody>
                        </table>
                        
                        <div class="report-actions">
                            <button class="btn-dashboard btn-primary" onclick="printOfficeReportForAccounting()">
                                <i class="fas fa-print"></i> IMPRIMIR para Contabilidade (OBRIGATÓRIO)
                            </button>
                            <button class="btn-dashboard btn-whatsapp" onclick="sendToAccountingWhatsApp()">
                                <i class="fab fa-whatsapp"></i> Enviar WhatsApp (OPCIONAL)
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- MENU NO FUNDO PARA ESCRITÓRIO -->
        <nav class="bottom-menu">
            <div class="bottom-menu-container">
                <a href="#" class="bottom-menu-item active" data-section="officeDashboard">
                    <i class="fas fa-home"></i>
                    <span>Dashboard</span>
                </a>
                <a href="#" class="bottom-menu-item" data-section="officePeople">
                    <i class="fas fa-user-plus"></i>
                    <span>Pessoal</span>
                </a>
                <a href="#" class="bottom-menu-item" data-section="officeTime">
                    <i class="fas fa-clock"></i>
                    <span>Marcar Horas</span>
                </a>
                <a href="#" class="bottom-menu-item" data-section="officeReports">
                    <i class="fas fa-file-alt"></i>
                    <span>Meu Extrato</span>
                </a>
            </div>
        </nav>
    </div>

    <!-- ============ DASHBOARD CHEFE DE EQUIPA ============ -->
    <div class="dashboard team-dashboard" id="teamDashboard">
        <!-- Top Bar -->
        <div class="top-bar">
            <div class="container top-bar-content">
                <div class="dashboard-brand">
                    <i class="fas fa-hard-hat"></i>
                    <h1>Chefe de Equipa - MAFC</h1>
                </div>
                <div class="dashboard-info">
                    <div class="user-info">
                        <i class="fas fa-user-hard-hat"></i>
                        <span id="teamUserName">Equipa</span>
                        <span class="team-location-badge" id="teamLocationBadge">
                            <i class="fas fa-map-marker-alt"></i> Localização
                        </span>
                    </div>
                    <div id="teamCurrentTime" style="font-weight: 600;">10:45 AM</div>
                    <button class="logout-btn" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i> Sair
                    </button>
                </div>
            </div>
        </div>

        <!-- Conteúdo -->
        <div class="dashboard-content">
            <!-- Visão Geral Equipa -->
            <div class="dashboard-section active" id="teamOverviewSection">
                <div class="stats-row">
                    <div class="stat-card-horizontal">
                        <div class="stat-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="teamMembersCount">0</h3>
                            <p>Membros</p>
                        </div>
                    </div>
                    <div class="stat-card-horizontal">
                        <div class="stat-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="teamHoursToday">0</h3>
                            <p>Horas Hoje</p>
                        </div>
                    </div>
                    <div class="stat-card-horizontal">
                        <div class="stat-icon">
                            <i class="fas fa-map-marker-alt"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="teamGPSStatus">Off</h3>
                            <p>GPS</p>
                        </div>
                    </div>
                    <div class="stat-card-horizontal">
                        <div class="stat-icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="teamWorkStatus">-</h3>
                            <p>Status Obra</p>
                        </div>
                    </div>
                </div>

                <!-- Sistema de Marcação de Horas OBRIGATÓRIA para Equipa -->
                <div class="content-card" style="margin-top: 30px;">
                    <div class="card-header">
                        <h3><i class="fas fa-clock"></i> Marcação de Horas da Equipa (OBRIGATÓRIA)</h3>
                        <div class="time-display" style="font-size: 2rem; color: var(--team);">
                            <span id="teamCurrentTimeDisplay">08:45</span>
                        </div>
                    </div>

                    <div class="time-tracker">
                        <div class="time-buttons">
                            <button class="btn-dashboard btn-success" onclick="markTeamEntry()">
                                <i class="fas fa-sign-in-alt"></i> Entrada da Equipa
                            </button>
                            <button class="btn-dashboard btn-warning" onclick="markTeamBreak()">
                                <i class="fas fa-coffee"></i> Pausa da Equipa
                            </button>
                            <button class="btn-dashboard btn-danger" onclick="markTeamExit()">
                                <i class="fas fa-sign-out-alt"></i> Saída da Equipa
                            </button>
                        </div>
                    </div>

                    <div style="margin-top: 20px;">
                        <h4><i class="fas fa-users"></i> Membros da Equipa - Marcações Hoje</h4>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Nome</th>
                                    <th>Entrada</th>
                                    <th>Saída</th>
                                    <th>Pausa</th>
                                    <th>Total</th>
                                    <th>Status</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody id="teamMembersTime">
                                <!-- Membros da equipa serão listados aqui -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Sistema GPS OBRIGATÓRIO para Equipa -->
                <div class="content-card" style="margin-top: 30px;">
                    <div class="card-header">
                        <h3><i class="fas fa-map-marker-alt"></i> Localização GPS da Obra (OBRIGATÓRIO)</h3>
                        <button class="btn-dashboard btn-primary" onclick="openGPSModal()">
                            <i class="fas fa-crosshairs"></i> Atualizar Localização
                        </button>
                    </div>

                    <div class="gps-tracker">
                        <div class="gps-info">
                            <i class="fas fa-satellite fa-2x"></i>
                            <div>
                                <h3>Localização Atual da Obra</h3>
                                <div class="gps-coordinates" id="teamCurrentGPS">
                                    Aguardando GPS...
                                </div>
                            </div>
                        </div>
                        <div class="time-buttons">
                            <button class="btn-dashboard btn-success" onclick="getTeamLocation()">
                                <i class="fas fa-crosshairs"></i> Obter GPS Atual
                            </button>
                            <button class="btn-dashboard btn-whatsapp" onclick="sendTeamGPSToBoss()">
                                <i class="fab fa-whatsapp"></i> Enviar para Patrão (OPCIONAL)
                            </button>
                        </div>
                    </div>

                    <div style="margin-top: 20px;">
                        <h4><i class="fas fa-history"></i> Histórico de Localizações Hoje</h4>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Hora</th>
                                    <th>Localização</th>
                                    <th>Obra</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody id="teamGPSHistory">
                                <!-- Histórico GPS será carregado aqui -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Gestão da Equipa -->
            <div class="dashboard-section" id="teamManagementSection">
                <div class="content-card">
                    <div class="card-header">
                        <h3><i class="fas fa-cogs"></i> Gestão da Equipa</h3>
                        <button class="btn-dashboard btn-primary" onclick="updateTeamInfo()">
                            <i class="fas fa-save"></i> Atualizar Informações
                        </button>
                    </div>

                    <div class="form-row">
                        <div class="form-group-dashboard">
                            <label>Nome da Equipa *</label>
                            <input type="text" id="teamName" placeholder="Ex: Equipa 01 - Berlin" required>
                        </div>
                        <div class="form-group-dashboard">
                            <label>Localidade *</label>
                            <input type="text" id="teamLocation" placeholder="Ex: Berlin, Alemanha" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group-dashboard">
                            <label>Obra Atual *</label>
                            <input type="text" id="teamCurrentWork" placeholder="Ex: Pavimentação Avenida Central" required>
                        </div>
                        <div class="form-group-dashboard">
                            <label>Status da Obra *</label>
                            <select id="teamWorkStatus" required>
                                <option value="active">Em Andamento</option>
                                <option value="paused">Pausada</option>
                                <option value="completed">Concluída</option>
                                <option value="delayed">Atrasada</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group-dashboard">
                        <label>Observações</label>
                        <textarea id="teamNotes" rows="3" placeholder="Observações sobre a obra..."></textarea>
                    </div>

                    <div class="form-actions">
                        <button class="btn-dashboard btn-success" onclick="saveTeamInfo()">
                            <i class="fas fa-save"></i> Guardar Informações
                        </button>
                        <button class="btn-dashboard btn-whatsapp" onclick="sendTeamUpdateToBoss()">
                            <i class="fab fa-whatsapp"></i> Reportar ao Patrão
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- MENU NO FUNDO PARA CHEFE DE EQUIPA -->
        <nav class="bottom-menu">
            <div class="bottom-menu-container">
                <a href="#" class="bottom-menu-item active" data-section="teamOverview">
                    <i class="fas fa-home"></i>
                    <span>Visão Geral</span>
                </a>
                <a href="#" class="bottom-menu-item" data-section="teamManagement">
                    <i class="fas fa-cogs"></i>
                    <span>Gestão Equipa</span>
                </a>
            </div>
        </nav>
    </div>

    <!-- ============ DASHBOARD COMPRAS ============ -->
    <div class="dashboard purchase-dashboard" id="purchaseDashboard">
        <!-- Top Bar -->
        <div class="top-bar">
            <div class="container top-bar-content">
                <div class="dashboard-brand">
                    <i class="fas fa-shopping-cart"></i>
                    <h1>Compras - MAFC</h1>
                </div>
                <div class="dashboard-info">
                    <div class="user-info">
                        <i class="fas fa-user-tie"></i>
                        <span id="purchaseUserName">Compras</span>
                    </div>
                    <div id="purchaseCurrentTime" style="font-weight: 600;">10:45 AM</div>
                    <button class="logout-btn" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i> Sair
                    </button>
                </div>
            </div>
        </div>

        <!-- Conteúdo -->
        <div class="dashboard-content">
            <!-- Dashboard Compras -->
            <div class="dashboard-section active" id="purchaseDashboardSection">
                <div class="stats-row">
                    <div class="stat-card-horizontal">
                        <div class="stat-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="purchasePendingCount">0</h3>
                            <p>Pendentes</p>
                        </div>
                    </div>
                    <div class="stat-card-horizontal">
                        <div class="stat-icon">
                            <i class="fas fa-check"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="purchaseApprovedCount">0</h3>
                            <p>Aprovados</p>
                        </div>
                    </div>
                    <div class="stat-card-horizontal">
                        <div class="stat-icon">
                            <i class="fas fa-check-double"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="purchaseCompletedCount">0</h3>
                            <p>Concluídos</p>
                        </div>
                    </div>
                    <div class="stat-card-horizontal">
                        <div class="stat-icon">
                            <i class="fas fa-euro-sign"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="purchaseMonthValue">€0</h3>
                            <p>Valor Mês</p>
                        </div>
                    </div>
                </div>

                <div class="content-card">
                    <div class="card-header">
                        <h3><i class="fas fa-clipboard-list"></i> Sistema de Compras (MANTIDO COMO ESTAVA)</h3>
                        <button class="btn-dashboard btn-primary" onclick="newPurchaseOrder()">
                            <i class="fas fa-plus"></i> Nova Ordem
                        </button>
                    </div>
                    
                    <p style="color: #666; margin-bottom: 20px;">Sistema mantido conforme configuração anterior. Todas as funcionalidades preservadas.</p>
                    
                    <div class="filter-bar">
                        <select id="filterPurchaseDashboardStatus" onchange="filterPurchaseDashboard()">
                            <option value="all">Todos Estados</option>
                            <option value="pending">Pendentes</option>
                            <option value="approved">Aprovados</option>
                            <option value="completed">Concluídos</option>
                        </select>
                        <input type="date" id="filterPurchaseDashboardDate" value="<?php echo date('Y-m-d'); ?>" onchange="filterPurchaseDashboard()">
                    </div>

                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Nº Pedido</th>
                                <th>Equipa</th>
                                <th>Material</th>
                                <th>Quantidade</th>
                                <th>Data</th>
                                <th>Estado</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="purchaseDashboardTable">
                            <!-- Compras serão carregadas aqui -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Marcação de Horas OBRIGATÓRIA para Compras -->
            <div class="dashboard-section" id="purchaseTimeSection">
                <div class="content-card">
                    <div class="card-header">
                        <h3><i class="fas fa-clock"></i> Marcação de Horas (OBRIGATÓRIA)</h3>
                        <div class="time-display" style="font-size: 2rem; color: var(--purchase);">
                            <span id="purchaseCurrentTimeDisplay">08:45</span>
                        </div>
                    </div>

                    <div class="time-tracker">
                        <div class="time-buttons">
                            <button class="btn-dashboard btn-success" onclick="markPurchaseEntry()">
                                <i class="fas fa-sign-in-alt"></i> Minha Entrada
                            </button>
                            <button class="btn-dashboard btn-warning" onclick="markPurchaseBreak()">
                                <i class="fas fa-coffee"></i> Minha Pausa
                            </button>
                            <button class="btn-dashboard btn-danger" onclick="markPurchaseExit()">
                                <i class="fas fa-sign-out-alt"></i> Minha Saída
                            </button>
                        </div>
                    </div>

                    <div style="margin-top: 20px;">
                        <h4><i class="fas fa-history"></i> Meu Registo de Hoje</h4>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Tipo</th>
                                    <th>Hora</th>
                                    <th>Data</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="purchaseMyTime">
                                <!-- Marcações pessoais serão carregadas aqui -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- MENU NO FUNDO PARA COMPRAS -->
        <nav class="bottom-menu">
            <div class="bottom-menu-container">
                <a href="#" class="bottom-menu-item active" data-section="purchaseDashboard">
                    <i class="fas fa-home"></i>
                    <span>Compras</span>
                </a>
                <a href="#" class="bottom-menu-item" data-section="purchaseTime">
                    <i class="fas fa-clock"></i>
                    <span>Minhas Horas</span>
                </a>
            </div>
        </nav>
    </div>

    <script>
        // ============ SISTEMA COMPLETO MAFC ============
        
        const MAFCSystem = {
            currentUser: null,
            editingEmployeeId: null,
            editingPurchaseId: null,
            editingSupplierId: null,
            selectedClearOption: null,
            
            // Credenciais
            credentials: {
                boss: [
                    { code: 'mafc', password: '1234', name: 'Administrador' },
                    { code: 'admin', password: 'admin123', name: 'Gestor Geral' }
                ],
                team: [
                    { code: 'equipa01', password: '1234', name: 'João Silva', team: 'Equipa 01 - Berlin', location: 'Berlin, Alemanha' },
                    { code: 'equipa02', password: '1234', name: 'Carlos Mendes', team: 'Equipa 02 - Hamburg', location: 'Hamburg, Alemanha' },
                    { code: 'equipa03', password: '1234', name: 'António Santos', team: 'Equipa 03 - Lisboa', location: 'Lisboa, Portugal' },
                    { code: 'equipa04', password: '1234', name: 'Miguel Costa', team: 'Equipa 04 - Porto', location: 'Porto, Portugal' },
                    { code: 'equipa05', password: '1234', name: 'Ricardo Oliveira', team: 'Equipa 05 - Frankfurt', location: 'Frankfurt, Alemanha' },
                    { code: 'equipa06', password: '1234', name: 'Pedro Martins', team: 'Equipa 06 - Munique', location: 'Munique, Alemanha' },
                    { code: 'equipa07', password: '1234', name: 'Francisco Lima', team: 'Equipa 07 - Colônia', location: 'Colônia, Alemanha' },
                    { code: 'equipa08', password: '1234', name: 'Jorge Silva', team: 'Equipa 08 - Estugarda', location: 'Estugarda, Alemanha' },
                    { code: 'equipa09', password: '1234', name: 'Rui Pereira', team: 'Equipa 09 - Düsseldorf', location: 'Düsseldorf, Alemanha' },
                    { code: 'equipa10', password: '1234', name: 'Luís Fernandes', team: 'Equipa 10 - Essen', location: 'Essen, Alemanha' },
                    { code: 'equipa11', password: '1234', name: 'Hugo Rodrigues', team: 'Equipa 11 - Dortmund', location: 'Dortmund, Alemanha' },
                    { code: 'equipa12', password: '1234', name: 'Bruno Sousa', team: 'Equipa 12 - Bremen', location: 'Bremen, Alemanha' },
                    { code: 'equipa13', password: '1234', name: 'Paulo Gomes', team: 'Equipa 13 - Hanôver', location: 'Hanôver, Alemanha' },
                    { code: 'equipa14', password: '1234', name: 'Vítor Lopes', team: 'Equipa 14 - Nuremberga', location: 'Nuremberga, Alemanha' },
                    { code: 'equipa15', password: '1234', name: 'André Marques', team: 'Equipa 15 - Leipzig', location: 'Leipzig, Alemanha' }
                ],
                purchase: [
                    { code: 'compras01', password: '1234', name: 'Responsável Compras' },
                    { code: 'compras', password: '1234', name: 'Ana Compras' }
                ],
                office: [
                    { code: 'escritorio', password: '1234', name: 'Maria Silva' },
                    { code: 'contabilidade', password: '1234', name: 'Ana Costa' }
                ]
            },
            
            // Dados do sistema
            employees: [],
            timeRecords: {},
            gpsLocations: [],
            materialRequests: [],
            purchases: [],
            teams: [],
            auditLog: [],
            
            // Inicializar dados
            init: function() {
                this.loadFromStorage();
                
                // Inicializar dados padrão se necessário
                if (this.employees.length === 0) {
                    this.employees = [
                        { id: 1, name: 'Maria Silva', whatsapp: '+351912345678', position: 'Administrativa', department: 'escritorio', team: '', status: 'active', startDate: '2023-01-15' },
                        { id: 2, name: 'Ana Costa', whatsapp: '+351912345679', position: 'Contabilista', department: 'contabilidade', team: '', status: 'active', startDate: '2022-03-10' },
                        { id: 3, name: 'João Silva', whatsapp: '+351912345680', position: 'Chefe Equipa', department: 'obra', team: 'equipa01', status: 'active', startDate: '2021-05-20' },
                        { id: 4, name: 'Carlos Mendes', whatsapp: '+351912345681', position: 'Chefe Equipa', department: 'obra', team: 'equipa02', status: 'active', startDate: '2021-06-15' },
                        { id: 5, name: 'Operário 01', whatsapp: '+351912345682', position: 'Operário', department: 'obra', team: 'equipa01', status: 'active', startDate: '2023-03-01' },
                        { id: 6, name: 'Operário 02', whatsapp: '+351912345683', position: 'Operário', department: 'obra', team: 'equipa01', status: 'active', startDate: '2023-03-01' },
                        { id: 7, name: 'Responsável Compras', whatsapp: '+351912345684', position: 'Responsável Compras', department: 'compras', team: '', status: 'active', startDate: '2022-01-15' }
                    ];
                }
                
                if (this.teams.length === 0) {
                    this.teams = [
                        { id: 1, name: 'Equipa 01 - Berlin', location: 'Berlin, Alemanha', leader: 'João Silva', members: 3, currentWork: 'Pavimentação Avenida Central', status: 'active', gps: '52.5200° N, 13.4050° E', lastGPSUpdate: new Date().toISOString() },
                        { id: 2, name: 'Equipa 02 - Hamburg', location: 'Hamburg, Alemanha', leader: 'Carlos Mendes', members: 4, currentWork: 'Sistema de Saneamento', status: 'active', gps: '53.5511° N, 9.9937° E', lastGPSUpdate: new Date().toISOString() },
                        { id: 3, name: 'Equipa 03 - Lisboa', location: 'Lisboa, Portugal', leader: 'António Santos', members: 5, currentWork: 'Rede Fibra Óptica', status: 'active', gps: '38.7223° N, 9.1393° W', lastGPSUpdate: new Date().toISOString() }
                    ];
                }
                
                this.saveToStorage();
            },
            
            // Salvar no localStorage
            saveToStorage: function() {
                const data = {
                    employees: this.employees,
                    timeRecords: this.timeRecords,
                    gpsLocations: this.gpsLocations,
                    materialRequests: this.materialRequests,
                    purchases: this.purchases,
                    teams: this.teams,
                    auditLog: this.auditLog
                };
                localStorage.setItem('mafcSystem', JSON.stringify(data));
            },
            
            // Carregar do localStorage
            loadFromStorage: function() {
                const data = JSON.parse(localStorage.getItem('mafcSystem'));
                if (data) {
                    this.employees = data.employees || [];
                    this.timeRecords = data.timeRecords || {};
                    this.gpsLocations = data.gpsLocations || [];
                    this.materialRequests = data.materialRequests || [];
                    this.purchases = data.purchases || [];
                    this.teams = data.teams || [];
                    this.auditLog = data.auditLog || [];
                }
            },
            
            // Log de auditoria
            logAudit: function(action, details, module = 'system') {
                const logEntry = {
                    id: Date.now(),
                    timestamp: new Date().toISOString(),
                    user: this.currentUser ? this.currentUser.name : 'system',
                    userRole: this.currentUser ? this.currentUser.role : 'system',
                    action: action,
                    details: details,
                    module: module
                };
                
                this.auditLog.unshift(logEntry);
                
                // Manter apenas últimos 1000 registos
                if (this.auditLog.length > 1000) this.auditLog.pop();
                
                this.saveToStorage();
            }
        };
        
        // ============ INICIALIZAÇÃO ============
        document.addEventListener('DOMContentLoaded', function() {
            MAFCSystem.init();
            updateClocks();
            setInterval(updateClocks, 1000);
            
            // Event listeners
            document.getElementById('openLogin').addEventListener('click', function(e) {
                e.preventDefault();
                openLoginModal();
            });
            
            document.getElementById('openLoginFromHero').addEventListener('click', function(e) {
                e.preventDefault();
                openLoginModal();
            });
            
            document.querySelector('.close-modal').addEventListener('click', function() {
                closeLoginModal();
            });
            
            window.addEventListener('click', function(e) {
                if (e.target === document.getElementById('loginModal')) {
                    closeLoginModal();
                }
            });
            
            // Login form
            document.getElementById('loginForm').addEventListener('submit', function(e) {
                e.preventDefault();
                handleLogin();
            });
            
            // Menu navigation
            document.querySelectorAll('.bottom-menu-item').forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    const dashboard = this.closest('.dashboard');
                    const sectionId = this.getAttribute('data-section') + 'Section';
                    
                    // Remover active de todos os items do mesmo dashboard
                    dashboard.querySelectorAll('.bottom-menu-item').forEach(i => {
                        i.classList.remove('active');
                    });
                    
                    // Adicionar active ao item clicado
                    this.classList.add('active');
                    
                    // Esconder todas as seções do dashboard
                    dashboard.querySelectorAll('.dashboard-section').forEach(section => {
                        section.classList.remove('active');
                    });
                    
                    // Mostrar seção selecionada
                    const section = document.getElementById(sectionId);
                    if (section) {
                        section.classList.add('active');
                        loadSectionData(sectionId);
                    }
                });
            });
            
            // Fechar modais
            document.querySelectorAll('.close-modal-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const modal = this.closest('.modal-employee, .modal-gps, .modal-clear-history');
                    if (modal) modal.style.display = 'none';
                });
            });
            
            // Fechar modais ao clicar fora
            window.addEventListener('click', function(e) {
                if (e.target.classList.contains('modal-employee')) {
                    document.getElementById('employeeModal').style.display = 'none';
                }
                if (e.target.classList.contains('modal-gps')) {
                    document.getElementById('gpsModal').style.display = 'none';
                }
                if (e.target.classList.contains('modal-clear-history')) {
                    document.getElementById('clearHistoryModal').style.display = 'none';
                }
            });
            
            // Tecla ESC fecha modais
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    closeAllModals();
                }
            });
        });
        
        function openLoginModal() {
            document.getElementById('loginModal').style.display = 'flex';
        }
        
        function closeLoginModal() {
            document.getElementById('loginModal').style.display = 'none';
        }
        
        function closeAllModals() {
            document.querySelectorAll('.modal, .modal-employee, .modal-gps, .modal-clear-history').forEach(modal => {
                modal.style.display = 'none';
            });
        }
        
        // ============ FUNÇÕES DE LOGIN ============
        function handleLogin() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const role = document.getElementById('role').value;
            
            let userFound = null;
            
            if (role && MAFCSystem.credentials[role]) {
                userFound = MAFCSystem.credentials[role].find(u => 
                    u.code === username && u.password === password
                );
            }
            
            if (userFound) {
                MAFCSystem.currentUser = { ...userFound, role };
                MAFCSystem.logAudit('login', `Login realizado como ${role}`);
                loginSuccess();
            } else {
                alert('Credenciais incorretas! Utilize:\n\nADMIN: mafc / 1234\nEQUIPAS: equipa01 a equipa15 / 1234\nCOMPRAS: compras01 / 1234\nESCRITÓRIO: escritorio / 1234');
            }
        }
        
        function loginSuccess() {
            closeLoginModal();
            document.getElementById('publicWebsite').style.display = 'none';
            
            // Mostrar dashboard apropriado
            switch(MAFCSystem.currentUser.role) {
                case 'boss':
                    showBossDashboard();
                    break;
                case 'team':
                    showTeamDashboard();
                    break;
                case 'purchase':
                    showPurchaseDashboard();
                    break;
                case 'office':
                    showOfficeDashboard();
                    break;
            }
            
            // Inicializar dashboard
            initializeDashboard();
        }
        
        function logout() {
            if (confirm('Tem certeza que deseja sair do sistema?')) {
                MAFCSystem.logAudit('logout', 'Logout realizado');
                
                // Esconder todos os dashboards
                document.querySelectorAll('.dashboard').forEach(d => {
                    d.style.display = 'none';
                });
                
                // Mostrar website público
                document.getElementById('publicWebsite').style.display = 'block';
                
                // Fechar todos os modais
                closeAllModals();
                
                // Limpar formulário de login
                document.getElementById('loginForm').reset();
                MAFCSystem.currentUser = null;
            }
        }
        
        // ============ DASHBOARD DO PATRÃO ============
        function showBossDashboard() {
            document.getElementById('bossDashboard').style.display = 'block';
            document.getElementById('bossUserName').textContent = MAFCSystem.currentUser.name;
            loadBossData();
        }
        
        function loadBossData() {
            // Atualizar contadores
            document.getElementById('totalEmployees').textContent = MAFCSystem.employees.filter(e => e.status === 'active').length;
            document.getElementById('activeTeams').textContent = MAFCSystem.teams.filter(t => t.status === 'active').length;
            
            // Calcular presentes hoje
            const today = new Date().toLocaleDateString('pt-PT');
            const todayRecords = MAFCSystem.timeRecords[today] || {};
            const presentCount = Object.keys(todayRecords).length;
            document.getElementById('todayPresent').textContent = presentCount;
            
            // Atualizar badges
            document.getElementById('hoursBadge').textContent = presentCount;
            document.getElementById('teamsBadge').textContent = MAFCSystem.teams.filter(t => t.status === 'active').length;
            
            // Carregar dados
            loadBossAlerts();
            loadBossTeamsOnline();
            loadBossHours();
            loadBossTeamsTable();
            loadBossPeopleTable();
            loadBossPurchasesTable();
            loadBossGPSLocations();
            loadBossAuditTable();
        }
        
        function loadBossAlerts() {
            const alertsDiv = document.getElementById('bossAlerts');
            alertsDiv.innerHTML = '';
            
            // Alertas de horas não registadas
            const today = new Date().toLocaleDateString('pt-PT');
            const activeEmployees = MAFCSystem.employees.filter(e => e.status === 'active');
            const todayRecords = MAFCSystem.timeRecords[today] || {};
            
            const missingEntries = activeEmployees.filter(emp => !todayRecords[emp.id] || !todayRecords[emp.id].entry);
            
            if (missingEntries.length > 0) {
                const alert = document.createElement('div');
                alert.className = 'alert alert-warning';
                alert.innerHTML = `
                    <i class="fas fa-clock"></i>
                    <div>
                        <strong>${missingEntries.length} pessoas sem entrada registada</strong>
                        <p>Horas obrigatórias não marcadas</p>
                    </div>
                    <button class="btn-dashboard btn-sm btn-warning" onclick="showMissingEntries()">Ver</button>
                `;
                alertsDiv.appendChild(alert);
            }
            
            // Alertas de GPS antigo
            const now = new Date();
            const oldGPS = MAFCSystem.gpsLocations.filter(gps => {
                const gpsTime = new Date(gps.timestamp);
                const hoursDiff = (now - gpsTime) / (1000 * 60 * 60);
                return hoursDiff > 24;
            });
            
            if (oldGPS.length > 0) {
                const alert = document.createElement('div');
                alert.className = 'alert alert-danger';
                alert.innerHTML = `
                    <i class="fas fa-map-marker-alt"></i>
                    <div>
                        <strong>${oldGPS.length} localizações desatualizadas</strong>
                        <p>GPS não atualizado há mais de 24h</p>
                    </div>
                    <button class="btn-dashboard btn-sm btn-danger" onclick="showOldGPS()">Ver</button>
                `;
                alertsDiv.appendChild(alert);
            }
        }
        
        function loadBossTeamsOnline() {
            const tbody = document.getElementById('bossTeamsOnline');
            tbody.innerHTML = '';
            
            MAFCSystem.teams.forEach(team => {
                const lastGPS = new Date(team.lastGPSUpdate);
                const now = new Date();
                const hoursDiff = (now - lastGPS) / (1000 * 60 * 60);
                const status = hoursDiff < 1 ? 'Online' : hoursDiff < 24 ? 'Inativo' : 'Offline';
                const statusBadge = hoursDiff < 1 ? 'badge-success' : hoursDiff < 24 ? 'badge-warning' : 'badge-danger';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${team.name}</strong></td>
                    <td>${team.location}</td>
                    <td><span class="badge ${statusBadge}">${status}</span></td>
                    <td>${lastGPS.toLocaleTimeString('pt-PT')}</td>
                    <td>
                        <button class="btn-dashboard btn-sm btn-info" onclick="viewTeamGPS('${team.name}')">
                            <i class="fas fa-map-marker-alt"></i>
                        </button>
                        <button class="btn-dashboard btn-sm btn-whatsapp" onclick="contactTeam('${team.name}')">
                            <i class="fab fa-whatsapp"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        function loadBossHours() {
            const date = document.getElementById('bossHoursDate').value;
            const teamFilter = document.getElementById('bossHoursTeam').value;
            const deptFilter = document.getElementById('bossHoursDept').value;
            
            const tbody = document.getElementById('bossHoursTable');
            tbody.innerHTML = '';
            
            // Atualizar opções de equipa
            const teamSelect = document.getElementById('bossHoursTeam');
            teamSelect.innerHTML = '<option value="all">Todas Equipas</option>';
            MAFCSystem.teams.forEach(team => {
                const option = document.createElement('option');
                option.value = team.name;
                option.textContent = team.name;
                teamSelect.appendChild(option);
            });
            
            const dateStr = new Date(date).toLocaleDateString('pt-PT');
            const dateRecords = MAFCSystem.timeRecords[dateStr] || {};
            
            Object.values(dateRecords).forEach(record => {
                const employee = MAFCSystem.employees.find(e => e.id === record.personId);
                if (!employee) return;
                
                // Aplicar filtros
                if (teamFilter !== 'all' && employee.team !== teamFilter) return;
                if (deptFilter !== 'all' && employee.department !== deptFilter) return;
                
                const status = record.exit ? 'Concluído' : record.entry ? 'Em trabalho' : 'Pendente';
                const statusBadge = record.exit ? 'badge-success' : record.entry ? 'badge-warning' : 'badge-danger';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${record.personName}</td>
                    <td>${employee.team || employee.department}</td>
                    <td>${record.entry || '--:--'}</td>
                    <td>${record.exit || '--:--'}</td>
                    <td>${record.break || '--'}</td>
                    <td>${record.totalHours ? record.totalHours + 'h' : '--'}</td>
                    <td><span class="badge ${statusBadge}">${status}</span></td>
                    <td>
                        <a href="https://wa.me/${employee.whatsapp.replace('+', '')}" target="_blank" class="btn-dashboard btn-sm btn-whatsapp">
                            <i class="fab fa-whatsapp"></i>
                        </a>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        function loadBossTeamsTable() {
            const tbody = document.getElementById('bossTeamsTable');
            tbody.innerHTML = '';
            
            MAFCSystem.teams.forEach(team => {
                const statusBadge = team.status === 'active' ? 
                    '<span class="badge badge-success">Ativa</span>' :
                    '<span class="badge badge-danger">Inativa</span>';
                
                const members = MAFCSystem.employees.filter(e => e.team === team.name && e.status === 'active').length;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>#${team.id.toString().padStart(3, '0')}</td>
                    <td><strong>${team.name}</strong></td>
                    <td>${team.location}</td>
                    <td>${team.leader}</td>
                    <td>${members} membros</td>
                    <td>${team.currentWork}</td>
                    <td>${team.gps || '--'}</td>
                    <td>${statusBadge}</td>
                    <td>
                        <button class="btn-dashboard btn-sm btn-info" onclick="viewTeamDetails('${team.name}')">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn-dashboard btn-sm btn-whatsapp" onclick="contactTeam('${team.name}')">
                            <i class="fab fa-whatsapp"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        function loadBossPeopleTable() {
            const tbody = document.getElementById('bossPeopleTable');
            tbody.innerHTML = '';
            
            MAFCSystem.employees.forEach(employee => {
                const statusBadge = employee.status === 'active' ? 
                    '<span class="badge badge-success">Ativo</span>' :
                    '<span class="badge badge-danger">Inativo</span>';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${employee.name}</td>
                    <td>${employee.whatsapp}</td>
                    <td>${employee.position}</td>
                    <td>${employee.department}</td>
                    <td>${employee.team || '--'}</td>
                    <td>${statusBadge}</td>
                    <td>
                        <button class="btn-dashboard btn-sm btn-warning" onclick="editEmployee(${employee.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <a href="https://wa.me/${employee.whatsapp.replace('+', '')}" target="_blank" class="btn-dashboard btn-sm btn-whatsapp">
                            <i class="fab fa-whatsapp"></i>
                        </a>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        function loadBossGPSLocations() {
            const container = document.getElementById('bossGPSLocations');
            container.innerHTML = '';
            
            // Agrupar por equipa
            const teamsGPS = {};
            MAFCSystem.gpsLocations.forEach(gps => {
                if (!teamsGPS[gps.team]) teamsGPS[gps.team] = [];
                teamsGPS[gps.team].push(gps);
            });
            
            Object.keys(teamsGPS).forEach(teamName => {
                const teamGPS = teamsGPS[teamName];
                const latestGPS = teamGPS[0]; // Último registo
                
                const card = document.createElement('div');
                card.className = 'content-card';
                card.style.marginBottom = '15px';
                
                card.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <h4 style="margin: 0;">${teamName}</h4>
                            <p style="margin: 5px 0; color: #666;">${latestGPS.workName || 'Obra não especificada'}</p>
                            <p style="margin: 0; font-family: monospace;">${latestGPS.coordinates}</p>
                        </div>
                        <div style="text-align: right;">
                            <small>${new Date(latestGPS.timestamp).toLocaleString('pt-PT')}</small><br>
                            <button class="btn-dashboard btn-sm btn-info" onclick="viewTeamGPSHistory('${teamName}')">
                                <i class="fas fa-history"></i> Histórico
                            </button>
                        </div>
                    </div>
                `;
                
                container.appendChild(card);
            });
        }
        
        function loadBossAuditTable() {
            const tbody = document.getElementById('bossAuditTable');
            tbody.innerHTML = '';
            
            MAFCSystem.auditLog.slice(0, 50).forEach(log => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${new Date(log.timestamp).toLocaleString('pt-PT')}</td>
                    <td>${log.user} (${log.userRole})</td>
                    <td>${log.action}</td>
                    <td>${log.details}</td>
                    <td>${log.module}</td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // ============ DASHBOARD ESCRITÓRIO ============
        function showOfficeDashboard() {
            document.getElementById('officeDashboard').style.display = 'block';
            document.getElementById('officeUserName').textContent = MAFCSystem.currentUser.name;
            loadOfficeData();
        }
        
        function loadOfficeData() {
            // Atualizar contadores
            const officeEmployees = MAFCSystem.employees.filter(e => 
                e.department === 'escritorio' && e.status === 'active'
            );
            document.getElementById('officePeopleCount').textContent = officeEmployees.length;
            
            // Calcular horas hoje
            const today = new Date().toLocaleDateString('pt-PT');
            let todayHours = 0;
            if (MAFCSystem.timeRecords[today]) {
                Object.values(MAFCSystem.timeRecords[today]).forEach(record => {
                    if (record.totalHours) todayHours += parseFloat(record.totalHours);
                });
            }
            document.getElementById('officeTodayHours').textContent = todayHours.toFixed(1);
            
            // Carregar dados
            loadAllEmployeesTime();
            loadOfficePeopleSelect();
            loadOfficePeopleTable();
            loadOfficeDailyMarks();
        }
        
        function loadAllEmployeesTime() {
            const tbody = document.getElementById('allEmployeesTime');
            tbody.innerHTML = '';
            
            const today = new Date().toLocaleDateString('pt-PT');
            const todayRecords = MAFCSystem.timeRecords[today] || {};
            
            // Filtrar apenas escritório
            const officeEmployees = MAFCSystem.employees.filter(e => 
                (e.department === 'escritorio' || e.department === 'contabilidade' || e.department === 'rh') && 
                e.status === 'active'
            );
            
            officeEmployees.forEach(employee => {
                const record = todayRecords[employee.id] || {};
                const status = record.entry ? (record.exit ? '✅ Concluído' : '⏳ Em trabalho') : '⏰ Pendente';
                const statusClass = record.exit ? 'badge-success' : record.entry ? 'badge-warning' : 'badge-danger';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${employee.name}</td>
                    <td>${record.entry || '--:--'}</td>
                    <td>${record.exit || '--:--'}</td>
                    <td>${record.break || '--'}</td>
                    <td>${record.totalHours ? record.totalHours + 'h' : '--'}</td>
                    <td><span class="badge ${statusClass}">${status}</span></td>
                    <td>
                        <button class="btn-dashboard btn-sm btn-success" onclick="markEmployeeTime(${employee.id}, 'entry')">
                            <i class="fas fa-sign-in-alt"></i>
                        </button>
                        <button class="btn-dashboard btn-sm btn-warning" onclick="markEmployeeTime(${employee.id}, 'break')">
                            <i class="fas fa-coffee"></i>
                        </button>
                        <button class="btn-dashboard btn-sm btn-danger" onclick="markEmployeeTime(${employee.id}, 'exit')">
                            <i class="fas fa-sign-out-alt"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        function markEmployeeTime(personId, type) {
            const employee = MAFCSystem.employees.find(e => e.id === personId);
            if (!employee) return;
            
            const now = new Date();
            const timeString = now.toLocaleTimeString('pt-PT', { hour: '2-digit', minute: '2-digit' });
            const dateString = now.toLocaleDateString('pt-PT');
            
            // Inicializar registos do dia
            if (!MAFCSystem.timeRecords[dateString]) {
                MAFCSystem.timeRecords[dateString] = {};
            }
            if (!MAFCSystem.timeRecords[dateString][personId]) {
                MAFCSystem.timeRecords[dateString][personId] = {
                    personName: employee.name,
                    personId: personId
                };
            }
            
            const record = MAFCSystem.timeRecords[dateString][personId];
            
            switch(type) {
                case 'entry':
                    record.entry = timeString;
                    MAFCSystem.logAudit('time_entry', `${employee.name} - Entrada às ${timeString}`, 'horas');
                    break;
                case 'exit':
                    record.exit = timeString;
                    // Calcular horas totais
                    if (record.entry) {
                        const entryTime = record.entry.split(':').map(Number);
                        const exitTime = timeString.split(':').map(Number);
                        let totalMinutes = (exitTime[0] * 60 + exitTime[1]) - (entryTime[0] * 60 + entryTime[1]);
                        if (totalMinutes < 0) totalMinutes += 24 * 60;
                        
                        // Subtrair pausa
                        if (record.break === '60') {
                            totalMinutes -= 60;
                        }
                        
                        record.totalHours = (totalMinutes / 60).toFixed(1);
                    }
                    MAFCSystem.logAudit('time_exit', `${employee.name} - Saída às ${timeString}`, 'horas');
                    break;
                case 'break':
                    record.break = '60';
                    MAFCSystem.logAudit('break', `${employee.name} - Pausa de 60min`, 'horas');
                    break;
            }
            
            MAFCSystem.saveToStorage();
            
            // Notificação WhatsApp (OPCIONAL)
            if (employee.whatsapp && confirm('Deseja enviar notificação por WhatsApp?')) {
                const messages = {
                    'entry': `✅ ${employee.name} - Entrada registada às ${timeString} - MAFC`,
                    'exit': `✅ ${employee.name} - Saída registada às ${timeString} - MAFC`,
                    'break': `⏸️ ${employee.name} - Pausa registada às ${timeString} - MAFC`
                };
                
                const message = messages[type];
                const url = `https://wa.me/${employee.whatsapp.replace('+', '')}?text=${encodeURIComponent(message)}`;
                window.open(url, '_blank');
            }
            
            alert(`✅ ${employee.name} - ${type === 'entry' ? 'Entrada' : type === 'exit' ? 'Saída' : 'Pausa'} registada às ${timeString}`);
            
            // Atualizar interfaces
            loadAllEmployeesTime();
            loadOfficeDailyMarks();
        }
        
        function markAllEntry() {
            if (confirm('Registar entrada para TODOS os funcionários do escritório?')) {
                const now = new Date();
                const timeString = now.toLocaleTimeString('pt-PT', { hour: '2-digit', minute: '2-digit' });
                const dateString = now.toLocaleDateString('pt-PT');
                
                if (!MAFCSystem.timeRecords[dateString]) {
                    MAFCSystem.timeRecords[dateString] = {};
                }
                
                const officeEmployees = MAFCSystem.employees.filter(e => 
                    (e.department === 'escritorio' || e.department === 'contabilidade' || e.department === 'rh') && 
                    e.status === 'active'
                );
                
                officeEmployees.forEach(employee => {
                    if (!MAFCSystem.timeRecords[dateString][employee.id]) {
                        MAFCSystem.timeRecords[dateString][employee.id] = {
                            personName: employee.name,
                            personId: employee.id
                        };
                    }
                    MAFCSystem.timeRecords[dateString][employee.id].entry = timeString;
                });
                
                MAFCSystem.saveToStorage();
                MAFCSystem.logAudit('bulk_time_entry', 'Entrada registada para todos os funcionários do escritório', 'horas');
                
                alert(`✅ Entrada registada para TODOS os funcionários do escritório às ${timeString}`);
                loadAllEmployeesTime();
                loadOfficeDailyMarks();
            }
        }
        
        function markAllExit() {
            if (confirm('Registar saída para TODOS os funcionários do escritório?')) {
                const now = new Date();
                const timeString = now.toLocaleTimeString('pt-PT', { hour: '2-digit', minute: '2-digit' });
                const dateString = now.toLocaleDateString('pt-PT');
                
                if (!MAFCSystem.timeRecords[dateString]) {
                    MAFCSystem.timeRecords[dateString] = {};
                }
                
                const officeEmployees = MAFCSystem.employees.filter(e => 
                    (e.department === 'escritório' || e.department === 'contabilidade' || e.department === 'rh') && 
                    e.status === 'active'
                );
                
                officeEmployees.forEach(employee => {
                    if (!MAFCSystem.timeRecords[dateString][employee.id]) {
                        MAFCSystem.timeRecords[dateString][employee.id] = {
                            personName: employee.name,
                            personId: employee.id
                        };
                    }
                    const record = MAFCSystem.timeRecords[dateString][employee.id];
                    record.exit = timeString;
                    
                    // Calcular horas totais
                    if (record.entry) {
                        const entryTime = record.entry.split(':').map(Number);
                        const exitTime = timeString.split(':').map(Number);
                        let totalMinutes = (exitTime[0] * 60 + exitTime[1]) - (entryTime[0] * 60 + entryTime[1]);
                        if (totalMinutes < 0) totalMinutes += 24 * 60;
                        
                        if (record.break === '60') {
                            totalMinutes -= 60;
                        }
                        
                        record.totalHours = (totalMinutes / 60).toFixed(1);
                    }
                });
                
                MAFCSystem.saveToStorage();
                MAFCSystem.logAudit('bulk_time_exit', 'Saída registada para todos os funcionários do escritório', 'horas');
                
                alert(`✅ Saída registada para TODOS os funcionários do escritório às ${timeString}`);
                loadAllEmployeesTime();
                loadOfficeDailyMarks();
            }
        }
        
        function markAllBreak() {
            if (confirm('Registar pausa para TODOS os funcionários do escritório?')) {
                const dateString = new Date().toLocaleDateString('pt-PT');
                
                if (!MAFCSystem.timeRecords[dateString]) {
                    MAFCSystem.timeRecords[dateString] = {};
                }
                
                const officeEmployees = MAFCSystem.employees.filter(e => 
                    (e.department === 'escritório' || e.department === 'contabilidade' || e.department === 'rh') && 
                    e.status === 'active'
                );
                
                officeEmployees.forEach(employee => {
                    if (!MAFCSystem.timeRecords[dateString][employee.id]) {
                        MAFCSystem.timeRecords[dateString][employee.id] = {
                            personName: employee.name,
                            personId: employee.id
                        };
                    }
                    MAFCSystem.timeRecords[dateString][employee.id].break = '60';
                });
                
                MAFCSystem.saveToStorage();
                MAFCSystem.logAudit('bulk_break', 'Pausa registada para todos os funcionários do escritório', 'horas');
                
                alert('✅ Pausa registada para TODOS os funcionários do escritório (60 minutos)');
                loadAllEmployeesTime();
                loadOfficeDailyMarks();
            }
        }
        
        function loadOfficePeopleSelect() {
            const select = document.getElementById('officePersonSelect');
            const reportSelect = document.getElementById('officeReportPerson');
            
            select.innerHTML = '<option value="">Selecione uma pessoa</option>';
            reportSelect.innerHTML = '<option value="all">Todas as Pessoas</option>';
            
            const officeEmployees = MAFCSystem.employees.filter(e => 
                (e.department === 'escritório' || e.department === 'contabilidade' || e.department === 'rh') && 
                e.status === 'active'
            );
            
            officeEmployees.forEach(employee => {
                const option1 = document.createElement('option');
                option1.value = employee.id;
                option1.textContent = employee.name;
                select.appendChild(option1);
                
                const option2 = document.createElement('option');
                option2.value = employee.id;
                option2.textContent = employee.name;
                reportSelect.appendChild(option2);
            });
        }
        
        function loadOfficePeopleTable() {
            const tbody = document.getElementById('officePeopleTable');
            tbody.innerHTML = '';
            
            const officeEmployees = MAFCSystem.employees.filter(e => 
                (e.department === 'escritório' || e.department === 'contabilidade' || e.department === 'rh')
            );
            
            officeEmployees.forEach(employee => {
                const statusBadge = employee.status === 'active' ? 
                    '<span class="badge badge-success">Ativo</span>' :
                    '<span class="badge badge-danger">Inativo</span>';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${employee.name}</td>
                    <td>${employee.whatsapp}</td>
                    <td>${employee.position}</td>
                    <td>${employee.department}</td>
                    <td>${statusBadge}</td>
                    <td>
                        <button class="btn-dashboard btn-sm btn-warning" onclick="editEmployee(${employee.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn-dashboard btn-sm btn-danger" onclick="deleteEmployee(${employee.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                        <a href="https://wa.me/${employee.whatsapp.replace('+', '')}" target="_blank" class="btn-dashboard btn-sm btn-whatsapp">
                            <i class="fab fa-whatsapp"></i>
                        </a>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        function loadOfficeDailyMarks() {
            const tbody = document.getElementById('officeDailyMarks');
            tbody.innerHTML = '';
            
            const today = new Date().toLocaleDateString('pt-PT');
            const todayRecords = MAFCSystem.timeRecords[today] || {};
            
            const officeEmployees = MAFCSystem.employees.filter(e => 
                (e.department === 'escritório' || e.department === 'contabilidade' || e.department === 'rh') && 
                e.status === 'active'
            );
            
            officeEmployees.forEach(employee => {
                const record = todayRecords[employee.id] || {};
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${employee.name}</td>
                    <td>${record.entry || '--:--'}</td>
                    <td>${record.exit || '--:--'}</td>
                    <td>${record.break || '--'}</td>
                    <td>${record.totalHours ? record.totalHours + 'h' : '--'}</td>
                    <td>
                        <button class="btn-dashboard btn-sm btn-warning" onclick="editTimeRecord('${today}', ${employee.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // ============ GESTÃO DE PESSOAL ============
        function openEmployeeModal() {
            MAFCSystem.editingEmployeeId = null;
            document.getElementById('employeeModal').style.display = 'flex';
            
            // Limpar formulário
            document.getElementById('employeeName').value = '';
            document.getElementById('employeeWhatsApp').value = '+351 ';
            document.getElementById('employeePosition').value = 'operario';
            document.getElementById('employeeDepartment').value = 'obra';
            document.getElementById('employeeTeam').value = '';
            document.getElementById('employeeStatus').value = 'active';
            
            loadEmployeeList();
        }
        
        function loadEmployeeList() {
            const tbody = document.getElementById('employeesList');
            tbody.innerHTML = '';
            
            MAFCSystem.employees.forEach(employee => {
                const statusBadge = employee.status === 'active' ? 
                    '<span class="badge badge-success">Ativo</span>' :
                    '<span class="badge badge-danger">Inativo</span>';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${employee.name}</td>
                    <td>${employee.whatsapp}</td>
                    <td>${employee.position}</td>
                    <td>${employee.department}</td>
                    <td>${employee.team || '--'}</td>
                    <td>${statusBadge}</td>
                    <td>
                        <button class="btn-dashboard btn-sm btn-warning" onclick="editEmployee(${employee.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn-dashboard btn-sm btn-danger" onclick="deleteEmployee(${employee.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        function saveEmployee() {
            const name = document.getElementById('employeeName').value;
            const whatsapp = document.getElementById('employeeWhatsApp').value;
            const position = document.getElementById('employeePosition').value;
            const department = document.getElementById('employeeDepartment').value;
            const team = document.getElementById('employeeTeam').value;
            const status = document.getElementById('employeeStatus').value;
            
            if (!name || !whatsapp || !position || !department) {
                alert('Por favor, preencha todos os campos obrigatórios!');
                return;
            }
            
            if (MAFCSystem.editingEmployeeId) {
                // Editar
                const index = MAFCSystem.employees.findIndex(e => e.id === MAFCSystem.editingEmployeeId);
                if (index !== -1) {
                    MAFCSystem.employees[index] = {
                        ...MAFCSystem.employees[index],
                        name, whatsapp, position, department, team, status
                    };
                    MAFCSystem.logAudit('employee_update', `Atualizou pessoa: ${name}`, 'pessoal');
                }
            } else {
                // Adicionar novo
                const newId = MAFCSystem.employees.length > 0 ? 
                    Math.max(...MAFCSystem.employees.map(e => e.id)) + 1 : 1;
                
                MAFCSystem.employees.push({
                    id: newId,
                    name, whatsapp, position, department, team, status,
                    startDate: new Date().toISOString().split('T')[0]
                });
                MAFCSystem.logAudit('employee_create', `Adicionou pessoa: ${name}`, 'pessoal');
            }
            
            MAFCSystem.saveToStorage();
            alert('Pessoa guardada com sucesso!');
            
            // Atualizar interfaces
            loadEmployeeList();
            
            if (MAFCSystem.currentUser.role === 'boss') {
                loadBossPeopleTable();
                loadBossData();
            } else if (MAFCSystem.currentUser.role === 'office') {
                loadOfficePeopleTable();
                loadOfficePeopleSelect();
                loadAllEmployeesTime();
                loadOfficeDailyMarks();
            }
            
            closeModal('employeeModal');
        }
        
        function editEmployee(id) {
            const employee = MAFCSystem.employees.find(e => e.id === id);
            if (employee) {
                MAFCSystem.editingEmployeeId = id;
                document.getElementById('employeeModal').style.display = 'flex';
                
                // Preencher formulário
                document.getElementById('employeeName').value = employee.name;
                document.getElementById('employeeWhatsApp').value = employee.whatsapp;
                document.getElementById('employeePosition').value = employee.position;
                document.getElementById('employeeDepartment').value = employee.department;
                document.getElementById('employeeTeam').value = employee.team || '';
                document.getElementById('employeeStatus').value = employee.status;
                
                loadEmployeeList();
            }
        }
        
        function deleteEmployee(id) {
            if (confirm('Tem certeza que deseja remover esta pessoa?')) {
                const employee = MAFCSystem.employees.find(e => e.id === id);
                if (employee) {
                    MAFCSystem.employees = MAFCSystem.employees.filter(e => e.id !== id);
                    MAFCSystem.logAudit('employee_delete', `Removeu pessoa: ${employee.name}`, 'pessoal');
                    MAFCSystem.saveToStorage();
                    
                    alert('Pessoa removida com sucesso!');
                    
                    // Atualizar interfaces
                    loadEmployeeList();
                    
                    if (MAFCSystem.currentUser.role === 'boss') {
                        loadBossPeopleTable();
                        loadBossData();
                    } else if (MAFCSystem.currentUser.role === 'office') {
                        loadOfficePeopleTable();
                        loadOfficePeopleSelect();
                        loadAllEmployeesTime();
                        loadOfficeDailyMarks();
                    }
                }
            }
        }
        
        // ============ CHEFE DE EQUIPA ============
        function showTeamDashboard() {
            document.getElementById('teamDashboard').style.display = 'block';
            document.getElementById('teamUserName').textContent = MAFCSystem.currentUser.team;
            document.getElementById('teamLocationBadge').innerHTML = `
                <i class="fas fa-map-marker-alt"></i> ${MAFCSystem.currentUser.location}
            `;
            loadTeamData();
        }
        
        function loadTeamData() {
            // Encontrar equipa atual
            const currentTeam = MAFCSystem.teams.find(t => t.name === MAFCSystem.currentUser.team);
            if (currentTeam) {
                // Preencher informações da equipa
                document.getElementById('teamName').value = currentTeam.name;
                document.getElementById('teamLocation').value = currentTeam.location;
                document.getElementById('teamCurrentWork').value = currentTeam.currentWork;
                document.getElementById('teamWorkStatus').value = currentTeam.status;
                
                // Atualizar contadores
                const teamMembers = MAFCSystem.employees.filter(e => e.team === currentTeam.name && e.status === 'active');
                document.getElementById('teamMembersCount').textContent = teamMembers.length;
                
                // Calcular horas hoje
                const today = new Date().toLocaleDateString('pt-PT');
                const todayRecords = MAFCSystem.timeRecords[today] || {};
                let teamHours = 0;
                teamMembers.forEach(member => {
                    const record = todayRecords[member.id];
                    if (record && record.totalHours) {
                        teamHours += parseFloat(record.totalHours);
                    }
                });
                document.getElementById('teamHoursToday').textContent = teamHours.toFixed(1);
                
                // Status GPS
                const lastGPS = new Date(currentTeam.lastGPSUpdate);
                const now = new Date();
                const hoursDiff = (now - lastGPS) / (1000 * 60 * 60);
                document.getElementById('teamGPSStatus').textContent = hoursDiff < 1 ? 'On' : hoursDiff < 24 ? 'Idle' : 'Off';
                document.getElementById('teamWorkStatus').textContent = currentTeam.status === 'active' ? 'Ativa' : 'Inativa';
                
                // Carregar dados
                loadTeamMembersTime();
                loadTeamGPSData();
            }
        }
        
        function loadTeamMembersTime() {
            const tbody = document.getElementById('teamMembersTime');
            tbody.innerHTML = '';
            
            const currentTeam = MAFCSystem.teams.find(t => t.name === MAFCSystem.currentUser.team);
            if (!currentTeam) return;
            
            const teamMembers = MAFCSystem.employees.filter(e => e.team === currentTeam.name && e.status === 'active');
            const today = new Date().toLocaleDateString('pt-PT');
            const todayRecords = MAFCSystem.timeRecords[today] || {};
            
            teamMembers.forEach(member => {
                const record = todayRecords[member.id] || {};
                const status = record.entry ? (record.exit ? '✅ Concluído' : '⏳ Em trabalho') : '⏰ Pendente';
                const statusClass = record.exit ? 'badge-success' : record.entry ? 'badge-warning' : 'badge-danger';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${member.name}</td>
                    <td>${record.entry || '--:--'}</td>
                    <td>${record.exit || '--:--'}</td>
                    <td>${record.break || '--'}</td>
                    <td>${record.totalHours ? record.totalHours + 'h' : '--'}</td>
                    <td><span class="badge ${statusClass}">${status}</span></td>
                    <td>
                        <button class="btn-dashboard btn-sm btn-success" onclick="markTeamMemberTime(${member.id}, 'entry')">
                            <i class="fas fa-sign-in-alt"></i>
                        </button>
                        <button class="btn-dashboard btn-sm btn-danger" onclick="markTeamMemberTime(${member.id}, 'exit')">
                            <i class="fas fa-sign-out-alt"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        function markTeamMemberTime(personId, type) {
            const member = MAFCSystem.employees.find(e => e.id === personId);
            if (!member) return;
            
            const now = new Date();
            const timeString = now.toLocaleTimeString('pt-PT', { hour: '2-digit', minute: '2-digit' });
            const dateString = now.toLocaleDateString('pt-PT');
            
            // Inicializar registos
            if (!MAFCSystem.timeRecords[dateString]) {
                MAFCSystem.timeRecords[dateString] = {};
            }
            if (!MAFCSystem.timeRecords[dateString][personId]) {
                MAFCSystem.timeRecords[dateString][personId] = {
                    personName: member.name,
                    personId: personId
                };
            }
            
            const record = MAFCSystem.timeRecords[dateString][personId];
            
            if (type === 'entry') {
                record.entry = timeString;
                MAFCSystem.logAudit('team_time_entry', `${member.name} - Entrada às ${timeString}`, 'equipa');
            } else if (type === 'exit') {
                record.exit = timeString;
                // Calcular horas
                if (record.entry) {
                    const entryTime = record.entry.split(':').map(Number);
                    const exitTime = timeString.split(':').map(Number);
                    let totalMinutes = (exitTime[0] * 60 + exitTime[1]) - (entryTime[0] * 60 + entryTime[1]);
                    if (totalMinutes < 0) totalMinutes += 24 * 60;
                    
                    if (record.break === '60') {
                        totalMinutes -= 60;
                    }
                    
                    record.totalHours = (totalMinutes / 60).toFixed(1);
                }
                MAFCSystem.logAudit('team_time_exit', `${member.name} - Saída às ${timeString}`, 'equipa');
            }
            
            MAFCSystem.saveToStorage();
            alert(`✅ ${member.name} - ${type === 'entry' ? 'Entrada' : 'Saída'} registada às ${timeString}`);
            loadTeamMembersTime();
        }
        
        function markTeamEntry() {
            if (confirm(`Registar entrada para TODOS os membros da ${MAFCSystem.currentUser.team}?`)) {
                const now = new Date();
                const timeString = now.toLocaleTimeString('pt-PT', { hour: '2-digit', minute: '2-digit' });
                const dateString = now.toLocaleDateString('pt-PT');
                
                if (!MAFCSystem.timeRecords[dateString]) {
                    MAFCSystem.timeRecords[dateString] = {};
                }
                
                const currentTeam = MAFCSystem.teams.find(t => t.name === MAFCSystem.currentUser.team);
                if (!currentTeam) return;
                
                const teamMembers = MAFCSystem.employees.filter(e => e.team === currentTeam.name && e.status === 'active');
                
                teamMembers.forEach(member => {
                    if (!MAFCSystem.timeRecords[dateString][member.id]) {
                        MAFCSystem.timeRecords[dateString][member.id] = {
                            personName: member.name,
                            personId: member.id
                        };
                    }
                    MAFCSystem.timeRecords[dateString][member.id].entry = timeString;
                });
                
                MAFCSystem.saveToStorage();
                MAFCSystem.logAudit('team_bulk_entry', `Entrada registada para toda a equipa ${currentTeam.name}`, 'equipa');
                
                alert(`✅ Entrada registada para TODA a equipa ${currentTeam.name} às ${timeString}`);
                loadTeamMembersTime();
            }
        }
        
        function markTeamExit() {
            if (confirm(`Registar saída para TODOS os membros da ${MAFCSystem.currentUser.team}?`)) {
                const now = new Date();
                const timeString = now.toLocaleTimeString('pt-PT', { hour: '2-digit', minute: '2-digit' });
                const dateString = now.toLocaleDateString('pt-PT');
                
                if (!MAFCSystem.timeRecords[dateString]) {
                    MAFCSystem.timeRecords[dateString] = {};
                }
                
                const currentTeam = MAFCSystem.teams.find(t => t.name === MAFCSystem.currentUser.team);
                if (!currentTeam) return;
                
                const teamMembers = MAFCSystem.employees.filter(e => e.team === currentTeam.name && e.status === 'active');
                
                teamMembers.forEach(member => {
                    if (!MAFCSystem.timeRecords[dateString][member.id]) {
                        MAFCSystem.timeRecords[dateString][member.id] = {
                            personName: member.name,
                            personId: member.id
                        };
                    }
                    const record = MAFCSystem.timeRecords[dateString][member.id];
                    record.exit = timeString;
                    
                    // Calcular horas
                    if (record.entry) {
                        const entryTime = record.entry.split(':').map(Number);
                        const exitTime = timeString.split(':').map(Number);
                        let totalMinutes = (exitTime[0] * 60 + exitTime[1]) - (entryTime[0] * 60 + entryTime[1]);
                        if (totalMinutes < 0) totalMinutes += 24 * 60;
                        
                        if (record.break === '60') {
                            totalMinutes -= 60;
                        }
                        
                        record.totalHours = (totalMinutes / 60).toFixed(1);
                    }
                });
                
                MAFCSystem.saveToStorage();
                MAFCSystem.logAudit('team_bulk_exit', `Saída registada para toda a equipa ${currentTeam.name}`, 'equipa');
                
                alert(`✅ Saída registada para TODA a equipa ${currentTeam.name} às ${timeString}`);
                loadTeamMembersTime();
            }
        }
        
        function markTeamBreak() {
            if (confirm(`Registar pausa para TODOS os membros da ${MAFCSystem.currentUser.team}?`)) {
                const dateString = new Date().toLocaleDateString('pt-PT');
                
                if (!MAFCSystem.timeRecords[dateString]) {
                    MAFCSystem.timeRecords[dateString] = {};
                }
                
                const currentTeam = MAFCSystem.teams.find(t => t.name === MAFCSystem.currentUser.team);
                if (!currentTeam) return;
                
                const teamMembers = MAFCSystem.employees.filter(e => e.team === currentTeam.name && e.status === 'active');
                
                teamMembers.forEach(member => {
                    if (!MAFCSystem.timeRecords[dateString][member.id]) {
                        MAFCSystem.timeRecords[dateString][member.id] = {
                            personName: member.name,
                            personId: member.id
                        };
                    }
                    MAFCSystem.timeRecords[dateString][member.id].break = '60';
                });
                
                MAFCSystem.saveToStorage();
                MAFCSystem.logAudit('team_bulk_break', `Pausa registada para toda a equipa ${currentTeam.name}`, 'equipa');
                
                alert(`✅ Pausa registada para TODA a equipa ${currentTeam.name} (60 minutos)`);
                loadTeamMembersTime();
            }
        }
        
        // ============ GPS ============
        function openGPSModal() {
            document.getElementById('gpsModal').style.display = 'flex';
            
            // Preencher equipa atual
            const gpsTeamSelect = document.getElementById('gpsTeam');
            gpsTeamSelect.innerHTML = '';
            
            const currentTeam = MAFCSystem.teams.find(t => t.name === MAFCSystem.currentUser.team);
            if (currentTeam) {
                const option = document.createElement('option');
                option.value = currentTeam.name;
                option.textContent = currentTeam.name;
                option.selected = true;
                gpsTeamSelect.appendChild(option);
            }
            
            loadGPSHistory();
        }
        
        function getCurrentLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const lat = position.coords.latitude.toFixed(6);
                        const lng = position.coords.longitude.toFixed(6);
                        const coordinates = `${lat}° ${lat >= 0 ? 'N' : 'S'}, ${lng}° ${lng >= 0 ? 'E' : 'W'}`;
                        
                        document.getElementById('currentGpsCoordinates').textContent = coordinates;
                        document.getElementById('mapCoordinates').textContent = `Coordenadas: ${coordinates}`;
                        
                        // Atualizar visual do mapa
                        const mapContainer = document.querySelector('.gps-map-container');
                        mapContainer.innerHTML = `
                            <div style="text-align: center; padding: 20px;">
                                <i class="fas fa-map-marked-alt fa-3x" style="color: #27ae60; margin-bottom: 10px;"></i>
                                <h4>Localização Obtida!</h4>
                                <p style="font-family: monospace; background: white; padding: 10px; border-radius: 5px;">${coordinates}</p>
                                <small>Precisão: ${position.coords.accuracy.toFixed(1)} metros</small>
                            </div>
                        `;
                    },
                    (error) => {
                        alert('Erro ao obter localização: ' + error.message);
                        // Usar localização simulada para demonstração
                        const simulatedCoords = "41.157943° N, -8.629105° W";
                        document.getElementById('currentGpsCoordinates').textContent = simulatedCoords;
                        document.getElementById('mapCoordinates').textContent = `Coordenadas: ${simulatedCoords}`;
                    }
                );
            } else {
                alert('Geolocalização não suportada pelo navegador.');
                // Usar localização simulada
                const simulatedCoords = "41.157943° N, -8.629105° W";
                document.getElementById('currentGpsCoordinates').textContent = simulatedCoords;
                document.getElementById('mapCoordinates').textContent = `Coordenadas: ${simulatedCoords}`;
            }
        }
        
        function saveGPSLocation() {
            const workName = document.getElementById('gpsWorkName').value;
            const team = document.getElementById('gpsTeam').value;
            const address = document.getElementById('gpsAddress').value;
            const coordinates = document.getElementById('currentGpsCoordinates').textContent;
            
            if (!workName || !team || coordinates === 'Aguardando GPS...') {
                alert('Por favor, obtenha a localização GPS e preencha todos os campos obrigatórios!');
                return;
            }
            
            const gpsEntry = {
                id: Date.now(),
                timestamp: new Date().toISOString(),
                workName: workName,
                team: team,
                coordinates: coordinates,
                address: address,
                recordedBy: MAFCSystem.currentUser.name
            };
            
            MAFCSystem.gpsLocations.unshift(gpsEntry);
            
            // Atualizar equipa
            const teamObj = MAFCSystem.teams.find(t => t.name === team);
            if (teamObj) {
                teamObj.gps = coordinates;
                teamObj.lastGPSUpdate = new Date().toISOString();
                if (workName) teamObj.currentWork = workName;
            }
            
            MAFCSystem.saveToStorage();
            MAFCSystem.logAudit('gps_save', `Localização registada para ${team}: ${coordinates}`, 'gps');
            
            alert('✅ Localização GPS guardada com sucesso!');
            
            // Atualizar interfaces
            loadGPSHistory();
            loadTeamGPSData();
            
            if (MAFCSystem.currentUser.role === 'boss') {
                loadBossGPSLocations();
                loadBossTeamsOnline();
            }
            
            // Limpar formulário
            document.getElementById('gpsWorkName').value = '';
            document.getElementById('gpsAddress').value = '';
        }
        
        function loadGPSHistory() {
            const tbody = document.getElementById('gpsHistoryTable');
            tbody.innerHTML = '';
            
            // Filtrar por equipa atual se for chefe de equipa
            let filteredGPS = MAFCSystem.gpsLocations;
            if (MAFCSystem.currentUser.role === 'team') {
                filteredGPS = MAFCSystem.gpsLocations.filter(gps => gps.team === MAFCSystem.currentUser.team);
            }
            
            filteredGPS.slice(0, 10).forEach(gps => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${new Date(gps.timestamp).toLocaleString('pt-PT')}</td>
                    <td>${gps.workName}</td>
                    <td>${gps.team}</td>
                    <td style="font-family: monospace;">${gps.coordinates}</td>
                    <td>
                        <button class="btn-dashboard btn-sm btn-info" onclick="viewGPSDetails(${gps.id})">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn-dashboard btn-sm btn-whatsapp" onclick="shareGPS(${gps.id})">
                            <i class="fab fa-whatsapp"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        function loadTeamGPSData() {
            const currentTeam = MAFCSystem.teams.find(t => t.name === MAFCSystem.currentUser.team);
            if (!currentTeam) return;
            
            // Atualizar display GPS
            document.getElementById('teamCurrentGPS').textContent = currentTeam.gps || 'Aguardando GPS...';
            
            // Carregar histórico GPS da equipa
            const tbody = document.getElementById('teamGPSHistory');
            tbody.innerHTML = '';
            
            const teamGPS = MAFCSystem.gpsLocations
                .filter(gps => gps.team === currentTeam.name)
                .slice(0, 5);
            
            teamGPS.forEach(gps => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${new Date(gps.timestamp).toLocaleTimeString('pt-PT')}</td>
                    <td style="font-family: monospace;">${gps.coordinates}</td>
                    <td>${gps.workName}</td>
                    <td>
                        <button class="btn-dashboard btn-sm btn-whatsapp" onclick="shareGPS(${gps.id})">
                            <i class="fab fa-whatsapp"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        function sendGPSToBoss() {
            const workName = document.getElementById('gpsWorkName').value;
            const team = document.getElementById('gpsTeam').value;
            const coordinates = document.getElementById('currentGpsCoordinates').textContent;
            
            if (coordinates === 'Aguardando GPS...') {
                alert('Obtenha a localização GPS primeiro!');
                return;
            }
            
            const message = `📍 LOCALIZAÇÃO GPS - ${team}\n\nObra: ${workName || 'Não especificada'}\nCoordenadas: ${coordinates}\n\nEnviado por: ${MAFCSystem.currentUser.name}\nHora: ${new Date().toLocaleString('pt-PT')}\n\nMAFC & FILHO, LDA.`;
            
            window.open(`https://wa.me/?text=${encodeURIComponent(message)}`, '_blank');
            
            MAFCSystem.logAudit('gps_share_boss', `Partilhou GPS com patrão: ${coordinates}`, 'gps');
        }
        
        function sendTeamGPSToBoss() {
            const currentTeam = MAFCSystem.teams.find(t => t.name === MAFCSystem.currentUser.team);
            if (!currentTeam || !currentTeam.gps) {
                alert('Nenhuma localização GPS disponível para esta equipa!');
                return;
            }
            
            const message = `📍 LOCALIZAÇÃO GPS - ${currentTeam.name}\n\nObra: ${currentTeam.currentWork}\nLocalização: ${currentTeam.location}\nCoordenadas: ${currentTeam.gps}\n\nEnviado por: ${MAFCSystem.currentUser.name}\nHora: ${new Date().toLocaleString('pt-PT')}\n\nMAFC & FILHO, LDA.`;
            
            window.open(`https://wa.me/?text=${encodeURIComponent(message)}`, '_blank');
            
            MAFCSystem.logAudit('gps_share_team_boss', `Partilhou GPS da equipa com patrão`, 'gps');
        }
        
        // ============ DASHBOARD COMPRAS ============
        function showPurchaseDashboard() {
            document.getElementById('purchaseDashboard').style.display = 'block';
            document.getElementById('purchaseUserName').textContent = MAFCSystem.currentUser.name;
            loadPurchaseData();
        }
        
        function loadPurchaseData() {
            // Sistema mantido como estava
            document.getElementById('purchasePendingCount').textContent = '0';
            document.getElementById('purchaseApprovedCount').textContent = '0';
            document.getElementById('purchaseCompletedCount').textContent = '0';
            
            // Carregar marações de horas pessoais
            loadPurchaseMyTime();
        }
        
        function loadPurchaseMyTime() {
            const tbody = document.getElementById('purchaseMyTime');
            tbody.innerHTML = '';
            
            const today = new Date().toLocaleDateString('pt-PT');
            const currentUserEmployee = MAFCSystem.employees.find(e => 
                e.name === MAFCSystem.currentUser.name && e.department === 'compras'
            );
            
            if (currentUserEmployee) {
                const record = MAFCSystem.timeRecords[today]?.[currentUserEmployee.id] || {};
                
                if (record.entry) {
                    const entryRow = document.createElement('tr');
                    entryRow.innerHTML = `
                        <td><span class="badge badge-success">Entrada</span></td>
                        <td>${record.entry}</td>
                        <td>${today}</td>
                        <td><span class="badge badge-success">Registada</span></td>
                    `;
                    tbody.appendChild(entryRow);
                }
                
                if (record.exit) {
                    const exitRow = document.createElement('tr');
                    exitRow.innerHTML = `
                        <td><span class="badge badge-danger">Saída</span></td>
                        <td>${record.exit}</td>
                        <td>${today}</td>
                        <td><span class="badge badge-success">Registada</span></td>
                    `;
                    tbody.appendChild(exitRow);
                }
                
                if (record.break) {
                    const breakRow = document.createElement('tr');
                    breakRow.innerHTML = `
                        <td><span class="badge badge-warning">Pausa</span></td>
                        <td>${record.break === '60' ? '60 min' : record.break}</td>
                        <td>${today}</td>
                        <td><span class="badge badge-success">Registada</span></td>
                    `;
                    tbody.appendChild(breakRow);
                }
            }
        }
        
        function markPurchaseEntry() {
            markPurchaseTime('entry');
        }
        
        function markPurchaseExit() {
            markPurchaseTime('exit');
        }
        
        function markPurchaseBreak() {
            markPurchaseTime('break');
        }
        
        function markPurchaseTime(type) {
            const currentUserEmployee = MAFCSystem.employees.find(e => 
                e.name === MAFCSystem.currentUser.name && e.department === 'compras'
            );
            
            if (!currentUserEmployee) {
                alert('Utilizador não encontrado no sistema de pessoal!');
                return;
            }
            
            const now = new Date();
            const timeString = now.toLocaleTimeString('pt-PT', { hour: '2-digit', minute: '2-digit' });
            const dateString = now.toLocaleDateString('pt-PT');
            
            // Inicializar registos
            if (!MAFCSystem.timeRecords[dateString]) {
                MAFCSystem.timeRecords[dateString] = {};
            }
            if (!MAFCSystem.timeRecords[dateString][currentUserEmployee.id]) {
                MAFCSystem.timeRecords[dateString][currentUserEmployee.id] = {
                    personName: currentUserEmployee.name,
                    personId: currentUserEmployee.id
                };
            }
            
            const record = MAFCSystem.timeRecords[dateString][currentUserEmployee.id];
            
            switch(type) {
                case 'entry':
                    record.entry = timeString;
                    MAFCSystem.logAudit('purchase_time_entry', `Entrada às ${timeString}`, 'compras');
                    break;
                case 'exit':
                    record.exit = timeString;
                    // Calcular horas
                    if (record.entry) {
                        const entryTime = record.entry.split(':').map(Number);
                        const exitTime = timeString.split(':').map(Number);
                        let totalMinutes = (exitTime[0] * 60 + exitTime[1]) - (entryTime[0] * 60 + entryTime[1]);
                        if (totalMinutes < 0) totalMinutes += 24 * 60;
                        
                        if (record.break === '60') {
                            totalMinutes -= 60;
                        }
                        
                        record.totalHours = (totalMinutes / 60).toFixed(1);
                    }
                    MAFCSystem.logAudit('purchase_time_exit', `Saída às ${timeString}`, 'compras');
                    break;
                case 'break':
                    record.break = '60';
                    MAFCSystem.logAudit('purchase_break', `Pausa de 60min`, 'compras');
                    break;
            }
            
            MAFCSystem.saveToStorage();
            
            alert(`✅ ${type === 'entry' ? 'Entrada' : type === 'exit' ? 'Saída' : 'Pausa'} registada às ${timeString}`);
            loadPurchaseMyTime();
        }
        
        // ============ LIMPAR HISTÓRICO ============
        function openClearHistoryModal() {
            MAFCSystem.selectedClearOption = null;
            document.getElementById('clearHistoryModal').style.display = 'flex';
            
            // Resetar seleção
            document.querySelectorAll('.clear-option-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // Esconder seções
            document.getElementById('individualClearSection').style.display = 'none';
            document.getElementById('periodClearSection').style.display = 'none';
            document.getElementById('clearSummary').style.display = 'none';
            document.getElementById('executeClearBtn').disabled = true;
            
            // Limpar selects
            document.getElementById('clearPerson').innerHTML = '<option value="">Selecione uma pessoa</option>';
            document.getElementById('clearTeam').innerHTML = '<option value="">Selecione uma equipa</option>';
            
            // Popular selects
            MAFCSystem.employees.forEach(emp => {
                if (emp.status === 'active') {
                    const option = document.createElement('option');
                    option.value = emp.id;
                    option.textContent = emp.name;
                    document.getElementById('clearPerson').appendChild(option);
                }
            });
            
            MAFCSystem.teams.forEach(team => {
                const option = document.createElement('option');
                option.value = team.name;
                option.textContent = team.name;
                document.getElementById('clearTeam').appendChild(option);
            });
        }
        
        function selectClearOption(option) {
            MAFCSystem.selectedClearOption = option;
            
            // Atualizar seleção visual
            document.querySelectorAll('.clear-option-card').forEach(card => {
                card.classList.remove('selected');
            });
            document.getElementById(`clearOption${option.charAt(0).toUpperCase() + option.slice(1)}`).classList.add('selected');
            
            // Mostrar/ocultar seções
            document.getElementById('individualClearSection').style.display = 
                option === 'employee' ? 'block' : 'none';
            document.getElementById('periodClearSection').style.display = 
                option === 'period' ? 'block' : 'none';
            
            // Atualizar resumo
            updateClearSummary();
        }
        
        function toggleClearType() {
            const type = document.getElementById('clearType').value;
            document.getElementById('clearPersonSelect').style.display = 
                type === 'person' ? 'block' : 'none';
            document.getElementById('clearTeamSelect').style.display = 
                type === 'team' ? 'block' : 'none';
            
            updateClearSummary();
        }
        
        function updateClearSummary() {
            const summaryDiv = document.getElementById('clearSummary');
            const summaryText = document.getElementById('summaryText');
            const itemCount = document.getElementById('itemCount');
            
            if (!MAFCSystem.selectedClearOption) {
                summaryDiv.style.display = 'none';
                document.getElementById('executeClearBtn').disabled = true;
                return;
            }
            
            let count = 0;
            let text = '';
            
            switch(MAFCSystem.selectedClearOption) {
                case 'all':
                    count = Object.keys(MAFCSystem.timeRecords).length + 
                           MAFCSystem.gpsLocations.length + 
                           MAFCSystem.auditLog.length;
                    text = 'TODOS os dados do sistema serão removidos.';
                    break;
                    
                case 'employee':
                    const clearType = document.getElementById('clearType').value;
                    if (clearType === 'person') {
                        const personId = parseInt(document.getElementById('clearPerson').value);
                        if (personId) {
                            // Contar registos desta pessoa
                            Object.values(MAFCSystem.timeRecords).forEach(dayRecords => {
                                if (dayRecords[personId]) count++;
                            });
                            const person = MAFCSystem.employees.find(e => e.id === personId);
                            text = `Remover todos os registos de ${person?.name || 'pessoa selecionada'}.`;
                        }
                    } else if (clearType === 'team') {
                        const teamName = document.getElementById('clearTeam').value;
                        if (teamName) {
                            // Contar registos desta equipa
                            const teamMembers = MAFCSystem.employees.filter(e => e.team === teamName);
                            teamMembers.forEach(member => {
                                Object.values(MAFCSystem.timeRecords).forEach(dayRecords => {
                                    if (dayRecords[member.id]) count++;
                                });
                            });
                            text = `Remover registos da equipa ${teamName}.`;
                        }
                    }
                    break;
                    
                case 'period':
                    const dateFrom = document.getElementById('clearDateFrom').value;
                    const dateTo = document.getElementById('clearDateTo').value;
                    if (dateFrom && dateTo) {
                        // Contar registos no período
                        const fromDate = new Date(dateFrom);
                        const toDate = new Date(dateTo);
                        
                        Object.keys(MAFCSystem.timeRecords).forEach(dateStr => {
                            const recordDate = new Date(dateStr.split('/').reverse().join('-'));
                            if (recordDate >= fromDate && recordDate <= toDate) {
                                count += Object.keys(MAFCSystem.timeRecords[dateStr]).length;
                            }
                        });
                        
                        text = `Remover registos de ${dateFrom} a ${dateTo}.`;
                    }
                    break;
            }
            
            itemCount.textContent = count;
            summaryText.textContent = text;
            summaryDiv.style.display = 'block';
            document.getElementById('executeClearBtn').disabled = count === 0;
        }
        
        function executeClearHistory() {
            if (!confirm('Tem CERTEZA ABSOLUTA que deseja executar esta limpeza?\n\nEsta ação NÃO PODE ser desfeita!')) {
                return;
            }
            
            switch(MAFCSystem.selectedClearOption) {
                case 'all':
                    // Backup antes de limpar
                    const backup = {
                        employees: MAFCSystem.employees,
                        timeRecords: MAFCSystem.timeRecords,
                        gpsLocations: MAFCSystem.gpsLocations,
                        auditLog: MAFCSystem.auditLog,
                        timestamp: new Date().toISOString()
                    };
                    localStorage.setItem('mafcBackup_' + Date.now(), JSON.stringify(backup));
                    
                    // Limpar tudo
                    MAFCSystem.timeRecords = {};
                    MAFCSystem.gpsLocations = [];
                    MAFCSystem.auditLog = [];
                    break;
                    
                case 'employee':
                    const clearType = document.getElementById('clearType').value;
                    if (clearType === 'person') {
                        const personId = parseInt(document.getElementById('clearPerson').value);
                        if (personId) {
                            // Remover registos desta pessoa
                            Object.keys(MAFCSystem.timeRecords).forEach(dateStr => {
                                if (MAFCSystem.timeRecords[dateStr][personId]) {
                                    delete MAFCSystem.timeRecords[dateStr][personId];
                                }
                            });
                        }
                    } else if (clearType === 'team') {
                        const teamName = document.getElementById('clearTeam').value;
                        if (teamName) {
                            // Remover registos desta equipa
                            const teamMembers = MAFCSystem.employees.filter(e => e.team === teamName);
                            teamMembers.forEach(member => {
                                Object.keys(MAFCSystem.timeRecords).forEach(dateStr => {
                                    if (MAFCSystem.timeRecords[dateStr][member.id]) {
                                        delete MAFCSystem.timeRecords[dateStr][member.id];
                                    }
                                });
                            });
                        }
                    }
                    break;
                    
                case 'period':
                    const dateFrom = document.getElementById('clearDateFrom').value;
                    const dateTo = document.getElementById('clearDateTo').value;
                    if (dateFrom && dateTo) {
                        const fromDate = new Date(dateFrom);
                        const toDate = new Date(dateTo);
                        
                        // Remover registos no período
                        Object.keys(MAFCSystem.timeRecords).forEach(dateStr => {
                            const recordDate = new Date(dateStr.split('/').reverse().join('-'));
                            if (recordDate >= fromDate && recordDate <= toDate) {
                                delete MAFCSystem.timeRecords[dateStr];
                            }
                        });
                    }
                    break;
            }
            
            MAFCSystem.saveToStorage();
            MAFCSystem.logAudit('history_clear', `Limpeza de histórico executada: ${MAFCSystem.selectedClearOption}`, 'sistema');
            
            alert('✅ Limpeza executada com sucesso!');
            
            // Atualizar interfaces
            if (MAFCSystem.currentUser.role === 'boss') {
                loadBossData();
            } else if (MAFCSystem.currentUser.role === 'office') {
                loadOfficeData();
            } else if (MAFCSystem.currentUser.role === 'team') {
                loadTeamData();
            }
            
            closeModal('clearHistoryModal');
        }
        
        function generateBackup() {
            const backup = {
                employees: MAFCSystem.employees,
                timeRecords: MAFCSystem.timeRecords,
                gpsLocations: MAFCSystem.gpsLocations,
                auditLog: MAFCSystem.auditLog,
                timestamp: new Date().toISOString(),
                generatedBy: MAFCSystem.currentUser.name
            };
            
            const backupStr = JSON.stringify(backup, null, 2);
            const blob = new Blob([backupStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `mafc_backup_${new Date().toISOString().slice(0, 10)}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            MAFCSystem.logAudit('backup_generate', 'Backup do sistema gerado', 'sistema');
            alert('✅ Backup gerado com sucesso!');
        }
        
        // ============ FUNÇÕES GERAIS ============
        function updateClocks() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('pt-PT');
            const timeShort = now.toLocaleTimeString('pt-PT', { hour: '2-digit', minute: '2-digit' });
            
            // Atualizar todos os relógios
            ['boss', 'team', 'purchase', 'office'].forEach(role => {
                const element = document.getElementById(`${role}CurrentTime`);
                if (element) element.textContent = timeShort;
            });
            
            // Relógios grandes
            ['officeClock', 'officeClockIndividual', 'teamCurrentTimeDisplay', 'purchaseCurrentTimeDisplay'].forEach(id => {
                const element = document.getElementById(id);
                if (element) element.textContent = timeShort;
            });
        }
        
        function initializeDashboard() {
            switch(MAFCSystem.currentUser.role) {
                case 'boss':
                    loadBossData();
                    break;
                case 'office':
                    loadOfficeData();
                    break;
                case 'team':
                    loadTeamData();
                    break;
                case 'purchase':
                    loadPurchaseData();
                    break;
            }
        }
        
        function loadSectionData(sectionId) {
            // Carregar dados específicos da seção
        }
        
        // ============ FUNÇÕES AUXILIARES ============
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
        
        function searchOfficePeople() {
            // Implementação simplificada
            const search = document.getElementById('officeSearchPerson').value.toLowerCase();
            const dept = document.getElementById('officeFilterDept').value;
            const status = document.getElementById('officeFilterStatus').value;
            
            const tbody = document.getElementById('officePeopleTable');
            const rows = tbody.getElementsByTagName('tr');
            
            for (let row of rows) {
                const cells = row.getElementsByTagName('td');
                const name = cells[0].textContent.toLowerCase();
                const department = cells[3].textContent.toLowerCase();
                const statusText = cells[4].textContent.toLowerCase();
                
                const matchesSearch = name.includes(search);
                const matchesDept = dept === 'all' || department.includes(dept);
                const matchesStatus = status === 'all' || statusText.includes(status);
                
                row.style.display = matchesSearch && matchesDept && matchesStatus ? '' : 'none';
            }
        }
        
        function searchBossPeople() {
            // Similar a searchOfficePeople
        }
        
        function filterEmployeeList() {
            // Implementação simplificada
        }
        
        // Funções de placeholder para funcionalidades não implementadas
        function showMissingEntries() {
            alert('Mostrando pessoas sem entrada registada...');
        }
        
        function showOldGPS() {
            alert('Mostrando localizações desatualizadas...');
        }
        
        function viewTeamGPS(teamName) {
            alert(`Mostrando GPS da equipa ${teamName}...`);
        }
        
        function contactTeam(teamName) {
            const message = `📞 MAFC Administração\n\nOlá equipa ${teamName},\n\nPrecisamos de atualização sobre a obra.\n\nObrigado!`;
            window.open(`https://wa.me/?text=${encodeURIComponent(message)}`, '_blank');
        }
        
        function viewTeamDetails(teamName) {
            alert(`Detalhes da equipa ${teamName}...`);
        }
        
        function editTimeRecord(date, personId) {
            alert(`Editar registo de horas...`);
        }
        
        function registerOfficeTime() {
            const select = document.getElementById('officePersonSelect');
            const timeType = document.getElementById('officeTimeType').value;
            const personId = parseInt(select.value);
            
            if (!personId) {
                alert('Selecione uma pessoa primeiro!');
                return;
            }
            
            markEmployeeTime(personId, timeType);
        }
        
        function loadPersonWhatsApp() {
            const select = document.getElementById('officePersonSelect');
            const whatsappInput = document.getElementById('officePersonWhatsApp');
            const personId = parseInt(select.value);
            
            if (personId) {
                const employee = MAFCSystem.employees.find(e => e.id === personId);
                whatsappInput.value = employee ? employee.whatsapp : '';
            } else {
                whatsappInput.value = '';
            }
        }
        
        function sendTimeWhatsApp() {
            const select = document.getElementById('officePersonSelect');
            const personId = parseInt(select.value);
            
            if (!personId) {
                alert('Selecione uma pessoa primeiro!');
                return;
            }
            
            const employee = MAFCSystem.employees.find(e => e.id === personId);
            if (employee) {
                const message = `⏰ Lembrete MAFC\n\nPor favor, registe as suas horas no sistema.\n\nObrigado!`;
                window.open(`https://wa.me/${employee.whatsapp.replace('+', '')}?text=${encodeURIComponent(message)}`, '_blank');
            }
        }
        
        function generateOfficeReport() {
            alert('Gerando extrato para contabilidade...\n\nEsta funcionalidade geraria um relatório completo para impressão.');
        }
        
        function printOfficeReportForAccounting() {
            alert('Imprimindo extrato para contabilidade...\n\nEm produção, isto geraria um documento formatado para impressão.');
        }
        
        function sendToAccountingWhatsApp() {
            const message = `📊 EXTRATO PARA CONTABILIDADE\n\nPreparado por: ${MAFCSystem.currentUser.name}\nData: ${new Date().toLocaleString('pt-PT')}\n\nMAFC & FILHO, LDA.`;
            window.open(`https://wa.me/?text=${encodeURIComponent(message)}`, '_blank');
        }
        
        function saveTeamInfo() {
            const currentTeam = MAFCSystem.teams.find(t => t.name === MAFCSystem.currentUser.team);
            if (currentTeam) {
                currentTeam.name = document.getElementById('teamName').value;
                currentTeam.location = document.getElementById('teamLocation').value;
                currentTeam.currentWork = document.getElementById('teamCurrentWork').value;
                currentTeam.status = document.getElementById('teamWorkStatus').value;
                
                MAFCSystem.saveToStorage();
                MAFCSystem.logAudit('team_update', `Atualizou informações da equipa ${currentTeam.name}`, 'equipa');
                
                alert('✅ Informações da equipa guardadas!');
                loadTeamData();
            }
        }
        
        function sendTeamUpdateToBoss() {
            const currentTeam = MAFCSystem.teams.find(t => t.name === MAFCSystem.currentUser.team);
            if (!currentTeam) return;
            
            const message = `📋 ATUALIZAÇÃO EQUIPA - ${currentTeam.name}\n\nLocalização: ${currentTeam.location}\nObra Atual: ${currentTeam.currentWork}\nStatus: ${currentTeam.status}\n\nReportado por: ${MAFCSystem.currentUser.name}\nHora: ${new Date().toLocaleString('pt-PT')}\n\nMAFC & FILHO, LDA.`;
            
            window.open(`https://wa.me/?text=${encodeURIComponent(message)}`, '_blank');
            
            MAFCSystem.logAudit('team_report_boss', `Reportou atualização ao patrão`, 'equipa');
        }
        
        function getTeamLocation() {
            getCurrentLocation();
        }
        
        function viewGPSDetails(id) {
            alert(`Detalhes do registo GPS #${id}...`);
        }
        
        function shareGPS(id) {
            const gps = MAFCSystem.gpsLocations.find(g => g.id === id);
            if (gps) {
                const message = `📍 LOCALIZAÇÃO GPS\n\nObra: ${gps.workName}\nEquipa: ${gps.team}\nCoordenadas: ${gps.coordinates}\n\nRegistado por: ${gps.recordedBy}\nHora: ${new Date(gps.timestamp).toLocaleString('pt-PT')}\n\nMAFC & FILHO, LDA.`;
                window.open(`https://wa.me/?text=${encodeURIComponent(message)}`, '_blank');
            }
        }
        
        function viewTeamGPSHistory(teamName) {
            alert(`Histórico GPS da equipa ${teamName}...`);
        }
        
        // Placeholder para funções do sistema de compras
        function newPurchaseOrder() {
            alert('Nova ordem de compra...');
        }
        
        function filterPurchaseDashboard() {
            // Filtro do dashboard de compras
        }
    </script>
</body>
    </html>
