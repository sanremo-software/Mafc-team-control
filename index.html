<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MAFC & FILHO, LDA. - Sistema de Gestão Completo</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ============ RESET E VARIÁVEIS ============ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #1a5f7a;
            --secondary: #2d9cdb;
            --accent: #ff9f1c;
            --dark: #003049;
            --light: #f8f9fa;
            --success: #27ae60;
            --warning: #f39c12;
            --danger: #e74c3c;
            --info: #17a2b8;
            --boss: #8e44ad;
            --team: #3498db;
            --purchase: #2ecc71;
            --office: #9b59b6;
            --construction: #e67e22;
            --gray: #6c757d;
            --light-gray: #e9ecef;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: var(--light);
            overflow-x: hidden;
        }

        .container {
            width: 90%;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* ============ PÁGINA PÚBLICA ============ */
        #publicWebsite {
            min-height: 100vh;
        }

        /* Header Público */
        .public-header {
            background: linear-gradient(135deg, var(--dark), var(--primary));
            color: white;
            padding: 1.5rem 0;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        }

        .nav-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo i {
            font-size: 2.8rem;
            color: var(--accent);
        }

        .logo-text h1 {
            font-size: 1.8rem;
            font-weight: 800;
        }

        .logo-text span {
            color: var(--accent);
            font-size: 1rem;
            display: block;
            margin-top: 5px;
        }

        .cta-buttons {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        /* Botões */
        .btn {
            padding: 12px 30px;
            border-radius: 50px;
            font-weight: 600;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            white-space: nowrap;
        }

        .btn-whatsapp {
            background: #25D366;
            color: white;
        }

        .btn-whatsapp:hover {
            background: #1da851;
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(37, 211, 102, 0.4);
        }

        .btn-email {
            background: var(--accent);
            color: var(--dark);
        }

        .btn-email:hover {
            background: #ffb143;
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(255, 159, 28, 0.3);
        }

        .btn-login {
            background: var(--primary);
            color: white;
        }

        .btn-login:hover {
            background: var(--dark);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(26, 95, 122, 0.3);
        }

        /* Hero Section */
        .hero {
            background: linear-gradient(rgba(0, 48, 73, 0.88), rgba(0, 48, 73, 0.92)), 
                        url('https://images.unsplash.com/photo-1504307651254-35680f356dfd?ixlib=rb-4.0.3&auto=format&fit=crop&w=1800&q=80');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            color: white;
            padding: 180px 0 120px;
            text-align: center;
            margin-top: 80px;
        }

        .hero h2 {
            font-size: 3.8rem;
            margin-bottom: 25px;
            font-weight: 900;
            text-transform: uppercase;
            text-shadow: 3px 3px 8px rgba(0,0,0,0.4);
            line-height: 1.2;
        }

        .hero p {
            font-size: 1.4rem;
            max-width: 850px;
            margin: 0 auto 50px;
            opacity: 0.95;
            line-height: 1.8;
        }

        .hero-buttons {
            display: flex;
            gap: 25px;
            justify-content: center;
            margin-top: 40px;
            flex-wrap: wrap;
        }

        /* Galeria de Projetos */
        .gallery {
            padding: 100px 0;
            background: white;
        }

        .section-title {
            text-align: center;
            font-size: 2.8rem;
            color: var(--dark);
            margin-bottom: 70px;
            position: relative;
            font-weight: 800;
        }

        .section-title:after {
            content: '';
            position: absolute;
            bottom: -20px;
            left: 50%;
            transform: translateX(-50%);
            width: 120px;
            height: 5px;
            background: var(--accent);
            border-radius: 10px;
        }

        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-top: 60px;
        }

        .gallery-item {
            border-radius: 15px;
            overflow: hidden;
            position: relative;
            height: 250px;
            cursor: pointer;
        }

        .gallery-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s;
        }

        .gallery-item:hover img {
            transform: scale(1.1);
        }

        .gallery-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent, rgba(0,0,0,0.8));
            color: white;
            padding: 20px;
            transform: translateY(100%);
            transition: transform 0.3s;
        }

        .gallery-item:hover .gallery-overlay {
            transform: translateY(0);
        }

        /* ============ MODAL LOGIN ============ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: white;
            width: 90%;
            max-width: 500px;
            border-radius: 20px;
            overflow: hidden;
            animation: modalSlideIn 0.4s;
            box-shadow: 0 25px 50px rgba(0,0,0,0.3);
        }

        @keyframes modalSlideIn {
            from { transform: translateY(-50px) scale(0.9); opacity: 0; }
            to { transform: translateY(0) scale(1); opacity: 1; }
        }

        .modal-header {
            background: linear-gradient(135deg, var(--dark), var(--primary));
            color: white;
            padding: 25px;
            text-align: center;
            position: relative;
        }

        .modal-header h2 {
            font-size: 2rem;
            font-weight: 700;
        }

        .close-modal {
            position: absolute;
            top: 20px;
            right: 25px;
            font-size: 1.8rem;
            cursor: pointer;
            color: white;
            transition: color 0.3s;
        }

        .close-modal:hover {
            color: var(--accent);
        }

        .modal-body {
            padding: 50px;
        }

        .form-group {
            margin-bottom: 30px;
        }

        .form-group label {
            display: block;
            margin-bottom: 10px;
            color: var(--dark);
            font-weight: 600;
            font-size: 1.1rem;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 15px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1.1rem;
            transition: all 0.3s;
            background: #f8f9fa;
        }

        .form-group input:focus, .form-group select:focus {
            border-color: var(--primary);
            outline: none;
            background: white;
            box-shadow: 0 0 0 3px rgba(26, 95, 122, 0.1);
        }

        .login-submit {
            background: linear-gradient(135deg, var(--primary), var(--dark));
            color: white;
            border: none;
            padding: 18px 40px;
            border-radius: 12px;
            font-size: 1.2rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .login-submit:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(26, 95, 122, 0.3);
            background: linear-gradient(135deg, var(--dark), var(--primary));
        }

        /* ============ DASHBOARDS ============ */
        .dashboard {
            display: none;
            min-height: 100vh;
            background: #f0f2f5;
        }

        /* Top Bar Horizontal */
        .top-bar {
            background: white;
            padding: 0;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            border-bottom: 5px solid;
        }

        /* Cores diferentes para cada dashboard */
        .boss-dashboard .top-bar {
            border-bottom-color: var(--boss);
            background: linear-gradient(135deg, #9b59b6, var(--boss));
        }

        .team-dashboard .top-bar {
            border-bottom-color: var(--team);
            background: linear-gradient(135deg, #3498db, #2980b9);
        }

        .purchase-dashboard .top-bar {
            border-bottom-color: var(--purchase);
            background: linear-gradient(135deg, #2ecc71, #27ae60);
        }

        .office-dashboard .top-bar {
            border-bottom-color: var(--office);
            background: linear-gradient(135deg, var(--office), #8e44ad);
        }

        .top-bar-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
        }

        .dashboard-brand {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .dashboard-brand i {
            font-size: 2.2rem;
            color: white;
        }

        .dashboard-brand h1 {
            color: white;
            font-size: 1.8rem;
            font-weight: 700;
        }

        .dashboard-info {
            display: flex;
            align-items: center;
            gap: 25px;
            color: white;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
            background: rgba(255,255,255,0.15);
            padding: 10px 20px;
            border-radius: 50px;
            backdrop-filter: blur(10px);
        }

        .user-info i {
            font-size: 1.4rem;
        }

        .logout-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid rgba(255,255,255,0.3);
            padding: 10px 25px;
            border-radius: 50px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
            backdrop-filter: blur(10px);
        }

        .logout-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
            border-color: white;
        }

        /* Menu Horizontal */
        .horizontal-menu {
            background: white;
            margin-top: 70px;
            padding: 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            position: fixed;
            width: 100%;
            z-index: 999;
            overflow-x: auto;
        }

        .menu-container {
            display: flex;
            gap: 5px;
            padding: 0;
            width: 100%;
        }

        .menu-item {
            padding: 20px 30px;
            color: #555;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 15px;
            font-weight: 600;
            white-space: nowrap;
            border-bottom: 4px solid transparent;
            transition: all 0.3s;
            position: relative;
        }

        .menu-item:hover {
            color: var(--primary);
            background: #f8f9fa;
        }

        .menu-item.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
            background: #f0f7ff;
        }

        .menu-item i {
            font-size: 1.2rem;
        }

        .menu-badge {
            background: var(--accent);
            color: white;
            font-size: 0.75rem;
            padding: 3px 8px;
            border-radius: 20px;
            margin-left: 8px;
            font-weight: 700;
        }

        /* Conteúdo do Dashboard */
        .dashboard-content {
            margin-top: 140px;
            padding: 20px 30px 80px;
            background: #f0f2f5;
            min-height: calc(100vh - 140px);
        }

        /* MENU NO FUNDO */
        .bottom-menu {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: white;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.1);
            z-index: 1000;
            overflow-x: auto;
        }

        .bottom-menu-container {
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
        }

        .bottom-menu-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px 15px;
            color: #666;
            text-decoration: none;
            font-size: 0.85rem;
            text-align: center;
            min-width: 80px;
            border-radius: 10px;
            transition: all 0.3s;
            position: relative;
        }

        .bottom-menu-item:hover {
            background: #f8f9fa;
            color: var(--primary);
        }

        .bottom-menu-item.active {
            color: var(--primary);
            background: #f0f7ff;
        }

        .bottom-menu-item i {
            font-size: 1.4rem;
            margin-bottom: 5px;
        }

        .bottom-menu-badge {
            position: absolute;
            top: 5px;
            right: 5px;
            background: var(--accent);
            color: white;
            font-size: 0.7rem;
            padding: 2px 5px;
            border-radius: 50%;
            min-width: 18px;
            text-align: center;
        }

        /* Dashboard Sections */
        .dashboard-section {
            display: none;
            animation: fadeIn 0.3s;
        }

        .dashboard-section.active {
            display: block;
        }

        /* Cards de Estatísticas */
        .stats-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .stat-card-horizontal {
            background: white;
            padding: 25px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            gap: 20px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.08);
            border-left: 6px solid;
            transition: transform 0.3s;
        }

        .stat-card-horizontal:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 30px rgba(0,0,0,0.12);
        }

        .boss-dashboard .stat-card-horizontal { border-left-color: var(--boss); }
        .team-dashboard .stat-card-horizontal { border-left-color: var(--team); }
        .purchase-dashboard .stat-card-horizontal { border-left-color: var(--purchase); }
        .office-dashboard .stat-card-horizontal { border-left-color: var(--office); }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            color: white;
        }

        .boss-dashboard .stat-icon { background: linear-gradient(135deg, var(--boss), #9b59b6); }
        .team-dashboard .stat-icon { background: linear-gradient(135deg, var(--team), #3498db); }
        .purchase-dashboard .stat-icon { background: linear-gradient(135deg, var(--purchase), #2ecc71); }
        .office-dashboard .stat-icon { background: linear-gradient(135deg, var(--office), #9b59b6); }

        .stat-info h3 {
            font-size: 2.2rem;
            color: var(--dark);
            margin-bottom: 5px;
            font-weight: 800;
        }

        .stat-info p {
            color: #666;
            font-weight: 600;
            font-size: 1rem;
        }

        /* Grids de Conteúdo */
        .content-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        /* Cards de Conteúdo */
        .content-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.08);
            transition: transform 0.3s;
        }

        .content-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 30px rgba(0,0,0,0.12);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .card-header h3 {
            color: var(--dark);
            font-size: 1.4rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .card-header h3 i {
            color: var(--primary);
        }

        /* Botões Dashboard */
        .btn-dashboard {
            padding: 12px 25px;
            border-radius: 10px;
            font-weight: 600;
            border: none;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
            font-size: 1rem;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--dark);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(26, 95, 122, 0.3);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover {
            background: #219653;
            transform: translateY(-3px);
        }

        .btn-warning {
            background: var(--warning);
            color: white;
        }

        .btn-warning:hover {
            background: #e67e22;
            transform: translateY(-3px);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background: #c0392b;
            transform: translateY(-3px);
        }

        .btn-info {
            background: var(--info);
            color: white;
        }

        .btn-info:hover {
            background: #138496;
            transform: translateY(-3px);
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 0.85rem;
        }

        /* Tabelas */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }

        .data-table th {
            background: var(--primary);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
            font-size: 1rem;
        }

        .data-table td {
            padding: 15px;
            border-bottom: 1px solid #f0f0f0;
        }

        .data-table tr:hover {
            background: #f8f9fa;
        }

        /* Badges */
        .badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 700;
            display: inline-block;
        }

        .badge-success { background: #d5f4e6; color: var(--success); }
        .badge-warning { background: #fff3cd; color: var(--warning); }
        .badge-danger { background: #f8d7da; color: var(--danger); }
        .badge-primary { background: #d1ecf1; color: var(--secondary); }
        .badge-info { background: #d1ecf1; color: #17a2b8; }
        .badge-secondary { background: #e2e3e5; color: #6c757d; }

        /* Formulários */
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group-dashboard {
            margin-bottom: 20px;
        }

        .form-group-dashboard label {
            display: block;
            margin-bottom: 8px;
            color: var(--dark);
            font-weight: 600;
            font-size: 1rem;
        }

        .form-group-dashboard input,
        .form-group-dashboard select,
        .form-group-dashboard textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s;
            background: #f8f9fa;
        }

        .form-group-dashboard input:focus,
        .form-group-dashboard select:focus,
        .form-group-dashboard textarea:focus {
            border-color: var(--primary);
            outline: none;
            background: white;
            box-shadow: 0 0 0 3px rgba(26, 95, 122, 0.1);
        }

        .form-actions {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #f0f0f0;
        }

        /* Time Tracker */
        .time-tracker {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 25px;
        }

        .time-display {
            font-size: 3.5rem;
            font-weight: 800;
            text-align: center;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .time-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        /* Sistema de Alertas */
        .alert {
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border-left: 5px solid var(--success);
        }

        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border-left: 5px solid var(--warning);
        }

        .alert-danger {
            background: #f8d7da;
            color: #721c24;
            border-left: 5px solid var(--danger);
        }

        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border-left: 5px solid var(--info);
        }

        /* Sistema de Filtros */
        .filter-bar {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        /* Loading Spinner */
        .loading-spinner {
            display: none;
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsividade */
        @media (max-width: 1200px) {
            .content-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 992px) {
            .hero h2 {
                font-size: 2.8rem;
            }
            
            .section-title {
                font-size: 2.3rem;
            }
            
            .dashboard-content {
                padding: 15px;
            }
            
            .bottom-menu-item {
                padding: 8px 10px;
                font-size: 0.8rem;
                min-width: 70px;
            }
        }

        @media (max-width: 768px) {
            .hero {
                padding: 150px 0 80px;
            }
            
            .hero h2 {
                font-size: 2.2rem;
            }
            
            .hero p {
                font-size: 1.2rem;
            }
            
            .stats-row {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .top-bar-content {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .dashboard-info {
                flex-direction: column;
                gap: 15px;
            }
            
            .content-card {
                padding: 20px;
            }
            
            .time-display {
                font-size: 2.8rem;
            }
        }

        @media (max-width: 480px) {
            .hero h2 {
                font-size: 1.8rem;
            }
            
            .section-title {
                font-size: 1.8rem;
            }
            
            .btn {
                padding: 10px 20px;
                font-size: 0.9rem;
            }
            
            .dashboard-content {
                padding: 10px;
            }
        }

        /* Notificações */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
            z-index: 9999;
            display: flex;
            align-items: center;
            gap: 15px;
            transform: translateX(150%);
            transition: transform 0.3s;
            max-width: 400px;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification-success {
            border-left: 5px solid var(--success);
        }

        .notification-error {
            border-left: 5px solid var(--danger);
        }

        .notification-warning {
            border-left: 5px solid var(--warning);
        }

        /* Progress Bar */
        .progress-bar {
            width: 100%;
            height: 10px;
            background: #e0e0e0;
            border-radius: 5px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            transition: width 0.3s;
        }

        /* Calendário */
        .calendar {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
        }

        .calendar-day {
            padding: 10px;
            text-align: center;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .calendar-day:hover {
            background: #f0f7ff;
        }

        .calendar-day.today {
            background: var(--primary);
            color: white;
        }

        .calendar-day.event {
            background: #fff3cd;
            border: 2px solid var(--warning);
        }
    </style>
</head>
<body>
    <!-- ============ PÁGINA PÚBLICA ============ -->
    <div id="publicWebsite">
        <!-- Header Público -->
        <header class="public-header">
            <div class="container nav-container">
                <div class="logo">
                    <i class="fas fa-hard-hat"></i>
                    <div class="logo-text">
                        <h1>MAFC & FILHO, LDA.</h1>
                        <span>Construção Civil & Obras Públicas | Desde 2001</span>
                    </div>
                </div>
                <div class="cta-buttons">
                    <a href="https://wa.me/351123456789?text=Olá MAFC,%20gostaria%20de%20solicitar%20um%20orçamento%20para%20uma%20obra" 
                       class="btn btn-whatsapp" target="_blank">
                        <i class="fab fa-whatsapp"></i> WhatsApp
                    </a>
                    <a href="mailto:orcamentos@mafc-filho.pt?subject=Solicitação de Orçamento&body=Olá MAFC,%0D%0A%0D%0AGostaria de solicitar um orçamento para:" 
                       class="btn btn-email">
                        <i class="fas fa-envelope"></i> Pedir Orçamento
                    </a>
                    <a href="#" class="btn btn-login" id="openLogin">
                        <i class="fas fa-sign-in-alt"></i> Acesso Sistema
                    </a>
                </div>
            </div>
        </header>

        <!-- Hero Section -->
        <section class="hero">
            <div class="container">
                <h2>Especialistas em Construção Civil e Obras Públicas</h2>
                <p>Mais de 20 anos de experiência em saneamento, abastecimento de água, redes de fibra óptica, pavimentação e infraestruturas. Operação em Portugal e Alemanha com 15 equipas especializadas.</p>
                <div class="hero-buttons">
                    <a href="#gallery" class="btn btn-email">
                        <i class="fas fa-hard-hat"></i> Ver Projetos
                    </a>
                    <a href="mailto:orcamentos@mafc-filho.pt" class="btn btn-whatsapp">
                        <i class="fas fa-calculator"></i> Orçamento Grátis
                    </a>
                </div>
            </div>
        </section>

        <!-- Galeria de Projetos -->
        <section class="gallery" id="gallery">
            <div class="container">
                <h2 class="section-title">Nossos Projetos</h2>
                <div class="gallery-grid">
                    <div class="gallery-item">
                        <img src="https://images.unsplash.com/photo-1541888946425-d81bb19240f5?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80" alt="Saneamento">
                        <div class="gallery-overlay">
                            <h3>Sistema de Saneamento</h3>
                            <p>Rede de águas pluviais em Berlim</p>
                        </div>
                    </div>
                    <div class="gallery-item">
                        <img src="https://images.unsplash.com/photo-1504917595217-d4dc5ebe6122?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80" alt="Fibra Óptica">
                        <div class="gallery-overlay">
                            <h3>Redes de Fibra Óptica</h3>
                            <p>Infraestrutura de telecomunicações</p>
                        </div>
                    </div>
                    <div class="gallery-item">
                        <img src="https://images.unsplash.com/photo-1519501025264-65ba15a82390?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80" alt="Pavimentação">
                        <div class="gallery-overlay">
                            <h3>Pavimentação Urbana</h3>
                            <p>Reabilitação de vias públicas</p>
                        </div>
                    </div>
                    <div class="gallery-item">
                        <img src="https://images.unsplash.com/photo-1541625602330-2277a4c46182?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80" alt="Infraestruturas">
                        <div class="gallery-overlay">
                            <h3>Infraestruturas EDP</h3>
                            <p>Instalação elétrica e gás natural</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer class="public-footer" style="background: var(--dark); color: white; padding: 80px 0 40px;">
            <div class="container">
                <div class="footer-content">
                    <div>
                        <h3>MAFC & FILHO, LDA.</h3>
                        <p>Constituída em 2001, somos especialistas em construção civil e obras públicas com operação em Portugal e Alemanha.</p>
                        <p><i class="fas fa-phone"></i> +351 123 456 789</p>
                        <p><i class="fas fa-envelope"></i> geral@mafc-filho.pt</p>
                    </div>
                </div>
                <div class="copyright">
                    <p>&copy; 2001-2024 MAFC & FILHO, LDA. - Todos os direitos reservados.</p>
                </div>
            </div>
        </footer>
    </div>

    <!-- ============ MODAL DE LOGIN ============ -->
    <div class="modal" id="loginModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-lock"></i> Acesso ao Sistema MAFC</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="loginForm">
                    <div class="form-group">
                        <label for="username"><i class="fas fa-user"></i> Código de Acesso</label>
                        <input type="text" id="username" placeholder="Digite seu código" required>
                    </div>
                    <div class="form-group">
                        <label for="password"><i class="fas fa-key"></i> Senha</label>
                        <input type="password" id="password" placeholder="Digite sua senha" required>
                    </div>
                    <div class="form-group">
                        <label for="role"><i class="fas fa-user-tag"></i> Tipo de Acesso</label>
                        <select id="role" required>
                            <option value="">Selecione o tipo de acesso</option>
                            <option value="boss">Administração Geral</option>
                            <option value="team">Chefe de Equipa</option>
                            <option value="purchase">Responsável de Compras</option>
                            <option value="office">Escritório</option>
                        </select>
                    </div>
                    <button type="submit" class="login-submit">
                        <i class="fas fa-sign-in-alt"></i> Entrar no Sistema
                    </button>
                    <div class="login-help" style="margin-top: 20px; font-size: 0.9rem; color: #666; text-align: center;">
                        <p><strong>Credenciais de Teste:</strong><br>
                        Admin: mafc / 1234<br>
                        Equipas: equipa01 a equipa15 / 1234<br>
                        Compras: compras01 / 1234<br>
                        Escritório: escritorio / 1234</p>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- ============ NOTIFICAÇÕES ============ -->
    <div id="notificationArea"></div>

    <!-- ============ DASHBOARD DO PATRÃO/ADMIN ============ -->
    <div class="dashboard boss-dashboard" id="bossDashboard">
        <!-- Top Bar -->
        <div class="top-bar">
            <div class="container top-bar-content">
                <div class="dashboard-brand">
                    <i class="fas fa-crown"></i>
                    <h1>Painel Administrativo - MAFC</h1>
                </div>
                <div class="dashboard-info">
                    <div class="user-info">
                        <i class="fas fa-user-circle"></i>
                        <span id="bossUserName">Administrador</span>
                    </div>
                    <div id="bossCurrentTime" style="font-weight: 600;">10:45 AM</div>
                    <button class="logout-btn" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i> Sair
                    </button>
                </div>
            </div>
        </div>

        <!-- Menu Horizontal -->
        <nav class="horizontal-menu">
            <div class="container menu-container">
                <a href="#" class="menu-item active" data-section="bossOverview">
                    <i class="fas fa-tachometer-alt"></i> Visão Geral
                </a>
                <a href="#" class="menu-item" data-section="bossTeams">
                    <i class="fas fa-users"></i> Equipas
                    <span class="menu-badge" id="teamsBadge">15</span>
                </a>
                <a href="#" class="menu-item" data-section="bossPurchases">
                    <i class="fas fa-shopping-cart"></i> Compras
                    <span class="menu-badge" id="purchasesBadge">24</span>
                </a>
                <a href="#" class="menu-item" data-section="bossFinances">
                    <i class="fas fa-euro-sign"></i> Finanças
                </a>
                <a href="#" class="menu-item" data-section="bossHours">
                    <i class="fas fa-clock"></i> Controlo Horas
                </a>
                <a href="#" class="menu-item" data-section="bossReports">
                    <i class="fas fa-chart-bar"></i> Relatórios
                </a>
                <a href="#" class="menu-item" data-section="bossAudit">
                    <i class="fas fa-shield-alt"></i> Auditoria
                </a>
                <a href="#" class="menu-item" data-section="bossSettings">
                    <i class="fas fa-cog"></i> Configurações
                </a>
            </div>
        </nav>

        <!-- Conteúdo -->
        <div class="dashboard-content">
            <!-- Visão Geral -->
            <div class="dashboard-section active" id="bossOverviewSection">
                <div class="stats-row">
                    <div class="stat-card-horizontal">
                        <div class="stat-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="totalEmployees">45</h3>
                            <p>Total Colaboradores</p>
                        </div>
                    </div>
                    <div class="stat-card-horizontal">
                        <div class="stat-icon">
                            <i class="fas fa-hard-hat"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="activeTeams">15</h3>
                            <p>Equipas Ativas</p>
                        </div>
                    </div>
                    <div class="stat-card-horizontal">
                        <div class="stat-icon">
                            <i class="fas fa-euro-sign"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="monthExpenses">€85.2K</h3>
                            <p>Despesas Mês</p>
                        </div>
                    </div>
                    <div class="stat-card-horizontal">
                        <div class="stat-icon">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="pendingItems">24</h3>
                            <p>Pendentes</p>
                        </div>
                    </div>
                </div>

                <div class="content-grid">
                    <!-- Alertas Recentes -->
                    <div class="content-card">
                        <div class="card-header">
                            <h3><i class="fas fa-bell"></i> Alertas Recentes</h3>
                            <button class="btn-dashboard btn-primary" onclick="markAllAlertsRead()">
                                <i class="fas fa-check-double"></i> Marcar Lidas
                            </button>
                        </div>
                        <div id="bossAlerts">
                            <!-- Alertas serão carregados aqui -->
                        </div>
                    </div>

                    <!-- Atividade Recente -->
                    <div class="content-card">
                        <div class="card-header">
                            <h3><i class="fas fa-history"></i> Atividade do Sistema</h3>
                            <button class="btn-dashboard btn-info" onclick="refreshActivity()">
                                <i class="fas fa-sync-alt"></i> Atualizar
                            </button>
                        </div>
                        <div style="max-height: 300px; overflow-y: auto;">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Data/Hora</th>
                                        <th>Utilizador</th>
                                        <th>Ação</th>
                                        <th>Detalhes</th>
                                    </tr>
                                </thead>
                                <tbody id="bossActivityLog">
                                    <!-- Log de atividades será carregado aqui -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Calendário de Obras -->
                <div class="content-card" style="margin-top: 30px;">
                    <div class="card-header">
                        <h3><i class="fas fa-calendar-alt"></i> Calendário de Obras</h3>
                        <div style="display: flex; gap: 10px;">
                            <button class="btn-dashboard btn-primary" onclick="prevMonth()">
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <button class="btn-dashboard btn-primary" onclick="nextMonth()">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                            <button class="btn-dashboard btn-success" onclick="addEvent()">
                                <i class="fas fa-plus"></i> Novo Evento
                            </button>
                        </div>
                    </div>
                    <div class="calendar">
                        <div class="calendar-header">
                            <h4 id="currentMonth">Dezembro 2024</h4>
                        </div>
                        <div class="calendar-grid" id="calendarGrid">
                            <!-- Calendário será gerado dinamicamente -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Equipas -->
            <div class="dashboard-section" id="bossTeamsSection">
                <div class="content-card">
                    <div class="card-header">
                        <h3><i class="fas fa-users"></i> Gestão de Equipas</h3>
                        <button class="btn-dashboard btn-primary" onclick="addNewTeam()">
                            <i class="fas fa-plus"></i> Nova Equipa
                        </button>
                    </div>
                    
                    <div class="filter-bar">
                        <input type="text" id="searchTeam" placeholder="Pesquisar equipa..." onkeyup="filterTeams()">
                        <select id="filterTeamLocation" onchange="filterTeams()">
                            <option value="all">Todas Localizações</option>
                            <option value="germany">Alemanha</option>
                            <option value="portugal">Portugal</option>
                        </select>
                        <select id="filterTeamStatus" onchange="filterTeams()">
                            <option value="all">Todos Estados</option>
                            <option value="active">Ativas</option>
                            <option value="inactive">Inativas</option>
                        </select>
                    </div>

                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Equipa</th>
                                <th>Localização</th>
                                <th>Chefe</th>
                                <th>Membros</th>
                                <th>Obra Atual</th>
                                <th>Estado</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="bossTeamsTable">
                            <!-- Equipas serão carregadas aqui -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Compras -->
            <div class="dashboard-section" id="bossPurchasesSection">
                <div class="content-card">
                    <div class="card-header">
                        <h3><i class="fas fa-shopping-cart"></i> Controle de Compras</h3>
                        <button class="btn-dashboard btn-info" onclick="generatePurchaseReport()">
                            <i class="fas fa-file-excel"></i> Exportar Excel
                        </button>
                    </div>

                    <div class="filter-bar">
                        <select id="filterPurchaseStatus" onchange="filterPurchases()">
                            <option value="all">Todos Estados</option>
                            <option value="pending">Pendentes</option>
                            <option value="approved">Aprovadas</option>
                            <option value="completed">Completadas</option>
                            <option value="cancelled">Canceladas</option>
                        </select>
                        <input type="date" id="filterPurchaseDateFrom" onchange="filterPurchases()">
                        <input type="date" id="filterPurchaseDateTo" onchange="filterPurchases()">
                        <input type="text" id="searchPurchase" placeholder="Pesquisar..." onkeyup="filterPurchases()">
                    </div>

                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Nº Pedido</th>
                                <th>Equipa</th>
                                <th>Material</th>
                                <th>Quantidade</th>
                                <th>Valor</th>
                                <th>Data Pedido</th>
                                <th>Estado</th>
                                <th>Responsável</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="bossPurchasesTable">
                            <!-- Compras serão carregadas aqui -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Finanças -->
            <div class="dashboard-section" id="bossFinancesSection">
                <div class="content-card">
                    <div class="card-header">
                        <h3><i class="fas fa-euro-sign"></i> Gestão Financeira</h3>
                        <button class="btn-dashboard btn-success" onclick="generateFinancialReport()">
                            <i class="fas fa-file-pdf"></i> Relatório Mensal
                        </button>
                    </div>
                    
                    <div class="stats-row">
                        <div class="stat-card-horizontal">
                            <div class="stat-icon">
                                <i class="fas fa-money-bill-wave"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="totalRevenue">€245.8K</h3>
                                <p>Receitas Mês</p>
                            </div>
                        </div>
                        <div class="stat-card-horizontal">
                            <div class="stat-icon">
                                <i class="fas fa-receipt"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="totalExpenses">€85.2K</h3>
                                <p>Despesas Mês</p>
                            </div>
                        </div>
                        <div class="stat-card-horizontal">
                            <div class="stat-icon">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="profitMargin">32.5%</h3>
                                <p>Margem de Lucro</p>
                            </div>
                        </div>
                        <div class="stat-card-horizontal">
                            <div class="stat-icon">
                                <i class="fas fa-wallet"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="cashFlow">€160.6K</h3>
                                <p>Fluxo de Caixa</p>
                            </div>
                        </div>
                    </div>

                    <div class="content-grid">
                        <div class="content-card">
                            <h4><i class="fas fa-chart-pie"></i> Distribuição de Despesas</h4>
                            <div style="height: 300px; display: flex; align-items: center; justify-content: center;">
                                <canvas id="expensesChart"></canvas>
                            </div>
                        </div>
                        
                        <div class="content-card">
                            <h4><i class="fas fa-file-invoice-dollar"></i> Últimas Faturas</h4>
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Nº Fatura</th>
                                        <th>Cliente</th>
                                        <th>Valor</th>
                                        <th>Vencimento</th>
                                        <th>Estado</th>
                                    </tr>
                                </thead>
                                <tbody id="invoicesTable">
                                    <!-- Faturas serão carregadas aqui -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Controlo Horas -->
            <div class="dashboard-section" id="bossHoursSection">
                <div class="content-card">
                    <div class="card-header">
                        <h3><i class="fas fa-clock"></i> Controlo de Horas</h3>
                        <button class="btn-dashboard btn-info" onclick="generateHoursReport()">
                            <i class="fas fa-file-excel"></i> Exportar Horas
                        </button>
                    </div>
                    
                    <div class="filter-bar">
                        <select id="filterHoursMonth" onchange="filterHours()">
                            <option value="12-2024">Dezembro 2024</option>
                            <option value="11-2024">Novembro 2024</option>
                            <option value="10-2024">Outubro 2024</option>
                        </select>
                        <select id="filterHoursTeam" onchange="filterHours()">
                            <option value="all">Todas Equipas</option>
                        </select>
                    </div>

                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Nome</th>
                                <th>Equipa</th>
                                <th>Horas Normais</th>
                                <th>Horas Extra</th>
                                <th>Total Horas</th>
                                <th>Valor</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="bossHoursTable">
                            <!-- Horas serão carregadas aqui -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Relatórios -->
            <div class="dashboard-section" id="bossReportsSection">
                <div class="content-card">
                    <div class="card-header">
                        <h3><i class="fas fa-chart-bar"></i> Relatórios e Estatísticas</h3>
                        <button class="btn-dashboard btn-primary" onclick="exportAllReports()">
                            <i class="fas fa-download"></i> Exportar Todos
                        </button>
                    </div>
                    
                    <div class="content-grid">
                        <div class="content-card">
                            <h4><i class="fas fa-chart-line"></i> Performance Mensal</h4>
                            <div style="height: 250px;">
                                <canvas id="performanceChart"></canvas>
                            </div>
                        </div>
                        
                        <div class="content-card">
                            <h4><i class="fas fa-tasks"></i> KPIs Principais</h4>
                            <div style="display: grid; gap: 15px; margin-top: 20px;">
                                <div>
                                    <label>Produtividade Equipas</label>
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: 85%;"></div>
                                    </div>
                                    <span>85%</span>
                                </div>
                                <div>
                                    <label>Satisfação Clientes</label>
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: 92%;"></div>
                                    </div>
                                    <span>92%</span>
                                </div>
                                <div>
                                    <label>Conclusão de Obras</label>
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: 78%;"></div>
                                    </div>
                                    <span>78%</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div style="margin-top: 30px;">
                        <h4><i class="fas fa-file-alt"></i> Relatórios Disponíveis</h4>
                        <div class="form-row">
                            <button class="btn-dashboard btn-info" onclick="generateReport('monthly')">
                                <i class="fas fa-calendar-alt"></i> Relatório Mensal
                            </button>
                            <button class="btn-dashboard btn-info" onclick="generateReport('teams')">
                                <i class="fas fa-users"></i> Relatório de Equipas
                            </button>
                            <button class="btn-dashboard btn-info" onclick="generateReport('financial')">
                                <i class="fas fa-euro-sign"></i> Relatório Financeiro
                            </button>
                            <button class="btn-dashboard btn-info" onclick="generateReport('hours')">
                                <i class="fas fa-clock"></i> Relatório de Horas
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Auditoria -->
            <div class="dashboard-section" id="bossAuditSection">
                <div class="content-card">
                    <div class="card-header">
                        <h3><i class="fas fa-shield-alt"></i> Log de Auditoria</h3>
                        <button class="btn-dashboard btn-danger" onclick="clearAuditLog()">
                            <i class="fas fa-trash"></i> Limpar Log
                        </button>
                    </div>

                    <div class="filter-bar">
                        <input type="date" id="auditDateFrom" onchange="filterAudit()">
                        <input type="date" id="auditDateTo" onchange="filterAudit()">
                        <select id="auditUserFilter" onchange="filterAudit()">
                            <option value="all">Todos Utilizadores</option>
                        </select>
                        <select id="auditActionFilter" onchange="filterAudit()">
                            <option value="all">Todas Ações</option>
                            <option value="login">Login</option>
                            <option value="logout">Logout</option>
                            <option value="create">Criação</option>
                            <option value="update">Atualização</option>
                            <option value="delete">Eliminação</option>
                        </select>
                    </div>

                    <div style="max-height: 500px; overflow-y: auto;">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Data/Hora</th>
                                    <th>Utilizador</th>
                                    <th>IP</th>
                                    <th>Ação</th>
                                    <th>Detalhes</th>
                                    <th>Módulo</th>
                                </tr>
                            </thead>
                            <tbody id="bossAuditTable">
                                <!-- Log de auditoria será carregado aqui -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Configurações -->
            <div class="dashboard-section" id="bossSettingsSection">
                <div class="content-card">
                    <div class="card-header">
                        <h3><i class="fas fa-cog"></i> Configurações do Sistema</h3>
                        <button class="btn-dashboard btn-success" onclick="saveSettings()">
                            <i class="fas fa-save"></i> Guardar Configurações
                        </button>
                    </div>

                    <div class="form-row">
                        <div class="form-group-dashboard">
                            <label>Nome da Empresa</label>
                            <input type="text" id="companyName" value="MAFC & FILHO, LDA.">
                        </div>
                        <div class="form-group-dashboard">
                            <label>NIF</label>
                            <input type="text" id="companyNIF" value="500000000">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group-dashboard">
                            <label>Hora Normal de Trabalho (diária)</label>
                            <input type="number" id="normalHours" value="8" min="1" max="12">
                        </div>
                        <div class="form-group-dashboard">
                            <label>Valor Hora Extra (%)</label>
                            <input type="number" id="extraHourRate" value="125" min="100" max="200">
                        </div>
                    </div>

                    <div class="form-group-dashboard">
                        <label>Mensagem Automática WhatsApp</label>
                        <textarea id="whatsappMessage" rows="3">✅ MAFC - Registro de horas confirmado. Obrigado!</textarea>
                    </div>

                    <div class="form-group-dashboard">
                        <label>Backup Automático</label>
                        <select id="autoBackup">
                            <option value="daily">Diário</option>
                            <option value="weekly" selected>Semanal</option>
                            <option value="monthly">Mensal</option>
                            <option value="none">Nenhum</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <!-- MENU NO FUNDO PARA PATRÃO -->
        <nav class="bottom-menu">
            <div class="bottom-menu-container">
                <a href="#" class="bottom-menu-item active" data-section="bossOverview">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Visão Geral</span>
                </a>
                <a href="#" class="bottom-menu-item" data-section="bossTeams">
                    <i class="fas fa-users"></i>
                    <span>Equipas</span>
                    <span class="bottom-menu-badge" id="teamsCountBottom">15</span>
                </a>
                <a href="#" class="bottom-menu-item" data-section="bossHours">
                    <i class="fas fa-clock"></i>
                    <span>Controlo Horas</span>
                    <span class="bottom-menu-badge" id="pendingHoursBottom">42</span>
                </a>
                <a href="#" class="bottom-menu-item" data-section="bossPurchases">
                    <i class="fas fa-shopping-cart"></i>
                    <span>Compras</span>
                    <span class="bottom-menu-badge" id="pendingPurchasesBottom">12</span>
                </a>
                <a href="#" class="bottom-menu-item" data-section="bossFinances">
                    <i class="fas fa-euro-sign"></i>
                    <span>Finanças</span>
                </a>
                <a href="#" class="bottom-menu-item" data-section="bossReports">
                    <i class="fas fa-chart-bar"></i>
                    <span>Relatórios</span>
                </a>
                <a href="#" class="bottom-menu-item" data-section="bossAudit">
                    <i class="fas fa-shield-alt"></i>
                    <span>Auditoria</span>
                </a>
                <a href="#" class="bottom-menu-item" data-section="bossSettings">
                    <i class="fas fa-cog"></i>
                    <span>Configurações</span>
                </a>
            </div>
        </nav>
    </div>

    <!-- ============ DASHBOARD ESCRITÓRIO ============ -->
    <div class="dashboard office-dashboard" id="officeDashboard">
        <!-- Top Bar -->
        <div class="top-bar">
            <div class="container top-bar-content">
                <div class="dashboard-brand">
                    <i class="fas fa-building"></i>
                    <h1>Escritório - MAFC</h1>
                </div>
                <div class="dashboard-info">
                    <div class="user-info">
                        <i class="fas fa-user-tie"></i>
                        <span id="officeUserName">Escritório</span>
                    </div>
                    <div id="officeCurrentTime" style="font-weight: 600;">10:45 AM</div>
                    <button class="logout-btn" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i> Sair
                    </button>
                </div>
            </div>
        </div>

        <!-- Menu Horizontal -->
        <nav class="horizontal-menu">
            <div class="container menu-container">
                <a href="#" class="menu-item active" data-section="officeDashboard">
                    <i class="fas fa-home"></i> Dashboard
                </a>
                <a href="#" class="menu-item" data-section="officePeople">
                    <i class="fas fa-user-plus"></i> Pessoal
                </a>
                <a href="#" class="menu-item" data-section="officeTime">
                    <i class="fas fa-clock"></i> Marcar Horas
                </a>
                <a href="#" class="menu-item" data-section="officeReports">
                    <i class="fas fa-file-alt"></i> Meu Extrato
                </a>
                <a href="#" class="menu-item" data-section="officeDocuments">
                    <i class="fas fa-folder"></i> Documentos
                </a>
                <a href="#" class="menu-item" data-section="officeDrucker">
                    <i class="fas fa-print"></i> Drucker
                    <span class="menu-badge" id="printBadge">5</span>
                </a>
                <a href="#" class="menu-item" data-section="officeCalendar">
                    <i class="fas fa-calendar-alt"></i> Calendário
                </a>
            </div>
        </nav>

        <!-- Conteúdo -->
        <div class="dashboard-content">
            <!-- Dashboard Escritório -->
            <div class="dashboard-section active" id="officeDashboardSection">
                <div class="stats-row">
                    <div class="stat-card-horizontal">
                        <div class="stat-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="officePeopleCount">8</h3>
                            <p>Pessoal</p>
                        </div>
                    </div>
                    <div class="stat-card-horizontal">
                        <div class="stat-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="officeTodayHours">7.5</h3>
                            <p>Horas Hoje</p>
                        </div>
                    </div>
                    <div class="stat-card-horizontal">
                        <div class="stat-icon">
                            <i class="fas fa-file-alt"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="officeDocumentsCount">24</h3>
                            <p>Documentos</p>
                        </div>
                    </div>
                    <div class="stat-card-horizontal">
                        <div class="stat-icon">
                            <i class="fas fa-print"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="officePrintsToday">5</h3>
                            <p>Impressões</p>
                        </div>
                    </div>
                </div>

                <div class="content-grid">
                    <!-- Marcações Recentes -->
                    <div class="content-card">
                        <div class="card-header">
                            <h3><i class="fas fa-clock"></i> Marcações Hoje</h3>
                            <button class="btn-dashboard btn-primary" onclick="refreshTodayMarks()">
                                <i class="fas fa-sync-alt"></i> Atualizar
                            </button>
                        </div>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Nome</th>
                                    <th>Entrada</th>
                                    <th>Saída</th>
                                    <th>Total</th>
                                    <th>WhatsApp</th>
                                </tr>
                            </thead>
                            <tbody id="officeTodayMarks">
                                <!-- Marcações serão carregadas aqui -->
                            </tbody>
                        </table>
                    </div>

                    <!-- Documentos Recentes -->
                    <div class="content-card">
                        <div class="card-header">
                            <h3><i class="fas fa-file-alt"></i> Documentos Recentes</h3>
                            <button class="btn-dashboard btn-success" onclick="openDocumentModal()">
                                <i class="fas fa-plus"></i> Novo
                            </button>
                        </div>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Tipo</th>
                                    <th>Referência</th>
                                    <th>Data</th>
                                    <th>Estado</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody id="officeRecentDocs">
                                <!-- Documentos serão carregados aqui -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Sistema de Marcação de Horas para Todos os Funcionários -->
                <div class="content-card" style="margin-top: 30px;">
                    <div class="card-header">
                        <h3><i class="fas fa-clock"></i> Marcação de Horas - Todos os Funcionários</h3>
                        <button class="btn-dashboard btn-success" onclick="openBulkTimeModal()">
                            <i class="fas fa-users"></i> Marcar Todos
                        </button>
                    </div>

                    <div class="time-tracker">
                        <div class="time-display" id="officeClock">08:45:23</div>
                        <div class="time-buttons">
                            <button class="btn-dashboard btn-success" onclick="markAllEntry()">
                                <i class="fas fa-sign-in-alt"></i> Entrada Geral
                            </button>
                            <button class="btn-dashboard btn-warning" onclick="markAllBreak()">
                                <i class="fas fa-coffee"></i> Pausa Geral
                            </button>
                            <button class="btn-dashboard btn-danger" onclick="markAllExit()">
                                <i class="fas fa-sign-out-alt"></i> Saída Geral
                            </button>
                        </div>
                    </div>

                    <div style="margin-top: 20px;">
                        <h4><i class="fas fa-list-check"></i> Estado Atual das Marcações</h4>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Nome</th>
                                    <th>Entrada</th>
                                    <th>Saída</th>
                                    <th>Pausa</th>
                                    <th>Total</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody id="allEmployeesTime">
                                <!-- Todos os funcionários serão listados aqui -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Gestão de Pessoal -->
            <div class="dashboard-section" id="officePeopleSection">
                <div class="content-card">
                    <div class="card-header">
                        <h3><i class="fas fa-user-plus"></i> Gestão de Pessoal</h3>
                        <button class="btn-dashboard btn-success" onclick="openEmployeeModal()">
                            <i class="fas fa-plus"></i> Adicionar Pessoa
                        </button>
                    </div>

                    <div class="filter-bar">
                        <input type="text" id="officeSearchPerson" placeholder="Pesquisar nome..." onkeyup="searchOfficePeople()">
                        <select id="officeFilterDept" onchange="searchOfficePeople()">
                            <option value="all">Todos Departamentos</option>
                            <option value="escritorio">Escritório</option>
                            <option value="contabilidade">Contabilidade</option>
                            <option value="rh">RH</option>
                        </select>
                        <select id="officeFilterStatus" onchange="searchOfficePeople()">
                            <option value="all">Todos Estados</option>
                            <option value="active">Ativos</option>
                            <option value="inactive">Inativos</option>
                        </select>
                    </div>

                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Nome</th>
                                <th>WhatsApp</th>
                                <th>Cargo</th>
                                <th>Departamento</th>
                                <th>Estado</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="officePeopleTable">
                            <!-- Pessoal será carregado aqui -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Marcar Horas Individual -->
            <div class="dashboard-section" id="officeTimeSection">
                <div class="content-card">
                    <div class="card-header">
                        <h3><i class="fas fa-clock"></i> Marcação Individual de Horas</h3>
                        <div class="time-display" style="font-size: 2.5rem; color: var(--office);" id="officeClockIndividual">
                            08:45:23
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group-dashboard">
                            <label>Selecione a Pessoa</label>
                            <select id="officePersonSelect" onchange="loadPersonWhatsApp()">
                                <option value="">Selecione uma pessoa</option>
                            </select>
                        </div>
                        <div class="form-group-dashboard">
                            <label>WhatsApp</label>
                            <input type="text" id="officePersonWhatsApp" readonly placeholder="Selecione uma pessoa">
                        </div>
                        <div class="form-group-dashboard">
                            <label>Tipo de Marcação</label>
                            <select id="officeTimeType">
                                <option value="entry">Entrada</option>
                                <option value="exit">Saída</option>
                                <option value="break_start">Início Pausa</option>
                                <option value="break_end">Fim Pausa</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button class="btn-dashboard btn-success" onclick="registerOfficeTime()">
                            <i class="fas fa-check"></i> Registar Marcação
                        </button>
                        <button class="btn-dashboard btn-whatsapp" onclick="sendTimeWhatsApp()">
                            <i class="fab fa-whatsapp"></i> Notificar WhatsApp
                        </button>
                        <button class="btn-dashboard btn-warning" onclick="registerAllOfficeEntry()">
                            <i class="fas fa-users"></i> Entrada Geral
                        </button>
                    </div>

                    <div style="margin-top: 30px;">
                        <h3><i class="fas fa-history"></i> Marcações do Dia</h3>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Nome</th>
                                    <th>Entrada</th>
                                    <th>Saída</th>
                                    <th>Pausa</th>
                                    <th>Total</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody id="officeDailyMarks">
                                <!-- Marcações diárias serão carregadas aqui -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Meu Extrato com Impressão para Contabilidade -->
            <div class="dashboard-section" id="officeReportsSection">
                <div class="content-card">
                    <div class="card-header">
                        <h3><i class="fas fa-file-invoice"></i> Extrato Mensal para Contabilidade</h3>
                        <button class="btn-dashboard btn-primary" onclick="generateOfficeReport()">
                            <i class="fas fa-sync-alt"></i> Gerar Extrato
                        </button>
                    </div>

                    <div class="form-row">
                        <div class="form-group-dashboard">
                            <label>Mês/Ano</label>
                            <select id="officeReportMonth">
                                <option value="12-2024">Dezembro 2024</option>
                                <option value="11-2024">Novembro 2024</option>
                                <option value="10-2024">Outubro 2024</option>
                                <option value="09-2024">Setembro 2024</option>
                            </select>
                        </div>
                        <div class="form-group-dashboard">
                            <label>Pessoa</label>
                            <select id="officeReportPerson">
                                <option value="all">Todas as Pessoas</option>
                            </select>
                        </div>
                        <div class="form-group-dashboard">
                            <label>Formato</label>
                            <select id="reportFormat">
                                <option value="pdf">PDF</option>
                                <option value="excel">Excel</option>
                                <option value="print">Imprimir</option>
                            </select>
                        </div>
                    </div>

                    <div class="monthly-report">
                        <div class="report-header">
                            <h4 id="officeReportTitle">Selecione mês e pessoa</h4>
                            <span class="badge badge-info" id="officeTotalHours">-- horas</span>
                        </div>
                        
                        <table class="time-sheet-table" id="officeTimeSheet">
                            <thead>
                                <tr>
                                    <th>Data</th>
                                    <th>Nome</th>
                                    <th>Entrada</th>
                                    <th>Saída</th>
                                    <th>Horas Normais</th>
                                    <th>Horas Extra</th>
                                    <th>Total</th>
                                </tr>
                            </thead>
                            <tbody id="officeReportBody">
                                <!-- Dados do extrato serão carregados aqui -->
                            </tbody>
                        </table>
                        
                        <div class="report-actions">
                            <button class="btn-dashboard btn-primary" onclick="printOfficeReportForAccounting()">
                                <i class="fas fa-print"></i> Imprimir para Contabilidade
                            </button>
                            <button class="btn-dashboard btn-success" onclick="exportToExcel()">
                                <i class="fas fa-file-excel"></i> Exportar Excel
                            </button>
                            <button class="btn-dashboard btn-info" onclick="generatePDF()">
                                <i class="fas fa-file-pdf"></i> Gerar PDF
                            </button>
                            <button class="btn-dashboard btn-whatsapp" onclick="sendToAccountingWhatsApp()">
                                <i class="fab fa-whatsapp"></i> Enviar para Contabilidade
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Documentos -->
            <div class="dashboard-section" id="officeDocumentsSection">
                <div class="content-card">
                    <div class="card-header">
                        <h3><i class="fas fa-folder"></i> Gestão de Documentos</h3>
                        <button class="btn-dashboard btn-success" onclick="openDocumentModal()">
                            <i class="fas fa-plus"></i> Novo Documento
                        </button>
                    </div>

                    <div class="filter-bar">
                        <select id="documentFilterType" onchange="filterDocuments()">
                            <option value="all">Todos Tipos</option>
                            <option value="contrato">Contratos</option>
                            <option value="fatura">Faturas</option>
                            <option value="relatorio">Relatórios</option>
                        </select>
                        <input type="date" id="documentFilterDateFrom" onchange="filterDocuments()">
                        <input type="date" id="documentFilterDateTo" onchange="filterDocuments()">
                        <input type="text" id="documentSearch" placeholder="Pesquisar..." onkeyup="filterDocuments()">
                    </div>

                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Referência</th>
                                <th>Tipo</th>
                                <th>Título</th>
                                <th>Data</th>
                                <th>Criado por</th>
                                <th>WhatsApp</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="officeDocumentsTable">
                            <!-- Documentos serão carregados aqui -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Drucker (Impressão) -->
            <div class="dashboard-section" id="officeDruckerSection">
                <div class="content-card">
                    <div class="card-header">
                        <h3><i class="fas fa-print"></i> Sistema de Impressão (Drucker)</h3>
                        <button class="btn-dashboard btn-info" onclick="testPrinter()">
                            <i class="fas fa-cog"></i> Testar Impressora
                        </button>
                    </div>

                    <div class="form-row">
                        <div class="form-group-dashboard">
                            <label>Tipo de Documento</label>
                            <select id="printDocumentType">
                                <option value="extrato">Extrato de Horas</option>
                                <option value="relatorio">Relatório</option>
                                <option value="documento">Documento Geral</option>
                                <option value="fatura">Fatura</option>
                                <option value="contrato">Contrato</option>
                            </select>
                        </div>
                        <div class="form-group-dashboard">
                            <label>Número de Cópias</label>
                            <input type="number" id="printCopies" value="1" min="1" max="10">
                        </div>
                    </div>

                    <div class="form-group-dashboard">
                        <label>Selecione o Documento para Imprimir</label>
                        <select id="printDocumentSelect">
                            <option value="">Selecione um documento</option>
                        </select>
                    </div>

                    <div class="form-group-dashboard">
                        <label>Configurações de Impressão</label>
                        <div style="display: flex; gap: 20px; margin-top: 10px;">
                            <label style="display: flex; align-items: center; gap: 5px;">
                                <input type="checkbox" id="printColor" checked> Colorido
                            </label>
                            <label style="display: flex; align-items: center; gap: 5px;">
                                <input type="checkbox" id="printDuplex"> Frente e Verso
                            </label>
                            <label style="display: flex; align-items: center; gap: 5px;">
                                <input type="checkbox" id="printCollate" checked> Reunir
                            </label>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button class="btn-dashboard btn-primary" onclick="printDocument()">
                            <i class="fas fa-print"></i> IMPRIMIR
                        </button>
                        <button class="btn-dashboard btn-success" onclick="previewPrint()">
                            <i class="fas fa-eye"></i> Pré-visualizar
                        </button>
                        <button class="btn-dashboard btn-warning" onclick="printQueue()">
                            <i class="fas fa-list"></i> Fila de Impressão
                        </button>
                    </div>

                    <div style="margin-top: 30px;">
                        <h3><i class="fas fa-history"></i> Histórico de Impressões</h3>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Data/Hora</th>
                                    <th>Documento</th>
                                    <th>Utilizador</th>
                                    <th>Cópias</th>
                                    <th>Estado</th>
                                </tr>
                            </thead>
                            <tbody id="printHistory">
                                <!-- Histórico será carregado aqui -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Calendário -->
            <div class="dashboard-section" id="officeCalendarSection">
                <div class="content-card">
                    <div class="card-header">
                        <h3><i class="fas fa-calendar-alt"></i> Calendário Escritório</h3>
                        <div style="display: flex; gap: 10px;">
                            <button class="btn-dashboard btn-success" onclick="addOfficeEvent()">
                                <i class="fas fa-plus"></i> Novo Evento
                            </button>
                            <button class="btn-dashboard btn-primary" onclick="syncWithGoogleCalendar()">
                                <i class="fab fa-google"></i> Sincronizar
                            </button>
                        </div>
                    </div>
                    <div class="calendar">
                        <div class="calendar-header">
                            <h4 id="officeCurrentMonth">Dezembro 2024</h4>
                        </div>
                        <div class="calendar-grid" id="officeCalendarGrid">
                            <!-- Calendário será gerado dinamicamente -->
                        </div>
                    </div>
                    <div style="margin-top: 20px;">
                        <h4><i class="fas fa-bell"></i> Próximos Eventos</h4>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Data</th>
                                    <th>Evento</th>
                                    <th>Local</th>
                                    <th>Participantes</th>
                                </tr>
                            </thead>
                            <tbody id="officeEventsTable">
                                <!-- Eventos serão carregados aqui -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- MENU NO FUNDO PARA ESCRITÓRIO -->
        <nav class="bottom-menu">
            <div class="bottom-menu-container">
                <a href="#" class="bottom-menu-item active" data-section="officeDashboard">
                    <i class="fas fa-home"></i>
                    <span>Dashboard</span>
                </a>
                <a href="#" class="bottom-menu-item" data-section="officePeople">
                    <i class="fas fa-user-plus"></i>
                    <span>Pessoal</span>
                </a>
                <a href="#" class="bottom-menu-item" data-section="officeTime">
                    <i class="fas fa-clock"></i>
                    <span>Marcar Horas</span>
                </a>
                <a href="#" class="bottom-menu-item" data-section="officeReports">
                    <i class="fas fa-file-alt"></i>
                    <span>Meu Extrato</span>
                </a>
                <a href="#" class="bottom-menu-item" data-section="officeDocuments">
                    <i class="fas fa-folder"></i>
                    <span>Documentos</span>
                </a>
                <a href="#" class="bottom-menu-item" data-section="officeDrucker">
                    <i class="fas fa-print"></i>
                    <span>Drucker</span>
                </a>
                <a href="#" class="bottom-menu-item" data-section="officeCalendar">
                    <i class="fas fa-calendar-alt"></i>
                    <span>Calendário</span>
                </a>
            </div>
        </nav>
    </div>

    <!-- ============ DASHBOARD CHEFE DE EQUIPA ============ -->
    <div class="dashboard team-dashboard" id="teamDashboard">
        <!-- Top Bar -->
        <div class="top-bar">
            <div class="container top-bar-content">
                <div class="dashboard-brand">
                    <i class="fas fa-hard-hat"></i>
                    <h1>Chefe de Equipa - MAFC</h1>
                </div>
                <div class="dashboard-info">
                    <div class="user-info">
                        <i class="fas fa-user-hard-hat"></i>
                        <span id="teamUserName">Equipa</span>
                    </div>
                    <div id="teamCurrentTime" style="font-weight: 600;">10:45 AM</div>
                    <button class="logout-btn" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i> Sair
                    </button>
                </div>
            </div>
        </div>

        <!-- Menu Horizontal -->
        <nav class="horizontal-menu">
            <div class="container menu-container">
                <a href="#" class="menu-item active" data-section="teamOverview">
                    <i class="fas fa-home"></i> Visão Geral
                </a>
                <a href="#" class="menu-item" data-section="teamTime">
                    <i class="fas fa-clock"></i> Controlo Horas
                </a>
                <a href="#" class="menu-item" data-section="teamMaterials">
                    <i class="fas fa-boxes"></i> Pedir Materiais
                    <span class="menu-badge" id="requestsBadge">3</span>
                </a>
                <a href="#" class="menu-item" data-section="teamRequests">
                    <i class="fas fa-clipboard-list"></i> Meus Pedidos
                </a>
                <a href="#" class="menu-item" data-section="teamReports">
                    <i class="fas fa-file-alt"></i> Relatórios
                </a>
                <a href="#" class="menu-item" data-section="teamGPS">
                    <i class="fas fa-map-marker-alt"></i> Localização
                </a>
            </div>
        </nav>

        <!-- Conteúdo -->
        <div class="dashboard-content">
            <!-- Visão Geral Equipa -->
            <div class="dashboard-section active" id="teamOverviewSection">
                <div class="stats-row">
                    <div class="stat-card-horizontal">
                        <div class="stat-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="teamMembersCount">5</h3>
                            <p>Membros</p>
                        </div>
                    </div>
                    <div class="stat-card-horizontal">
                        <div class="stat-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="teamHoursToday">8.5</h3>
                            <p>Horas Hoje</p>
                        </div>
                    </div>
                    <div class="stat-card-horizontal">
                        <div class="stat-icon">
                            <i class="fas fa-box"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="teamPendingRequests">3</h3>
                            <p>Pedidos Pendentes</p>
                        </div>
                    </div>
                    <div class="stat-card-horizontal">
                        <div class="stat-icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="teamStatus">Online</h3>
                            <p>Estado</p>
                        </div>
                    </div>
                </div>

                <!-- Sistema de Pedidos de Material -->
                <div class="content-card" style="margin-top: 30px;">
                    <div class="card-header">
                        <h3><i class="fas fa-boxes"></i> Novo Pedido de Material</h3>
                        <span class="badge badge-info">Envia automaticamente para Compras</span>
                    </div>

                    <div class="form-row">
                        <div class="form-group-dashboard">
                            <label>Categoria</label>
                            <select id="materialCategory" onchange="loadMaterials()">
                                <option value="construction">Materiais de Construção</option>
                                <option value="machines">Máquinas e Equipamentos</option>
                                <option value="tools">Ferramentas</option>
                                <option value="consumables">Consumíveis</option>
                                <option value="safety">EPIs e Segurança</option>
                            </select>
                        </div>
                        <div class="form-group-dashboard">
                            <label>Material</label>
                            <select id="materialSelect">
                                <option value="">Selecione um material</option>
                            </select>
                        </div>
                        <div class="form-group-dashboard">
                            <label>Quantidade</label>
                            <input type="number" id="materialQuantity" min="1" value="1">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group-dashboard">
                            <label>Unidade</label>
                            <select id="materialUnit">
                                <option value="sacos">sacos</option>
                                <option value="ton">toneladas</option>
                                <option value="m3">m³</option>
                                <option value="litros">litros</option>
                                <option value="unidades">unidades</option>
                                <option value="caixas">caixas</option>
                            </select>
                        </div>
                        <div class="form-group-dashboard">
                            <label>Urgência</label>
                            <select id="materialUrgency">
                                <option value="normal">Normal (1-2 semanas)</option>
                                <option value="urgent">Urgente (3-5 dias)</option>
                                <option value="critical">Crítico (24-48h)</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group-dashboard">
                        <label>Observações/Detalhes</label>
                        <textarea id="materialNotes" rows="3" placeholder="Detalhes sobre o material necessário..."></textarea>
                    </div>

                    <div class="form-actions">
                        <button class="btn-dashboard btn-success" onclick="submitMaterialRequest()">
                            <i class="fas fa-paper-plane"></i> Enviar para Compras
                        </button>
                        <button class="btn-dashboard btn-whatsapp" onclick="submitMaterialRequestWhatsApp()">
                            <i class="fab fa-whatsapp"></i> WhatsApp Compras
                        </button>
                    </div>
                </div>

                <!-- Lista de Equipas Disponíveis -->
                <div class="content-card" style="margin-top: 30px;">
                    <div class="card-header">
                        <h3><i class="fas fa-users"></i> Equipas da Empresa</h3>
                        <span class="badge badge-info" id="totalTeamsCount">15 equipas</span>
                    </div>
                    
                    <div class="filter-bar">
                        <select id="filterTeamLocationList" onchange="filterTeamList()">
                            <option value="all">Todas Localizações</option>
                            <option value="germany">Alemanha</option>
                            <option value="portugal">Portugal</option>
                        </select>
                        <select id="filterTeamStatusList" onchange="filterTeamList()">
                            <option value="all">Todos Estados</option>
                            <option value="active">Ativas</option>
                            <option value="inactive">Inativas</option>
                        </select>
                    </div>

                    <div style="max-height: 300px; overflow-y: auto;">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Equipa</th>
                                    <th>Localização</th>
                                    <th>Chefe</th>
                                    <th>Membros</th>
                                    <th>Obra Atual</th>
                                    <th>Estado</th>
                                </tr>
                            </thead>
                            <tbody id="teamListTable">
                                <!-- Lista de equipas será carregada aqui -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Pedidos de Material -->
            <div class="dashboard-section" id="teamMaterialsSection">
                <div class="content-card">
                    <div class="card-header">
                        <h3><i class="fas fa-clipboard-list"></i> Histórico de Pedidos</h3>
                        <button class="btn-dashboard btn-primary" onclick="refreshMaterialRequests()">
                            <i class="fas fa-sync-alt"></i> Atualizar
                        </button>
                    </div>

                    <div class="filter-bar">
                        <select id="filterRequestStatus" onchange="filterMaterialRequests()">
                            <option value="all">Todos Estados</option>
                            <option value="pending">Pendentes</option>
                            <option value="approved">Aprovados</option>
                            <option value="completed">Completados</option>
                            <option value="cancelled">Cancelados</option>
                        </select>
                        <input type="date" id="filterRequestDateFrom" onchange="filterMaterialRequests()">
                        <input type="date" id="filterRequestDateTo" onchange="filterMaterialRequests()">
                    </div>

                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Nº Pedido</th>
                                <th>Material</th>
                                <th>Quantidade</th>
                                <th>Data Pedido</th>
                                <th>Urgência</th>
                                <th>Estado</th>
                                <th>Responsável Compras</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="teamMaterialRequestsTable">
                            <!-- Pedidos serão carregados aqui -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Controlo Horas da Equipa -->
            <div class="dashboard-section" id="teamTimeSection">
                <div class="content-card">
                    <div class="card-header">
                        <h3><i class="fas fa-clock"></i> Controlo de Horas da Equipa</h3>
                        <div class="time-display" style="font-size: 2rem; color: var(--team);">
                            <span id="teamCurrentTimeDisplay">08:45</span>
                        </div>
                    </div>

                    <div class="time-tracker">
                        <div class="time-buttons">
                            <button class="btn-dashboard btn-success" onclick="markTeamEntry()">
                                <i class="fas fa-sign-in-alt"></i> Entrada da Equipa
                            </button>
                            <button class="btn-dashboard btn-warning" onclick="markTeamBreak()">
                                <i class="fas fa-coffee"></i> Pausa da Equipa
                            </button>
                            <button class="btn-dashboard btn-danger" onclick="markTeamExit()">
                                <i class="fas fa-sign-out-alt"></i> Saída da Equipa
                            </button>
                        </div>
                    </div>

                    <div style="margin-top: 20px;">
                        <h4><i class="fas fa-users"></i> Membros da Equipa</h4>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Nome</th>
                                    <th>Entrada</th>
                                    <th>Saída</th>
                                    <th>Pausa</th>
                                    <th>Total</th>
                                    <th>Estado</th>
                                </tr>
                            </thead>
                            <tbody id="teamMembersTime">
                                <!-- Membros da equipa serão listados aqui -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Meus Pedidos -->
            <div class="dashboard-section" id="teamRequestsSection">
                <div class="content-card">
                    <div class="card-header">
                        <h3><i class="fas fa-clipboard-list"></i> Meus Pedidos</h3>
                        <button class="btn-dashboard btn-info" onclick="exportMyRequests()">
                            <i class="fas fa-download"></i> Exportar
                        </button>
                    </div>
                    
                    <div class="filter-bar">
                        <select id="filterMyRequestsStatus" onchange="filterMyRequests()">
                            <option value="all">Todos Estados</option>
                            <option value="pending">Pendentes</option>
                            <option value="approved">Aprovados</option>
                            <option value="completed">Completados</option>
                        </select>
                        <input type="date" id="filterMyRequestsDateFrom" onchange="filterMyRequests()">
                        <input type="date" id="filterMyRequestsDateTo" onchange="filterMyRequests()">
                    </div>

                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Nº Pedido</th>
                                <th>Material</th>
                                <th>Quantidade</th>
                                <th>Data</th>
                                <th>Urgência</th>
                                <th>Estado</th>
                                <th>Fornecedor</th>
                                <th>Previsão Entrega</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="myRequestsTable">
                            <!-- Meus pedidos serão carregados aqui -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Relatórios -->
            <div class="dashboard-section" id="teamReportsSection">
                <div class="content-card">
                    <div class="card-header">
                        <h3><i class="fas fa-file-alt"></i> Relatórios da Equipa</h3>
                        <button class="btn-dashboard btn-primary" onclick="generateTeamReport()">
                            <i class="fas fa-file-pdf"></i> Gerar Relatório
                        </button>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group-dashboard">
                            <label>Período</label>
                            <select id="teamReportPeriod">
                                <option value="week">Esta Semana</option>
                                <option value="month">Este Mês</option>
                                <option value="quarter">Este Trimestre</option>
                                <option value="year">Este Ano</option>
                                <option value="custom">Personalizado</option>
                            </select>
                        </div>
                        <div class="form-group-dashboard">
                            <label>Tipo de Relatório</label>
                            <select id="teamReportType">
                                <option value="hours">Horas de Trabalho</option>
                                <option value="materials">Consumo de Materiais</option>
                                <option value="productivity">Produtividade</option>
                                <option value="safety">Segurança</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button class="btn-dashboard btn-success" onclick="generateTeamReportPreview()">
                            <i class="fas fa-eye"></i> Pré-visualizar
                        </button>
                        <button class="btn-dashboard btn-primary" onclick="printTeamReport()">
                            <i class="fas fa-print"></i> Imprimir
                        </button>
                        <button class="btn-dashboard btn-info" onclick="downloadTeamReport()">
                            <i class="fas fa-download"></i> Download
                        </button>
                    </div>

                    <div id="teamReportPreview" style="margin-top: 30px; display: none;">
                        <!-- Pré-visualização do relatório será carregada aqui -->
                    </div>
                </div>
            </div>

            <!-- Localização GPS -->
            <div class="dashboard-section" id="teamGPSSection">
                <div class="content-card">
                    <div class="card-header">
                        <h3><i class="fas fa-map-marker-alt"></i> Localização em Tempo Real</h3>
                        <button class="btn-dashboard btn-success" onclick="getLocation()">
                            <i class="fas fa-location-crosshairs"></i> Atualizar Localização
                        </button>
                    </div>

                    <div class="gps-tracker">
                        <div class="gps-info">
                            <i class="fas fa-satellite"></i>
                            <div class="gps-coordinates" id="gpsCoordinates">
                                Aguardando localização...
                            </div>
                        </div>
                        <div class="time-buttons">
                            <button class="btn-dashboard btn-primary" onclick="shareLocation()">
                                <i class="fas fa-share-alt"></i> Partilhar Localização
                            </button>
                            <button class="btn-dashboard btn-whatsapp" onclick="sendLocationWhatsApp()">
                                <i class="fab fa-whatsapp"></i> Enviar por WhatsApp
                            </button>
                        </div>
                    </div>

                    <div style="margin-top: 20px;">
                        <h4><i class="fas fa-map"></i> Mapa da Área</h4>
                        <div id="mapContainer" style="height: 300px; background: #e0e0e0; border-radius: 10px; display: flex; align-items: center; justify-content: center; color: #666;">
                            <div style="text-align: center;">
                                <i class="fas fa-map-marked-alt" style="font-size: 3rem; margin-bottom: 10px;"></i>
                                <p>Mapa de localização (integrado com Google Maps)</p>
                            </div>
                        </div>
                    </div>

                    <div style="margin-top: 20px;">
                        <h4><i class="fas fa-history"></i> Histórico de Localizações</h4>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Data/Hora</th>
                                    <th>Localização</th>
                                    <th>Coordenadas</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody id="locationHistoryTable">
                                <!-- Histórico de localizações será carregado aqui -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- MENU NO FUNDO PARA CHEFE DE EQUIPA -->
        <nav class="bottom-menu">
            <div class="bottom-menu-container">
                <a href="#" class="bottom-menu-item active" data-section="teamOverview">
                    <i class="fas fa-home"></i>
                    <span>Visão Geral</span>
                </a>
                <a href="#" class="bottom-menu-item" data-section="teamTime">
                    <i class="fas fa-clock"></i>
                    <span>Controlo Horas</span>
                </a>
                <a href="#" class="bottom-menu-item" data-section="teamMaterials">
                    <i class="fas fa-boxes"></i>
                    <span>Pedir Materiais</span>
                    <span class="bottom-menu-badge" id="pendingRequestsBottom">3</span>
                </a>
                <a href="#" class="bottom-menu-item" data-section="teamRequests">
                    <i class="fas fa-clipboard-list"></i>
                    <span>Meus Pedidos</span>
                </a>
                <a href="#" class="bottom-menu-item" data-section="teamReports">
                    <i class="fas fa-file-alt"></i>
                    <span>Relatórios</span>
                </a>
                <a href="#" class="bottom-menu-item" data-section="teamGPS">
                    <i class="fas fa-map-marker-alt"></i>
                    <span>Localização</span>
                </a>
            </div>
        </nav>
    </div>

    <!-- ============ DASHBOARD COMPRAS ============ -->
    <div class="dashboard purchase-dashboard" id="purchaseDashboard">
        <!-- Top Bar -->
        <div class="top-bar">
            <div class="container top-bar-content">
                <div class="dashboard-brand">
                    <i class="fas fa-shopping-cart"></i>
                    <h1>Compras - MAFC</h1>
                </div>
                <div class="dashboard-info">
                    <div class="user-info">
                        <i class="fas fa-user-tie"></i>
                        <span id="purchaseUserName">Compras</span>
                    </div>
                    <div id="purchaseCurrentTime" style="font-weight: 600;">10:45 AM</div>
                    <button class="logout-btn" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i> Sair
                    </button>
                </div>
            </div>
        </div>

        <!-- Menu Horizontal -->
        <nav class="horizontal-menu">
            <div class="container menu-container">
                <a href="#" class="menu-item active" data-section="purchaseDashboard">
                    <i class="fas fa-home"></i> Dashboard
                </a>
                <a href="#" class="menu-item" data-section="purchasePending">
                    <i class="fas fa-clock"></i> Pendentes
                    <span class="menu-badge" id="pendingBadge">12</span>
                </a>
                <a href="#" class="menu-item" data-section="purchaseApproved">
                    <i class="fas fa-check-circle"></i> Aprovados
                </a>
                <a href="#" class="menu-item" data-section="purchaseCompleted">
                    <i class="fas fa-check-double"></i> Concluídos
                </a>
                <a href="#" class="menu-item" data-section="purchaseSuppliers">
                    <i class="fas fa-truck"></i> Fornecedores
                </a>
                <a href="#" class="menu-item" data-section="purchaseReports">
                    <i class="fas fa-chart-bar"></i> Relatórios
                </a>
                <a href="#" class="menu-item" data-section="purchaseOrders">
                    <i class="fas fa-file-invoice"></i> Ordens Compra
                </a>
            </div>
        </nav>

        <!-- Conteúdo -->
        <div class="dashboard-content">
            <!-- Dashboard Compras -->
            <div class="dashboard-section active" id="purchaseDashboardSection">
                <div class="stats-row">
                    <div class="stat-card-horizontal">
                        <div class="stat-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="purchasePendingCount">12</h3>
                            <p>Pendentes</p>
                        </div>
                    </div>
                    <div class="stat-card-horizontal">
                        <div class="stat-icon">
                            <i class="fas fa-check"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="purchaseApprovedCount">8</h3>
                            <p>Aprovados</p>
                        </div>
                    </div>
                    <div class="stat-card-horizontal">
                        <div class="stat-icon">
                            <i class="fas fa-check-double"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="purchaseCompletedCount">24</h3>
                            <p>Concluídos</p>
                        </div>
                    </div>
                    <div class="stat-card-horizontal">
                        <div class="stat-icon">
                            <i class="fas fa-euro-sign"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="purchaseMonthValue">€18.5K</h3>
                            <p>Valor Mês</p>
                        </div>
                    </div>
                </div>

                <!-- Alertas Urgentes -->
                <div class="content-card">
                    <div class="card-header">
                        <h3><i class="fas fa-exclamation-triangle"></i> Pedidos Urgentes</h3>
                        <button class="btn-dashboard btn-warning" onclick="processUrgentRequests()">
                            <i class="fas fa-bolt"></i> Processar Todos
                        </button>
                    </div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Nº Pedido</th>
                                <th>Equipa</th>
                                <th>Material</th>
                                <th>Quantidade</th>
                                <th>Urgência</th>
                                <th>Tempo Pendente</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="purchaseUrgentTable">
                            <!-- Pedidos urgentes serão carregados aqui -->
                        </tbody>
                    </table>
                </div>

                <!-- Gestão de Fornecedores -->
                <div class="content-card" style="margin-top: 30px;">
                    <div class="card-header">
                        <h3><i class="fas fa-truck"></i> Fornecedores de Materiais de Construção</h3>
                        <button class="btn-dashboard btn-success" onclick="openSupplierModal()">
                            <i class="fas fa-plus"></i> Adicionar Fornecedor
                        </button>
                    </div>

                    <div class="filter-bar">
                        <input type="text" id="searchSupplier" placeholder="Pesquisar fornecedor..." onkeyup="filterSuppliers()">
                        <select id="filterSupplierType" onchange="filterSuppliers()">
                            <option value="all">Todos Tipos</option>
                            <option value="construcao">Materiais de Construção</option>
                            <option value="ferramentas">Ferramentas</option>
                            <option value="equipamentos">Equipamentos</option>
                        </select>
                    </div>

                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Nome</th>
                                <th>NIF</th>
                                <th>Contacto</th>
                                <th>Tipo</th>
                                <th>Email</th>
                                <th>Avaliação</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="suppliersTable">
                            <!-- Fornecedores serão carregados aqui -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Pendentes -->
            <div class="dashboard-section" id="purchasePendingSection">
                <div class="content-card">
                    <div class="card-header">
                        <h3><i class="fas fa-clock"></i> Pedidos Pendentes de Aprovação</h3>
                        <button class="btn-dashboard btn-success" onclick="approveAllPending()">
                            <i class="fas fa-check-double"></i> Aprovar Todos
                        </button>
                    </div>

                    <div class="filter-bar">
                        <select id="filterPendingUrgency" onchange="filterPendingPurchases()">
                            <option value="all">Todas Urgências</option>
                            <option value="critical">Crítico</option>
                            <option value="urgent">Urgente</option>
                            <option value="normal">Normal</option>
                        </select>
                        <select id="filterPendingTeam" onchange="filterPendingPurchases()">
                            <option value="all">Todas Equipas</option>
                        </select>
                        <input type="text" id="searchPending" placeholder="Pesquisar material..." onkeyup="filterPendingPurchases()">
                    </div>

                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Nº Pedido</th>
                                <th>Data</th>
                                <th>Equipa</th>
                                <th>Material</th>
                                <th>Quantidade</th>
                                <th>Urgência</th>
                                <th>Pedido por</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="purchasePendingTable">
                            <!-- Pedidos pendentes serão carregados aqui -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Aprovados -->
            <div class="dashboard-section" id="purchaseApprovedSection">
                <div class="content-card">
                    <div class="card-header">
                        <h3><i class="fas fa-check-circle"></i> Pedidos Aprovados para Execução</h3>
                        <button class="btn-dashboard btn-primary" onclick="newPurchaseOrder()">
                            <i class="fas fa-plus"></i> Nova Ordem Compra
                        </button>
                    </div>

                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Nº Pedido</th>
                                <th>Material</th>
                                <th>Quantidade</th>
                                <th>Fornecedor</th>
                                <th>Valor</th>
                                <th>Data Aprovação</th>
                                <th>Prazo Entrega</th>
                                <th>Estado</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="purchaseApprovedTable">
                            <!-- Pedidos aprovados serão carregados aqui -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Concluídos/Resolvidos -->
            <div class="dashboard-section" id="purchaseCompletedSection">
                <div class="content-card">
                    <div class="card-header">
                        <h3><i class="fas fa-check-double"></i> Compras Concluídas/Resolvidas</h3>
                        <button class="btn-dashboard btn-info" onclick="exportCompletedPurchases()">
                            <i class="fas fa-file-excel"></i> Exportar Excel
                        </button>
                    </div>

                    <div class="filter-bar">
                        <select id="filterCompletedMonth" onchange="filterCompletedPurchases()">
                            <option value="all">Todos os Meses</option>
                            <option value="12">Dezembro 2024</option>
                            <option value="11">Novembro 2024</option>
                        </select>
                        <select id="filterCompletedSupplier" onchange="filterCompletedPurchases()">
                            <option value="all">Todos Fornecedores</option>
                        </select>
                        <input type="text" id="searchCompleted" placeholder="Pesquisar..." onkeyup="filterCompletedPurchases()">
                    </div>

                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Nº Ordem</th>
                                <th>Material</th>
                                <th>Quantidade</th>
                                <th>Fornecedor</th>
                                <th>Valor Total</th>
                                <th>Data Compra</th>
                                <th>Data Entrega</th>
                                <th>Equipa</th>
                                <th>Nº Fatura</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="purchaseCompletedTable">
                            <!-- Compras concluídas serão carregadas aqui -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Fornecedores -->
            <div class="dashboard-section" id="purchaseSuppliersSection">
                <div class="content-card">
                    <div class="card-header">
                        <h3><i class="fas fa-truck"></i> Gestão de Fornecedores</h3>
                        <button class="btn-dashboard btn-success" onclick="openSupplierModal()">
                            <i class="fas fa-plus"></i> Novo Fornecedor
                        </button>
                    </div>

                    <div class="stats-row">
                        <div class="stat-card-horizontal">
                            <div class="stat-icon">
                                <i class="fas fa-truck"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="totalSuppliers">24</h3>
                                <p>Total Fornecedores</p>
                            </div>
                        </div>
                        <div class="stat-card-horizontal">
                            <div class="stat-icon">
                                <i class="fas fa-star"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="topRatedSuppliers">8</h3>
                                <p>Top Avaliados</p>
                            </div>
                        </div>
                        <div class="stat-card-horizontal">
                            <div class="stat-icon">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="lateDeliveries">3</h3>
                                <p>Entregas Atrasadas</p>
                            </div>
                        </div>
                        <div class="stat-card-horizontal">
                            <div class="stat-icon">
                                <i class="fas fa-euro-sign"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="monthSupplierValue">€45.2K</h3>
                                <p>Valor Mês Fornecedores</p>
                            </div>
                        </div>
                    </div>

                    <div class="filter-bar">
                        <input type="text" id="searchSupplierList" placeholder="Pesquisar fornecedor..." onkeyup="filterSupplierList()">
                        <select id="filterSupplierCategory" onchange="filterSupplierList()">
                            <option value="all">Todas Categorias</option>
                            <option value="construction">Construção</option>
                            <option value="tools">Ferramentas</option>
                            <option value="equipment">Equipamentos</option>
                            <option value="consumables">Consumíveis</option>
                        </select>
                        <select id="filterSupplierRating" onchange="filterSupplierList()">
                            <option value="all">Todas Avaliações</option>
                            <option value="5">★★★★★</option>
                            <option value="4">★★★★☆</option>
                            <option value="3">★★★☆☆</option>
                        </select>
                    </div>

                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Nome</th>
                                <th>NIF</th>
                                <th>Contacto</th>
                                <th>Categoria</th>
                                <th>Avaliação</th>
                                <th>Última Compra</th>
                                <th>Valor Total</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="supplierListTable">
                            <!-- Lista de fornecedores será carregada aqui -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Relatórios -->
            <div class="dashboard-section" id="purchaseReportsSection">
                <div class="content-card">
                    <div class="card-header">
                        <h3><i class="fas fa-chart-bar"></i> Relatórios de Compras</h3>
                        <button class="btn-dashboard btn-primary" onclick="generatePurchaseReports()">
                            <i class="fas fa-download"></i> Gerar Relatórios
                        </button>
                    </div>

                    <div class="content-grid">
                        <div class="content-card">
                            <h4><i class="fas fa-chart-pie"></i> Distribuição por Categoria</h4>
                            <div style="height: 250px;">
                                <canvas id="purchaseCategoryChart"></canvas>
                            </div>
                        </div>

                        <div class="content-card">
                            <h4><i class="fas fa-chart-line"></i> Evolução Mensal</h4>
                            <div style="height: 250px;">
                                <canvas id="purchaseMonthlyChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <div style="margin-top: 30px;">
                        <h4><i class="fas fa-file-alt"></i> Relatórios Disponíveis</h4>
                        <div class="form-row">
                            <div class="form-group-dashboard">
                                <label>Período</label>
                                <select id="reportPeriod">
                                    <option value="month">Este Mês</option>
                                    <option value="quarter">Este Trimestre</option>
                                    <option value="year">Este Ano</option>
                                    <option value="custom">Personalizado</option>
                                </select>
                            </div>
                            <div class="form-group-dashboard">
                                <label>Tipo de Relatório</label>
                                <select id="reportType">
                                    <option value="summary">Resumo Geral</option>
                                    <option value="suppliers">Por Fornecedor</option>
                                    <option value="categories">Por Categoria</option>
                                    <option value="teams">Por Equipa</option>
                                </select>
                            </div>
                            <div class="form-group-dashboard">
                                <label>Formato</label>
                                <select id="reportOutputFormat">
                                    <option value="pdf">PDF</option>
                                    <option value="excel">Excel</option>
                                    <option value="html">HTML</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-actions">
                            <button class="btn-dashboard btn-success" onclick="generateReportPreview()">
                                <i class="fas fa-eye"></i> Pré-visualizar
                            </button>
                            <button class="btn-dashboard btn-primary" onclick="downloadReport()">
                                <i class="fas fa-download"></i> Download
                            </button>
                            <button class="btn-dashboard btn-info" onclick="emailReport()">
                                <i class="fas fa-envelope"></i> Enviar por Email
                            </button>
                        </div>

                        <div id="reportPreview" style="margin-top: 30px; display: none;">
                            <!-- Pré-visualização do relatório será carregada aqui -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Ordens de Compra -->
            <div class="dashboard-section" id="purchaseOrdersSection">
                <div class="content-card">
                    <div class="card-header">
                        <h3><i class="fas fa-file-invoice"></i> Gestão de Ordens de Compra</h3>
                        <button class="btn-dashboard btn-success" onclick="createPurchaseOrder()">
                            <i class="fas fa-plus"></i> Nova Ordem
                        </button>
                    </div>

                    <div class="filter-bar">
                        <select id="filterOrderStatus" onchange="filterOrders()">
                            <option value="all">Todos Estados</option>
                            <option value="draft">Rascunho</option>
                            <option value="sent">Enviada</option>
                            <option value="confirmed">Confirmada</option>
                            <option value="delivered">Entregue</option>
                            <option value="paid">Paga</option>
                        </select>
                        <input type="date" id="filterOrderDateFrom" onchange="filterOrders()">
                        <input type="date" id="filterOrderDateTo" onchange="filterOrders()">
                        <input type="text" id="searchOrder" placeholder="Pesquisar ordem..." onkeyup="filterOrders()">
                    </div>

                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Nº Ordem</th>
                                <th>Fornecedor</th>
                                <th>Data</th>
                                <th>Valor Total</th>
                                <th>Estado</th>
                                <th>Previsão Entrega</th>
                                <th>Equipa</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="purchaseOrdersTable">
                            <!-- Ordens de compra serão carregadas aqui -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- MENU NO FUNDO PARA COMPRAS -->
        <nav class="bottom-menu">
            <div class="bottom-menu-container">
                <a href="#" class="bottom-menu-item active" data-section="purchaseDashboard">
                    <i class="fas fa-home"></i>
                    <span>Dashboard</span>
                </a>
                <a href="#" class="bottom-menu-item" data-section="purchasePending">
                    <i class="fas fa-clock"></i>
                    <span>Pendentes</span>
                    <span class="bottom-menu-badge" id="pendingPurchasesCountBottom">12</span>
                </a>
                <a href="#" class="bottom-menu-item" data-section="purchaseApproved">
                    <i class="fas fa-check-circle"></i>
                    <span>Aprovados</span>
                </a>
                <a href="#" class="bottom-menu-item" data-section="purchaseCompleted">
                    <i class="fas fa-check-double"></i>
                    <span>Concluídos</span>
                </a>
                <a href="#" class="bottom-menu-item" data-section="purchaseSuppliers">
                    <i class="fas fa-truck"></i>
                    <span>Fornecedores</span>
                </a>
                <a href="#" class="bottom-menu-item" data-section="purchaseReports">
                    <i class="fas fa-chart-bar"></i>
                    <span>Relatórios</span>
                </a>
                <a href="#" class="bottom-menu-item" data-section="purchaseOrders">
                    <i class="fas fa-file-invoice"></i>
                    <span>Ordens</span>
                </a>
            </div>
        </nav>
    </div>

    <!-- ============ MODAIS ============ -->
    <!-- Modal Gestão de Pessoal -->
    <div class="modal" id="employeeModal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h2><i class="fas fa-user-plus"></i> Gestão de Pessoal</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="employee-form">
                    <div class="form-row">
                        <div class="form-group-dashboard">
                            <label>Nome Completo</label>
                            <input type="text" id="employeeName" placeholder="Nome completo">
                        </div>
                        <div class="form-group-dashboard">
                            <label>Número de WhatsApp</label>
                            <input type="tel" id="employeeWhatsApp" placeholder="+351 912 345 678" value="+351">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group-dashboard">
                            <label>Cargo/Função</label>
                            <select id="employeePosition">
                                <option value="administrativo">Administrativo</option>
                                <option value="contabilidade">Contabilidade</option>
                                <option value="rh">Recursos Humanos</option>
                                <option value="gestor">Gestor</option>
                                <option value="assistente">Assistente</option>
                            </select>
                        </div>
                        <div class="form-group-dashboard">
                            <label>Departamento</label>
                            <select id="employeeDepartment">
                                <option value="escritorio">Escritório</option>
                                <option value="contabilidade">Contabilidade</option>
                                <option value="rh">RH</option>
                                <option value="administracao">Administração</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group-dashboard">
                            <label>Data de Início</label>
                            <input type="date" id="employeeStartDate">
                        </div>
                        <div class="form-group-dashboard">
                            <label>Estado</label>
                            <select id="employeeStatus">
                                <option value="active">Ativo</option>
                                <option value="inactive">Inativo</option>
                                <option value="ferias">Férias</option>
                                <option value="baixa">Baixa Médica</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn-dashboard btn-success" onclick="saveEmployee()">
                            <i class="fas fa-save"></i> Guardar
                        </button>
                        <button type="button" class="btn-dashboard btn-danger" onclick="closeModal('employeeModal')">
                            <i class="fas fa-times"></i> Cancelar
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Documento -->
    <div class="modal" id="documentModal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h2><i class="fas fa-file-alt"></i> Novo Documento</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="document-form">
                    <div class="form-row">
                        <div class="form-group-dashboard">
                            <label>Tipo de Documento</label>
                            <select id="documentType">
                                <option value="contrato">Contrato</option>
                                <option value="fatura">Fatura</option>
                                <option value="relatorio">Relatório</option>
                                <option value="outro">Outro</option>
                            </select>
                        </div>
                        <div class="form-group-dashboard">
                            <label>Número/Referência</label>
                            <input type="text" id="documentNumber" placeholder="Ex: CON-2024-001">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group-dashboard">
                            <label>Título</label>
                            <input type="text" id="documentTitle" placeholder="Título do documento">
                        </div>
                        <div class="form-group-dashboard">
                            <label>Data</label>
                            <input type="date" id="documentDate">
                        </div>
                    </div>
                    <div class="form-group-dashboard">
                        <label>Descrição</label>
                        <textarea id="documentDescription" rows="3" placeholder="Descrição do documento..."></textarea>
                    </div>
                    <div class="form-group-dashboard">
                        <label>Ficheiro (opcional)</label>
                        <input type="file" id="documentFile">
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn-dashboard btn-success" onclick="saveDocument()">
                            <i class="fas fa-save"></i> Guardar Documento
                        </button>
                        <button type="button" class="btn-dashboard btn-whatsapp" onclick="sendDocumentWhatsApp()">
                            <i class="fab fa-whatsapp"></i> Partilhar WhatsApp
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Fornecedor -->
    <div class="modal" id="supplierModal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h2><i class="fas fa-truck"></i> Gestão de Fornecedores</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="employee-form">
                    <div class="form-row">
                        <div class="form-group-dashboard">
                            <label>Nome do Fornecedor</label>
                            <input type="text" id="supplierName" placeholder="Nome da empresa">
                        </div>
                        <div class="form-group-dashboard">
                            <label>NIF/NIPC</label>
                            <input type="text" id="supplierNIF" placeholder="Número de identificação fiscal">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group-dashboard">
                            <label>Contacto</label>
                            <input type="tel" id="supplierContact" placeholder="Telefone/WhatsApp">
                        </div>
                        <div class="form-group-dashboard">
                            <label>Email</label>
                            <input type="email" id="supplierEmail" placeholder="email@fornecedor.pt">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group-dashboard">
                            <label>Tipo de Materiais</label>
                            <select id="supplierType" multiple>
                                <option value="construcao">Materiais de Construção</option>
                                <option value="ferramentas">Ferramentas</option>
                                <option value="equipamentos">Equipamentos</option>
                                <option value="consumiveis">Consumíveis</option>
                                <option value="seguranca">EPIs e Segurança</option>
                            </select>
                        </div>
                        <div class="form-group-dashboard">
                            <label>Observações</label>
                            <textarea id="supplierNotes" rows="3" placeholder="Informações adicionais..."></textarea>
                        </div>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn-dashboard btn-success" onclick="saveSupplier()">
                            <i class="fas fa-save"></i> Guardar Fornecedor
                        </button>
                        <button type="button" class="btn-dashboard btn-danger" onclick="closeModal('supplierModal')">
                            <i class="fas fa-times"></i> Cancelar
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Spinner -->
    <div id="loadingSpinner" class="loading-spinner" style="display: none;"></div>

    <script>
        // ============ SISTEMA COMPLETO MAFC ============
        
        // Sistema de armazenamento
        const MAFCSystem = {
            currentUser: null,
            editingEmployeeId: null,
            editingPurchaseId: null,
            editingSupplierId: null,
            
            // Credenciais
            credentials: {
                boss: [
                    { code: 'mafc', password: '1234', name: 'Administrador' },
                    { code: 'admin', password: 'admin123', name: 'Gestor Geral' }
                ],
                team: [
                    { code: 'equipa01', password: '1234', name: 'João Silva', team: 'Equipa 01 - Berlin' },
                    { code: 'equipa02', password: '1234', name: 'Carlos Mendes', team: 'Equipa 02 - Hamburg' },
                    { code: 'equipa03', password: '1234', name: 'António Santos', team: 'Equipa 03 - Lisboa' },
                    { code: 'equipa04', password: '1234', name: 'Miguel Costa', team: 'Equipa 04 - Porto' },
                    { code: 'equipa05', password: '1234', name: 'Ricardo Oliveira', team: 'Equipa 05 - Frankfurt' },
                    { code: 'equipa06', password: '1234', name: 'Pedro Martins', team: 'Equipa 06 - Munique' },
                    { code: 'equipa07', password: '1234', name: 'Francisco Lima', team: 'Equipa 07 - Colônia' },
                    { code: 'equipa08', password: '1234', name: 'Jorge Silva', team: 'Equipa 08 - Estugarda' },
                    { code: 'equipa09', password: '1234', name: 'Rui Pereira', team: 'Equipa 09 - Düsseldorf' },
                    { code: 'equipa10', password: '1234', name: 'Luís Fernandes', team: 'Equipa 10 - Essen' },
                    { code: 'equipa11', password: '1234', name: 'Hugo Rodrigues', team: 'Equipa 11 - Dortmund' },
                    { code: 'equipa12', password: '1234', name: 'Bruno Sousa', team: 'Equipa 12 - Bremen' },
                    { code: 'equipa13', password: '1234', name: 'Paulo Gomes', team: 'Equipa 13 - Hanôver' },
                    { code: 'equipa14', password: '1234', name: 'Vítor Lopes', team: 'Equipa 14 - Nuremberga' },
                    { code: 'equipa15', password: '1234', name: 'André Marques', team: 'Equipa 15 - Leipzig' }
                ],
                purchase: [
                    { code: 'compras01', password: '1234', name: 'Responsável Compras' },
                    { code: 'compras', password: '1234', name: 'Ana Compras' }
                ],
                office: [
                    { code: 'escritorio', password: '1234', name: 'Maria Silva' },
                    { code: 'contabilidade', password: '1234', name: 'Ana Costa' }
                ]
            },
            
            // Dados do sistema
            officePeople: [],
            timeRecords: {},
            materialRequests: [],
            purchases: [],
            documents: [],
            auditLog: [],
            activityLog: [],
            teams: [],
            suppliers: [],
            calendarEvents: [],
            settings: {
                companyName: 'MAFC & FILHO, LDA.',
                companyNIF: '500000000',
                normalHours: 8,
                extraHourRate: 125,
                whatsappMessage: '✅ MAFC - Registro de horas confirmado. Obrigado!',
                autoBackup: 'weekly'
            },
            
            // Inicializar dados
            init: function() {
                this.loadFromStorage();
                
                // Inicializar dados padrão se necessário
                if (this.officePeople.length === 0) {
                    this.initSampleData();
                }
                
                if (this.teams.length === 0) {
                    this.initTeamsData();
                }
                
                if (this.suppliers.length === 0) {
                    this.initSuppliersData();
                }
                
                this.saveToStorage();
                this.initEventListeners();
            },
            
            // Dados de exemplo para funcionários
            initSampleData: function() {
                this.officePeople = [
                    { 
                        id: 1, 
                        name: 'Maria Silva', 
                        whatsapp: '+351912345678', 
                        position: 'Administrativa', 
                        department: 'escritorio', 
                        status: 'active', 
                        startDate: '2023-01-15',
                        salary: 1500
                    },
                    { 
                        id: 2, 
                        name: 'Ana Costa', 
                        whatsapp: '+351912345679', 
                        position: 'Contabilista', 
                        department: 'contabilidade', 
                        status: 'active', 
                        startDate: '2022-03-10',
                        salary: 1800
                    },
                    { 
                        id: 3, 
                        name: 'João Silva', 
                        whatsapp: '+351912345680', 
                        position: 'Chefe Equipa', 
                        department: 'obra', 
                        status: 'active', 
                        startDate: '2021-05-20',
                        team: 'Equipa 01 - Berlin',
                        salary: 2200
                    }
                ];
            },
            
            // Dados de exemplo para equipas
            initTeamsData: function() {
                const teamLocations = ['Berlim', 'Hamburgo', 'Lisboa', 'Porto', 'Frankfurt', 
                                      'Munique', 'Colônia', 'Estugarda', 'Düsseldorf', 'Essen', 
                                      'Dortmund', 'Bremen', 'Hanôver', 'Nuremberga', 'Leipzig'];
                const teamCountries = ['Alemanha', 'Alemanha', 'Portugal', 'Portugal', 'Alemanha',
                                      'Alemanha', 'Alemanha', 'Alemanha', 'Alemanha', 'Alemanha',
                                      'Alemanha', 'Alemanha', 'Alemanha', 'Alemanha', 'Alemanha'];
                
                this.teams = [];
                for (let i = 1; i <= 15; i++) {
                    const locationIndex = i - 1;
                    this.teams.push({
                        id: i,
                        name: `Equipa ${i.toString().padStart(2, '0')} - ${teamLocations[locationIndex]}`,
                        location: teamLocations[locationIndex],
                        country: teamCountries[locationIndex],
                        leader: `Chefe ${i}`,
                        members: Math.floor(Math.random() * 5) + 3,
                        currentWork: `Projeto ${i}`,
                        status: 'active',
                        phone: `+351 912 345 ${(600 + i).toString().padStart(3, '0')}`,
                        email: `equipa${i}@mafc-filho.pt`
                    });
                }
            },
            
            // Dados de exemplo para fornecedores
            initSuppliersData: function() {
                this.suppliers = [
                    { 
                        id: 1, 
                        name: 'Cimentos de Portugal', 
                        nif: '500000001', 
                        contact: '+351219876543', 
                        email: 'vendas@cimentos.pt', 
                        type: ['construcao'], 
                        notes: 'Fornecedor principal de cimento',
                        rating: 5,
                        lastPurchase: '2024-12-01',
                        totalValue: 45000
                    },
                    { 
                        id: 2, 
                        name: 'Ferragens Lda.', 
                        nif: '500000002', 
                        contact: '+351219876544', 
                        email: 'compras@ferragens.pt', 
                        type: ['ferramentas', 'equipamentos'], 
                        notes: 'Ferramentas e equipamentos',
                        rating: 4,
                        lastPurchase: '2024-11-28',
                        totalValue: 32000
                    },
                    { 
                        id: 3, 
                        name: 'Madeiras Nobres SA', 
                        nif: '500000003', 
                        contact: '+351219876545', 
                        email: 'info@madeiras.pt', 
                        type: ['construcao'], 
                        notes: 'Madeiras para construção',
                        rating: 5,
                        lastPurchase: '2024-12-05',
                        totalValue: 28000
                    }
                ];
            },
            
            // Salvar no localStorage
            saveToStorage: function() {
                const data = {
                    officePeople: this.officePeople,
                    timeRecords: this.timeRecords,
                    materialRequests: this.materialRequests,
                    purchases: this.purchases,
                    documents: this.documents,
                    auditLog: this.auditLog,
                    activityLog: this.activityLog,
                    teams: this.teams,
                    suppliers: this.suppliers,
                    calendarEvents: this.calendarEvents,
                    settings: this.settings
                };
                localStorage.setItem('mafcSystem', JSON.stringify(data));
            },
            
            // Carregar do localStorage
            loadFromStorage: function() {
                try {
                    const data = JSON.parse(localStorage.getItem('mafcSystem'));
                    if (data) {
                        this.officePeople = data.officePeople || [];
                        this.timeRecords = data.timeRecords || {};
                        this.materialRequests = data.materialRequests || [];
                        this.purchases = data.purchases || [];
                        this.documents = data.documents || [];
                        this.auditLog = data.auditLog || [];
                        this.activityLog = data.activityLog || [];
                        this.teams = data.teams || [];
                        this.suppliers = data.suppliers || [];
                        this.calendarEvents = data.calendarEvents || [];
                        this.settings = data.settings || this.settings;
                    }
                } catch (e) {
                    console.error('Erro ao carregar dados:', e);
                    this.initSampleData();
                }
            },
            
            // Inicializar event listeners
            initEventListeners: function() {
                // Login form
                const loginForm = document.getElementById('loginForm');
                if (loginForm) {
                    loginForm.addEventListener('submit', function(e) {
                        e.preventDefault();
                        handleLogin();
                    });
                }
                
                // Abrir modal de login
                const openLoginBtn = document.getElementById('openLogin');
                if (openLoginBtn) {
                    openLoginBtn.addEventListener('click', function(e) {
                        e.preventDefault();
                        document.getElementById('loginModal').style.display = 'flex';
                    });
                }
                
                // Fechar modais
                document.querySelectorAll('.close-modal').forEach(btn => {
                    btn.addEventListener('click', function() {
                        this.closest('.modal').style.display = 'none';
                    });
                });
                
                // Fechar modais ao clicar fora
                window.addEventListener('click', function(e) {
                    if (e.target.classList.contains('modal')) {
                        e.target.style.display = 'none';
                    }
                });
                
                // Menu navigation
                document.querySelectorAll('.menu-item, .bottom-menu-item').forEach(item => {
                    item.addEventListener('click', function(e) {
                        e.preventDefault();
                        const sectionId = this.getAttribute('data-section') + 'Section';
                        
                        // Encontrar dashboard parent
                        const dashboard = this.closest('.dashboard');
                        if (!dashboard) return;
                        
                        // Remover active de todos os items do mesmo menu
                        const menuType = this.classList.contains('menu-item') ? 'menu-item' : 'bottom-menu-item';
                        dashboard.querySelectorAll('.' + menuType).forEach(i => {
                            i.classList.remove('active');
                        });
                        
                        // Adicionar active ao item clicado
                        this.classList.add('active');
                        
                        // Esconder todas as seções do dashboard
                        dashboard.querySelectorAll('.dashboard-section').forEach(section => {
                            section.classList.remove('active');
                        });
                        
                        // Mostrar seção selecionada
                        const section = document.getElementById(sectionId);
                        if (section) {
                            section.classList.add('active');
                            loadSectionData(sectionId);
                        }
                    });
                });
            },
            
            // Log de auditoria
            logAudit: function(action, details, module = 'system') {
                const logEntry = {
                    id: Date.now(),
                    timestamp: new Date().toISOString(),
                    user: this.currentUser ? this.currentUser.name : 'system',
                    userRole: this.currentUser ? this.currentUser.role : 'system',
                    ip: '127.0.0.1',
                    action: action,
                    details: details,
                    module: module
                };
                
                this.auditLog.unshift(logEntry);
                this.activityLog.unshift({
                    ...logEntry,
                    displayTime: new Date().toLocaleTimeString('pt-PT')
                });
                
                // Manter apenas últimos 1000 registos
                if (this.auditLog.length > 1000) this.auditLog.pop();
                if (this.activityLog.length > 100) this.activityLog.pop();
                
                this.saveToStorage();
            },
            
            // Log de atividade
            logActivity: function(action, details) {
                this.logAudit(action, details, 'activity');
            },
            
            // Mostrar notificação
            showNotification: function(message, type = 'success') {
                const notificationArea = document.getElementById('notificationArea');
                if (!notificationArea) return;
                
                const notification = document.createElement('div');
                notification.className = `notification notification-${type}`;
                notification.innerHTML = `
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'exclamation-triangle'}"></i>
                    <div>${message}</div>
                    <button onclick="this.parentElement.remove()" style="background:none; border:none; cursor:pointer;">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                
                notificationArea.appendChild(notification);
                
                // Mostrar
                setTimeout(() => notification.classList.add('show'), 10);
                
                // Remover automaticamente após 5 segundos
                setTimeout(() => {
                    notification.classList.remove('show');
                    setTimeout(() => notification.remove(), 300);
                }, 5000);
            },
            
            // Carregar dados da seção
            loadSectionData: function(sectionId) {
                switch(sectionId) {
                    case 'bossOverviewSection':
                        loadBossOverview();
                        break;
                    case 'bossTeamsSection':
                        loadBossTeams();
                        break;
                    case 'bossPurchasesSection':
                        loadBossPurchases();
                        break;
                    case 'bossFinancesSection':
                        loadBossFinances();
                        break;
                    case 'bossHoursSection':
                        loadBossHours();
                        break;
                    case 'bossReportsSection':
                        loadBossReports();
                        break;
                    case 'bossAuditSection':
                        loadBossAudit();
                        break;
                    case 'bossSettingsSection':
                        loadBossSettings();
                        break;
                    case 'officeDashboardSection':
                        loadOfficeDashboard();
                        break;
                    case 'officePeopleSection':
                        loadOfficePeople();
                        break;
                    case 'officeTimeSection':
                        loadOfficeTime();
                        break;
                    case 'officeReportsSection':
                        loadOfficeReports();
                        break;
                    case 'officeDocumentsSection':
                        loadOfficeDocuments();
                        break;
                    case 'officeDruckerSection':
                        loadOfficeDrucker();
                        break;
                    case 'officeCalendarSection':
                        loadOfficeCalendar();
                        break;
                    case 'teamOverviewSection':
                        loadTeamOverview();
                        break;
                    case 'teamTimeSection':
                        loadTeamTime();
                        break;
                    case 'teamMaterialsSection':
                        loadTeamMaterials();
                        break;
                    case 'teamRequestsSection':
                        loadTeamRequests();
                        break;
                    case 'teamReportsSection':
                        loadTeamReports();
                        break;
                    case 'teamGPSSection':
                        loadTeamGPS();
                        break;
                    case 'purchaseDashboardSection':
                        loadPurchaseDashboard();
                        break;
                    case 'purchasePendingSection':
                        loadPurchasePending();
                        break;
                    case 'purchaseApprovedSection':
                        loadPurchaseApproved();
                        break;
                    case 'purchaseCompletedSection':
                        loadPurchaseCompleted();
                        break;
                    case 'purchaseSuppliersSection':
                        loadPurchaseSuppliers();
                        break;
                    case 'purchaseReportsSection':
                        loadPurchaseReports();
                        break;
                    case 'purchaseOrdersSection':
                        loadPurchaseOrders();
                        break;
                }
            }
        };
        
        // ============ FUNÇÕES GLOBAIS ============
        
        // Atualizar relógios
        function updateClocks() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('pt-PT');
            const timeShort = now.toLocaleTimeString('pt-PT', { hour: '2-digit', minute: '2-digit' });
            
            // Atualizar todos os relógios visíveis
            ['boss', 'team', 'purchase', 'office'].forEach(role => {
                const element = document.getElementById(`${role}CurrentTime`);
                if (element) element.textContent = timeShort;
            });
            
            // Relógios grandes
            ['officeClock', 'officeClockIndividual'].forEach(id => {
                const element = document.getElementById(id);
                if (element) element.textContent = timeString;
            });
            
            // Atualizar hora da equipa
            if (document.getElementById('teamCurrentTimeDisplay')) {
                document.getElementById('teamCurrentTimeDisplay').textContent = timeShort;
            }
        }
        
        // Mostrar loading
        function showLoading() {
            document.getElementById('loadingSpinner').style.display = 'block';
        }
        
        // Esconder loading
        function hideLoading() {
            document.getElementById('loadingSpinner').style.display = 'none';
        }
        
        // ============ SISTEMA DE LOGIN ============
        
        function handleLogin() {
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;
            const role = document.getElementById('role').value;
            
            if (!username || !password || !role) {
                MAFCSystem.showNotification('Preencha todos os campos!', 'error');
                return;
            }
            
            let userFound = null;
            
            // Verificar credenciais
            if (MAFCSystem.credentials[role]) {
                userFound = MAFCSystem.credentials[role].find(u => 
                    u.code === username && u.password === password
                );
            }
            
            if (userFound) {
                MAFCSystem.currentUser = { ...userFound, role };
                MAFCSystem.logAudit('login', `Login realizado como ${role}`);
                loginSuccess();
            } else {
                MAFCSystem.showNotification('Credenciais incorretas!', 'error');
            }
        }
        
        function loginSuccess() {
            document.getElementById('loginModal').style.display = 'none';
            document.getElementById('publicWebsite').style.display = 'none';
            
            // Resetar todos os dashboards
            document.querySelectorAll('.dashboard').forEach(d => {
                d.style.display = 'none';
            });
            
            // Mostrar dashboard apropriado
            switch(MAFCSystem.currentUser.role) {
                case 'boss':
                    showBossDashboard();
                    break;
                case 'team':
                    showTeamDashboard();
                    break;
                case 'purchase':
                    showPurchaseDashboard();
                    break;
                case 'office':
                    showOfficeDashboard();
                    break;
            }
            
            // Inicializar dashboard
            initializeDashboard();
        }
        
        function logout() {
            if (confirm('Tem certeza que deseja sair do sistema?')) {
                MAFCSystem.logAudit('logout', 'Logout realizado');
                
                // Esconder todos os dashboards
                document.querySelectorAll('.dashboard').forEach(d => {
                    d.style.display = 'none';
                });
                
                // Mostrar website público
                document.getElementById('publicWebsite').style.display = 'block';
                
                // Fechar todos os modais
                document.querySelectorAll('.modal').forEach(modal => {
                    modal.style.display = 'none';
                });
                
                // Limpar formulário de login
                document.getElementById('loginForm').reset();
                MAFCSystem.currentUser = null;
                
                MAFCSystem.showNotification('Logout realizado com sucesso!');
            }
        }
        
        // ============ DASHBOARD DO PATRÃO ============
        
        function showBossDashboard() {
            document.getElementById('bossDashboard').style.display = 'block';
            document.getElementById('bossUserName').textContent = MAFCSystem.currentUser.name;
            loadBossOverview();
        }
        
        function loadBossOverview() {
            // Atualizar estatísticas
            document.getElementById('totalEmployees').textContent = MAFCSystem.officePeople.length;
            document.getElementById('activeTeams').textContent = MAFCSystem.teams.filter(t => t.status === 'active').length;
            
            // Calcular despesas do mês
            const currentMonth = new Date().getMonth() + 1;
            const monthPurchases = MAFCSystem.purchases.filter(p => {
                if (!p.purchaseDate) return false;
                const purchaseDate = new Date(p.purchaseDate);
                return purchaseDate.getMonth() + 1 === currentMonth;
            });
            const monthExpenses = monthPurchases.reduce((sum, p) => sum + (p.totalValue || 0), 0);
            document.getElementById('monthExpenses').textContent = `€${(monthExpenses/1000).toFixed(1)}K`;
            
            // Pedidos pendentes
            const pendingItems = MAFCSystem.materialRequests.filter(r => r.status === 'pending').length;
            document.getElementById('pendingItems').textContent = pendingItems;
            
            // Atualizar badges
            document.getElementById('teamsBadge').textContent = MAFCSystem.teams.length;
            document.getElementById('purchasesBadge').textContent = MAFCSystem.purchases.length;
            document.getElementById('teamsCountBottom').textContent = MAFCSystem.teams.length;
            document.getElementById('pendingPurchasesBottom').textContent = pendingItems;
            
            // Calcular horas pendentes
            const today = new Date().toLocaleDateString('pt-PT');
            const todayRecords = MAFCSystem.timeRecords[today] || {};
            let pendingHoursCount = 0;
            Object.values(todayRecords).forEach(record => {
                if (record.entry && !record.exit) pendingHoursCount++;
            });
            document.getElementById('pendingHoursBottom').textContent = pendingHoursCount;
            
            // Carregar alertas
            loadBossAlerts();
            
            // Carregar atividade
            loadBossActivity();
            
            // Carregar calendário
            loadBossCalendar();
        }
        
        function loadBossTeams() {
            const tbody = document.getElementById('bossTeamsTable');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            MAFCSystem.teams.forEach(team => {
                const statusBadge = team.status === 'active' ? 
                    '<span class="badge badge-success">Ativa</span>' :
                    '<span class="badge badge-danger">Inativa</span>';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>#${team.id.toString().padStart(3, '0')}</td>
                    <td><strong>${team.name}</strong></td>
                    <td>${team.location}</td>
                    <td>${team.leader}</td>
                    <td>${team.members}</td>
                    <td>${team.currentWork}</td>
                    <td>${statusBadge}</td>
                    <td>
                        <button class="btn-dashboard btn-sm btn-info" onclick="viewTeamDetails(${team.id})">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn-dashboard btn-sm btn-warning" onclick="editTeam(${team.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        function loadBossPurchases() {
            const tbody = document.getElementById('bossPurchasesTable');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            // Combinar pedidos e compras
            const allPurchases = [...MAFCSystem.materialRequests, ...MAFCSystem.purchases]
                .sort((a, b) => new Date(b.date || b.requestDate) - new Date(a.date || a.requestDate));
            
            allPurchases.slice(0, 50).forEach(item => {
                const isRequest = !item.orderNumber;
                const statusMap = {
                    'pending': '<span class="badge badge-warning">Pendente</span>',
                    'approved': '<span class="badge badge-info">Aprovado</span>',
                    'completed': '<span class="badge badge-success">Concluído</span>',
                    'cancelled': '<span class="badge badge-danger">Cancelado</span>'
                };
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${isRequest ? `#PED-${item.id}` : `#ORD-${item.orderNumber}`}</td>
                    <td>${item.team || '--'}</td>
                    <td>${item.material || '--'}</td>
                    <td>${item.quantity || '--'} ${item.unit || ''}</td>
                    <td>${item.totalValue ? `€${item.totalValue.toLocaleString('pt-PT')}` : '--'}</td>
                    <td>${new Date(item.date || item.requestDate).toLocaleDateString('pt-PT')}</td>
                    <td>${statusMap[item.status] || '--'}</td>
                    <td>${item.responsible || '--'}</td>
                    <td>
                        <button class="btn-dashboard btn-sm btn-info" onclick="viewPurchaseDetails('${isRequest ? 'request' : 'purchase'}', ${item.id})">
                            <i class="fas fa-eye"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        function loadBossFinances() {
            // Atualizar estatísticas financeiras
            document.getElementById('totalRevenue').textContent = '€245.8K';
            document.getElementById('totalExpenses').textContent = '€85.2K';
            document.getElementById('profitMargin').textContent = '32.5%';
            document.getElementById('cashFlow').textContent = '€160.6K';
            
            // Carregar faturas
            const tbody = document.getElementById('invoicesTable');
            if (tbody) {
                tbody.innerHTML = `
                    <tr>
                        <td>FAT-2024-1234</td>
                        <td>Município de Lisboa</td>
                        <td>€45.200</td>
                        <td>15/12/2024</td>
                        <td><span class="badge badge-success">Paga</span></td>
                    </tr>
                    <tr>
                        <td>FAT-2024-1235</td>
                        <td>EDP Distribuição</td>
                        <td>€32.500</td>
                        <td>20/12/2024</td>
                        <td><span class="badge badge-warning">Pendente</span></td>
                    </tr>
                `;
            }
        }
        
        function loadBossHours() {
            const tbody = document.getElementById('bossHoursTable');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            // Agrupar horas por pessoa
            const hoursSummary = {};
            
            MAFCSystem.officePeople.forEach(person => {
                let totalHours = 0;
                let normalHours = 0;
                let extraHours = 0;
                
                // Calcular horas do mês
                Object.entries(MAFCSystem.timeRecords).forEach(([date, records]) => {
                    const record = records[person.id];
                    if (record && record.totalHours) {
                        const hours = parseFloat(record.totalHours);
                        totalHours += hours;
                        normalHours += Math.min(hours, 8);
                        extraHours += Math.max(0, hours - 8);
                    }
                });
                
                if (totalHours > 0) {
                    hoursSummary[person.id] = {
                        name: person.name,
                        team: person.team || 'Escritório',
                        normalHours: normalHours.toFixed(1),
                        extraHours: extraHours.toFixed(1),
                        totalHours: totalHours.toFixed(1),
                        value: (normalHours * 10 + extraHours * 12.5).toFixed(2) // Valores exemplo
                    };
                }
            });
            
            // Adicionar à tabela
            Object.values(hoursSummary).forEach(summary => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${summary.name}</td>
                    <td>${summary.team}</td>
                    <td>${summary.normalHours}h</td>
                    <td>${summary.extraHours}h</td>
                    <td>${summary.totalHours}h</td>
                    <td>€${summary.value}</td>
                    <td>
                        <button class="btn-dashboard btn-sm btn-info" onclick="viewPersonHours('${summary.name}')">
                            <i class="fas fa-eye"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        function loadBossReports() {
            // Esta função carrega os relatórios
            // Em produção, aqui seriam carregados dados reais
        }
        
        function loadBossAudit() {
            const tbody = document.getElementById('bossAuditTable');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            MAFCSystem.auditLog.slice(0, 50).forEach(log => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${new Date(log.timestamp).toLocaleString('pt-PT')}</td>
                    <td>${log.user} (${log.userRole})</td>
                    <td>${log.ip}</td>
                    <td>${log.action}</td>
                    <td>${log.details}</td>
                    <td>${log.module}</td>
                `;
                tbody.appendChild(row);
            });
        }
        
        function loadBossSettings() {
            // Carregar configurações
            document.getElementById('companyName').value = MAFCSystem.settings.companyName;
            document.getElementById('companyNIF').value = MAFCSystem.settings.companyNIF;
            document.getElementById('normalHours').value = MAFCSystem.settings.normalHours;
            document.getElementById('extraHourRate').value = MAFCSystem.settings.extraHourRate;
            document.getElementById('whatsappMessage').value = MAFCSystem.settings.whatsappMessage;
            document.getElementById('autoBackup').value = MAFCSystem.settings.autoBackup;
        }
        
        function loadBossAlerts() {
            const alertsDiv = document.getElementById('bossAlerts');
            if (!alertsDiv) return;
            
            alertsDiv.innerHTML = '';
            
            // Alertas de pedidos urgentes
            const urgentRequests = MAFCSystem.materialRequests.filter(r => 
                r.status === 'pending' && r.urgency === 'critical'
            );
            
            if (urgentRequests.length > 0) {
                const alert = document.createElement('div');
                alert.className = 'alert alert-danger';
                alert.innerHTML = `
                    <i class="fas fa-exclamation-triangle"></i>
                    <div>
                        <strong>${urgentRequests.length} pedidos críticos pendentes</strong>
                        <p>Necessitam de atenção imediata</p>
                    </div>
                    <button class="btn-dashboard btn-sm btn-danger" onclick="viewUrgentRequests()">
                        Ver
                    </button>
                `;
                alertsDiv.appendChild(alert);
            }
            
            // Alertas de horas pendentes
            const today = new Date().toLocaleDateString('pt-PT');
            const todayRecords = MAFCSystem.timeRecords[today] || {};
            const missingExits = Object.values(todayRecords).filter(record => 
                record.entry && !record.exit
            ).length;
            
            if (missingExits > 0) {
                const alert = document.createElement('div');
                alert.className = 'alert alert-warning';
                alert.innerHTML = `
                    <i class="fas fa-clock"></i>
                    <div>
                        <strong>${missingExits} saídas não registadas</strong>
                        <p>Funcionários ainda não marcaram saída</p>
                    </div>
                    <button class="btn-dashboard btn-sm btn-warning" onclick="viewMissingExits()">
                        Ver
                    </button>
                `;
                alertsDiv.appendChild(alert);
            }
        }
        
        function loadBossActivity() {
            const tbody = document.getElementById('bossActivityLog');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            MAFCSystem.activityLog.slice(0, 10).forEach(log => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${new Date(log.timestamp).toLocaleString('pt-PT')}</td>
                    <td>${log.user}</td>
                    <td>${log.action}</td>
                    <td>${log.details}</td>
                `;
                tbody.appendChild(row);
            });
        }
        
        function loadBossCalendar() {
            const calendarGrid = document.getElementById('calendarGrid');
            if (!calendarGrid) return;
            
            const now = new Date();
            const currentMonth = now.getMonth();
            const currentYear = now.getFullYear();
            
            // Atualizar título
            document.getElementById('currentMonth').textContent = 
                now.toLocaleDateString('pt-PT', { month: 'long', year: 'numeric' });
            
            // Gerar calendário
            calendarGrid.innerHTML = '';
            
            // Dias da semana
            const days = ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb'];
            days.forEach(day => {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                dayElement.style.fontWeight = 'bold';
                dayElement.textContent = day;
                calendarGrid.appendChild(dayElement);
            });
            
            // Dias do mês
            const firstDay = new Date(currentYear, currentMonth, 1);
            const lastDay = new Date(currentYear, currentMonth + 1, 0);
            
            // Espaços vazios antes do primeiro dia
            for (let i = 0; i < firstDay.getDay(); i++) {
                const emptyElement = document.createElement('div');
                emptyElement.className = 'calendar-day';
                calendarGrid.appendChild(emptyElement);
            }
            
            // Dias do mês
            for (let day = 1; day <= lastDay.getDate(); day++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                dayElement.textContent = day;
                
                // Marcar dia atual
                if (day === now.getDate() && currentMonth === now.getMonth()) {
                    dayElement.classList.add('today');
                }
                
                // Verificar se há eventos neste dia
                const hasEvent = MAFCSystem.calendarEvents.some(event => {
                    const eventDate = new Date(event.date);
                    return eventDate.getDate() === day && 
                           eventDate.getMonth() === currentMonth && 
                           eventDate.getFullYear() === currentYear;
                });
                
                if (hasEvent) {
                    dayElement.classList.add('event');
                    dayElement.title = 'Tem eventos';
                }
                
                calendarGrid.appendChild(dayElement);
            }
        }
        
        // ============ DASHBOARD ESCRITÓRIO ============
        
        function showOfficeDashboard() {
            document.getElementById('officeDashboard').style.display = 'block';
            document.getElementById('officeUserName').textContent = MAFCSystem.currentUser.name;
            loadOfficeDashboard();
        }
        
        function loadOfficeDashboard() {
            // Atualizar estatísticas
            document.getElementById('officePeopleCount').textContent = MAFCSystem.officePeople.length;
            
            // Calcular horas hoje
            const today = new Date().toLocaleDateString('pt-PT');
            let todayHours = 0;
            if (MAFCSystem.timeRecords[today]) {
                Object.values(MAFCSystem.timeRecords[today]).forEach(record => {
                    if (record.totalHours) todayHours += parseFloat(record.totalHours);
                });
            }
            document.getElementById('officeTodayHours').textContent = todayHours.toFixed(1);
            
            // Documentos
            document.getElementById('officeDocumentsCount').textContent = MAFCSystem.documents.length;
            
            // Carregar tabelas
            loadOfficeTodayMarks();
            loadAllEmployeesTime();
        }
        
        function loadOfficeTodayMarks() {
            const tbody = document.getElementById('officeTodayMarks');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            const today = new Date().toLocaleDateString('pt-PT');
            const todayRecords = MAFCSystem.timeRecords[today] || {};
            
            MAFCSystem.officePeople.forEach(person => {
                if (person.status === 'active') {
                    const record = todayRecords[person.id] || {};
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${person.name}</td>
                        <td>${record.entry || '--:--'}</td>
                        <td>${record.exit || '--:--'}</td>
                        <td>${record.totalHours ? record.totalHours + 'h' : '--'}</td>
                        <td>
                            <a href="https://wa.me/${person.whatsapp.replace('+', '')}" target="_blank" class="btn-dashboard btn-sm btn-whatsapp">
                                <i class="fab fa-whatsapp"></i>
                            </a>
                        </td>
                    `;
                    tbody.appendChild(row);
                }
            });
        }
        
        function loadAllEmployeesTime() {
            const tbody = document.getElementById('allEmployeesTime');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            const today = new Date().toLocaleDateString('pt-PT');
            const todayRecords = MAFCSystem.timeRecords[today] || {};
            
            MAFCSystem.officePeople.forEach(person => {
                if (person.status === 'active') {
                    const record = todayRecords[person.id] || {};
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${person.name}</td>
                        <td>${record.entry || '--:--'}</td>
                        <td>${record.exit || '--:--'}</td>
                        <td>${record.break || '--'}</td>
                        <td>${record.totalHours ? record.totalHours + 'h' : '--'}</td>
                        <td>
                            <button class="btn-dashboard btn-sm btn-success" onclick="markEmployeeTime(${person.id}, 'entry')">
                                <i class="fas fa-sign-in-alt"></i>
                            </button>
                            <button class="btn-dashboard btn-sm btn-warning" onclick="markEmployeeTime(${person.id}, 'break')">
                                <i class="fas fa-coffee"></i>
                            </button>
                            <button class="btn-dashboard btn-sm btn-danger" onclick="markEmployeeTime(${person.id}, 'exit')">
                                <i class="fas fa-sign-out-alt"></i>
                            </button>
                        </td>
                    `;
                    tbody.appendChild(row);
                }
            });
        }
        
        function markEmployeeTime(personId, type) {
            const person = MAFCSystem.officePeople.find(p => p.id === personId);
            if (!person) return;
            
            const now = new Date();
            const timeString = now.toLocaleTimeString('pt-PT', { hour: '2-digit', minute: '2-digit' });
            const dateString = now.toLocaleDateString('pt-PT');
            
            // Inicializar registos do dia se necessário
            if (!MAFCSystem.timeRecords[dateString]) {
                MAFCSystem.timeRecords[dateString] = {};
            }
            if (!MAFCSystem.timeRecords[dateString][personId]) {
                MAFCSystem.timeRecords[dateString][personId] = {
                    personName: person.name,
                    personId: personId
                };
            }
            
            const record = MAFCSystem.timeRecords[dateString][personId];
            
            switch(type) {
                case 'entry':
                    record.entry = timeString;
                    MAFCSystem.logActivity('time_entry', `${person.name} - Entrada: ${timeString}`);
                    break;
                case 'exit':
                    record.exit = timeString;
                    // Calcular horas totais
                    if (record.entry) {
                        calculateTotalHours(record);
                    }
                    MAFCSystem.logActivity('time_exit', `${person.name} - Saída: ${timeString}`);
                    break;
                case 'break':
                    record.break = record.break === '60' ? '' : '60';
                    MAFCSystem.logActivity('break', `${person.name} - ${record.break ? 'Pausa' : 'Fim pausa'}`);
                    break;
            }
            
            MAFCSystem.saveToStorage();
            
            // Enviar notificação WhatsApp
            const messages = {
                'entry': `✅ ${person.name} - Entrada registada às ${timeString} - MAFC`,
                'exit': `✅ ${person.name} - Saída registada às ${timeString} - MAFC`,
                'break': `⏸️ ${person.name} - Pausa registada às ${timeString} - MAFC`
            };
            
            const message = messages[type];
            if (message && person.whatsapp) {
                const url = `https://wa.me/${person.whatsapp.replace('+', '')}?text=${encodeURIComponent(message)}`;
                window.open(url, '_blank');
            }
            
            MAFCSystem.showNotification(`${person.name} - ${type === 'entry' ? 'Entrada' : type === 'exit' ? 'Saída' : 'Pausa'} registada às ${timeString}`);
            
            // Atualizar tabelas
            loadAllEmployeesTime();
            loadOfficeTodayMarks();
        }
        
        function calculateTotalHours(record) {
            if (!record.entry || !record.exit) return;
            
            const entryTime = record.entry.split(':').map(Number);
            const exitTime = record.exit.split(':').map(Number);
            let totalMinutes = (exitTime[0] * 60 + exitTime[1]) - (entryTime[0] * 60 + entryTime[1]);
            
            // Ajustar para casos que passam da meia-noite
            if (totalMinutes < 0) totalMinutes += 24 * 60;
            
            // Subtrair pausa se existir
            if (record.break === '60') {
                totalMinutes -= 60;
            }
            
            record.totalHours = (totalMinutes / 60).toFixed(1);
        }
        
        function markAllEntry() {
            if (confirm('Registar entrada para TODOS os funcionários ativos?')) {
                const now = new Date();
                const timeString = now.toLocaleTimeString('pt-PT', { hour: '2-digit', minute: '2-digit' });
                const dateString = now.toLocaleDateString('pt-PT');
                
                if (!MAFCSystem.timeRecords[dateString]) {
                    MAFCSystem.timeRecords[dateString] = {};
                }
                
                MAFCSystem.officePeople.forEach(person => {
                    if (person.status === 'active') {
                        if (!MAFCSystem.timeRecords[dateString][person.id]) {
                            MAFCSystem.timeRecords[dateString][person.id] = {
                                personName: person.name,
                                personId: person.id
                            };
                        }
                        MAFCSystem.timeRecords[dateString][person.id].entry = timeString;
                    }
                });
                
                MAFCSystem.saveToStorage();
                MAFCSystem.logActivity('bulk_time_entry', 'Entrada registada para todos os funcionários');
                MAFCSystem.showNotification(`Entrada registada para TODOS os funcionários às ${timeString}`);
                
                loadAllEmployeesTime();
                loadOfficeTodayMarks();
            }
        }
        
        function markAllExit() {
            if (confirm('Registar saída para TODOS os funcionários ativos?')) {
                const now = new Date();
                const timeString = now.toLocaleTimeString('pt-PT', { hour: '2-digit', minute: '2-digit' });
                const dateString = now.toLocaleDateString('pt-PT');
                
                if (!MAFCSystem.timeRecords[dateString]) {
                    MAFCSystem.timeRecords[dateString] = {};
                }
                
                MAFCSystem.officePeople.forEach(person => {
                    if (person.status === 'active') {
                        if (!MAFCSystem.timeRecords[dateString][person.id]) {
                            MAFCSystem.timeRecords[dateString][person.id] = {
                                personName: person.name,
                                personId: person.id
                            };
                        }
                        const record = MAFCSystem.timeRecords[dateString][person.id];
                        record.exit = timeString;
                        
                        // Calcular horas totais
                        if (record.entry) {
                            calculateTotalHours(record);
                        }
                    }
                });
                
                MAFCSystem.saveToStorage();
                MAFCSystem.logActivity('bulk_time_exit', 'Saída registada para todos os funcionários');
                MAFCSystem.showNotification(`Saída registada para TODOS os funcionários às ${timeString}`);
                
                loadAllEmployeesTime();
                loadOfficeTodayMarks();
            }
        }
        
        // ============ GESTÃO DE PESSOAL ============
        
        function openEmployeeModal() {
            MAFCSystem.editingEmployeeId = null;
            document.getElementById('employeeModal').style.display = 'flex';
            
            // Limpar formulário
            document.getElementById('employeeName').value = '';
            document.getElementById('employeeWhatsApp').value = '+351';
            document.getElementById('employeePosition').value = 'administrativo';
            document.getElementById('employeeDepartment').value = 'escritorio';
            document.getElementById('employeeStartDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('employeeStatus').value = 'active';
        }
        
        function saveEmployee() {
            const name = document.getElementById('employeeName').value.trim();
            const whatsapp = document.getElementById('employeeWhatsApp').value.trim();
            const position = document.getElementById('employeePosition').value;
            const department = document.getElementById('employeeDepartment').value;
            const startDate = document.getElementById('employeeStartDate').value;
            const status = document.getElementById('employeeStatus').value;
            
            if (!name || !whatsapp) {
                MAFCSystem.showNotification('Preencha pelo menos o nome e WhatsApp!', 'error');
                return;
            }
            
            if (MAFCSystem.editingEmployeeId) {
                // Editar funcionário existente
                const index = MAFCSystem.officePeople.findIndex(p => p.id === MAFCSystem.editingEmployeeId);
                if (index !== -1) {
                    MAFCSystem.officePeople[index] = {
                        ...MAFCSystem.officePeople[index],
                        name, whatsapp, position, department, startDate, status
                    };
                    MAFCSystem.logActivity('update_employee', `Atualizou funcionário: ${name}`);
                }
            } else {
                // Adicionar novo funcionário
                const newId = MAFCSystem.officePeople.length > 0 ? 
                    Math.max(...MAFCSystem.officePeople.map(p => p.id)) + 1 : 1;
                
                MAFCSystem.officePeople.push({
                    id: newId,
                    name, whatsapp, position, department, startDate, status,
                    salary: 0
                });
                MAFCSystem.logActivity('add_employee', `Adicionou funcionário: ${name}`);
            }
            
            MAFCSystem.saveToStorage();
            MAFCSystem.showNotification('Funcionário guardado com sucesso!');
            
            // Fechar modal e atualizar dados
            closeModal('employeeModal');
            
            // Atualizar interfaces relevantes
            if (MAFCSystem.currentUser.role === 'office') {
                loadOfficeDashboard();
                loadOfficePeople();
            } else if (MAFCSystem.currentUser.role === 'boss') {
                loadBossOverview();
            }
        }
        
        function loadOfficePeople() {
            const tbody = document.getElementById('officePeopleTable');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            MAFCSystem.officePeople.forEach(person => {
                const statusBadge = {
                    'active': 'badge-success',
                    'inactive': 'badge-danger',
                    'ferias': 'badge-warning',
                    'baixa': 'badge-info'
                }[person.status] || 'badge-secondary';
                
                const statusText = {
                    'active': 'Ativo',
                    'inactive': 'Inativo',
                    'ferias': 'Férias',
                    'baixa': 'Baixa'
                }[person.status] || person.status;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${person.name}</td>
                    <td>${person.whatsapp}</td>
                    <td>${person.position}</td>
                    <td>${person.department}</td>
                    <td><span class="badge ${statusBadge}">${statusText}</span></td>
                    <td>
                        <button class="btn-dashboard btn-sm btn-warning" onclick="editEmployee(${person.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <a href="https://wa.me/${person.whatsapp.replace('+', '')}" target="_blank" class="btn-dashboard btn-sm btn-whatsapp">
                            <i class="fab fa-whatsapp"></i>
                        </a>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        function editEmployee(id) {
            const person = MAFCSystem.officePeople.find(p => p.id === id);
            if (person) {
                MAFCSystem.editingEmployeeId = id;
                document.getElementById('employeeModal').style.display = 'flex';
                
                // Preencher formulário
                document.getElementById('employeeName').value = person.name;
                document.getElementById('employeeWhatsApp').value = person.whatsapp;
                document.getElementById('employeePosition').value = person.position;
                document.getElementById('employeeDepartment').value = person.department;
                document.getElementById('employeeStartDate').value = person.startDate;
                document.getElementById('employeeStatus').value = person.status;
            }
        }
        
        // ============ DASHBOARD CHEFE DE EQUIPA ============
        
        function showTeamDashboard() {
            document.getElementById('teamDashboard').style.display = 'block';
            const userName = MAFCSystem.currentUser.team || MAFCSystem.currentUser.name;
            document.getElementById('teamUserName').textContent = userName;
            loadTeamOverview();
        }
        
        function loadTeamOverview() {
            // Atualizar estatísticas
            const userTeam = MAFCSystem.currentUser.team;
            const teamData = MAFCSystem.teams.find(t => t.name === userTeam);
            
            if (teamData) {
                document.getElementById('teamMembersCount').textContent = teamData.members;
                document.getElementById('teamStatus').textContent = teamData.status === 'active' ? 'Online' : 'Offline';
            }
            
            // Calcular horas hoje para a equipa
            const today = new Date().toLocaleDateString('pt-PT');
            const todayRecords = MAFCSystem.timeRecords[today] || {};
            let teamHours = 0;
            
            Object.values(todayRecords).forEach(record => {
                if (record.totalHours) {
                    // Verificar se o funcionário pertence à equipa
                    const person = MAFCSystem.officePeople.find(p => p.id === record.personId);
                    if (person && person.team === userTeam) {
                        teamHours += parseFloat(record.totalHours);
                    }
                }
            });
            
            document.getElementById('teamHoursToday').textContent = teamHours.toFixed(1);
            
            // Pedidos pendentes da equipa
            const pendingRequests = MAFCSystem.materialRequests.filter(r => 
                r.team === userTeam && r.status === 'pending'
            ).length;
            
            document.getElementById('teamPendingRequests').textContent = pendingRequests;
            document.getElementById('pendingRequestsBottom').textContent = pendingRequests;
            document.getElementById('requestsBadge').textContent = pendingRequests;
            
            // Carregar materiais
            loadMaterials();
            
            // Carregar lista de equipas
            loadTeamList();
        }
        
        function loadMaterials() {
            const select = document.getElementById('materialSelect');
            if (!select) return;
            
            // Materiais por categoria
            const materials = {
                construction: [
                    { id: 1, name: 'Cimento' },
                    { id: 2, name: 'Areia' },
                    { id: 3, name: 'Brita' },
                    { id: 4, name: 'Tijolos' },
                    { id: 5, name: 'Argamassa' },
                    { id: 6, name: 'Tinta' }
                ],
                machines: [
                    { id: 7, name: 'Retroescavadora' },
                    { id: 8, name: 'Compactador' },
                    { id: 9, name: 'Betoneira' },
                    { id: 10, name: 'Grua' }
                ],
                tools: [
                    { id: 11, name: 'Martelo Pneumático' },
                    { id: 12, name: 'Furadeira' },
                    { id: 13, name: 'Serra Circular' },
                    { id: 14, name: 'Nível Laser' }
                ],
                consumables: [
                    { id: 15, name: 'Gasóleo' },
                    { id: 16, name: 'Óleo Hidráulico' },
                    { id: 17, name: 'Parafusos' },
                    { id: 18, name: 'Pregos' }
                ],
                safety: [
                    { id: 19, name: 'Capacetes' },
                    { id: 20, name: 'Luvas' },
                    { id: 21, name: 'Botas' },
                    { id: 22, name: 'Colete Refletor' }
                ]
            };
            
            const category = document.getElementById('materialCategory').value;
            select.innerHTML = '<option value="">Selecione um material</option>';
            
            (materials[category] || []).forEach(mat => {
                const option = document.createElement('option');
                option.value = mat.id;
                option.textContent = mat.name;
                select.appendChild(option);
            });
        }
        
        function submitMaterialRequest() {
            const category = document.getElementById('materialCategory').value;
            const materialSelect = document.getElementById('materialSelect');
            const materialId = materialSelect.value;
            const materialName = materialSelect.options[materialSelect.selectedIndex].text;
            const quantity = document.getElementById('materialQuantity').value;
            const unit = document.getElementById('materialUnit').value;
            const urgency = document.getElementById('materialUrgency').value;
            const notes = document.getElementById('materialNotes').value;
            
            if (!materialId || !quantity) {
                MAFCSystem.showNotification('Selecione um material e quantidade!', 'error');
                return;
            }
            
            const requestId = Date.now();
            const request = {
                id: requestId,
                team: MAFCSystem.currentUser.team || 'Equipa',
                material: materialName,
                quantity: parseInt(quantity),
                unit: unit,
                urgency: urgency,
                notes: notes,
                requestDate: new Date().toISOString(),
                status: 'pending',
                requestedBy: MAFCSystem.currentUser.name,
                category: category
            };
            
            MAFCSystem.materialRequests.unshift(request);
            MAFCSystem.saveToStorage();
            MAFCSystem.logActivity('material_request', `Pediu material: ${materialName} (${quantity} ${unit})`);
            
            // Notificar admin via log
            MAFCSystem.logAudit('new_material_request', 
                `Nova requisição de material: ${materialName} - ${request.team}`, 
                'compras'
            );
            
            MAFCSystem.showNotification(`Pedido enviado para Compras! Nº: #PED-${requestId}`);
            
            // Limpar formulário
            document.getElementById('materialQuantity').value = 1;
            document.getElementById('materialNotes').value = '';
            
            // Atualizar contadores
            loadTeamOverview();
        }
        
        function loadTeamList() {
            const tbody = document.getElementById('teamListTable');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            document.getElementById('totalTeamsCount').textContent = `${MAFCSystem.teams.length} equipas`;
            
            MAFCSystem.teams.forEach(team => {
                const statusBadge = team.status === 'active' ? 
                    '<span class="badge badge-success">Ativa</span>' :
                    '<span class="badge badge-danger">Inativa</span>';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${team.name}</td>
                    <td>${team.location}</td>
                    <td>${team.leader}</td>
                    <td>${team.members} membros</td>
                    <td>${team.currentWork}</td>
                    <td>${statusBadge}</td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // ============ DASHBOARD COMPRAS ============
        
        function showPurchaseDashboard() {
            document.getElementById('purchaseDashboard').style.display = 'block';
            document.getElementById('purchaseUserName').textContent = MAFCSystem.currentUser.name;
            loadPurchaseDashboard();
        }
        
        function loadPurchaseDashboard() {
            // Contadores
            const pending = MAFCSystem.materialRequests.filter(r => r.status === 'pending').length;
            const approved = MAFCSystem.purchases.filter(p => p.status === 'approved').length;
            const completed = MAFCSystem.purchases.filter(p => p.status === 'completed').length;
            
            document.getElementById('purchasePendingCount').textContent = pending;
            document.getElementById('purchaseApprovedCount').textContent = approved;
            document.getElementById('purchaseCompletedCount').textContent = completed;
            document.getElementById('pendingPurchasesCountBottom').textContent = pending;
            document.getElementById('pendingBadge').textContent = pending;
            
            // Valor do mês
            const currentMonth = new Date().getMonth() + 1;
            const monthPurchases = MAFCSystem.purchases.filter(p => {
                if (!p.purchaseDate) return false;
                const date = new Date(p.purchaseDate);
                return date.getMonth() + 1 === currentMonth;
            });
            const monthValue = monthPurchases.reduce((sum, p) => sum + (p.totalValue || 0), 0);
            document.getElementById('purchaseMonthValue').textContent = `€${(monthValue/1000).toFixed(1)}K`;
            
            // Carregar tabelas
            loadPurchaseUrgentTable();
            loadSuppliersTable();
        }
        
        function loadPurchaseUrgentTable() {
            const tbody = document.getElementById('purchaseUrgentTable');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            const urgentRequests = MAFCSystem.materialRequests
                .filter(r => r.status === 'pending' && r.urgency === 'critical')
                .slice(0, 10);
            
            urgentRequests.forEach(request => {
                const timeDiff = Date.now() - new Date(request.requestDate).getTime();
                const hoursDiff = Math.floor(timeDiff / (1000 * 60 * 60));
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>#PED-${request.id}</td>
                    <td>${request.team}</td>
                    <td>${request.material}</td>
                    <td>${request.quantity} ${request.unit}</td>
                    <td><span class="badge badge-danger">CRÍTICO</span></td>
                    <td>${hoursDiff > 24 ? `${Math.floor(hoursDiff/24)}d` : `${hoursDiff}h`}</td>
                    <td>
                        <button class="btn-dashboard btn-sm btn-success" onclick="approvePurchaseRequest(${request.id})">
                            <i class="fas fa-check"></i>
                        </button>
                        <button class="btn-dashboard btn-sm btn-info" onclick="viewRequestDetails(${request.id})">
                            <i class="fas fa-eye"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        function loadSuppliersTable() {
            const tbody = document.getElementById('suppliersTable');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            MAFCSystem.suppliers.forEach(supplier => {
                // Gerar avaliação em estrelas
                const ratingStars = '★'.repeat(supplier.rating || 3) + '☆'.repeat(5 - (supplier.rating || 3));
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${supplier.name}</td>
                    <td>${supplier.nif}</td>
                    <td>${supplier.contact}</td>
                    <td>${Array.isArray(supplier.type) ? supplier.type.join(', ') : supplier.type}</td>
                    <td>${supplier.email}</td>
                    <td><span style="color: gold;">${ratingStars}</span></td>
                    <td>
                        <button class="btn-dashboard btn-sm btn-info" onclick="viewSupplierDetails(${supplier.id})">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn-dashboard btn-sm btn-whatsapp" onclick="contactSupplier(${supplier.id})">
                            <i class="fab fa-whatsapp"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        function approvePurchaseRequest(requestId) {
            const request = MAFCSystem.materialRequests.find(r => r.id === requestId);
            if (!request) return;
            
            // Em produção, aqui haveria um formulário mais completo
            // Por simplicidade, vamos aprovar automaticamente
            request.status = 'approved';
            request.approvalDate = new Date().toISOString();
            request.approvedBy = MAFCSystem.currentUser.name;
            
            // Criar ordem de compra associada
            const purchaseId = Date.now();
            const purchase = {
                id: purchaseId,
                orderNumber: `ORD-${purchaseId.toString().slice(-6)}`,
                requestId: requestId,
                material: request.material,
                quantity: request.quantity,
                unit: request.unit,
                supplier: 'Fornecedor Padrão',
                estimatedCost: 100,
                totalValue: 100 * request.quantity,
                purchaseDate: new Date().toISOString(),
                deliveryDate: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString(),
                status: 'approved',
                team: request.team,
                requestedBy: request.requestedBy,
                approvedBy: MAFCSystem.currentUser.name
            };
            
            MAFCSystem.purchases.unshift(purchase);
            MAFCSystem.saveToStorage();
            
            MAFCSystem.logActivity('purchase_approve', `Aprovou pedido #${requestId}`);
            MAFCSystem.showNotification(`Pedido #PED-${requestId} aprovado! Ordem criada: ${purchase.orderNumber}`);
            
            // Atualizar interface
            loadPurchaseDashboard();
        }
        
        // ============ FUNÇÕES UTILITÁRIAS ============
        
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
        
        function initializeDashboard() {
            // Inicializar dados específicos do dashboard atual
            switch(MAFCSystem.currentUser.role) {
                case 'office':
                    loadOfficeDashboard();
                    break;
                case 'boss':
                    loadBossOverview();
                    break;
                case 'purchase':
                    loadPurchaseDashboard();
                    break;
                case 'team':
                    loadTeamOverview();
                    break;
            }
        }
        
        function viewTeamDetails(teamId) {
            const team = MAFCSystem.teams.find(t => t.id === teamId);
            if (team) {
                alert(`Detalhes da Equipa:\n\nNome: ${team.name}\nLocalização: ${team.location}\nChefe: ${team.leader}\nMembros: ${team.members}\nObra: ${team.currentWork}\nEstado: ${team.status}`);
            }
        }
        
        function editTeam(teamId) {
            const team = MAFCSystem.teams.find(t => t.id === teamId);
            if (team) {
                // Em produção, abriria um modal de edição
                const newName = prompt('Novo nome da equipa:', team.name);
                if (newName && newName.trim()) {
                    team.name = newName.trim();
                    MAFCSystem.saveToStorage();
                    loadBossTeams();
                    MAFCSystem.showNotification('Equipa atualizada!');
                }
            }
        }
        
        function viewPurchaseDetails(type, id) {
            let item;
            if (type === 'request') {
                item = MAFCSystem.materialRequests.find(r => r.id === id);
            } else {
                item = MAFCSystem.purchases.find(p => p.id === id);
            }
            
            if (item) {
                let details = `Detalhes do ${type === 'request' ? 'Pedido' : 'Ordem de Compra'}:\n\n`;
                details += `ID: ${type === 'request' ? '#PED-' : '#ORD-'}${item.id}\n`;
                
                for (const [key, value] of Object.entries(item)) {
                    if (key !== 'id' && value) {
                        const formattedKey = key.replace(/([A-Z])/g, ' $1').toLowerCase();
                        const formattedValue = key.includes('Date') ? new Date(value).toLocaleDateString('pt-PT') : value;
                        details += `${formattedKey}: ${formattedValue}\n`;
                    }
                }
                
                alert(details);
            }
        }
        
        function viewUrgentRequests() {
            // Navegar para a seção de pedidos urgentes
            if (MAFCSystem.currentUser.role === 'purchase') {
                document.querySelector('[data-section="purchasePending"]').click();
            } else if (MAFCSystem.currentUser.role === 'boss') {
                document.querySelector('[data-section="bossPurchases"]').click();
            }
        }
        
        function viewMissingExits() {
            // Navegar para a seção de controlo de horas
            if (MAFCSystem.currentUser.role === 'office') {
                document.querySelector('[data-section="officeTime"]').click();
            } else if (MAFCSystem.currentUser.role === 'boss') {
                document.querySelector('[data-section="bossHours"]').click();
            }
        }
        
        function contactSupplier(supplierId) {
            const supplier = MAFCSystem.suppliers.find(s => s.id === supplierId);
            if (supplier) {
                const message = `Olá ${supplier.name},\n\nGostaríamos de solicitar um orçamento.\n\nAtenciosamente,\nMAFC & FILHO, LDA.`;
                window.open(`https://wa.me/${supplier.contact.replace('+', '')}?text=${encodeURIComponent(message)}`, '_blank');
            }
        }
        
        function viewRequestDetails(requestId) {
            const request = MAFCSystem.materialRequests.find(r => r.id === requestId);
            if (request) {
                alert(`Detalhes do Pedido:\n\nID: #PED-${request.id}\nMaterial: ${request.material}\nQuantidade: ${request.quantity} ${request.unit}\nEquipa: ${request.team}\nUrgência: ${request.urgency}\nEstado: ${request.status}\nData: ${new Date(request.requestDate).toLocaleDateString('pt-PT')}`);
            }
        }
        
        function viewSupplierDetails(supplierId) {
            const supplier = MAFCSystem.suppliers.find(s => s.id === supplierId);
            if (supplier) {
                alert(`Detalhes do Fornecedor:\n\nNome: ${supplier.name}\nNIF: ${supplier.nif}\nContacto: ${supplier.contact}\nEmail: ${supplier.email}\nTipos: ${Array.isArray(supplier.type) ? supplier.type.join(', ') : supplier.type}\nNotas: ${supplier.notes || 'Nenhuma'}`);
            }
        }
        
        // ============ INICIALIZAÇÃO DO SISTEMA ============
        
        document.addEventListener('DOMContentLoaded', function() {
            // Inicializar sistema
            MAFCSystem.init();
            
            // Iniciar relógios
            updateClocks();
            setInterval(updateClocks, 1000);
            
            // Adicionar listener para tecla ESC
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    document.querySelectorAll('.modal').forEach(modal => {
                        modal.style.display = 'none';
                    });
                }
            });
            
            // Adicionar listener para WhatsApp
            document.addEventListener('click', function(e) {
                if (e.target.closest('.btn-whatsapp')) {
                    MAFCSystem.logActivity('whatsapp_click', 'Clicou em botão WhatsApp');
                }
            });
        });
    </script>
</body>
    </html>
