<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MAFC & FILHO, LDA. - Sistema de Gestão</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ============ RESET E VARIÁVEIS ============ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #1a5f7a;
            --secondary: #2d9cdb;
            --accent: #ff9f1c;
            --dark: #003049;
            --light: #f8f9fa;
            --success: #27ae60;
            --warning: #f39c12;
            --danger: #e74c3c;
            --info: #17a2b8;
            --boss: #8e44ad;
            --team: #3498db;
            --purchase: #2ecc71;
            --office: #9b59b6;
            --construction: #e67e22;
            --gray: #6c757d;
            --light-gray: #e9ecef;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: var(--light);
            overflow-x: hidden;
        }

        .container {
            width: 90%;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* ============ PÁGINA PÚBLICA ============ */
        #publicWebsite {
            min-height: 100vh;
        }

        /* Header Público */
        .public-header {
            background: linear-gradient(135deg, var(--dark), var(--primary));
            color: white;
            padding: 1.5rem 0;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        }

        .nav-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo i {
            font-size: 2.8rem;
            color: var(--accent);
        }

        .logo-text h1 {
            font-size: 1.8rem;
            font-weight: 800;
        }

        .logo-text span {
            color: var(--accent);
            font-size: 1rem;
            display: block;
            margin-top: 5px;
        }

        .cta-buttons {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        /* Botões */
        .btn {
            padding: 12px 30px;
            border-radius: 50px;
            font-weight: 600;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            white-space: nowrap;
        }

        .btn-whatsapp {
            background: #25D366;
            color: white;
        }

        .btn-whatsapp:hover {
            background: #1da851;
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(37, 211, 102, 0.4);
        }

        .btn-email {
            background: var(--accent);
            color: var(--dark);
        }

        .btn-email:hover {
            background: #ffb143;
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(255, 159, 28, 0.3);
        }

        .btn-login {
            background: var(--primary);
            color: white;
        }

        .btn-login:hover {
            background: var(--dark);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(26, 95, 122, 0.3);
        }

        /* Hero Section */
        .hero {
            background: linear-gradient(rgba(0, 48, 73, 0.88), rgba(0, 48, 73, 0.92)), 
                        url('https://images.unsplash.com/photo-1504307651254-35680f356dfd?ixlib=rb-4.0.3&auto=format&fit=crop&w=1800&q=80');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            color: white;
            padding: 180px 0 120px;
            text-align: center;
            margin-top: 80px;
        }

        .hero h2 {
            font-size: 3.8rem;
            margin-bottom: 25px;
            font-weight: 900;
            text-transform: uppercase;
            text-shadow: 3px 3px 8px rgba(0,0,0,0.4);
            line-height: 1.2;
        }

        .hero p {
            font-size: 1.4rem;
            max-width: 850px;
            margin: 0 auto 50px;
            opacity: 0.95;
            line-height: 1.8;
        }

        .hero-buttons {
            display: flex;
            gap: 25px;
            justify-content: center;
            margin-top: 40px;
            flex-wrap: wrap;
        }

        /* Galeria de Projetos */
        .gallery {
            padding: 100px 0;
            background: white;
        }

        .section-title {
            text-align: center;
            font-size: 2.8rem;
            color: var(--dark);
            margin-bottom: 70px;
            position: relative;
            font-weight: 800;
        }

        .section-title:after {
            content: '';
            position: absolute;
            bottom: -20px;
            left: 50%;
            transform: translateX(-50%);
            width: 120px;
            height: 5px;
            background: var(--accent);
            border-radius: 10px;
        }

        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-top: 60px;
        }

        .gallery-item {
            border-radius: 15px;
            overflow: hidden;
            position: relative;
            height: 250px;
            cursor: pointer;
        }

        .gallery-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s;
        }

        .gallery-item:hover img {
            transform: scale(1.1);
        }

        .gallery-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent, rgba(0,0,0,0.8));
            color: white;
            padding: 20px;
            transform: translateY(100%);
            transition: transform 0.3s;
        }

        .gallery-item:hover .gallery-overlay {
            transform: translateY(0);
        }

        /* ============ MODAL LOGIN ============ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: white;
            width: 90%;
            max-width: 500px;
            border-radius: 20px;
            overflow: hidden;
            animation: modalSlideIn 0.4s;
            box-shadow: 0 25px 50px rgba(0,0,0,0.3);
        }

        @keyframes modalSlideIn {
            from { transform: translateY(-50px) scale(0.9); opacity: 0; }
            to { transform: translateY(0) scale(1); opacity: 1; }
        }

        .modal-header {
            background: linear-gradient(135deg, var(--dark), var(--primary));
            color: white;
            padding: 25px;
            text-align: center;
            position: relative;
        }

        .modal-header h2 {
            font-size: 2rem;
            font-weight: 700;
        }

        .close-modal {
            position: absolute;
            top: 20px;
            right: 25px;
            font-size: 1.8rem;
            cursor: pointer;
            color: white;
            transition: color 0.3s;
        }

        .close-modal:hover {
            color: var(--accent);
        }

        .modal-body {
            padding: 50px;
        }

        .form-group {
            margin-bottom: 30px;
        }

        .form-group label {
            display: block;
            margin-bottom: 10px;
            color: var(--dark);
            font-weight: 600;
            font-size: 1.1rem;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 15px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1.1rem;
            transition: all 0.3s;
            background: #f8f9fa;
        }

        .form-group input:focus, .form-group select:focus {
            border-color: var(--primary);
            outline: none;
            background: white;
            box-shadow: 0 0 0 3px rgba(26, 95, 122, 0.1);
        }

        .login-submit {
            background: linear-gradient(135deg, var(--primary), var(--dark));
            color: white;
            border: none;
            padding: 18px 40px;
            border-radius: 12px;
            font-size: 1.2rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .login-submit:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(26, 95, 122, 0.3);
            background: linear-gradient(135deg, var(--dark), var(--primary));
        }

        /* ============ DASHBOARDS ============ */
        .dashboard {
            display: none;
            min-height: 100vh;
            background: #f0f2f5;
        }

        /* Top Bar Horizontal */
        .top-bar {
            background: white;
            padding: 0;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            border-bottom: 5px solid;
        }

        /* Cores diferentes para cada dashboard */
        .boss-dashboard .top-bar {
            border-bottom-color: var(--boss);
            background: linear-gradient(135deg, #9b59b6, var(--boss));
        }

        .team-dashboard .top-bar {
            border-bottom-color: var(--team);
            background: linear-gradient(135deg, #3498db, #2980b9);
        }

        .purchase-dashboard .top-bar {
            border-bottom-color: var(--purchase);
            background: linear-gradient(135deg, #2ecc71, #27ae60);
        }

        .office-dashboard .top-bar {
            border-bottom-color: var(--office);
            background: linear-gradient(135deg, var(--office), #8e44ad);
        }

        .top-bar-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
        }

        .dashboard-brand {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .dashboard-brand i {
            font-size: 2.2rem;
            color: white;
        }

        .dashboard-brand h1 {
            color: white;
            font-size: 1.8rem;
            font-weight: 700;
        }

        .dashboard-info {
            display: flex;
            align-items: center;
            gap: 25px;
            color: white;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
            background: rgba(255,255,255,0.15);
            padding: 10px 20px;
            border-radius: 50px;
            backdrop-filter: blur(10px);
        }

        .user-info i {
            font-size: 1.4rem;
        }

        .logout-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid rgba(255,255,255,0.3);
            padding: 10px 25px;
            border-radius: 50px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
            backdrop-filter: blur(10px);
        }

        .logout-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
            border-color: white;
        }

        /* Menu Horizontal FIXO NO TOPO */
        .horizontal-menu {
            background: white;
            margin-top: 70px;
            padding: 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            position: fixed;
            width: 100%;
            z-index: 999;
            overflow-x: auto;
        }

        .menu-container {
            display: flex;
            gap: 5px;
            padding: 0;
            width: 100%;
        }

        .menu-item {
            padding: 20px 30px;
            color: #555;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 15px;
            font-weight: 600;
            white-space: nowrap;
            border-bottom: 4px solid transparent;
            transition: all 0.3s;
            position: relative;
        }

        .menu-item:hover {
            color: var(--primary);
            background: #f8f9fa;
        }

        .menu-item.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
            background: #f0f7ff;
        }

        .menu-item i {
            font-size: 1.2rem;
        }

        .menu-badge {
            background: var(--accent);
            color: white;
            font-size: 0.75rem;
            padding: 3px 8px;
            border-radius: 20px;
            margin-left: 8px;
            font-weight: 700;
        }

        /* Conteúdo do Dashboard - AFASTADO DO MENU FIXO */
        .dashboard-content {
            margin-top: 140px;
            padding: 20px 30px 80px 30px;
            background: #f0f2f5;
            min-height: calc(100vh - 140px);
        }

        /* MENU NO FUNDO */
        .bottom-menu {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: white;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.1);
            z-index: 1000;
            overflow-x: auto;
        }

        .bottom-menu-container {
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
        }

        .bottom-menu-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px 15px;
            color: #666;
            text-decoration: none;
            font-size: 0.85rem;
            text-align: center;
            min-width: 80px;
            border-radius: 10px;
            transition: all 0.3s;
        }

        .bottom-menu-item:hover {
            background: #f8f9fa;
            color: var(--primary);
        }

        .bottom-menu-item.active {
            color: var(--primary);
            background: #f0f7ff;
        }

        .bottom-menu-item i {
            font-size: 1.4rem;
            margin-bottom: 5px;
        }

        .bottom-menu-badge {
            position: absolute;
            top: 5px;
            right: 5px;
            background: var(--accent);
            color: white;
            font-size: 0.7rem;
            padding: 2px 5px;
            border-radius: 50%;
            min-width: 18px;
            text-align: center;
        }

        /* Dashboard Sections */
        .dashboard-section {
            display: none;
        }

        .dashboard-section.active {
            display: block;
        }

        /* Cards de Estatísticas */
        .stats-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .stat-card-horizontal {
            background: white;
            padding: 25px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            gap: 20px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.08);
            border-left: 6px solid;
            transition: transform 0.3s;
        }

        .stat-card-horizontal:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 30px rgba(0,0,0,0.12);
        }

        .boss-dashboard .stat-card-horizontal { border-left-color: var(--boss); }
        .team-dashboard .stat-card-horizontal { border-left-color: var(--team); }
        .purchase-dashboard .stat-card-horizontal { border-left-color: var(--purchase); }
        .office-dashboard .stat-card-horizontal { border-left-color: var(--office); }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            color: white;
        }

        .boss-dashboard .stat-icon { background: linear-gradient(135deg, var(--boss), #9b59b6); }
        .team-dashboard .stat-icon { background: linear-gradient(135deg, var(--team), #3498db); }
        .purchase-dashboard .stat-icon { background: linear-gradient(135deg, var(--purchase), #2ecc71); }
        .office-dashboard .stat-icon { background: linear-gradient(135deg, var(--office), #9b59b6); }

        .stat-info h3 {
            font-size: 2.2rem;
            color: var(--dark);
            margin-bottom: 5px;
            font-weight: 800;
        }

        .stat-info p {
            color: #666;
            font-weight: 600;
            font-size: 1rem;
        }

        /* Grids de Conteúdo */
        .content-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        /* Cards de Conteúdo */
        .content-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.08);
            transition: transform 0.3s;
        }

        .content-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 30px rgba(0,0,0,0.12);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .card-header h3 {
            color: var(--dark);
            font-size: 1.4rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .card-header h3 i {
            color: var(--primary);
        }

        /* Botões Dashboard */
        .btn-dashboard {
            padding: 12px 25px;
            border-radius: 10px;
            font-weight: 600;
            border: none;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
            font-size: 1rem;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--dark);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(26, 95, 122, 0.3);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover {
            background: #219653;
            transform: translateY(-3px);
        }

        .btn-warning {
            background: var(--warning);
            color: white;
        }

        .btn-warning:hover {
            background: #e67e22;
            transform: translateY(-3px);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background: #c0392b;
            transform: translateY(-3px);
        }

        .btn-info {
            background: var(--info);
            color: white;
        }

        .btn-info:hover {
            background: #138496;
            transform: translateY(-3px);
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 0.85rem;
        }

        /* Tabelas */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }

        .data-table th {
            background: var(--primary);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
            font-size: 1rem;
        }

        .data-table td {
            padding: 15px;
            border-bottom: 1px solid #f0f0f0;
        }

        .data-table tr:hover {
            background: #f8f9fa;
        }

        /* Badges */
        .badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 700;
            display: inline-block;
        }

        .badge-success { background: #d5f4e6; color: var(--success); }
        .badge-warning { background: #fff3cd; color: var(--warning); }
        .badge-danger { background: #f8d7da; color: var(--danger); }
        .badge-primary { background: #d1ecf1; color: var(--secondary); }
        .badge-info { background: #d1ecf1; color: #17a2b8; }
        .badge-secondary { background: #e2e3e5; color: #6c757d; }

        /* Formulários */
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group-dashboard {
            margin-bottom: 20px;
        }

        .form-group-dashboard label {
            display: block;
            margin-bottom: 8px;
            color: var(--dark);
            font-weight: 600;
            font-size: 1rem;
        }

        .form-group-dashboard input,
        .form-group-dashboard select,
        .form-group-dashboard textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s;
            background: #f8f9fa;
        }

        .form-group-dashboard input:focus,
        .form-group-dashboard select:focus,
        .form-group-dashboard textarea:focus {
            border-color: var(--primary);
            outline: none;
            background: white;
            box-shadow: 0 0 0 3px rgba(26, 95, 122, 0.1);
        }

        .form-actions {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #f0f0f0;
        }

        /* Time Tracker */
        .time-tracker {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 25px;
        }

        .time-display {
            font-size: 3.5rem;
            font-weight: 800;
            text-align: center;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .time-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        /* GPS Tracker */
        .gps-tracker {
            background: linear-gradient(135deg, #11998e, #38ef7d);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 25px;
        }

        .gps-info {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        .gps-coordinates {
            font-family: monospace;
            font-size: 1.2rem;
            background: rgba(255,255,255,0.15);
            padding: 12px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }

        /* ============ MODAIS ============ */
        .modal-employee, .modal-monthly-report, .modal-document, .modal-purchase-details, .modal-supplier,
        .modal-absence, .modal-substitution, .modal-gps, .modal-team-report {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.85);
            z-index: 2001;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .modal-employee-content, .modal-monthly-report-content, 
        .modal-document-content, .modal-purchase-details-content,
        .modal-supplier-content, .modal-absence-content,
        .modal-substitution-content, .modal-gps-content,
        .modal-team-report-content {
            background: white;
            width: 90%;
            max-width: 800px;
            border-radius: 15px;
            padding: 30px;
            position: relative;
            max-height: 85vh;
            overflow-y: auto;
        }

        .close-modal-btn {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 1.8rem;
            cursor: pointer;
            color: var(--dark);
            background: none;
            border: none;
        }

        .close-modal-btn:hover {
            color: var(--danger);
        }

        /* Sistema de Alertas */
        .alert {
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border-left: 5px solid var(--success);
        }

        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border-left: 5px solid var(--warning);
        }

        .alert-danger {
            background: #f8d7da;
            color: #721c24;
            border-left: 5px solid var(--danger);
        }

        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border-left: 5px solid var(--info);
        }

        /* Sistema de Filtros */
        .filter-bar {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Cards para trabalhadores */
        .worker-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            transition: all 0.3s;
            border: 2px solid transparent;
            position: relative;
        }

        .worker-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }

        .worker-card.absent {
            border-color: var(--danger);
            background: linear-gradient(135deg, #fff5f5, #ffffff);
        }

        .worker-card.present {
            border-color: var(--success);
            background: linear-gradient(135deg, #f0fff4, #ffffff);
        }

        .worker-card.working {
            border-color: var(--warning);
            background: linear-gradient(135deg, #fffaf0, #ffffff);
        }

        .worker-card.resting {
            border-color: var(--info);
            background: linear-gradient(135deg, #f0f9ff, #ffffff);
        }

        .worker-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--team), var(--primary));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
            font-weight: bold;
        }

        .worker-status-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 700;
        }

        .status-present { background: #d4edda; color: var(--success); }
        .status-absent { background: #f8d7da; color: var(--danger); }
        .status-working { background: #fff3cd; color: var(--warning); }
        .status-resting { background: #d1ecf1; color: var(--info); }

        /* Cards de localização */
        .location-card {
            background: linear-gradient(135deg, #11998e, #38ef7d);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .location-map {
            height: 200px;
            background: rgba(255,255,255,0.2);
            border-radius: 10px;
            margin: 15px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
        }

        /* Sistema de ausências */
        .absence-card {
            border-left: 5px solid var(--danger);
            background: #fff5f5;
        }

        .substitution-card {
            border-left: 5px solid var(--warning);
            background: #fffaf0;
        }

        /* Cards de relatórios */
        .report-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        /* Responsividade */
        @media (max-width: 1200px) {
            .content-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 992px) {
            .hero h2 {
                font-size: 2.8rem;
            }
            
            .section-title {
                font-size: 2.3rem;
            }
            
            .menu-container {
                overflow-x: auto;
                padding-bottom: 10px;
            }
            
            .menu-item {
                padding: 15px 20px;
                font-size: 0.95rem;
            }
            
            .dashboard-content {
                padding: 15px;
            }
            
            .bottom-menu-item {
                padding: 8px 10px;
                font-size: 0.8rem;
                min-width: 70px;
            }
        }

        @media (max-width: 768px) {
            .hero {
                padding: 150px 0 80px;
            }
            
            .hero h2 {
                font-size: 2.2rem;
            }
            
            .hero p {
                font-size: 1.2rem;
            }
            
            .stats-row {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .top-bar-content {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .dashboard-info {
                flex-direction: column;
                gap: 15px;
            }
            
            .menu-item {
                padding: 12px 15px;
            }
            
            .content-card {
                padding: 20px;
            }
            
            .time-display {
                font-size: 2.8rem;
            }
        }

        @media (max-width: 480px) {
            .hero h2 {
                font-size: 1.8rem;
            }
            
            .section-title {
                font-size: 1.8rem;
            }
            
            .btn {
                padding: 10px 20px;
                font-size: 0.9rem;
            }
            
            .dashboard-content {
                padding: 10px;
            }
            
            .modal-employee-content,
            .modal-monthly-report-content {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
     <!-- ============ PÁGINA PÚBLICA ============ -->
    <div id="publicWebsite">
        <!-- Header Público -->
        <header class="public-header">
            <div class="container nav-container">
                <div class="logo">
                    <i class="fas fa-hard-hat"></i>
                    <div class="logo-text">
                        <h1>MAFC & FILHO, LDA.</h1>
                        <span>Construção Civil & Obras Públicas | Desde 2001</span>
                    </div>
                </div>
                <div class="cta-buttons">
                    <a href="https://wa.me/351123456789?text=Olá MAFC,%20gostaria%20de%20solicitar%20um%20orçamento%20para%20uma%20obra" 
                       class="btn btn-whatsapp" target="_blank">
                        <i class="fab fa-whatsapp"></i> WhatsApp
                    </a>
                    <a href="mailto:orcamentos@mafc-filho.pt?subject=Solicitação de Orçamento&body=Olá MAFC,%0D%0A%0D%0AGostaria de solicitar um orçamento para:" 
                       class="btn btn-email">
                        <i class="fas fa-envelope"></i> Pedir Orçamento
                    </a>
                    <a href="#" class="btn btn-login" id="openLogin">
                        <i class="fas fa-sign-in-alt"></i> Acesso Sistema
                    </a>
                </div>
            </div>
        </header>

        <!-- Hero Section -->
        <section class="hero">
            <div class="container">
                <h2>Especialistas em Construção Civil e Obras Públicas</h2>
                <p>Mais de 20 anos de experiência em saneamento, abastecimento de água, redes de fibra óptica, pavimentação e infraestruturas. Operação em Portugal e Alemanha com 15 equipas especializadas.</p>
                <div class="hero-buttons">
                    <a href="#gallery" class="btn btn-email">
                        <i class="fas fa-hard-hat"></i> Ver Projetos
                    </a>
                    <a href="mailto:orcamentos@mafc-filho.pt" class="btn btn-whatsapp">
                        <i class="fas fa-calculator"></i> Orçamento Grátis
                    </a>
                </div>
            </div>
        </section>

        <!-- Galeria de Projetos -->
        <section class="gallery" id="gallery">
            <div class="container">
                <h2 class="section-title">Nossos Projetos</h2>
                <div class="gallery-grid">
                    <div class="gallery-item">
                        <img src="https://images.unsplash.com/photo-1541888946425-d81bb19240f5?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80" alt="Saneamento">
                        <div class="gallery-overlay">
                            <h3>Sistema de Saneamento</h3>
                            <p>Rede de águas pluviais em Berlim</p>
                        </div>
                    </div>
                    <div class="gallery-item">
                        <img src="https://images.unsplash.com/photo-1504917595217-d4dc5ebe6122?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80" alt="Fibra Óptica">
                        <div class="gallery-overlay">
                            <h3>Redes de Fibra Óptica</h3>
                            <p>Infraestrutura de telecomunicações</p>
                        </div>
                    </div>
                    <div class="gallery-item">
                        <img src="https://images.unsplash.com/photo-1519501025264-65ba15a82390?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80" alt="Pavimentação">
                        <div class="gallery-overlay">
                            <h3>Pavimentação Urbana</h3>
                            <p>Reabilitação de vias públicas</p>
                        </div>
                    </div>
                    <div class="gallery-item">
                        <img src="https://images.unsplash.com/photo-1541625602330-2277a4c46182?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80" alt="Infraestruturas">
                        <div class="gallery-overlay">
                            <h3>Infraestruturas EDP</h3>
                            <p>Instalação elétrica e gás natural</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer class="public-footer" style="background: var(--dark); color: white; padding: 80px 0 40px;">
            <div class="container">
                <div class="footer-content">
                    <div>
                        <h3>MAFC & FILHO, LDA.</h3>
                        <p>Constituída em 2001, somos especialistas em construção civil e obras públicas com operação em Portugal e Alemanha.</p>
                    </div>
                </div>
                <div class="copyright">
                    <p>&copy; 2001-2024 MAFC & FILHO, LDA. - Todos os direitos reservados.</p>
                </div>
            </div>
        </footer>
    </div>

    <!-- ============ MODAL DE LOGIN ============ -->
    <div class="modal" id="loginModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-lock"></i> Acesso ao Sistema MAFC</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="loginForm">
                    <div class="form-group">
                        <label for="username"><i class="fas fa-user"></i> Código de Acesso</label>
                        <input type="text" id="username" placeholder="Digite seu código" required>
                    </div>
                    <div class="form-group">
                        <label for="password"><i class="fas fa-key"></i> Senha</label>
                        <input type="password" id="password" placeholder="Digite sua senha" required>
                    </div>
                    <div class="form-group">
                        <label for="role"><i class="fas fa-user-tag"></i> Tipo de Acesso</label>
                        <select id="role" required>
                            <option value="">Selecione o tipo de acesso</option>
                            <option value="boss">Administração Geral (Patrão/Admin)</option>
                            <option value="team">Chefe de Equipa (Obra/Campo)</option>
                            <option value="purchase">Responsável de Compras</option>
                            <option value="office">Escritório (Gestão RH/Horas)</option>
                        </select>
                    </div>
                    <button type="submit" class="login-submit">
                        <i class="fas fa-sign-in-alt"></i> Entrar no Sistema
                    </button>
                </form>
            </div>
        </div>
    </div>
        <!-- ============ DASHBOARD CHEFE DE EQUIPA ATUALIZADO ============ -->
    <div class="dashboard team-dashboard" id="teamDashboard">
        <!-- Top Bar -->
        <div class="top-bar">
            <div class="container top-bar-content">
                <div class="dashboard-brand">
                    <i class="fas fa-hard-hat"></i>
                    <h1>Chefe de Equipa - MAFC</h1>
                </div>
                <div class="dashboard-info">
                    <div class="user-info">
                        <i class="fas fa-user-hard-hat"></i>
                        <span id="teamUserName">Equipa</span>
                    </div>
                    <div id="teamCurrentTime" style="font-weight: 600;">10:45 AM</div>
                    <button class="logout-btn" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i> Sair
                    </button>
                </div>
            </div>
        </div>

        <!-- Menu Horizontal -->
        <nav class="horizontal-menu">
            <div class="container menu-container">
                <a href="#" class="menu-item active" data-section="teamOverview">
                    <i class="fas fa-tachometer-alt"></i> Visão Geral
                </a>
                <a href="#" class="menu-item" data-section="teamTimeTracking">
                    <i class="fas fa-clock"></i> Marcar Horas
                    <span class="menu-badge" id="pendingHoursMenu">0</span>
                </a>
                <a href="#" class="menu-item" data-section="teamAbsences">
                    <i class="fas fa-user-times"></i> Ausências
                    <span class="menu-badge" id="absencesMenu">0</span>
                </a>
                <a href="#" class="menu-item" data-section="teamSubstitutions">
                    <i class="fas fa-exchange-alt"></i> Substituições
                    <span class="menu-badge" id="substitutionsMenu">0</span>
                </a>
                <a href="#" class="menu-item" data-section="teamGPS">
                    <i class="fas fa-map-marker-alt"></i> Localização GPS
                </a>
                <a href="#" class="menu-item" data-section="teamReports">
                    <i class="fas fa-chart-bar"></i> Relatórios
                </a>
            </div>
        </nav>

        <!-- Conteúdo -->
        <div class="dashboard-content">
            <!-- ============ VISÃO GERAL ============ -->
            <div class="dashboard-section active" id="teamOverviewSection">
                <div class="stats-row">
                    <div class="stat-card-horizontal">
                        <div class="stat-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="teamMembersCount">6</h3>
                            <p>Trabalhadores na Equipa</p>
                        </div>
                    </div>
                    <div class="stat-card-horizontal">
                        <div class="stat-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="teamHoursToday">8.5</h3>
                            <p>Horas Hoje</p>
                        </div>
                    </div>
                    <div class="stat-card-horizontal">
                        <div class="stat-icon">
                            <i class="fas fa-user-times"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="teamAbsencesCount">1</h3>
                            <p>Ausências Hoje</p>
                        </div>
                    </div>
                    <div class="stat-card-horizontal">
                        <div class="stat-icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="teamOnlineCount">5</h3>
                            <p>Presentes</p>
                        </div>
                    </div>
                </div>

                <!-- Lista de Trabalhadores - Foco Principal -->
                <div class="content-card">
                    <div class="card-header">
                        <h3><i class="fas fa-users"></i> Minha Equipa (6 Trabalhadores)</h3>
                        <button class="btn-dashboard btn-success" onclick="markAllEntry()">
                            <i class="fas fa-sign-in-alt"></i> Entrada Geral
                        </button>
                    </div>

                    <div class="filter-bar">
                        <div class="filter-group">
                            <span>Filtrar:</span>
                            <select id="filterWorkerStatus" onchange="filterWorkers()">
                                <option value="all">Todos</option>
                                <option value="present">Presentes</option>
                                <option value="absent">Ausentes</option>
                                <option value="working">A Trabalhar</option>
                                <option value="resting">Em Pausa</option>
                            </select>
                        </div>
                        <input type="text" id="searchWorker" placeholder="Pesquisar trabalhador..." onkeyup="filterWorkers()">
                    </div>

                    <div class="content-grid" id="workersGrid">
                        <!-- Trabalhadores serão carregados aqui dinamicamente -->
                        <div class="worker-card present">
                            <div class="worker-avatar">JS</div>
                            <div class="worker-status-badge status-present">PRESENTE</div>
                            <h4>João Silva</h4>
                            <p>Operário</p>
                            <div class="worker-time">
                                <p><i class="fas fa-sign-in-alt"></i> Entrada: <strong>08:00</strong></p>
                                <p><i class="fas fa-sign-out-alt"></i> Saída: <strong>--:--</strong></p>
                            </div>
                            <div class="form-actions" style="margin-top: 15px; padding: 0; border: none;">
                                <button class="btn-dashboard btn-sm btn-success" onclick="markWorkerTime(1, 'entry')">
                                    <i class="fas fa-sign-in-alt"></i> Entrada
                                </button>
                                <button class="btn-dashboard btn-sm btn-danger" onclick="markWorkerTime(1, 'exit')">
                                    <i class="fas fa-sign-out-alt"></i> Saída
                                </button>
                                <button class="btn-dashboard btn-sm btn-warning" onclick="markWorkerAbsence(1)">
                                    <i class="fas fa-user-times"></i> Ausente
                                </button>
                            </div>
                        </div>

                        <div class="worker-card working">
                            <div class="worker-avatar">CM</div>
                            <div class="worker-status-badge status-working">A TRABALHAR</div>
                            <h4>Carlos Mendes</h4>
                            <p>Operário</p>
                            <div class="worker-time">
                                <p><i class="fas fa-sign-in-alt"></i> Entrada: <strong>07:45</strong></p>
                                <p><i class="fas fa-clock"></i> Trabalhando há: <strong>3h15m</strong></p>
                            </div>
                            <div class="form-actions" style="margin-top: 15px; padding: 0; border: none;">
                                <button class="btn-dashboard btn-sm btn-danger" onclick="markWorkerTime(2, 'exit')">
                                    <i class="fas fa-sign-out-alt"></i> Saída
                                </button>
                                <button class="btn-dashboard btn-sm btn-info" onclick="markWorkerTime(2, 'break')">
                                    <i class="fas fa-coffee"></i> Pausa
                                </button>
                                <button class="btn-dashboard btn-sm btn-warning" onclick="markWorkerAbsence(2)">
                                    <i class="fas fa-user-times"></i> Ausente
                                </button>
                            </div>
                        </div>

                        <div class="worker-card resting">
                            <div class="worker-avatar">AS</div>
                            <div class="worker-status-badge status-resting">EM PAUSA</div>
                            <h4>António Santos</h4>
                            <p>Operário</p>
                            <div class="worker-time">
                                <p><i class="fas fa-sign-in-alt"></i> Entrada: <strong>07:30</strong></p>
                                <p><i class="fas fa-coffee"></i> Pausa desde: <strong>10:00</strong></p>
                            </div>
                            <div class="form-actions" style="margin-top: 15px; padding: 0; border: none;">
                                <button class="btn-dashboard btn-sm btn-success" onclick="markWorkerTime(3, 'return')">
                                    <i class="fas fa-undo"></i> Retornar
                                </button>
                                <button class="btn-dashboard btn-sm btn-danger" onclick="markWorkerTime(3, 'exit')">
                                    <i class="fas fa-sign-out-alt"></i> Saída
                                </button>
                                <button class="btn-dashboard btn-sm btn-warning" onclick="markWorkerAbsence(3)">
                                    <i class="fas fa-user-times"></i> Ausente
                                </button>
                            </div>
                        </div>

                        <div class="worker-card absent">
                            <div class="worker-avatar">MC</div>
                            <div class="worker-status-badge status-absent">AUSENTE</div>
                            <h4>Miguel Costa</h4>
                            <p>Operário</p>
                            <div class="worker-time">
                                <p><i class="fas fa-user-times"></i> Ausente hoje</p>
                                <p><i class="fas fa-stethoscope"></i> Motivo: Doença</p>
                            </div>
                            <div class="form-actions" style="margin-top: 15px; padding: 0; border: none;">
                                <button class="btn-dashboard btn-sm btn-success" onclick="markWorkerReturn(4)">
                                    <i class="fas fa-undo"></i> Retornou
                                </button>
                                <button class="btn-dashboard btn-sm btn-warning" onclick="requestSubstitution(4)">
                                    <i class="fas fa-exchange-alt"></i> Substituto
                                </button>
                                <a href="https://wa.me/351912345678" target="_blank" class="btn-dashboard btn-sm btn-whatsapp">
                                    <i class="fab fa-whatsapp"></i> Contactar
                                </a>
                            </div>
                        </div>

                        <div class="worker-card present">
                            <div class="worker-avatar">RM</div>
                            <div class="worker-status-badge status-present">PRESENTE</div>
                            <h4>Ricardo Oliveira</h4>
                            <p>Operário</p>
                            <div class="worker-time">
                                <p><i class="fas fa-sign-in-alt"></i> Entrada: <strong>08:15</strong></p>
                                <p><i class="fas fa-sign-out-alt"></i> Saída: <strong>--:--</strong></p>
                            </div>
                            <div class="form-actions" style="margin-top: 15px; padding: 0; border: none;">
                                <button class="btn-dashboard btn-sm btn-danger" onclick="markWorkerTime(5, 'exit')">
                                    <i class="fas fa-sign-out-alt"></i> Saída
                                </button>
                                <button class="btn-dashboard btn-sm btn-info" onclick="markWorkerTime(5, 'break')">
                                    <i class="fas fa-coffee"></i> Pausa
                                </button>
                                <button class="btn-dashboard btn-sm btn-warning" onclick="markWorkerAbsence(5)">
                                    <i class="fas fa-user-times"></i> Ausente
                                </button>
                            </div>
                        </div>

                        <div class="worker-card working">
                            <div class="worker-avatar">PM</div>
                            <div class="worker-status-badge status-working">A TRABALHAR</div>
                            <h4>Pedro Martins</h4>
                            <p>Operário</p>
                            <div class="worker-time">
                                <p><i class="fas fa-sign-in-alt"></i> Entrada: <strong>08:00</strong></p>
                                <p><i class="fas fa-clock"></i> Trabalhando há: <strong>2h45m</strong></p>
                            </div>
                            <div class="form-actions" style="margin-top: 15px; padding: 0; border: none;">
                                <button class="btn-dashboard btn-sm btn-danger" onclick="markWorkerTime(6, 'exit')">
                                    <i class="fas fa-sign-out-alt"></i> Saída
                                </button>
                                <button class="btn-dashboard btn-sm btn-info" onclick="markWorkerTime(6, 'break')">
                                    <i class="fas fa-coffee"></i> Pausa
                                </button>
                                <button class="btn-dashboard btn-sm btn-warning" onclick="markWorkerAbsence(6)">
                                    <i class="fas fa-user-times"></i> Ausente
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Alertas e Notificações -->
                <div class="content-card">
                    <div class="card-header">
                        <h3><i class="fas fa-bell"></i> Alertas do Dia</h3>
                        <button class="btn-dashboard btn-primary" onclick="markAllAlertsRead()">
                            <i class="fas fa-check-double"></i> Marcar Lidas
                        </button>
                    </div>
                    
                    <div id="teamAlerts">
                        <div class="alert alert-danger">
                            <i class="fas fa-user-times"></i>
                            <div>
                                <strong>Miguel Costa está ausente hoje</strong>
                                <p>Motivo: Doença | Necessita de substituto</p>
                            </div>
                            <button class="btn-dashboard btn-sm btn-warning" onclick="requestSubstitution(4)">
                                <i class="fas fa-exchange-alt"></i> Pedir Substituto
                            </button>
                        </div>
                        
                        <div class="alert alert-warning">
                            <i class="fas fa-clock"></i>
                            <div>
                                <strong>3 trabalhadores sem saída registada</strong>
                                <p>Verificar situação antes do fim do dia</p>
                            </div>
                            <button class="btn-dashboard btn-sm btn-info" onclick="checkMissingExits()">
                                <i class="fas fa-search"></i> Verificar
                            </button>
                        </div>
                        
                        <div class="alert alert-success">
                            <i class="fas fa-map-marker-alt"></i>
                            <div>
                                <strong>Toda a equipa com GPS ativo</strong>
                                <p>Localização em tempo real disponível</p>
                            </div>
                            <button class="btn-dashboard btn-sm btn-primary" onclick="viewTeamGPS()">
                                <i class="fas fa-map"></i> Ver Mapa
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ============ MARCAR HORAS ============ -->
            <div class="dashboard-section" id="teamTimeTrackingSection">
                <div class="content-card">
                    <div class="card-header">
                        <h3><i class="fas fa-clock"></i> Marcação de Horas - Controle Total</h3>
                        <div class="time-display" style="font-size: 2rem; color: var(--team);">
                            <span id="teamCurrentTimeDisplay">08:45</span>
                        </div>
                    </div>

                    <!-- Sistema de Marcação Rápida -->
                    <div class="time-tracker">
                        <div class="time-buttons">
                            <button class="btn-dashboard btn-success" onclick="markAllEntry()">
                                <i class="fas fa-sign-in-alt"></i> Entrada Geral
                            </button>
                            <button class="btn-dashboard btn-warning" onclick="markAllBreak()">
                                <i class="fas fa-coffee"></i> Pausa Geral
                            </button>
                            <button class="btn-dashboard btn-danger" onclick="markAllExit()">
                                <i class="fas fa-sign-out-alt"></i> Saída Geral
                            </button>
                            <button class="btn-dashboard btn-info" onclick="openBulkTimeModal()">
                                <i class="fas fa-users"></i> Marcação em Lote
                            </button>
                        </div>
                    </div>

                    <!-- Lista para marcação individual -->
                    <div style="margin-top: 30px;">
                        <h3><i class="fas fa-list-check"></i> Marcação Individual</h3>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Trabalhador</th>
                                    <th>Entrada</th>
                                    <th>Saída</th>
                                    <th>Pausa</th>
                                    <th>Total</th>
                                    <th>Ações Rápidas</th>
                                </tr>
                            </thead>
                            <tbody id="workersTimeTable">
                                <tr>
                                    <td>
                                        <div style="display: flex; align-items: center; gap: 10px;">
                                            <div class="worker-avatar" style="width: 30px; height: 30px; font-size: 0.9rem;">JS</div>
                                            <span>João Silva</span>
                                        </div>
                                    </td>
                                    <td><input type="time" value="08:00" onchange="updateWorkerTime(1, 'entry', this.value)"></td>
                                    <td><input type="time" onchange="updateWorkerTime(1, 'exit', this.value)"></td>
                                    <td>
                                        <select onchange="updateWorkerTime(1, 'break', this.value)">
                                            <option value="">Sem pausa</option>
                                            <option value="30">30min</option>
                                            <option value="45">45min</option>
                                            <option value="60">60min</option>
                                        </select>
                                    </td>
                                    <td><strong>0h</strong></td>
                                    <td>
                                        <button class="btn-dashboard btn-sm btn-success" onclick="markWorkerTime(1, 'entry')">
                                            <i class="fas fa-sign-in-alt"></i>
                                        </button>
                                        <button class="btn-dashboard btn-sm btn-danger" onclick="markWorkerTime(1, 'exit')">
                                            <i class="fas fa-sign-out-alt"></i>
                                        </button>
                                        <a href="https://wa.me/351912345671" target="_blank" class="btn-dashboard btn-sm btn-whatsapp">
                                            <i class="fab fa-whatsapp"></i>
                                        </a>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <div style="display: flex; align-items: center; gap: 10px;">
                                            <div class="worker-avatar" style="width: 30px; height: 30px; font-size: 0.9rem;">CM</div>
                                            <span>Carlos Mendes</span>
                                        </div>
                                    </td>
                                    <td><input type="time" value="07:45" onchange="updateWorkerTime(2, 'entry', this.value)"></td>
                                    <td><input type="time" onchange="updateWorkerTime(2, 'exit', this.value)"></td>
                                    <td>
                                        <select onchange="updateWorkerTime(2, 'break', this.value)">
                                            <option value="">Sem pausa</option>
                                            <option value="30">30min</option>
                                            <option value="45" selected>45min</option>
                                            <option value="60">60min</option>
                                        </select>
                                    </td>
                                    <td><strong>3.5h</strong></td>
                                    <td>
                                        <button class="btn-dashboard btn-sm btn-danger" onclick="markWorkerTime(2, 'exit')">
                                            <i class="fas fa-sign-out-alt"></i>
                                        </button>
                                        <button class="btn-dashboard btn-sm btn-info" onclick="markWorkerTime(2, 'break')">
                                            <i class="fas fa-coffee"></i>
                                        </button>
                                        <a href="https://wa.me/351912345672" target="_blank" class="btn-dashboard btn-sm btn-whatsapp">
                                            <i class="fab fa-whatsapp"></i>
                                        </a>
                                    </td>
                                </tr>
                                <!-- Mais trabalhadores serão carregados dinamicamente -->
                            </tbody>
                        </table>
                    </div>

                    <!-- Botões de ação -->
                    <div class="form-actions">
                        <button class="btn-dashboard btn-primary" onclick="saveAllTimes()">
                            <i class="fas fa-save"></i> Guardar Todas as Horas
                        </button>
                        <button class="btn-dashboard btn-success" onclick="generateTimeReport()">
                            <i class="fas fa-file-excel"></i> Exportar Excel
                        </button>
                        <button class="btn-dashboard btn-whatsapp" onclick="sendTimesToWhatsApp()">
                            <i class="fab fa-whatsapp"></i> Partilhar no WhatsApp
                        </button>
                    </div>
                </div>
            </div>

            <!-- ============ SISTEMA DE AUSÊNCIAS ============ -->
            <div class="dashboard-section" id="teamAbsencesSection">
                <div class="content-card">
                    <div class="card-header">
                        <h3><i class="fas fa-user-times"></i> Sistema de Ausências</h3>
                        <button class="btn-dashboard btn-warning" onclick="openAbsenceModal()">
                            <i class="fas fa-plus"></i> Nova Ausência
                        </button>
                    </div>

                    <!-- Ausências de Hoje -->
                    <div class="content-card absence-card">
                        <div class="card-header">
                            <h4><i class="fas fa-calendar-day"></i> Ausências de Hoje</h4>
                            <span class="badge badge-danger" id="todayAbsencesCount">1 ausência</span>
                        </div>
                        
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Trabalhador</th>
                                    <th>Motivo</th>
                                    <th>Duração</th>
                                    <th>Data</th>
                                    <th>Comprovativo</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody id="todayAbsencesTable">
                                <tr>
                                    <td>
                                        <div style="display: flex; align-items: center; gap: 10px;">
                                            <div class="worker-avatar" style="width: 30px; height: 30px; font-size: 0.9rem;">MC</div>
                                            <span>Miguel Costa</span>
                                        </div>
                                    </td>
                                    <td>
                                        <strong>Doença</strong>
                                        <p style="font-size: 0.85rem; color: #666;">Febre e tosse - baixa médica</p>
                                    </td>
                                    <td>1 dia</td>
                                    <td>15/12/2024</td>
                                    <td>
                                        <span class="badge badge-warning">Pendente</span>
                                    </td>
                                    <td>
                                        <button class="btn-dashboard btn-sm btn-success" onclick="markWorkerReturn(4)">
                                            <i class="fas fa-undo"></i> Retornou
                                        </button>
                                        <button class="btn-dashboard btn-sm btn-warning" onclick="requestSubstitution(4)">
                                            <i class="fas fa-exchange-alt"></i> Substituto
                                        </button>
                                        <button class="btn-dashboard btn-sm btn-info" onclick="uploadAbsenceProof(4)">
                                            <i class="fas fa-upload"></i> Comprovativo
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- Histórico de Ausências -->
                    <div style="margin-top: 30px;">
                        <h3><i class="fas fa-history"></i> Histórico de Ausências</h3>
                        <div class="filter-bar">
                            <input type="month" id="absenceMonth" value="2024-12" onchange="filterAbsences()">
                            <select id="absenceType" onchange="filterAbsences()">
                                <option value="all">Todos Tipos</option>
                                <option value="doenca">Doença</option>
                                <option value="ferias">Férias</option>
                                <option value="familia">Assuntos Familiares</option>
                                <option value="outro">Outro</option>
                            </select>
                            <input type="text" id="searchAbsence" placeholder="Pesquisar..." onkeyup="filterAbsences()">
                        </div>

                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Data</th>
                                    <th>Trabalhador</th>
                                    <th>Motivo</th>
                                    <th>Duração</th>
                                    <th>Estado</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody id="absencesHistoryTable">
                                <tr>
                                    <td>10/12/2024</td>
                                    <td>João Silva</td>
                                    <td>Consulta Médica</td>
                                    <td>Meio dia</td>
                                    <td><span class="badge badge-success">Justificado</span></td>
                                    <td>
                                        <button class="btn-dashboard btn-sm btn-info" onclick="viewAbsenceDetails(1)">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                    </td>
                                </tr>
                                <tr>
                                    <td>05/12/2024</td>
                                    <td>Carlos Mendes</td>
                                    <td>Férias</td>
                                    <td>1 dia</td>
                                    <td><span class="badge badge-success">Aprovado</span></td>
                                    <td>
                                        <button class="btn-dashboard btn-sm btn-info" onclick="viewAbsenceDetails(2)">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- ============ SISTEMA DE SUBSTITUIÇÕES ============ -->
            <div class="dashboard-section" id="teamSubstitutionsSection">
                <div class="content-card">
                    <div class="card-header">
                        <h3><i class="fas fa-exchange-alt"></i> Sistema de Substituições</h3>
                        <button class="btn-dashboard btn-success" onclick="openSubstitutionModal()">
                            <i class="fas fa-plus"></i> Pedir Substituto
                        </button>
                    </div>

                    <!-- Substituições Pendentes -->
                    <div class="content-card substitution-card">
                        <div class="card-header">
                            <h4><i class="fas fa-clock"></i> Substituições Pendentes</h4>
                            <span class="badge badge-warning" id="pendingSubstitutionsCount">1 pendente</span>
                        </div>
                        
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Trabalhador Ausente</th>
                                    <th>Motivo</th>
                                    <th>Habilidades Necessárias</th>
                                    <th>Data</th>
                                    <th>Estado</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody id="pendingSubstitutionsTable">
                                <tr>
                                    <td>Miguel Costa</td>
                                    <td>Doença</td>
                                    <td>
                                        <span class="badge badge-primary">Operário</span>
                                        <span class="badge badge-info">Betoneira</span>
                                    </td>
                                    <td>15/12/2024</td>
                                    <td><span class="badge badge-warning">A Aguardar</span></td>
                                    <td>
                                        <button class="btn-dashboard btn-sm btn-success" onclick="assignSubstitution(1)">
                                            <i class="fas fa-user-check"></i> Atribuir
                                        </button>
                                        <button class="btn-dashboard btn-sm btn-danger" onclick="cancelSubstitution(1)">
                                            <i class="fas fa-times"></i> Cancelar
                                        </button>
                                        <a href="https://wa.me/351912345678" target="_blank" class="btn-dashboard btn-sm btn-whatsapp">
                                            <i class="fab fa-whatsapp"></i>
                                        </a>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- Substituições Atribuídas -->
                    <div style="margin-top: 30px;">
                        <h3><i class="fas fa-user-check"></i> Substituições Atribuídas</h3>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Substituto</th>
                                    <th>Substitui</th>
                                    <th>Habilidades</th>
                                    <th>Período</th>
                                    <th>Estado</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody id="assignedSubstitutionsTable">
                                <tr>
                                    <td>Rui Pereira (Equipa 08)</td>
                                    <td>João Silva (10/12)</td>
                                    <td>
                                        <span class="badge badge-primary">Operário</span>
                                        <span class="badge badge-info">Betoneira</span>
                                    </td>
                                    <td>10/12/2024 (meio dia)</td>
                                    <td><span class="badge badge-success">Concluído</span></td>
                                    <td>
                                        <button class="btn-dashboard btn-sm btn-info" onclick="viewSubstitutionDetails(1)">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button class="btn-dashboard btn-sm btn-primary" onclick="rateSubstitution(1)">
                                            <i class="fas fa-star"></i> Avaliar
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- Banco de Substitutos Disponíveis -->
                    <div class="content-card" style="margin-top: 30px;">
                        <div class="card-header">
                            <h4><i class="fas fa-database"></i> Banco de Substitutos Disponíveis</h4>
                            <button class="btn-dashboard btn-info" onclick="refreshSubstitutes()">
                                <i class="fas fa-sync-alt"></i> Atualizar
                            </button>
                        </div>
                        
                        <div class="filter-bar">
                            <select id="filterSubstituteSkills" onchange="filterSubstitutes()">
                                <option value="all">Todas Habilidades</option>
                                <option value="operario">Operário</option>
                                <option value="betoneira">Betoneira</option>
                                <option value="grua">Grua</option>
                                <option value="soldador">Soldador</option>
                            </select>
                            <select id="filterSubstituteLocation" onchange="filterSubstitutes()">
                                <option value="all">Todas Localizações</option>
                                <option value="lisboa">Lisboa</option>
                                <option value="porto">Porto</option>
                                <option value="berlim">Berlim</option>
                            </select>
                        </div>

                        <div class="content-grid" id="substitutesGrid">
                            <div class="worker-card present">
                                <div class="worker-avatar">RP</div>
                                <div class="worker-status-badge status-present">DISPONÍVEL</div>
                                <h4>Rui Pereira</h4>
                                <p>Operário Sénior</p>
                                <div class="worker-skills">
                                    <span class="badge badge-primary">Operário</span>
                                    <span class="badge badge-info">Betoneira</span>
                                    <span class="badge badge-warning">Grua</span>
                                </div>
                                <p><i class="fas fa-map-marker-alt"></i> Lisboa</p>
                                <p><i class="fas fa-phone"></i> +351 912 345 689</p>
                                <div class="form-actions" style="margin-top: 15px; padding: 0; border: none;">
                                    <button class="btn-dashboard btn-sm btn-success" onclick="selectSubstitute(1)">
                                        <i class="fas fa-check"></i> Selecionar
                                    </button>
                                    <a href="https://wa.me/351912345689" target="_blank" class="btn-dashboard btn-sm btn-whatsapp">
                                        <i class="fab fa-whatsapp"></i> Contactar
                                    </a>
                                </div>
                            </div>

                            <div class="worker-card present">
                                <div class="worker-avatar">LF</div>
                                <div class="worker-status-badge status-present">DISPONÍVEL</div>
                                <h4>Luís Fernandes</h4>
                                <p>Operário Especializado</p>
                                <div class="worker-skills">
                                    <span class="badge badge-primary">Operário</span>
                                    <span class="badge badge-danger">Soldador</span>
                                    <span class="badge badge-info">Betoneira</span>
                                </div>
                                <p><i class="fas fa-map-marker-alt"></i> Porto</p>
                                <p><i class="fas fa-phone"></i> +351 912 345 690</p>
                                <div class="form-actions" style="margin-top: 15px; padding: 0; border: none;">
                                    <button class="btn-dashboard btn-sm btn-success" onclick="selectSubstitute(2)">
                                        <i class="fas fa-check"></i> Selecionar
                                    </button>
                                    <a href="https://wa.me/351912345690" target="_blank" class="btn-dashboard btn-sm btn-whatsapp">
                                        <i class="fab fa-whatsapp"></i> Contactar
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ============ GPS PARA PATRÃO ============ -->
            <div class="dashboard-section" id="teamGPSSection">
                <div class="content-card">
                    <div class="card-header">
                        <h3><i class="fas fa-map-marker-alt"></i> Localização GPS - Partilha com Patrão</h3>
                        <button class="btn-dashboard btn-success" onclick="startGPSSharing()">
                            <i class="fas fa-satellite"></i> Iniciar Partilha
                        </button>
                    </div>

                    <!-- GPS Tracker -->
                    <div class="location-card">
                        <h3><i class="fas fa-satellite"></i> Localização em Tempo Real</h3>
                        <p>Partilhando localização com o patrão automaticamente</p>
                        
                        <div class="gps-info">
                            <div>
                                <p><strong>Status GPS:</strong> <span class="badge badge-success" id="gpsStatus">ATIVO</span></p>
                                <p><strong>Última atualização:</strong> <span id="lastGPSTime">há 2 minutos</span></p>
                                <p><strong>Precisão:</strong> <span id="gpsAccuracy">15 metros</span></p>
                            </div>
                            <div class="gps-coordinates" id="gpsCoordinates">
                                38.736946, -9.142685
                            </div>
                        </div>
                        
                        <div class="location-map">
                            <i class="fas fa-map-marked-alt"></i>
                            <span style="margin-left: 15px;">Mapa da Localização</span>
                        </div>
                        
                        <div class="time-buttons">
                            <button class="btn-dashboard btn-success" onclick="shareGPSWithBoss()">
                                <i class="fas fa-share"></i> Partilhar com Patrão
                            </button>
                            <button class="btn-dashboard btn-info" onclick="viewTeamMap()">
                                <i class="fas fa-map"></i> Ver Mapa Completo
                            </button>
                            <button class="btn-dashboard btn-warning" onclick="stopGPSSharing()">
                                <i class="fas fa-stop"></i> Parar Partilha
                            </button>
                        </div>
                    </div>

                    <!-- Localização da Equipa -->
                    <div style="margin-top: 30px;">
                        <h3><i class="fas fa-users"></i> Localização da Equipa</h3>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Trabalhador</th>
                                    <th>Status GPS</th>
                                    <th>Última Localização</th>
                                    <th>Hora</th>
                                    <th>Partilha com Patrão</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody id="teamGPSTable">
                                <tr>
                                    <td>João Silva</td>
                                    <td><span class="badge badge-success">Ativo</span></td>
                                    <td>38.736946, -9.142685</td>
                                    <td>10:42 AM</td>
                                    <td><span class="badge badge-success">Sim</span></td>
                                    <td>
                                        <button class="btn-dashboard btn-sm btn-info" onclick="viewWorkerLocation(1)">
                                            <i class="fas fa-map-marker-alt"></i>
                                        </button>
                                        <button class="btn-dashboard btn-sm btn-whatsapp" onclick="shareWorkerLocation(1)">
                                            <i class="fab fa-whatsapp"></i>
                                        </button>
                                    </td>
                                </tr>
                                <tr>
                                    <td>Carlos Mendes</td>
                                    <td><span class="badge badge-success">Ativo</span></td>
                                    <td>38.736123, -9.143456</td>
                                    <td>10:40 AM</td>
                                    <td><span class="badge badge-success">Sim</span></td>
                                    <td>
                                        <button class="btn-dashboard btn-sm btn-info" onclick="viewWorkerLocation(2)">
                                            <i class="fas fa-map-marker-alt"></i>
                                        </button>
                                        <button class="btn-dashboard btn-sm btn-whatsapp" onclick="shareWorkerLocation(2)">
                                            <i class="fab fa-whatsapp"></i>
                                        </button>
                                    </td>
                                </tr>
                                <tr>
                                    <td>António Santos</td>
                                    <td><span class="badge badge-warning">Inativo</span></td>
                                    <td>38.735789, -9.142123</td>
                                    <td>09:15 AM</td>
                                    <td><span class="badge badge-danger">Não</span></td>
                                    <td>
                                        <button class="btn-dashboard btn-sm btn-warning" onclick="activateWorkerGPS(3)">
                                            <i class="fas fa-power-off"></i> Ativar
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- Configurações GPS -->
                    <div class="content-card" style="margin-top: 30px;">
                        <div class="card-header">
                            <h4><i class="fas fa-cog"></i> Configurações de Partilha GPS</h4>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group-dashboard">
                                <label>Intervalo de Atualização</label>
                                <select id="gpsUpdateInterval">
                                    <option value="1">1 minuto</option>
                                    <option value="5" selected>5 minutos</option>
                                    <option value="10">10 minutos</option>
                                    <option value="15">15 minutos</option>
                                </select>
                            </div>
                            <div class="form-group-dashboard">
                                <label>Partilha Automática</label>
                                <select id="autoShareGPS">
                                    <option value="yes">Sim, partilhar automaticamente</option>
                                    <option value="no">Não, pedir autorização</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group-dashboard">
                            <label>Recipientes da Partilha</label>
                            <div style="margin-top: 10px;">
                                <label style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                                    <input type="checkbox" checked> Patrão/Administração
                                </label>
                                <label style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                                    <input type="checkbox" checked> Escritório Central
                                </label>
                                <label style="display: flex; align-items: center; gap: 10px;">
                                    <input type="checkbox"> Outras Equipas
                                </label>
                            </div>
                        </div>
                        
                        <div class="form-actions">
                            <button class="btn-dashboard btn-primary" onclick="saveGPSSettings()">
                                <i class="fas fa-save"></i> Guardar Configurações
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ============ RELATÓRIOS POR EQUIPA ============ -->
            <div class="dashboard-section" id="teamReportsSection">
                <div class="content-card">
                    <div class="card-header">
                        <h3><i class="fas fa-chart-bar"></i> Relatórios por Equipa - Estatísticas Detalhadas</h3>
                        <button class="btn-dashboard btn-success" onclick="generateTeamReport()">
                            <i class="fas fa-file-pdf"></i> Gerar Relatório
                        </button>
                    </div>

                    <!-- Estatísticas Gerais -->
                    <div class="report-card">
                        <h3><i class="fas fa-chart-line"></i> Estatísticas da Equipa - Dezembro 2024</h3>
                        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-top: 20px;">
                            <div style="text-align: center;">
                                <h4 style="font-size: 2rem; margin: 0;">168h</h4>
                                <p>Horas Trabalhadas</p>
                            </div>
                            <div style="text-align: center;">
                                <h4 style="font-size: 2rem; margin: 0;">12h</h4>
                                <p>Horas Extra</p>
                            </div>
                            <div style="text-align: center;">
                                <h4 style="font-size: 2rem; margin: 0;">3</h4>
                                <p>Ausências</p>
                            </div>
                            <div style="text-align: center;">
                                <h4 style="font-size: 2rem; margin: 0;">98%</h4>
                                <p>Pontualidade</p>
                            </div>
                        </div>
                    </div>

                    <!-- Relatórios Disponíveis -->
                    <div class="content-grid" style="margin-top: 30px;">
                        <div class="content-card">
                            <div class="card-header">
                                <h4><i class="fas fa-clock"></i> Relatório de Horas</h4>
                            </div>
                            <p>Horas trabalhadas por trabalhador e por dia</p>
                            <div class="form-actions" style="margin-top: 20px;">
                                <button class="btn-dashboard btn-sm btn-primary" onclick="generateHoursReport()">
                                    <i class="fas fa-file-excel"></i> Excel
                                </button>
                                <button class="btn-dashboard btn-sm btn-info" onclick="generateHoursPDF()">
                                    <i class="fas fa-file-pdf"></i> PDF
                                </button>
                                <button class="btn-dashboard btn-sm btn-whatsapp" onclick="shareHoursReport()">
                                    <i class="fab fa-whatsapp"></i>
                                </button>
                            </div>
                        </div>

                        <div class="content-card">
                            <div class="card-header">
                                <h4><i class="fas fa-user-times"></i> Relatório de Ausências</h4>
                            </div>
                            <p>Ausências, justificações e substituições</p>
                            <div class="form-actions" style="margin-top: 20px;">
                                <button class="btn-dashboard btn-sm btn-primary" onclick="generateAbsencesReport()">
                                    <i class="fas fa-file-excel"></i> Excel
                                </button>
                                <button class="btn-dashboard btn-sm btn-info" onclick="generateAbsencesPDF()">
                                    <i class="fas fa-file-pdf"></i> PDF
                                </button>
                                <button class="btn-dashboard btn-sm btn-warning" onclick="openTeamReportModal()">
                                    <i class="fas fa-chart-bar"></i> Estatísticas
                                </button>
                            </div>
                        </div>

                        <div class="content-card">
                            <div class="card-header">
                                <h4><i class="fas fa-map-marker-alt"></i> Relatório de Localização</h4>
                            </div>
                            <p>GPS, rotas e tempos de deslocação</p>
                            <div class="form-actions" style="margin-top: 20px;">
                                <button class="btn-dashboard btn-sm btn-primary" onclick="generateGPSReport()">
                                    <i class="fas fa-file-excel"></i> Excel
                                </button>
                                <button class="btn-dashboard btn-sm btn-info" onclick="generateGPSPDF()">
                                    <i class="fas fa-file-pdf"></i> PDF
                                </button>
                                <button class="btn-dashboard btn-sm btn-success" onclick="viewRouteMap()">
                                    <i class="fas fa-route"></i> Mapa
                                </button>
                            </div>
                        </div>

                        <div class="content-card">
                            <div class="card-header">
                                <h4><i class="fas fa-euro-sign"></i> Relatório Financeiro</h4>
                            </div>
                            <p>Custos com horas e substituições</p>
                            <div class="form-actions" style="margin-top: 20px;">
                                <button class="btn-dashboard btn-sm btn-primary" onclick="generateFinancialReport()">
                                    <i class="fas fa-file-excel"></i> Excel
                                </button>
                                <button class="btn-dashboard btn-sm btn-info" onclick="generateFinancialPDF()">
                                    <i class="fas fa-file-pdf"></i> PDF
                                </button>
                                <button class="btn-dashboard btn-sm btn-success" onclick="sendToAccounting()">
                                    <i class="fas fa-paper-plane"></i> Contabilidade
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Gráficos e Visualizações -->
                    <div class="content-card" style="margin-top: 30px;">
                        <div class="card-header">
                            <h4><i class="fas fa-chart-pie"></i> Visualizações Gráficas</h4>
                            <select id="chartPeriod" onchange="updateCharts()">
                                <option value="week">Esta Semana</option>
                                <option value="month" selected>Este Mês</option>
                                <option value="quarter">Este Trimestre</option>
                            </select>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-top: 20px;">
                            <div style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
                                <h5>Distribuição de Horas</h5>
                                <div style="height: 200px; display: flex; align-items: center; justify-content: center;">
                                    <i class="fas fa-chart-pie" style="font-size: 4rem; color: var(--primary);"></i>
                                </div>
                            </div>
                            <div style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
                                <h5>Pontualidade</h5>
                                <div style="height: 200px; display: flex; align-items: center; justify-content: center;">
                                    <i class="fas fa-chart-bar" style="font-size: 4rem; color: var(--success);"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- MENU NO FUNDO PARA CHEFE DE EQUIPA -->
        <nav class="bottom-menu">
            <div class="bottom-menu-container">
                <a href="#" class="bottom-menu-item active" data-section="teamOverview">
                    <i class="fas fa-home"></i>
                    <span>Equipa</span>
                    <span class="bottom-menu-badge" id="workersCountBottom">6</span>
                </a>
                <a href="#" class="bottom-menu-item" data-section="teamTimeTracking">
                    <i class="fas fa-clock"></i>
                    <span>Horas</span>
                    <span class="bottom-menu-badge" id="pendingHoursBottom">3</span>
                </a>
                <a href="#" class="bottom-menu-item" data-section="teamAbsences">
                    <i class="fas fa-user-times"></i>
                    <span>Ausências</span>
                    <span class="bottom-menu-badge" id="absencesBottom">1</span>
                </a>
                <a href="#" class="bottom-menu-item" data-section="teamSubstitutions">
                    <i class="fas fa-exchange-alt"></i>
                    <span>Substituições</span>
                    <span class="bottom-menu-badge" id="substitutionsBottom">1</span>
                </a>
                <a href="#" class="bottom-menu-item" data-section="teamGPS">
                    <i class="fas fa-map-marker-alt"></i>
                    <span>GPS</span>
                </a>
                <a href="#" class="bottom-menu-item" data-section="teamReports">
                    <i class="fas fa-chart-bar"></i>
                    <span>Relatórios</span>
                </a>
            </div>
        </nav>
    </div>
        <!-- ============ MODAL AUSÊNCIA ============ -->
    <div class="modal-absence" id="absenceModal">
        <div class="modal-absence-content">
            <button class="close-modal-btn" onclick="closeModal('absenceModal')">&times;</button>
            <h2><i class="fas fa-user-times"></i> Registar Ausência</h2>
            
            <div class="form-row">
                <div class="form-group-dashboard">
                    <label>Trabalhador</label>
                    <select id="absenceWorker">
                        <option value="">Selecione o trabalhador</option>
                        <option value="1">João Silva</option>
                        <option value="2">Carlos Mendes</option>
                        <option value="3">António Santos</option>
                        <option value="4">Miguel Costa</option>
                        <option value="5">Ricardo Oliveira</option>
                        <option value="6">Pedro Martins</option>
                    </select>
                </div>
                <div class="form-group-dashboard">
                    <label>Tipo de Ausência</label>
                    <select id="absenceTypeModal">
                        <option value="doenca">Doença</option>
                        <option value="ferias">Férias</option>
                        <option value="familia">Assuntos Familiares</option>
                        <option value="formacao">Formação</option>
                        <option value="outro">Outro</option>
                    </select>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group-dashboard">
                    <label>Data de Início</label>
                    <input type="date" id="absenceStartDate" value="<?php echo date('Y-m-d'); ?>">
                </div>
                <div class="form-group-dashboard">
                    <label>Data de Fim</label>
                    <input type="date" id="absenceEndDate">
                </div>
            </div>
            
            <div class="form-group-dashboard">
                <label>Motivo Detalhado</label>
                <textarea id="absenceReason" rows="4" placeholder="Descreva o motivo da ausência em detalhe..."></textarea>
            </div>
            
            <div class="form-group-dashboard">
                <label>Comprovativo (opcional)</label>
                <input type="file" id="absenceProof">
                <small>Pode anexar atestado médico, justificação, etc.</small>
            </div>
            
            <div class="form-actions">
                <button class="btn-dashboard btn-success" onclick="registerAbsence()">
                    <i class="fas fa-save"></i> Registar Ausência
                </button>
                <button class="btn-dashboard btn-warning" onclick="registerAbsenceAndRequestSubstitution()">
                    <i class="fas fa-exchange-alt"></i> Registar e Pedir Substituto
                </button>
                <button class="btn-dashboard btn-whatsapp" onclick="notifyAbsenceWhatsApp()">
                    <i class="fab fa-whatsapp"></i> Notificar WhatsApp
                </button>
            </div>
        </div>
    </div>

    <!-- ============ MODAL SUBSTITUIÇÃO ============ -->
    <div class="modal-substitution" id="substitutionModal">
        <div class="modal-substitution-content">
            <button class="close-modal-btn" onclick="closeModal('substitutionModal')">&times;</button>
            <h2><i class="fas fa-exchange-alt"></i> Pedir Substituto</h2>
            
            <div class="form-row">
                <div class="form-group-dashboard">
                    <label>Trabalhador Ausente</label>
                    <select id="substitutionWorker">
                        <option value="">Selecione o trabalhador ausente</option>
                        <option value="4" selected>Miguel Costa</option>
                        <option value="1">João Silva</option>
                        <option value="2">Carlos Mendes</option>
                        <option value="3">António Santos</option>
                        <option value="5">Ricardo Oliveira</option>
                        <option value="6">Pedro Martins</option>
                    </select>
                </div>
                <div class="form-group-dashboard">
                    <label>Período</label>
                    <select id="substitutionPeriod">
                        <option value="1">1 dia</option>
                        <option value="2">2 dias</option>
                        <option value="3">3 dias</option>
                        <option value="5">5 dias</option>
                        <option value="10">10 dias</option>
                        <option value="custom">Personalizado</option>
                    </select>
                </div>
            </div>
            
            <div class="form-row" id="customPeriod" style="display: none;">
                <div class="form-group-dashboard">
                    <label>Data de Início</label>
                    <input type="date" id="substitutionStartDate" value="<?php echo date('Y-m-d'); ?>">
                </div>
                <div class="form-group-dashboard">
                    <label>Data de Fim</label>
                    <input type="date" id="substitutionEndDate">
                </div>
            </div>
            
            <div class="form-group-dashboard">
                <label>Habilidades Necessárias</label>
                <div style="margin-top: 10px;">
                    <label style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                        <input type="checkbox" name="substitutionSkills" value="operario" checked> Operário Geral
                    </label>
                    <label style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                        <input type="checkbox" name="substitutionSkills" value="betoneira"> Betoneira
                    </label>
                    <label style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                        <input type="checkbox" name="substitutionSkills" value="grua"> Grua
                    </label>
                    <label style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                        <input type="checkbox" name="substitutionSkills" value="soldador"> Soldador
                    </label>
                    <label style="display: flex; align-items: center; gap: 10px;">
                        <input type="checkbox" name="substitutionSkills" value="outro"> Outras Habilidades
                    </label>
                </div>
            </div>
            
            <div class="form-group-dashboard">
                <label>Observações</label>
                <textarea id="substitutionNotes" rows="3" placeholder="Detalhes adicionais sobre a substituição..."></textarea>
            </div>
            
            <div class="form-group-dashboard">
                <label>Urgência</label>
                <select id="substitutionUrgency">
                    <option value="normal">Normal (encontre quando possível)</option>
                    <option value="urgent">Urgente (precisa para hoje)</option>
                    <option value="critical">Crítico (precisa imediatamente)</option>
                </select>
            </div>
            
            <div class="form-actions">
                <button class="btn-dashboard btn-success" onclick="requestSubstitutionSystem()">
                    <i class="fas fa-paper-plane"></i> Enviar Pedido
                </button>
                <button class="btn-dashboard btn-primary" onclick="findAvailableSubstitutes()">
                    <i class="fas fa-search"></i> Encontrar Substitutos
                </button>
                <button class="btn-dashboard btn-whatsapp" onclick="shareSubstitutionRequest()">
                    <i class="fab fa-whatsapp"></i> Partilhar WhatsApp
                </button>
            </div>
        </div>
    </div>

    <!-- ============ MODAL RELATÓRIO EQUIPA ============ -->
    <div class="modal-team-report" id="teamReportModal">
        <div class="modal-team-report-content">
            <button class="close-modal-btn" onclick="closeModal('teamReportModal')">&times;</button>
            <h2><i class="fas fa-chart-bar"></i> Relatório de Equipa - Estatísticas Detalhadas</h2>
            
            <div class="form-row">
                <div class="form-group-dashboard">
                    <label>Período</label>
                    <select id="reportPeriod">
                        <option value="today">Hoje</option>
                        <option value="week">Esta Semana</option>
                        <option value="month" selected>Este Mês</option>
                        <option value="quarter">Este Trimestre</option>
                        <option value="custom">Personalizado</option>
                    </select>
                </div>
                <div class="form-group-dashboard">
                    <label>Formato</label>
                    <select id="reportFormat">
                        <option value="excel">Excel</option>
                        <option value="pdf">PDF</option>
                        <option value="print">Imprimir</option>
                        <option value="screen">Ver no Ecrã</option>
                    </select>
                </div>
            </div>
            
            <div class="form-row" id="customReportPeriod" style="display: none;">
                <div class="form-group-dashboard">
                    <label>Data de Início</label>
                    <input type="date" id="reportStartDate">
                </div>
                <div class="form-group-dashboard">
                    <label>Data de Fim</label>
                    <input type="date" id="reportEndDate">
                </div>
            </div>
            
            <div class="form-group-dashboard">
                <label>Incluir Dados</label>
                <div style="margin-top: 10px;">
                    <label style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                        <input type="checkbox" checked> Horas Trabalhadas
                    </label>
                    <label style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                        <input type="checkbox" checked> Ausências e Justificações
                    </label>
                    <label style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                        <input type="checkbox" checked> Substituições
                    </label>
                    <label style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                        <input type="checkbox"> Localização GPS
                    </label>
                    <label style="display: flex; align-items: center; gap: 10px;">
                        <input type="checkbox" checked> Estatísticas de Produtividade
                    </label>
                </div>
            </div>
            
            <div class="form-actions">
                <button class="btn-dashboard btn-success" onclick="generateCompleteReport()">
                    <i class="fas fa-file-export"></i> Gerar Relatório
                </button>
                <button class="btn-dashboard btn-primary" onclick="previewReport()">
                    <i class="fas fa-eye"></i> Pré-visualizar
                </button>
                <button class="btn-dashboard btn-whatsapp" onclick="sendReportWhatsApp()">
                    <i class="fab fa-whatsapp"></i> Enviar por WhatsApp
                </button>
            </div>
            
            <div id="reportPreview" style="margin-top: 30px; display: none;">
                <!-- Pré-visualização do relatório -->
            </div>
        </div>
    </div>

    <!-- ============ MODAL GPS ============ -->
    <div class="modal-gps" id="gpsModal">
        <div class="modal-gps-content">
            <button class="close-modal-btn" onclick="closeModal('gpsModal')">&times;</button>
            <h2><i class="fas fa-map-marked-alt"></i> Mapa da Equipa - Localização em Tempo Real</h2>
            
            <div class="location-map" style="height: 400px; margin: 20px 0;">
                <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%;">
                    <i class="fas fa-map" style="font-size: 4rem; color: var(--primary); margin-bottom: 20px;"></i>
                    <h3>Mapa Interativo</h3>
                    <p>Localização em tempo real de todos os trabalhadores</p>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group-dashboard">
                    <label>Mostrar</label>
                    <select id="mapView">
                        <option value="all">Todos os Trabalhadores</option>
                        <option value="working">Apenas a Trabalhar</option>
                        <option value="location">Por Localização</option>
                    </select>
                </div>
                <div class="form-group-dashboard">
                    <label>Atualizar a cada</label>
                    <select id="mapRefresh">
                        <option value="30">30 segundos</option>
                        <option value="60" selected>1 minuto</option>
                        <option value="300">5 minutos</option>
                    </select>
                </div>
            </div>
            
            <div class="form-actions">
                <button class="btn-dashboard btn-success" onclick="startLiveTracking()">
                    <i class="fas fa-play"></i> Iniciar Tracking
                </button>
                <button class="btn-dashboard btn-primary" onclick="shareLiveMap()">
                    <i class="fas fa-share"></i> Partilhar Mapa
                </button>
                <button class="btn-dashboard btn-info" onclick="exportGPSData()">
                    <i class="fas fa-download"></i> Exportar Dados
                </button>
            </div>
        </div>
    </div>

    <!-- ============ MODAL MARCAÇÃO EM LOTE ============ -->
    <div class="modal" id="bulkTimeModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-users"></i> Marcação em Lote</h2>
                <button class="close-modal" onclick="closeModal('bulkTimeModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Ação</label>
                    <select id="bulkTimeAction">
                        <option value="entry">Entrada</option>
                        <option value="exit">Saída</option>
                        <option value="break">Pausa</option>
                        <option value="return">Retorno de Pausa</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Hora</label>
                    <input type="time" id="bulkTime" value="<?php echo date('H:i'); ?>">
                </div>
                
                <div class="form-group">
                    <label>Trabalhadores</label>
                    <div style="max-height: 200px; overflow-y: auto; border: 1px solid #ddd; padding: 10px; border-radius: 5px;">
                        <label style="display: block; margin-bottom: 5px;">
                            <input type="checkbox" checked> Todos os trabalhadores
                        </label>
                        <label style="display: block; margin-bottom: 5px;">
                            <input type="checkbox" checked> João Silva
                        </label>
                        <label style="display: block; margin-bottom: 5px;">
                            <input type="checkbox" checked> Carlos Mendes
                        </label>
                        <label style="display: block; margin-bottom: 5px;">
                            <input type="checkbox" checked> António Santos
                        </label>
                        <label style="display: block; margin-bottom: 5px;">
                            <input type="checkbox" checked> Ricardo Oliveira
                        </label>
                        <label style="display: block; margin-bottom: 5px;">
                            <input type="checkbox" checked> Pedro Martins
                        </label>
                        <label style="display: block;">
                            <input type="checkbox"> Miguel Costa (ausente)
                        </label>
                    </div>
                </div>
                
                <button class="login-submit" onclick="applyBulkTime()">
                    <i class="fas fa-check"></i> Aplicar a Todos Selecionados
                </button>
            </div>
        </div>
    </div>
       <script>
        // ============ SISTEMA DO CHEFE DE EQUIPA ============
        
        const TeamSystem = {
            currentUser: null,
            teamWorkers: [],
            timeRecords: {},
            absences: [],
            substitutions: [],
            gpsData: {},
            
            // Dados de exemplo
            init: function() {
                // Trabalhadores da equipa (6 como solicitado)
                this.teamWorkers = [
                    { id: 1, name: 'João Silva', avatar: 'JS', role: 'Operário', phone: '+351912345671', skills: ['operario'], status: 'present', todayEntry: '08:00' },
                    { id: 2, name: 'Carlos Mendes', avatar: 'CM', role: 'Operário', phone: '+351912345672', skills: ['operario', 'betoneira'], status: 'working', todayEntry: '07:45' },
                    { id: 3, name: 'António Santos', avatar: 'AS', role: 'Operário', phone: '+351912345673', skills: ['operario'], status: 'resting', todayEntry: '07:30', breakStart: '10:00' },
                    { id: 4, name: 'Miguel Costa', avatar: 'MC', role: 'Operário', phone: '+351912345674', skills: ['operario', 'grua'], status: 'absent', absenceReason: 'Doença' },
                    { id: 5, name: 'Ricardo Oliveira', avatar: 'RO', role: 'Operário', phone: '+351912345675', skills: ['operario'], status: 'present', todayEntry: '08:15' },
                    { id: 6, name: 'Pedro Martins', avatar: 'PM', role: 'Operário', phone: '+351912345676', skills: ['operario', 'soldador'], status: 'working', todayEntry: '08:00' }
                ];
                
                // Registos de tempo
                this.timeRecords = {
                    '15/12/2024': {
                        1: { entry: '08:00' },
                        2: { entry: '07:45', break: '45' },
                        3: { entry: '07:30', breakStart: '10:00' },
                        5: { entry: '08:15' },
                        6: { entry: '08:00' }
                    }
                };
                
                // Ausências
                this.absences = [
                    { id: 1, workerId: 4, workerName: 'Miguel Costa', type: 'doenca', reason: 'Febre e tosse - baixa médica', startDate: '15/12/2024', endDate: '15/12/2024', status: 'active' },
                    { id: 2, workerId: 1, workerName: 'João Silva', type: 'consulta', reason: 'Consulta médica', startDate: '10/12/2024', endDate: '10/12/2024', status: 'completed' },
                    { id: 3, workerId: 2, workerName: 'Carlos Mendes', type: 'ferias', reason: 'Férias marcadas', startDate: '05/12/2024', endDate: '05/12/2024', status: 'completed' }
                ];
                
                // Substituições
                this.substitutions = [
                    { id: 1, absentWorkerId: 4, absentWorkerName: 'Miguel Costa', substituteId: null, status: 'pending', skills: ['operario', 'betoneira'], date: '15/12/2024' },
                    { id: 2, absentWorkerId: 1, absentWorkerName: 'João Silva', substituteId: 7, substituteName: 'Rui Pereira', status: 'completed', skills: ['operario', 'betoneira'], date: '10/12/2024' }
                ];
                
                // Dados GPS
                this.gpsData = {
                    1: { lat: '38.736946', lng: '-9.142685', lastUpdate: '10:42', status: 'active', sharing: true },
                    2: { lat: '38.736123', lng: '-9.143456', lastUpdate: '10:40', status: 'active', sharing: true },
                    3: { lat: '38.735789', lng: '-9.142123', lastUpdate: '09:15', status: 'inactive', sharing: false },
                    5: { lat: '38.736500', lng: '-9.142900', lastUpdate: '10:45', status: 'active', sharing: true },
                    6: { lat: '38.736300', lng: '-9.143100', lastUpdate: '10:43', status: 'active', sharing: true }
                };
                
                this.loadFromStorage();
            },
            
            saveToStorage: function() {
                const data = {
                    teamWorkers: this.teamWorkers,
                    timeRecords: this.timeRecords,
                    absences: this.absences,
                    substitutions: this.substitutions,
                    gpsData: this.gpsData
                };
                localStorage.setItem('teamSystem', JSON.stringify(data));
            },
            
            loadFromStorage: function() {
                const data = JSON.parse(localStorage.getItem('teamSystem'));
                if (data) {
                    this.teamWorkers = data.teamWorkers || this.teamWorkers;
                    this.timeRecords = data.timeRecords || this.timeRecords;
                    this.absences = data.absences || this.absences;
                    this.substitutions = data.substitutions || this.substitutions;
                    this.gpsData = data.gpsData || this.gpsData;
                }
            }
        };
        
        // ============ INICIALIZAÇÃO ============
        document.addEventListener('DOMContentLoaded', function() {
            TeamSystem.init();
            updateClocks();
            setInterval(updateClocks, 1000);
            
            // Event listeners para login
            document.getElementById('openLogin').addEventListener('click', function(e) {
                e.preventDefault();
                document.getElementById('loginModal').style.display = 'flex';
            });
            
            document.querySelector('.close-modal').addEventListener('click', function() {
                document.getElementById('loginModal').style.display = 'none';
            });
            
            window.addEventListener('click', function(e) {
                if (e.target === document.getElementById('loginModal')) {
                    document.getElementById('loginModal').style.display = 'none';
                }
            });
            
            // Login form
            document.getElementById('loginForm').addEventListener('submit', function(e) {
                e.preventDefault();
                handleLogin();
            });
            
            // Menu navigation
            document.querySelectorAll('.menu-item, .bottom-menu-item').forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    const dashboard = document.getElementById('teamDashboard');
                    const sectionId = this.getAttribute('data-section') + 'Section';
                    
                    // Remove active from all items
                    dashboard.querySelectorAll('.menu-item, .bottom-menu-item').forEach(i => {
                        i.classList.remove('active');
                    });
                    
                    // Add active to clicked item
                    this.classList.add('active');
                    
                    // Hide all sections
                    dashboard.querySelectorAll('.dashboard-section').forEach(section => {
                        section.classList.remove('active');
                    });
                    
                    // Show selected section
                    const section = document.getElementById(sectionId);
                    if (section) section.classList.add('active');
                    
                    // Load section data
                    loadSectionData(sectionId);
                });
            });
            
            // Close modals
            document.querySelectorAll('.close-modal-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const modal = this.closest('.modal-absence, .modal-substitution, .modal-team-report, .modal-gps, .modal');
                    if (modal) modal.style.display = 'none';
                });
            });
            
            // Fechar modais ao clicar fora
            window.addEventListener('click', function(e) {
                if (e.target.classList.contains('modal-absence')) {
                    document.getElementById('absenceModal').style.display = 'none';
                }
                if (e.target.classList.contains('modal-substitution')) {
                    document.getElementById('substitutionModal').style.display = 'none';
                }
                if (e.target.classList.contains('modal-team-report')) {
                    document.getElementById('teamReportModal').style.display = 'none';
                }
                if (e.target.classList.contains('modal-gps')) {
                    document.getElementById('gpsModal').style.display = 'none';
                }
                if (e.target.classList.contains('modal')) {
                    document.getElementById('bulkTimeModal').style.display = 'none';
                }
            });
            
            // Inicializar dashboard se já estiver logado
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                TeamSystem.currentUser = JSON.parse(savedUser);
                if (TeamSystem.currentUser.role === 'team') {
                    showTeamDashboard();
                }
            }
            
            // Event listeners para modais
            document.getElementById('substitutionPeriod').addEventListener('change', function() {
                const customDiv = document.getElementById('customPeriod');
                customDiv.style.display = this.value === 'custom' ? 'block' : 'none';
            });
            
            document.getElementById('reportPeriod').addEventListener('change', function() {
                const customDiv = document.getElementById('customReportPeriod');
                customDiv.style.display = this.value === 'custom' ? 'block' : 'none';
            });
        });
        
        // ============ FUNÇÕES DE LOGIN ============
        function handleLogin() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const role = document.getElementById('role').value;
            
            // Credenciais simplificadas para demonstração
            const credentials = {
                team: [
                    { code: 'chefe01', password: '1234', name: 'Chefe Equipa 01', team: 'Equipa 01 - Berlim' },
                    { code: 'chefe02', password: '1234', name: 'Chefe Equipa 02', team: 'Equipa 02 - Hamburgo' }
                ]
            };
            
            let userFound = null;
            
            if (role && credentials[role]) {
                userFound = credentials[role].find(u => 
                    u.code === username && u.password === password
                );
            }
            
            if (userFound) {
                TeamSystem.currentUser = { ...userFound, role };
                localStorage.setItem('currentUser', JSON.stringify(TeamSystem.currentUser));
                loginSuccess();
            } else {
                alert('Credenciais incorretas! Utilize:\n\nCHEFE: chefe01 / 1234\n\nPara demonstração, use qualquer código com senha 1234');
            }
        }
        
        function loginSuccess() {
            document.getElementById('loginModal').style.display = 'none';
            document.getElementById('publicWebsite').style.display = 'none';
            showTeamDashboard();
        }
        
        function logout() {
            if (confirm('Tem certeza que deseja sair do sistema?')) {
                localStorage.removeItem('currentUser');
                TeamSystem.currentUser = null;
                
                document.getElementById('teamDashboard').style.display = 'none';
                document.getElementById('publicWebsite').style.display = 'block';
                document.getElementById('loginForm').reset();
            }
        }
        
        function showTeamDashboard() {
            document.getElementById('teamDashboard').style.display = 'block';
            document.getElementById('teamUserName').textContent = TeamSystem.currentUser.team || TeamSystem.currentUser.name;
            initializeTeamDashboard();
        }
        
        function initializeTeamDashboard() {
            updateTeamStats();
            updateMenuBadges();
            loadSectionData('teamOverviewSection');
        }
        
        // ============ FUNÇÕES PRINCIPAIS ============
        function updateTeamStats() {
            // Contar trabalhadores por status
            const presentCount = TeamSystem.teamWorkers.filter(w => w.status === 'present' || w.status === 'working' || w.status === 'resting').length;
            const absentCount = TeamSystem.teamWorkers.filter(w => w.status === 'absent').length;
            const workingCount = TeamSystem.teamWorkers.filter(w => w.status === 'working').length;
            
            document.getElementById('teamMembersCount').textContent = TeamSystem.teamWorkers.length;
            document.getElementById('teamOnlineCount').textContent = presentCount;
            document.getElementById('teamAbsencesCount').textContent = absentCount;
            
            // Calcular horas hoje
            const today = new Date().toLocaleDateString('pt-PT');
            let totalHours = 0;
            if (TeamSystem.timeRecords[today]) {
                Object.values(TeamSystem.timeRecords[today]).forEach(record => {
                    if (record.entry) {
                        const entryTime = record.entry.split(':').map(Number);
                        const now = new Date();
                        const currentHours = now.getHours() + (now.getMinutes() / 60);
                        const entryHours = entryTime[0] + (entryTime[1] / 60);
                        totalHours += Math.max(0, currentHours - entryHours);
                    }
                });
            }
            document.getElementById('teamHoursToday').textContent = totalHours.toFixed(1);
        }
        
        function updateMenuBadges() {
            const today = new Date().toLocaleDateString('pt-PT');
            const todayRecords = TeamSystem.timeRecords[today] || {};
            
            // Trabalhadores sem saída
            let pendingExits = 0;
            Object.values(todayRecords).forEach(record => {
                if (record.entry && !record.exit) pendingExits++;
            });
            
            // Ausências de hoje
            const todayAbsences = TeamSystem.absences.filter(a => 
                a.startDate === today && a.status === 'active'
            ).length;
            
            // Substituições pendentes
            const pendingSubstitutions = TeamSystem.substitutions.filter(s => 
                s.status === 'pending'
            ).length;
            
            // Atualizar badges
            document.getElementById('pendingHoursMenu').textContent = pendingExits;
            document.getElementById('absencesMenu').textContent = todayAbsences;
            document.getElementById('substitutionsMenu').textContent = pendingSubstitutions;
            document.getElementById('workersCountBottom').textContent = TeamSystem.teamWorkers.length;
            document.getElementById('pendingHoursBottom').textContent = pendingExits;
            document.getElementById('absencesBottom').textContent = todayAbsences;
            document.getElementById('substitutionsBottom').textContent = pendingSubstitutions;
            document.getElementById('todayAbsencesCount').textContent = todayAbsences + ' ausência' + (todayAbsences !== 1 ? 's' : '');
            document.getElementById('pendingSubstitutionsCount').textContent = pendingSubstitutions + ' pendente' + (pendingSubstitutions !== 1 ? 's' : '');
        }
        
        function loadSectionData(sectionId) {
            switch(sectionId) {
                case 'teamOverviewSection':
                    updateTeamStats();
                    updateMenuBadges();
                    break;
                case 'teamTimeTrackingSection':
                    loadWorkersTimeTable();
                    break;
                case 'teamAbsencesSection':
                    loadTodayAbsences();
                    loadAbsencesHistory();
                    break;
                case 'teamSubstitutionsSection':
                    loadPendingSubstitutions();
                    loadAssignedSubstitutions();
                    break;
                case 'teamGPSSection':
                    loadTeamGPSTable();
                    updateGPSStatus();
                    break;
                case 'teamReportsSection':
                    // Inicializar gráficos se necessário
                    break;
            }
        }
        
        // ============ SISTEMA DE MARCAÇÃO DE HORAS ============
        function markWorkerTime(workerId, action) {
            const worker = TeamSystem.teamWorkers.find(w => w.id === workerId);
            if (!worker) return;
            
            const now = new Date();
            const timeString = now.toLocaleTimeString('pt-PT', { hour: '2-digit', minute: '2-digit' });
            const dateString = now.toLocaleDateString('pt-PT');
            
            // Inicializar registos do dia
            if (!TeamSystem.timeRecords[dateString]) {
                TeamSystem.timeRecords[dateString] = {};
            }
            if (!TeamSystem.timeRecords[dateString][workerId]) {
                TeamSystem.timeRecords[dateString][workerId] = {};
            }
            
            const record = TeamSystem.timeRecords[dateString][workerId];
            
            switch(action) {
                case 'entry':
                    record.entry = timeString;
                    worker.status = 'working';
                    worker.todayEntry = timeString;
                    showNotification(`${worker.name} - Entrada registada às ${timeString}`, 'success');
                    break;
                    
                case 'exit':
                    record.exit = timeString;
                    worker.status = 'present';
                    delete worker.breakStart;
                    
                    // Calcular horas totais
                    if (record.entry) {
                        const entryTime = record.entry.split(':').map(Number);
                        const exitTime = timeString.split(':').map(Number);
                        let totalMinutes = (exitTime[0] * 60 + exitTime[1]) - (entryTime[0] * 60 + entryTime[1]);
                        if (totalMinutes < 0) totalMinutes += 24 * 60;
                        
                        // Subtrair pausa
                        if (record.break) {
                            totalMinutes -= parseInt(record.break);
                        }
                        
                        record.totalHours = (totalMinutes / 60).toFixed(1);
                    }
                    
                    showNotification(`${worker.name} - Saída registada às ${timeString}`, 'success');
                    break;
                    
                case 'break':
                    record.breakStart = timeString;
                    worker.status = 'resting';
                    showNotification(`${worker.name} - Pausa iniciada às ${timeString}`, 'warning');
                    break;
                    
                case 'return':
                    if (record.breakStart) {
                        const breakStartTime = record.breakStart.split(':').map(Number);
                        const returnTime = timeString.split(':').map(Number);
                        const breakMinutes = (returnTime[0] * 60 + returnTime[1]) - (breakStartTime[0] * 60 + breakStartTime[1]);
                        record.break = Math.max(60, breakMinutes); // Mínimo 60 minutos
                        delete record.breakStart;
                    }
                    worker.status = 'working';
                    showNotification(`${worker.name} - Retornou do intervalo às ${timeString}`, 'success');
                    break;
            }
            
            TeamSystem.saveToStorage();
            updateTeamStats();
            updateMenuBadges();
            
            // Atualizar interface se estiver na seção correta
            if (document.getElementById('teamOverviewSection').classList.contains('active')) {
                filterWorkers();
            }
            if (document.getElementById('teamTimeTrackingSection').classList.contains('active')) {
                loadWorkersTimeTable();
            }
            
            // Opção WhatsApp
            if (confirm('Deseja enviar notificação por WhatsApp?')) {
                const messages = {
                    'entry': `✅ ${worker.name} - Entrada registada às ${timeString} - MAFC`,
                    'exit': `✅ ${worker.name} - Saída registada às ${timeString} - MAFC`,
                    'break': `⏸️ ${worker.name} - Pausa registada às ${timeString} - MAFC`,
                    'return': `🔄 ${worker.name} - Retorno registado às ${timeString} - MAFC`
                };
                const message = messages[action];
                if (message && worker.phone) {
                    window.open(`https://wa.me/${worker.phone.replace('+', '')}?text=${encodeURIComponent(message)}`, '_blank');
                }
            }
        }
        
        function markWorkerAbsence(workerId) {
            const worker = TeamSystem.teamWorkers.find(w => w.id === workerId);
            if (worker) {
                document.getElementById('absenceWorker').value = workerId;
                openAbsenceModal();
            }
        }
        
        function markWorkerReturn(workerId) {
            const worker = TeamSystem.teamWorkers.find(w => w.id === workerId);
            if (worker && worker.status === 'absent') {
                worker.status = 'present';
                
                // Marcar ausência como concluída
                const absence = TeamSystem.absences.find(a => a.workerId === workerId && a.status === 'active');
                if (absence) {
                    absence.status = 'completed';
                }
                
                TeamSystem.saveToStorage();
                updateTeamStats();
                updateMenuBadges();
                filterWorkers();
                
                showNotification(`${worker.name} - Retorno registado com sucesso`, 'success');
            }
        }
        
        function markAllEntry() {
            if (confirm('Registar entrada para TODOS os trabalhadores presentes?')) {
                const now = new Date();
                const timeString = now.toLocaleTimeString('pt-PT', { hour: '2-digit', minute: '2-digit' });
                const dateString = now.toLocaleDateString('pt-PT');
                
                TeamSystem.teamWorkers.forEach(worker => {
                    if (worker.status === 'present') {
                        markWorkerTime(worker.id, 'entry');
                    }
                });
                
                showNotification(`Entrada registada para todos os trabalhadores presentes às ${timeString}`, 'success');
            }
        }
        
        function markAllExit() {
            if (confirm('Registar saída para TODOS os trabalhadores a trabalhar?')) {
                const now = new Date();
                const timeString = now.toLocaleTimeString('pt-PT', { hour: '2-digit', minute: '2-digit' });
                
                TeamSystem.teamWorkers.forEach(worker => {
                    if (worker.status === 'working' || worker.status === 'resting') {
                        markWorkerTime(worker.id, 'exit');
                    }
                });
                
                showNotification(`Saída registada para todos os trabalhadores às ${timeString}`, 'success');
            }
        }
        
        function markAllBreak() {
            if (confirm('Registar pausa para TODOS os trabalhadores a trabalhar?')) {
                TeamSystem.teamWorkers.forEach(worker => {
                    if (worker.status === 'working') {
                        markWorkerTime(worker.id, 'break');
                    }
                });
                
                showNotification('Pausa registada para todos os trabalhadores', 'warning');
            }
        }
        
        function loadWorkersTimeTable() {
            const tbody = document.getElementById('workersTimeTable');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            const today = new Date().toLocaleDateString('pt-PT');
            const todayRecords = TeamSystem.timeRecords[today] || {};
            
            TeamSystem.teamWorkers.forEach(worker => {
                const record = todayRecords[worker.id] || {};
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div class="worker-avatar" style="width: 30px; height: 30px; font-size: 0.9rem;">${worker.avatar}</div>
                            <span>${worker.name}</span>
                        </div>
                    </td>
                    <td><input type="time" value="${record.entry || ''}" onchange="updateWorkerTime(${worker.id}, 'entry', this.value)"></td>
                    <td><input type="time" value="${record.exit || ''}" onchange="updateWorkerTime(${worker.id}, 'exit', this.value)"></td>
                    <td>
                        <select onchange="updateWorkerTime(${worker.id}, 'break', this.value)">
                            <option value="">Sem pausa</option>
                            <option value="30" ${record.break === '30' ? 'selected' : ''}>30min</option>
                            <option value="45" ${record.break === '45' ? 'selected' : ''}>45min</option>
                            <option value="60" ${record.break === '60' ? 'selected' : ''}>60min</option>
                        </select>
                    </td>
                    <td><strong>${record.totalHours ? record.totalHours + 'h' : '0h'}</strong></td>
                    <td>
                        <button class="btn-dashboard btn-sm btn-success" onclick="markWorkerTime(${worker.id}, 'entry')">
                            <i class="fas fa-sign-in-alt"></i>
                        </button>
                        <button class="btn-dashboard btn-sm btn-danger" onclick="markWorkerTime(${worker.id}, 'exit')">
                            <i class="fas fa-sign-out-alt"></i>
                        </button>
                        <a href="https://wa.me/${worker.phone.replace('+', '')}" target="_blank" class="btn-dashboard btn-sm btn-whatsapp">
                            <i class="fab fa-whatsapp"></i>
                        </a>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }
        
        function updateWorkerTime(workerId, type, value) {
            const today = new Date().toLocaleDateString('pt-PT');
            if (!TeamSystem.timeRecords[today]) {
                TeamSystem.timeRecords[today] = {};
            }
            if (!TeamSystem.timeRecords[today][workerId]) {
                TeamSystem.timeRecords[today][workerId] = {};
            }
            
            TeamSystem.timeRecords[today][workerId][type] = value;
            TeamSystem.saveToStorage();
        }
        
        function saveAllTimes() {
            showNotification('Todas as horas foram guardadas com sucesso!', 'success');
        }
        
        function filterWorkers() {
            const filter = document.getElementById('filterWorkerStatus').value;
            const search = document.getElementById('searchWorker').value.toLowerCase();
            
            const workersGrid = document.getElementById('workersGrid');
            if (!workersGrid) return;
            
            const workerCards = workersGrid.querySelectorAll('.worker-card');
            
            workerCards.forEach(card => {
                const workerName = card.querySelector('h4').textContent.toLowerCase();
                const workerStatus = card.classList.contains('present') ? 'present' : 
                                   card.classList.contains('working') ? 'working' :
                                   card.classList.contains('resting') ? 'resting' : 'absent';
                
                const matchesSearch = workerName.includes(search);
                const matchesFilter = filter === 'all' || workerStatus === filter;
                
                card.style.display = matchesSearch && matchesFilter ? 'block' : 'none';
            });
        }
        
        // ============ SISTEMA DE AUSÊNCIAS ============
        function openAbsenceModal() {
            document.getElementById('absenceModal').style.display = 'flex';
        }
        
        function registerAbsence() {
            const workerId = parseInt(document.getElementById('absenceWorker').value);
            const type = document.getElementById('absenceTypeModal').value;
            const startDate = document.getElementById('absenceStartDate').value;
            const endDate = document.getElementById('absenceEndDate').value || startDate;
            const reason = document.getElementById('absenceReason').value;
            
            if (!workerId || !reason) {
                alert('Por favor, preencha todos os campos obrigatórios!');
                return;
            }
            
            const worker = TeamSystem.teamWorkers.find(w => w.id === workerId);
            if (!worker) return;
            
            // Format dates
            const startDateStr = formatDate(new Date(startDate));
            const endDateStr = formatDate(new Date(endDate));
            
            // Create absence record
            const absenceId = Date.now();
            const absence = {
                id: absenceId,
                workerId: workerId,
                workerName: worker.name,
                type: type,
                reason: reason,
                startDate: startDateStr,
                endDate: endDateStr,
                status: 'active',
                registeredAt: new Date().toISOString()
            };
            
            TeamSystem.absences.unshift(absence);
            
            // Update worker status
            worker.status = 'absent';
            worker.absenceReason = reason;
            
            TeamSystem.saveToStorage();
            updateTeamStats();
            updateMenuBadges();
            
            showNotification(`Ausência registada para ${worker.name}`, 'success');
            closeModal('absenceModal');
            
            // Clear form
            document.getElementById('absenceReason').value = '';
            
            // Update UI
            if (document.getElementById('teamAbsencesSection').classList.contains('active')) {
                loadTodayAbsences();
                loadAbsencesHistory();
            }
            
            // Ask about substitution
            if (confirm('Deseja pedir um substituto para este trabalhador?')) {
                requestSubstitution(workerId);
            }
        }
        
        function registerAbsenceAndRequestSubstitution() {
            registerAbsence();
            const workerId = parseInt(document.getElementById('absenceWorker').value);
            setTimeout(() => requestSubstitution(workerId), 500);
        }
        
        function notifyAbsenceWhatsApp() {
            const workerId = parseInt(document.getElementById('absenceWorker').value);
            const worker = TeamSystem.teamWorkers.find(w => w.id === workerId);
            const reason = document.getElementById('absenceReason').value;
            
            if (worker) {
                const message = `📋 REGISTO DE AUSÊNCIA\n\nTrabalhador: ${worker.name}\nMotivo: ${reason}\n\nRegistado por: ${TeamSystem.currentUser.name}`;
                window.open(`https://wa.me/?text=${encodeURIComponent(message)}`, '_blank');
            }
        }
        
        function loadTodayAbsences() {
            const today = new Date().toLocaleDateString('pt-PT');
            const tbody = document.getElementById('todayAbsencesTable');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            const todayAbsences = TeamSystem.absences.filter(a => 
                a.startDate === today && a.status === 'active'
            );
            
            todayAbsences.forEach(absence => {
                const worker = TeamSystem.teamWorkers.find(w => w.id === absence.workerId);
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div class="worker-avatar" style="width: 30px; height: 30px; font-size: 0.9rem;">${worker?.avatar || '--'}</div>
                            <span>${absence.workerName}</span>
                        </div>
                    </td>
                    <td>
                        <strong>${getAbsenceTypeText(absence.type)}</strong>
                        <p style="font-size: 0.85rem; color: #666;">${absence.reason}</p>
                    </td>
                    <td>${absence.startDate === absence.endDate ? '1 dia' : 'Vários dias'}</td>
                    <td>${absence.startDate}</td>
                    <td>
                        <span class="badge badge-warning">Pendente</span>
                    </td>
                    <td>
                        <button class="btn-dashboard btn-sm btn-success" onclick="markWorkerReturn(${absence.workerId})">
                            <i class="fas fa-undo"></i> Retornou
                        </button>
                        <button class="btn-dashboard btn-sm btn-warning" onclick="requestSubstitution(${absence.workerId})">
                            <i class="fas fa-exchange-alt"></i> Substituto
                        </button>
                        <button class="btn-dashboard btn-sm btn-info" onclick="uploadAbsenceProof(${absence.id})">
                            <i class="fas fa-upload"></i> Comprovativo
                        </button>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }
        
        function loadAbsencesHistory() {
            const tbody = document.getElementById('absencesHistoryTable');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            // Get absences from last 30 days
            const recentAbsences = TeamSystem.absences.filter(a => {
                const absenceDate = new Date(a.registeredAt);
                const thirtyDaysAgo = new Date();
                thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
                return absenceDate >= thirtyDaysAgo;
            });
            
            recentAbsences.forEach(absence => {
                const row = document.createElement('tr');
                const statusBadge = absence.status === 'active' ? 
                    '<span class="badge badge-warning">Ativa</span>' :
                    '<span class="badge badge-success">Concluída</span>';
                
                row.innerHTML = `
                    <td>${absence.startDate}</td>
                    <td>${absence.workerName}</td>
                    <td>${getAbsenceTypeText(absence.type)}</td>
                    <td>${absence.startDate === absence.endDate ? '1 dia' : 'Vários dias'}</td>
                    <td>${statusBadge}</td>
                    <td>
                        <button class="btn-dashboard btn-sm btn-info" onclick="viewAbsenceDetails(${absence.id})">
                            <i class="fas fa-eye"></i>
                        </button>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }
        
        function filterAbsences() {
            // Implementar filtragem de ausências
            console.log('Filtrar ausências');
        }
        
        function getAbsenceTypeText(type) {
            const types = {
                'doenca': 'Doença',
                'ferias': 'Férias',
                'familia': 'Assuntos Familiares',
                'consulta': 'Consulta Médica',
                'formacao': 'Formação',
                'outro': 'Outro'
            };
            return types[type] || type;
        }
        
        // ============ SISTEMA DE SUBSTITUIÇÕES ============
        function requestSubstitution(workerId) {
            const worker = TeamSystem.teamWorkers.find(w => w.id === workerId);
            if (worker) {
                document.getElementById('substitutionWorker').value = workerId;
                openSubstitutionModal();
            }
        }
        
        function openSubstitutionModal() {
            document.getElementById('substitutionModal').style.display = 'flex';
        }
        
        function requestSubstitutionSystem() {
            const workerId = parseInt(document.getElementById('substitutionWorker').value);
            const period = document.getElementById('substitutionPeriod').value;
            const urgency = document.getElementById('substitutionUrgency').value;
            const notes = document.getElementById('substitutionNotes').value;
            
            // Get selected skills
            const skillCheckboxes = document.querySelectorAll('input[name="substitutionSkills"]:checked');
            const skills = Array.from(skillCheckboxes).map(cb => cb.value);
            
            if (!workerId || skills.length === 0) {
                alert('Por favor, selecione o trabalhador e as habilidades necessárias!');
                return;
            }
            
            const worker = TeamSystem.teamWorkers.find(w => w.id === workerId);
            if (!worker) return;
            
            // Calculate dates
            let startDate = new Date();
            let endDate = new Date();
            
            if (period === 'custom') {
                startDate = new Date(document.getElementById('substitutionStartDate').value);
                endDate = new Date(document.getElementById('substitutionEndDate').value);
            } else {
                endDate.setDate(startDate.getDate() + parseInt(period));
            }
            
            // Create substitution request
            const substitutionId = Date.now();
            const substitution = {
                id: substitutionId,
                absentWorkerId: workerId,
                absentWorkerName: worker.name,
                substituteId: null,
                substituteName: null,
                skills: skills,
                startDate: formatDate(startDate),
                endDate: formatDate(endDate),
                urgency: urgency,
                notes: notes,
                status: 'pending',
                requestedAt: new Date().toISOString()
            };
            
            TeamSystem.substitutions.unshift(substitution);
            TeamSystem.saveToStorage();
            updateMenuBadges();
            
            showNotification(`Pedido de substituto enviado para ${worker.name}`, 'success');
            closeModal('substitutionModal');
            
            // Clear form
            document.getElementById('substitutionNotes').value = '';
            
            // Update UI
            if (document.getElementById('teamSubstitutionsSection').classList.contains('active')) {
                loadPendingSubstitutions();
                loadAssignedSubstitutions();
            }
            
            // Show available substitutes
            findAvailableSubstitutes();
        }
        
        function findAvailableSubstitutes() {
            // Get required skills from current request
            const skillCheckboxes = document.querySelectorAll('input[name="substitutionSkills"]:checked');
            const requiredSkills = Array.from(skillCheckboxes).map(cb => cb.value);
            
            if (requiredSkills.length === 0) {
                alert('Por favor, selecione as habilidades necessárias primeiro!');
                return;
            }
            
            // In a real system, this would query a database
            // For demo, we'll show a message
            showNotification(`Buscando substitutos com habilidades: ${requiredSkills.join(', ')}`, 'info');
            
            // Simulate finding substitutes
            setTimeout(() => {
                const substitutesGrid = document.getElementById('substitutesGrid');
                if (substitutesGrid) {
                    substitutesGrid.style.display = 'grid';
                }
            }, 1000);
        }
        
        function selectSubstitute(substituteId) {
            // In a real system, this would assign the substitute
            showNotification('Substituto selecionado com sucesso!', 'success');
            
            // Update the first pending substitution
            const pendingSub = TeamSystem.substitutions.find(s => s.status === 'pending');
            if (pendingSub) {
                pendingSub.substituteId = substituteId;
                pendingSub.substituteName = 'Substituto Selecionado';
                pendingSub.status = 'assigned';
                TeamSystem.saveToStorage();
                
                // Update UI
                loadPendingSubstitutions();
                loadAssignedSubstitutions();
                updateMenuBadges();
            }
        }
        
        function loadPendingSubstitutions() {
            const tbody = document.getElementById('pendingSubstitutionsTable');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            const pendingSubs = TeamSystem.substitutions.filter(s => s.status === 'pending');
            
            pendingSubs.forEach(sub => {
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td>${sub.absentWorkerName}</td>
                    <td>${getAbsenceTypeText(TeamSystem.absences.find(a => a.workerId === sub.absentWorkerId)?.type || 'outro')}</td>
                    <td>
                        ${sub.skills.map(skill => `<span class="badge badge-primary">${skill}</span>`).join(' ')}
                    </td>
                    <td>${sub.startDate}</td>
                    <td><span class="badge badge-warning">A Aguardar</span></td>
                    <td>
                        <button class="btn-dashboard btn-sm btn-success" onclick="assignSubstitution(${sub.id})">
                            <i class="fas fa-user-check"></i> Atribuir
                        </button>
                        <button class="btn-dashboard btn-sm btn-danger" onclick="cancelSubstitution(${sub.id})">
                            <i class="fas fa-times"></i> Cancelar
                        </button>
                        <a href="https://wa.me/351912345678" target="_blank" class="btn-dashboard btn-sm btn-whatsapp">
                            <i class="fab fa-whatsapp"></i>
                        </a>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }
        
        function loadAssignedSubstitutions() {
            const tbody = document.getElementById('assignedSubstitutionsTable');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            const assignedSubs = TeamSystem.substitutions.filter(s => s.status === 'assigned' || s.status === 'completed');
            
            assignedSubs.forEach(sub => {
                const row = document.createElement('tr');
                const statusBadge = sub.status === 'assigned' ? 
                    '<span class="badge badge-info">Atribuído</span>' :
                    '<span class="badge badge-success">Concluído</span>';
                
                row.innerHTML = `
                    <td>${sub.substituteName || '--'}</td>
                    <td>${sub.absentWorkerName} (${sub.startDate})</td>
                    <td>
                        ${sub.skills.map(skill => `<span class="badge badge-primary">${skill}</span>`).join(' ')}
                    </td>
                    <td>${sub.startDate} a ${sub.endDate}</td>
                    <td>${statusBadge}</td>
                    <td>
                        <button class="btn-dashboard btn-sm btn-info" onclick="viewSubstitutionDetails(${sub.id})">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn-dashboard btn-sm btn-primary" onclick="rateSubstitution(${sub.id})">
                            <i class="fas fa-star"></i> Avaliar
                        </button>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }
        
        function assignSubstitution(substitutionId) {
            // In a real system, this would open a modal to select substitute
            showNotification('Abrindo lista de substitutos disponíveis...', 'info');
            findAvailableSubstitutes();
        }
        
        function cancelSubstitution(substitutionId) {
            if (confirm('Tem certeza que deseja cancelar este pedido de substituição?')) {
                const subIndex = TeamSystem.substitutions.findIndex(s => s.id === substitutionId);
                if (subIndex !== -1) {
                    TeamSystem.substitutions.splice(subIndex, 1);
                    TeamSystem.saveToStorage();
                    updateMenuBadges();
                    
                    showNotification('Pedido de substituição cancelado', 'success');
                    
                    // Update UI
                    loadPendingSubstitutions();
                }
            }
        }
        
        function filterSubstitutes() {
            // Implementar filtragem de substitutos
            console.log('Filtrar substitutos');
        }
        
        function refreshSubstitutes() {
            showNotification('Lista de substitutos atualizada', 'success');
        }
        
        // ============ SISTEMA GPS ============
        function startGPSSharing() {
            if (navigator.geolocation) {
                showNotification('Iniciando partilha de localização...', 'info');
                
                // Simulate GPS updates
                simulateGPSUpdates();
                
                document.getElementById('gpsStatus').textContent = 'ATIVO';
                document.getElementById('gpsStatus').className = 'badge badge-success';
                
                // Update GPS coordinates with random nearby location
                const baseLat = 38.736946;
                const baseLng = -9.142685;
                const randomLat = baseLat + (Math.random() - 0.5) * 0.001;
                const randomLng = baseLng + (Math.random() - 0.5) * 0.001;
                
                document.getElementById('gpsCoordinates').textContent = 
                    `${randomLat.toFixed(6)}, ${randomLng.toFixed(6)}`;
                
                document.getElementById('lastGPSTime').textContent = 'há 0 minutos';
                document.getElementById('gpsAccuracy').textContent = '10 metros';
            } else {
                showNotification('GPS não suportado neste dispositivo', 'error');
            }
        }
        
        function simulateGPSUpdates() {
            // Simulate GPS updates every 30 seconds
            setInterval(() => {
                const baseLat = 38.736946;
                const baseLng = -9.142685;
                const randomLat = baseLat + (Math.random() - 0.5) * 0.0005;
                const randomLng = baseLng + (Math.random() - 0.5) * 0.0005;
                
                document.getElementById('gpsCoordinates').textContent = 
                    `${randomLat.toFixed(6)}, ${randomLng.toFixed(6)}`;
                
                // Update time
                const timeElement = document.getElementById('lastGPSTime');
                const text = timeElement.textContent;
                const match = text.match(/\d+/);
                if (match) {
                    const minutes = parseInt(match[0]) + 1;
                    timeElement.textContent = `há ${minutes} minutos`;
                }
            }, 30000);
        }
        
        function shareGPSWithBoss() {
            const coords = document.getElementById('gpsCoordinates').textContent;
            const message = `📍 LOCALIZAÇÃO DA EQUIPA\n\nCoordenadas: ${coords}\nEquipa: ${TeamSystem.currentUser.team}\nChefe: ${TeamSystem.currentUser.name}\nHora: ${new Date().toLocaleTimeString('pt-PT')}`;
            
            window.open(`https://wa.me/?text=${encodeURIComponent(message)}`, '_blank');
            showNotification('Localização partilhada com o patrão', 'success');
        }
        
        function stopGPSSharing() {
            document.getElementById('gpsStatus').textContent = 'INATIVO';
            document.getElementById('gpsStatus').className = 'badge badge-danger';
            showNotification('Partilha de localização parada', 'warning');
        }
        
        function loadTeamGPSTable() {
            const tbody = document.getElementById('teamGPSTable');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            TeamSystem.teamWorkers.forEach(worker => {
                const gps = TeamSystem.gpsData[worker.id] || {};
                const gpsStatus = gps.status === 'active' ? 
                    '<span class="badge badge-success">Ativo</span>' :
                    '<span class="badge badge-warning">Inativo</span>';
                
                const sharingStatus = gps.sharing ? 
                    '<span class="badge badge-success">Sim</span>' :
                    '<span class="badge badge-danger">Não</span>';
                
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td>${worker.name}</td>
                    <td>${gpsStatus}</td>
                    <td>${gps.lat ? `${gps.lat}, ${gps.lng}` : '--'}</td>
                    <td>${gps.lastUpdate || '--'}</td>
                    <td>${sharingStatus}</td>
                    <td>
                        <button class="btn-dashboard btn-sm btn-info" onclick="viewWorkerLocation(${worker.id})">
                            <i class="fas fa-map-marker-alt"></i>
                        </button>
                        <button class="btn-dashboard btn-sm btn-whatsapp" onclick="shareWorkerLocation(${worker.id})">
                            <i class="fab fa-whatsapp"></i>
                        </button>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }
        
        function updateGPSStatus() {
            // Update GPS status based on worker status
            TeamSystem.teamWorkers.forEach(worker => {
                if (!TeamSystem.gpsData[worker.id]) {
                    TeamSystem.gpsData[worker.id] = {};
                }
                
                // Only active if worker is present or working
                if (worker.status === 'present' || worker.status === 'working' || worker.status === 'resting') {
                    TeamSystem.gpsData[worker.id].status = 'active';
                    TeamSystem.gpsData[worker.id].sharing = true;
                } else {
                    TeamSystem.gpsData[worker.id].status = 'inactive';
                    TeamSystem.gpsData[worker.id].sharing = false;
                }
            });
        }
        
        function viewWorkerLocation(workerId) {
            const worker = TeamSystem.teamWorkers.find(w => w.id === workerId);
            const gps = TeamSystem.gpsData[workerId];
            
            if (worker && gps && gps.lat) {
                showNotification(`Mostrando localização de ${worker.name}: ${gps.lat}, ${gps.lng}`, 'info');
                // In a real system, this would open a map
            } else {
                showNotification(`${worker?.name || 'Trabalhador'} não tem localização disponível`, 'warning');
            }
        }
        
        function shareWorkerLocation(workerId) {
            const worker = TeamSystem.teamWorkers.find(w => w.id === workerId);
            const gps = TeamSystem.gpsData[workerId];
            
            if (worker && gps && gps.lat) {
                const message = `📍 LOCALIZAÇÃO DO TRABALHADOR\n\nNome: ${worker.name}\nCoordenadas: ${gps.lat}, ${gps.lng}\nÚltima atualização: ${gps.lastUpdate}\nEquipa: ${TeamSystem.currentUser.team}`;
                window.open(`https://wa.me/?text=${encodeURIComponent(message)}`, '_blank');
            }
        }
        
        function activateWorkerGPS(workerId) {
            const worker = TeamSystem.teamWorkers.find(w => w.id === workerId);
            if (worker) {
                if (!TeamSystem.gpsData[workerId]) {
                    TeamSystem.gpsData[workerId] = {};
                }
                
                TeamSystem.gpsData[workerId].status = 'active';
                TeamSystem.gpsData[workerId].sharing = true;
                TeamSystem.gpsData[workerId].lat = '38.736' + Math.floor(Math.random() * 1000);
                TeamSystem.gpsData[workerId].lng = '-9.142' + Math.floor(Math.random() * 1000);
                TeamSystem.gpsData[workerId].lastUpdate = new Date().toLocaleTimeString('pt-PT', { hour: '2-digit', minute: '2-digit' });
                
                TeamSystem.saveToStorage();
                loadTeamGPSTable();
                showNotification(`GPS ativado para ${worker.name}`, 'success');
            }
        }
        
        function saveGPSSettings() {
            showNotification('Configurações GPS guardadas com sucesso', 'success');
        }
        
        // ============ SISTEMA DE RELATÓRIOS ============
        function generateTeamReport() {
            openTeamReportModal();
        }
        
        function openTeamReportModal() {
            document.getElementById('teamReportModal').style.display = 'flex';
        }
        
        function generateCompleteReport() {
            const period = document.getElementById('reportPeriod').value;
            const format = document.getElementById('reportFormat').value;
            
            showNotification(`Gerando relatório (${period}) em formato ${format.toUpperCase()}...`, 'info');
            
            // Simulate report generation
            setTimeout(() => {
                showNotification('Relatório gerado com sucesso!', 'success');
                closeModal('teamReportModal');
                
                if (format === 'excel') {
                    alert('📊 Relatório Excel gerado!\n\nFicheiro: relatorio_equipa_' + new Date().toISOString().split('T')[0] + '.xlsx');
                } else if (format === 'pdf') {
                    alert('📄 Relatório PDF gerado!\n\nPronto para impressão ou partilha.');
                }
            }, 2000);
        }
        
        function previewReport() {
            const previewDiv = document.getElementById('reportPreview');
            previewDiv.style.display = previewDiv.style.display === 'none' ? 'block' : 'none';
            
            if (previewDiv.style.display === 'block') {
                previewDiv.innerHTML = `
                    <h4>Pré-visualização do Relatório</h4>
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-top: 10px;">
                        <p><strong>Período:</strong> Este Mês (Dezembro 2024)</p>
                        <p><strong>Equipa:</strong> ${TeamSystem.currentUser.team}</p>
                        <p><strong>Total de Horas:</strong> 168h</p>
                        <p><strong>Ausências:</strong> 3</p>
                        <p><strong>Substituições:</strong> 2</p>
                        <p><strong>Pontualidade:</strong> 98%</p>
                    </div>
                `;
            }
        }
        
        function sendReportWhatsApp() {
            const message = `📊 RELATÓRIO DA EQUIPA\n\nEquipa: ${TeamSystem.currentUser.team}\nPeríodo: Este Mês\nTotal Horas: 168h\nAusências: 3\nSubstituições: 2\nPontualidade: 98%\n\nGerado por: ${TeamSystem.currentUser.name}`;
            window.open(`https://wa.me/?text=${encodeURIComponent(message)}`, '_blank');
        }
        
        // ============ FUNÇÕES GERAIS ============
        function updateClocks() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('pt-PT');
            const timeShort = now.toLocaleTimeString('pt-PT', { hour: '2-digit', minute: '2-digit' });
            
            document.getElementById('teamCurrentTime').textContent = timeShort;
            document.getElementById('teamCurrentTimeDisplay').textContent = timeShort;
        }
        
        function formatDate(date) {
            return date.toLocaleDateString('pt-PT');
        }
        
        function showNotification(message, type = 'info') {
            const alertClass = {
                'success': 'alert-success',
                'error': 'alert-danger',
                'warning': 'alert-warning',
                'info': 'alert-info'
            }[type];
            
            // Create notification element
            const notification = document.createElement('div');
            notification.className = `alert ${alertClass}`;
            notification.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : type === 'warning' ? 'exclamation-triangle' : 'info-circle'}"></i>
                <div>${message}</div>
            `;
            
            // Add to page
            document.body.appendChild(notification);
            
            // Remove after 3 seconds
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
        
        function openBulkTimeModal() {
            document.getElementById('bulkTimeModal').style.display = 'flex';
        }
        
        function applyBulkTime() {
            const action = document.getElementById('bulkTimeAction').value;
            const time = document.getElementById('bulkTime').value;
            
            // In a real system, this would apply to selected workers
            showNotification(`Ação "${action}" aplicada à hora ${time} para todos os selecionados`, 'success');
            closeModal('bulkTimeModal');
        }
        
        // Funções para alertas
        function markAllAlertsRead() {
            showNotification('Todos os alertas marcados como lidos', 'success');
        }
        
        function checkMissingExits() {
            showNotification('Verificando saídas em falta...', 'info');
            // In a real system, this would highlight workers without exit time
        }
        
        function viewTeamGPS() {
            document.getElementById('gpsModal').style.display = 'flex';
        }
        
        function viewTeamMap() {
            document.getElementById('gpsModal').style.display = 'flex';
        }
        
        // Funções placeholder para funcionalidades futuras
        function generateTimeReport() { showNotification('Relatório de horas gerado', 'success'); }
        function sendTimesToWhatsApp() { showNotification('Horas partilhadas no WhatsApp', 'success'); }
        function uploadAbsenceProof(id) { showNotification('Comprovativo carregado', 'success'); }
        function viewAbsenceDetails(id) { showNotification('Detalhes da ausência', 'info'); }
        function viewSubstitutionDetails(id) { showNotification('Detalhes da substituição', 'info'); }
        function rateSubstitution(id) { showNotification('Substituição avaliada', 'success'); }
        function viewRouteMap() { showNotification('Mapa de rotas aberto', 'info'); }
        function generateHoursReport() { showNotification('Relatório de horas gerado', 'success'); }
        function generateHoursPDF() { showNotification('PDF de horas gerado', 'success'); }
        function shareHoursReport() { showNotification('Relatório partilhado', 'success'); }
        function generateAbsencesReport() { showNotification('Relatório de ausências gerado', 'success'); }
        function generateAbsencesPDF() { showNotification('PDF de ausências gerado', 'success'); }
        function generateGPSReport() { showNotification('Relatório GPS gerado', 'success'); }
        function generateGPSPDF() { showNotification('PDF GPS gerado', 'success'); }
        function generateFinancialReport() { showNotification('Relatório financeiro gerado', 'success'); }
        function generateFinancialPDF() { showNotification('PDF financeiro gerado', 'success'); }
        function sendToAccounting() { showNotification('Enviado para contabilidade', 'success'); }
        function updateCharts() { showNotification('Gráficos atualizados', 'info'); }
        function startLiveTracking() { showNotification('Tracking em tempo real iniciado', 'success'); }
        function shareLiveMap() { showNotification('Mapa partilhado', 'success'); }
        function exportGPSData() { showNotification('Dados GPS exportados', 'success'); }
        function shareSubstitutionRequest() { showNotification('Pedido partilhado no WhatsApp', 'success'); }
    </script>
</body>
</html>
