<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MAFC & FILHO, LDA. - Sistema de Gestão Profissional</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Roboto', sans-serif;
        }

        :root {
            --primary: #1a5f7a;
            --secondary: #2d9cdb;
            --accent: #ff9f1c;
            --dark: #003049;
            --light: #f8f9fa;
            --success: #27ae60;
            --warning: #f39c12;
            --danger: #e74c3c;
            --info: #3498db;
            --boss: #8e44ad;
            --team: #3498db;
            --purchase: #2ecc71;
            --office: #9b59b6;
            --construction: #e67e22;
            --gray-100: #f8f9fa;
            --gray-200: #e9ecef;
            --gray-300: #dee2e6;
            --gray-400: #ced4da;
            --gray-500: #adb5bd;
            --gray-600: #6c757d;
            --gray-700: #495057;
            --gray-800: #343a40;
            --gray-900: #212529;
            --shadow-sm: 0 2px 4px rgba(0,0,0,0.05);
            --shadow-md: 0 4px 6px rgba(0,0,0,0.07);
            --shadow-lg: 0 10px 15px rgba(0,0,0,0.1);
            --shadow-xl: 0 20px 25px rgba(0,0,0,0.15);
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-xl: 20px;
            --transition: all 0.3s ease;
        }

        body {
            background: var(--light);
            color: var(--gray-800);
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* ============ UTILITÁRIOS ============ */
        .container {
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .d-none { display: none !important; }
        .d-flex { display: flex; }
        .flex-column { flex-direction: column; }
        .justify-between { justify-content: space-between; }
        .align-center { align-items: center; }
        .gap-1 { gap: 0.5rem; }
        .gap-2 { gap: 1rem; }
        .gap-3 { gap: 1.5rem; }
        .gap-4 { gap: 2rem; }
        .text-center { text-align: center; }
        .text-right { text-align: right; }
        .w-100 { width: 100%; }
        .mt-1 { margin-top: 0.5rem; }
        .mt-2 { margin-top: 1rem; }
        .mt-3 { margin-top: 1.5rem; }
        .mt-4 { margin-top: 2rem; }
        .mb-1 { margin-bottom: 0.5rem; }
        .mb-2 { margin-bottom: 1rem; }
        .mb-3 { margin-bottom: 1.5rem; }
        .mb-4 { margin-bottom: 2rem; }
        .p-1 { padding: 0.5rem; }
        .p-2 { padding: 1rem; }
        .p-3 { padding: 1.5rem; }
        .p-4 { padding: 2rem; }

        /* ============ PÁGINA PÚBLICA ============ */
        #publicWebsite {
            min-height: 100vh;
            background: var(--gray-100);
        }

        /* Header Público */
        .public-header {
            background: linear-gradient(135deg, var(--dark) 0%, var(--primary) 100%);
            color: white;
            padding: 1rem 0;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            box-shadow: var(--shadow-lg);
            backdrop-filter: blur(10px);
            background-color: rgba(0, 48, 73, 0.95);
        }

        .nav-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 1rem;
            text-decoration: none;
            color: white;
        }

        .logo-icon {
            width: 50px;
            height: 50px;
            background: var(--accent);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
        }

        .logo-text h1 {
            font-size: 1.6rem;
            font-weight: 800;
            line-height: 1.2;
        }

        .logo-text span {
            font-size: 0.9rem;
            opacity: 0.9;
            display: block;
            margin-top: 0.25rem;
        }

        .cta-buttons {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        /* Botões */
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 50px;
            font-weight: 600;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: var(--transition);
            border: none;
            cursor: pointer;
            font-size: 1rem;
            white-space: nowrap;
            border: 2px solid transparent;
        }

        .btn-whatsapp {
            background: #25D366;
            color: white;
        }

        .btn-whatsapp:hover {
            background: #1da851;
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--dark);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-accent {
            background: var(--accent);
            color: var(--dark);
        }

        .btn-accent:hover {
            background: #ffb143;
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-outline {
            background: transparent;
            border-color: white;
            color: white;
        }

        .btn-outline:hover {
            background: white;
            color: var(--dark);
        }

        /* Hero Section */
        .hero {
            background: linear-gradient(rgba(0, 48, 73, 0.9), rgba(0, 48, 73, 0.95)), 
                        url('https://images.unsplash.com/photo-1504307651254-35680f356dfd?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            color: white;
            padding: 180px 0 100px;
            margin-top: 70px;
        }

        .hero-content {
            max-width: 800px;
            margin: 0 auto;
            text-align: center;
        }

        .hero h2 {
            font-size: 3.5rem;
            font-weight: 900;
            margin-bottom: 1.5rem;
            line-height: 1.2;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .hero p {
            font-size: 1.3rem;
            opacity: 0.95;
            margin-bottom: 2.5rem;
            line-height: 1.8;
        }

        .hero-buttons {
            display: flex;
            gap: 1.5rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        /* Serviços */
        .services {
            padding: 6rem 0;
            background: white;
        }

        .section-title {
            text-align: center;
            font-size: 2.8rem;
            color: var(--dark);
            margin-bottom: 3rem;
            position: relative;
            font-weight: 800;
        }

        .section-title::after {
            content: '';
            position: absolute;
            bottom: -1rem;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 4px;
            background: var(--accent);
            border-radius: 2px;
        }

        .services-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-top: 3rem;
        }

        .service-card {
            background: var(--gray-100);
            padding: 2.5rem 2rem;
            border-radius: var(--radius-lg);
            transition: var(--transition);
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
        }

        .service-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--accent);
            transform: translateX(-100%);
            transition: transform 0.3s ease;
        }

        .service-card:hover {
            transform: translateY(-10px);
            border-color: var(--accent);
            box-shadow: var(--shadow-xl);
        }

        .service-card:hover::before {
            transform: translateX(0);
        }

        .service-icon {
            font-size: 3rem;
            color: var(--primary);
            margin-bottom: 1.5rem;
        }

        .service-card h3 {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            color: var(--dark);
            font-weight: 700;
        }

        /* Estatísticas */
        .company-info {
            padding: 6rem 0;
            background: linear-gradient(135deg, var(--gray-100) 0%, var(--gray-200) 100%);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
            margin-top: 3rem;
        }

        .stat-card {
            background: white;
            padding: 2.5rem 2rem;
            border-radius: var(--radius-lg);
            text-align: center;
            box-shadow: var(--shadow-md);
            border-top: 4px solid var(--accent);
            transition: var(--transition);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .stat-card i {
            font-size: 3rem;
            color: var(--primary);
            margin-bottom: 1rem;
        }

        .stat-card h3 {
            font-size: 2.5rem;
            color: var(--dark);
            margin-bottom: 0.5rem;
            font-weight: 800;
        }

        /* Orçamento */
        .quote-request {
            background: linear-gradient(135deg, var(--dark), var(--primary));
            color: white;
            padding: 6rem 0;
            text-align: center;
        }

        .quote-request h2 {
            font-size: 2.5rem;
            margin-bottom: 1.5rem;
            font-weight: 800;
        }

        .quote-buttons {
            display: flex;
            gap: 1.5rem;
            justify-content: center;
            margin-top: 3rem;
            flex-wrap: wrap;
        }

        /* Footer */
        .public-footer {
            background: var(--dark);
            color: white;
            padding: 4rem 0 2rem;
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 3rem;
            margin-bottom: 3rem;
        }

        .copyright {
            text-align: center;
            padding-top: 2rem;
            border-top: 1px solid rgba(255,255,255,0.1);
            color: rgba(255,255,255,0.7);
            font-size: 0.9rem;
        }

        /* ============ MODAL LOGIN ============ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: white;
            width: 90%;
            max-width: 500px;
            border-radius: var(--radius-lg);
            overflow: hidden;
            animation: modalSlideIn 0.4s ease;
            box-shadow: var(--shadow-xl);
        }

        @keyframes modalSlideIn {
            from { 
                transform: translateY(-50px) scale(0.9); 
                opacity: 0; 
            }
            to { 
                transform: translateY(0) scale(1); 
                opacity: 1; 
            }
        }

        .modal-header {
            background: linear-gradient(135deg, var(--dark), var(--primary));
            color: white;
            padding: 2rem;
            text-align: center;
            position: relative;
        }

        .modal-header h2 {
            font-size: 1.8rem;
            font-weight: 700;
        }

        .close-modal {
            position: absolute;
            top: 1.5rem;
            right: 1.5rem;
            font-size: 1.5rem;
            cursor: pointer;
            color: white;
            transition: var(--transition);
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .close-modal:hover {
            background: rgba(255,255,255,0.1);
        }

        .modal-body {
            padding: 3rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--dark);
            font-weight: 600;
            font-size: 1rem;
        }

        .form-control {
            width: 100%;
            padding: 0.875rem 1rem;
            border: 2px solid var(--gray-300);
            border-radius: var(--radius-sm);
            font-size: 1rem;
            transition: var(--transition);
            background: var(--gray-100);
        }

        .form-control:focus {
            border-color: var(--primary);
            outline: none;
            background: white;
            box-shadow: 0 0 0 3px rgba(26, 95, 122, 0.1);
        }

        .login-submit {
            background: linear-gradient(135deg, var(--primary), var(--dark));
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: var(--radius-sm);
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition);
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .login-submit:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        /* ============ DASHBOARDS ============ */
        .dashboard {
            display: none;
            min-height: 100vh;
            background: var(--gray-100);
        }

        /* Top Bar */
        .top-bar {
            background: white;
            padding: 0;
            box-shadow: var(--shadow-md);
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            border-bottom: 4px solid;
        }

        .boss-dashboard .top-bar {
            border-bottom-color: var(--boss);
            background: linear-gradient(135deg, #9b59b6, var(--boss));
        }

        .team-dashboard .top-bar {
            border-bottom-color: var(--team);
            background: linear-gradient(135deg, #3498db, #2980b9);
        }

        .purchase-dashboard .top-bar {
            border-bottom-color: var(--purchase);
            background: linear-gradient(135deg, #2ecc71, #27ae60);
        }

        .office-dashboard .top-bar {
            border-bottom-color: var(--office);
            background: linear-gradient(135deg, var(--office), #8e44ad);
        }

        .top-bar-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 0;
        }

        .dashboard-brand {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .dashboard-brand i {
            font-size: 1.8rem;
            color: white;
        }

        .dashboard-brand h1 {
            color: white;
            font-size: 1.4rem;
            font-weight: 700;
        }

        .dashboard-info {
            display: flex;
            align-items: center;
            gap: 1.5rem;
            color: white;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(255,255,255,0.15);
            padding: 0.5rem 1rem;
            border-radius: 50px;
            backdrop-filter: blur(10px);
        }

        .user-info i {
            font-size: 1.2rem;
        }

        .logout-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid rgba(255,255,255,0.3);
            padding: 0.5rem 1.5rem;
            border-radius: 50px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            backdrop-filter: blur(10px);
        }

        .logout-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
            border-color: white;
        }

        /* Menu Horizontal */
        .horizontal-menu {
            background: white;
            margin-top: 70px;
            padding: 0;
            box-shadow: var(--shadow-sm);
            position: fixed;
            width: 100%;
            z-index: 999;
            overflow-x: auto;
        }

        .menu-container {
            display: flex;
            gap: 0;
            padding: 0;
            width: 100%;
        }

        .menu-item {
            padding: 1rem 1.5rem;
            color: var(--gray-600);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-weight: 600;
            white-space: nowrap;
            border-bottom: 3px solid transparent;
            transition: var(--transition);
            position: relative;
        }

        .menu-item:hover {
            color: var(--primary);
            background: var(--gray-100);
        }

        .menu-item.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
            background: var(--gray-100);
        }

        .menu-item i {
            font-size: 1.1rem;
        }

        .menu-badge {
            background: var(--accent);
            color: white;
            font-size: 0.75rem;
            padding: 0.2rem 0.5rem;
            border-radius: 10px;
            margin-left: 0.5rem;
            font-weight: 700;
        }

        /* Conteúdo do Dashboard */
        .dashboard-content {
            margin-top: 140px;
            padding: 2rem;
            background: var(--gray-100);
            min-height: calc(100vh - 140px);
        }

        .dashboard-section {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .dashboard-section.active {
            display: block;
        }

        /* Cards de Estatísticas */
        .stats-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card-horizontal {
            background: white;
            padding: 1.5rem;
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            gap: 1rem;
            box-shadow: var(--shadow-md);
            border-left: 5px solid;
            transition: var(--transition);
        }

        .stat-card-horizontal:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }

        .boss-dashboard .stat-card-horizontal { border-left-color: var(--boss); }
        .team-dashboard .stat-card-horizontal { border-left-color: var(--team); }
        .purchase-dashboard .stat-card-horizontal { border-left-color: var(--purchase); }
        .office-dashboard .stat-card-horizontal { border-left-color: var(--office); }

        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
        }

        .boss-dashboard .stat-icon { background: linear-gradient(135deg, var(--boss), #9b59b6); }
        .team-dashboard .stat-icon { background: linear-gradient(135deg, var(--team), #3498db); }
        .purchase-dashboard .stat-icon { background: linear-gradient(135deg, var(--purchase), #2ecc71); }
        .office-dashboard .stat-icon { background: linear-gradient(135deg, var(--office), #8e44ad); }

        .stat-info h3 {
            font-size: 1.8rem;
            color: var(--dark);
            margin-bottom: 0.25rem;
            font-weight: 800;
        }

        .stat-info p {
            color: var(--gray-600);
            font-weight: 600;
            font-size: 0.9rem;
        }

        /* Grids de Conteúdo */
        .content-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        /* Cards de Conteúdo */
        .content-card {
            background: white;
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            box-shadow: var(--shadow-md);
            transition: var(--transition);
        }

        .content-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--gray-200);
        }

        .card-header h3 {
            color: var(--dark);
            font-size: 1.3rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .card-header h3 i {
            color: var(--primary);
        }

        /* Botões Dashboard */
        .btn-dashboard {
            padding: 0.75rem 1.5rem;
            border-radius: var(--radius-sm);
            font-weight: 600;
            border: none;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: var(--transition);
            font-size: 1rem;
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover {
            background: #219653;
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .btn-warning {
            background: var(--warning);
            color: white;
        }

        .btn-warning:hover {
            background: #e67e22;
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background: #c0392b;
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .btn-info {
            background: var(--info);
            color: white;
        }

        .btn-info:hover {
            background: #2980b9;
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .btn-sm {
            padding: 0.375rem 0.75rem;
            font-size: 0.875rem;
        }

        /* Tabelas */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: var(--radius-md);
            overflow: hidden;
            box-shadow: var(--shadow-sm);
            margin-top: 1rem;
        }

        .data-table th {
            background: var(--primary);
            color: white;
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .data-table td {
            padding: 1rem;
            border-bottom: 1px solid var(--gray-200);
        }

        .data-table tr:hover {
            background: var(--gray-100);
        }

        /* Badges */
        .badge {
            padding: 0.25rem 0.75rem;
            border-radius: 50px;
            font-size: 0.75rem;
            font-weight: 700;
            display: inline-block;
        }

        .badge-success { background: #d5f4e6; color: var(--success); }
        .badge-warning { background: #fff3cd; color: var(--warning); }
        .badge-danger { background: #f8d7da; color: var(--danger); }
        .badge-primary { background: #d1ecf1; color: var(--secondary); }
        .badge-info { background: #d1ecf1; color: #17a2b8; }

        /* Formulários */
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .form-group-dashboard {
            margin-bottom: 1rem;
        }

        .form-group-dashboard label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--dark);
            font-weight: 600;
            font-size: 0.9rem;
        }

        .form-group-dashboard input,
        .form-group-dashboard select,
        .form-group-dashboard textarea {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid var(--gray-300);
            border-radius: var(--radius-sm);
            font-size: 0.9rem;
            transition: var(--transition);
            background: var(--gray-100);
        }

        .form-group-dashboard input:focus,
        .form-group-dashboard select:focus,
        .form-group-dashboard textarea:focus {
            border-color: var(--primary);
            outline: none;
            background: white;
            box-shadow: 0 0 0 3px rgba(26, 95, 122, 0.1);
        }

        .form-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            margin-top: 2rem;
            padding-top: 1.5rem;
            border-top: 2px solid var(--gray-200);
        }

        /* Time Tracker */
        .time-tracker {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1.5rem;
            border-radius: var(--radius-lg);
            margin-bottom: 1.5rem;
        }

        .time-display {
            font-size: 2.5rem;
            font-weight: 800;
            text-align: center;
            margin-bottom: 1rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .time-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
        }

        /* Categorias de Materiais */
        .categories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .category-card {
            background: white;
            padding: 1.5rem;
            border-radius: var(--radius-md);
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            border: 2px solid transparent;
        }

        .category-card:hover {
            transform: translateY(-3px);
            border-color: var(--accent);
            box-shadow: var(--shadow-md);
        }

        .category-card i {
            font-size: 2rem;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .category-card h4 {
            font-size: 1.1rem;
            margin-bottom: 0.25rem;
        }

        /* GPS Tracker */
        .gps-tracker {
            background: linear-gradient(135deg, #11998e, #38ef7d);
            color: white;
            padding: 1.5rem;
            border-radius: var(--radius-lg);
            margin-bottom: 1.5rem;
        }

        .gps-info {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .gps-coordinates {
            font-family: monospace;
            font-size: 1rem;
            background: rgba(255,255,255,0.15);
            padding: 0.75rem;
            border-radius: var(--radius-sm);
            backdrop-filter: blur(10px);
        }

        /* ============ MODAIS ============ */
        .modal-employee, 
        .modal-monthly-report,
        .modal-purchase-details,
        .modal-history {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 2001;
            display: none;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }

        .modal-employee-content, 
        .modal-monthly-report-content,
        .modal-purchase-content,
        .modal-history-content {
            background: white;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            border-radius: var(--radius-lg);
            padding: 2rem;
            position: relative;
            overflow-y: auto;
            animation: modalSlideIn 0.3s ease;
        }

        .modal-history-content {
            max-width: 1200px;
        }

        .close-employee-modal, 
        .close-report-modal,
        .close-purchase-modal,
        .close-history-modal {
            position: absolute;
            top: 1rem;
            right: 1rem;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--dark);
            transition: var(--transition);
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .close-employee-modal:hover, 
        .close-report-modal:hover,
        .close-purchase-modal:hover,
        .close-history-modal:hover {
            background: var(--gray-200);
        }

        /* Extrato Mensal */
        .monthly-report {
            background: white;
            border-radius: var(--radius-md);
            padding: 1.5rem;
            margin-top: 1rem;
            box-shadow: var(--shadow-sm);
        }

        .report-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--gray-200);
        }

        .report-actions {
            display: flex;
            gap: 0.75rem;
            justify-content: flex-end;
            margin-top: 1.5rem;
        }

        /* Tabela de Horários */
        .time-sheet-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }

        .time-sheet-table th {
            background: var(--gray-100);
            padding: 0.75rem;
            text-align: left;
            border-bottom: 2px solid var(--gray-300);
            font-weight: 600;
        }

        .time-sheet-table td {
            padding: 0.75rem;
            border-bottom: 1px solid var(--gray-200);
        }

        /* Status Indicators */
        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 600;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            display: inline-block;
        }

        .status-pending { background: var(--warning); }
        .status-approved { background: var(--success); }
        .status-rejected { background: var(--danger); }
        .status-delivered { background: var(--info); }
        .status-processing { background: var(--accent); }

        /* Purchase Status Badges */
        .status-badge {
            padding: 0.375rem 0.75rem;
            border-radius: 50px;
            font-size: 0.75rem;
            font-weight: 700;
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
        }

        /* History Timeline */
        .history-timeline {
            margin-top: 2rem;
        }

        .timeline-item {
            padding: 1rem;
            border-left: 3px solid var(--primary);
            margin-left: 1rem;
            margin-bottom: 1rem;
            background: var(--gray-100);
            border-radius: 0 var(--radius-sm) var(--radius-sm) 0;
        }

        .timeline-date {
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        /* Activity Log */
        .activity-log {
            max-height: 400px;
            overflow-y: auto;
        }

        .activity-item {
            padding: 1rem;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--gray-200);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
        }

        /* Responsividade */
        @media (max-width: 1200px) {
            .content-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 992px) {
            .hero h2 {
                font-size: 2.5rem;
            }
            
            .section-title {
                font-size: 2rem;
            }
            
            .dashboard-content {
                padding: 1rem;
            }
            
            .content-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .hero {
                padding: 150px 0 80px;
            }
            
            .hero h2 {
                font-size: 2rem;
            }
            
            .hero p {
                font-size: 1.1rem;
            }
            
            .stats-row {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .top-bar-content {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }
            
            .dashboard-info {
                flex-direction: column;
                gap: 1rem;
            }
            
            .menu-item {
                padding: 0.75rem 1rem;
                font-size: 0.9rem;
            }
            
            .modal-employee-content,
            .modal-monthly-report-content,
            .modal-purchase-content {
                padding: 1.5rem;
            }
        }

        @media (max-width: 576px) {
            .hero h2 {
                font-size: 1.8rem;
            }
            
            .section-title {
                font-size: 1.8rem;
            }
            
            .btn {
                padding: 0.625rem 1.25rem;
                font-size: 0.9rem;
            }
            
            .dashboard-content {
                padding: 0.75rem;
            }
            
            .content-card {
                padding: 1rem;
            }
            
            .modal-employee-content,
            .modal-monthly-report-content,
            .modal-purchase-content {
                padding: 1rem;
                width: 95%;
            }
        }
    </style>
</head>
<body>
    <!-- ============ PÁGINA PÚBLICA ============ -->
    <div id="publicWebsite">
        <!-- Header Público -->
        <header class="public-header">
            <div class="container nav-container">
                <a href="#" class="logo">
                    <div class="logo-icon">
                        <i class="fas fa-hard-hat"></i>
                    </div>
                    <div class="logo-text">
                        <h1>MAFC & FILHO, LDA.</h1>
                        <span>Construção Civil & Obras Públicas | Desde 2001</span>
                    </div>
                </a>
                <div class="cta-buttons">
                    <a href="https://wa.me/351123456789?text=Olá%20MAFC,%20gostaria%20de%20solicitar%20um%20orçamento%20para%20uma%20obra" 
                       class="btn btn-whatsapp" target="_blank">
                        <i class="fab fa-whatsapp"></i> WhatsApp
                    </a>
                    <a href="mailto:orcamentos@mafc-filho.pt" 
                       class="btn btn-accent">
                        <i class="fas fa-envelope"></i> Pedir Orçamento
                    </a>
                    <a href="#" class="btn btn-primary" id="openLogin">
                        <i class="fas fa-sign-in-alt"></i> Acesso Sistema
                    </a>
                </div>
            </div>
        </header>

        <!-- Hero Section -->
        <section class="hero">
            <div class="container hero-content">
                <h2>Especialistas em Construção Civil e Obras Públicas</h2>
                <p>Mais de 20 anos de experiência em saneamento, abastecimento de água, redes de fibra óptica, pavimentação e infraestruturas. Operação em Portugal e Alemanha com 15 equipas especializadas.</p>
                <div class="hero-buttons">
                    <a href="#services" class="btn btn-accent">
                        <i class="fas fa-hard-hat"></i> Nossos Serviços
                    </a>
                    <a href="#quote" class="btn btn-whatsapp">
                        <i class="fas fa-calculator"></i> Orçamento Grátis
                    </a>
                </div>
            </div>
        </section>

        <!-- Services -->
        <section class="services" id="services">
            <div class="container">
                <h2 class="section-title">Serviços Especializados</h2>
                <div class="services-grid">
                    <div class="service-card">
                        <div class="service-icon">
                            <i class="fas fa-water"></i>
                        </div>
                        <h3>Saneamento e Águas</h3>
                        <p>Redes de águas pluviais, sistemas de drenagem e abastecimento de água potável.</p>
                    </div>
                    <div class="service-card">
                        <div class="service-icon">
                            <i class="fas fa-satellite-dish"></i>
                        </div>
                        <h3>Redes de Fibra Óptica</h3>
                        <p>Instalação e manutenção de infraestruturas de telecomunicações.</p>
                    </div>
                    <div class="service-card">
                        <div class="service-icon">
                            <i class="fas fa-road"></i>
                        </div>
                        <h3>Pavimentação</h3>
                        <p>Pavimentação em cubo, betuminosa e reabilitação de vias públicas.</p>
                    </div>
                    <div class="service-card">
                        <div class="service-icon">
                            <i class="fas fa-bolt"></i>
                        </div>
                        <h3>Redes EDP e Gás</h3>
                        <p>Instalação de infraestruturas elétricas e de gás natural.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Company Info -->
        <section class="company-info">
            <div class="container">
                <h2 class="section-title">MAFC em Números</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <i class="fas fa-calendar-alt"></i>
                        <h3>20+</h3>
                        <p>Anos de Experiência</p>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-users"></i>
                        <h3>40+</h3>
                        <p>Colaboradores</p>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-hard-hat"></i>
                        <h3>15</h3>
                        <p>Equipas Ativas</p>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-globe-europe"></i>
                        <h3>2</h3>
                        <p>Países de Operação</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Quote Request -->
        <section class="quote-request" id="quote">
            <div class="container">
                <h2>Solicite um Orçamento Gratuito</h2>
                <p>Tem um projeto de construção? Entre em contacto connosco para uma avaliação personalizada.</p>
                <div class="quote-buttons">
                    <a href="https://wa.me/351123456789?text=Olá%20MAFC,%20gostaria%20de%20solicitar%20um%20orçamento%20para%20uma%20obra" 
                       class="btn btn-whatsapp" target="_blank">
                        <i class="fab fa-whatsapp"></i> WhatsApp
                    </a>
                    <a href="mailto:orcamentos@mafc-filho.pt" 
                       class="btn btn-accent">
                        <i class="fas fa-envelope"></i> Email
                    </a>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer class="public-footer">
            <div class="container">
                <div class="footer-content">
                    <div>
                        <h3>MAFC & FILHO, LDA.</h3>
                        <p>Constituída em 2001, somos especialistas em construção civil e obras públicas com operação em Portugal e Alemanha.</p>
                    </div>
                    <div>
                        <h3>Contactos</h3>
                        <p>Email: geral@mafc-filho.pt</p>
                        <p>Telefone: +351 123 456 789</p>
                    </div>
                </div>
                <div class="copyright">
                    <p>&copy; 2001-2024 MAFC & FILHO, LDA. - Todos os direitos reservados.</p>
                </div>
            </div>
        </footer>
    </div>

    <!-- ============ MODAL DE LOGIN ============ -->
    <div class="modal" id="loginModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-lock"></i> Acesso ao Sistema MAFC</h2>
                <span class="close-modal">&times;</span>
            </div>
            <div class="modal-body">
                <form id="loginForm">
                    <div class="form-group">
                        <label for="username"><i class="fas fa-user"></i> Código de Acesso</label>
                        <input type="text" id="username" class="form-control" placeholder="Digite seu código" required>
                    </div>
                    <div class="form-group">
                        <label for="password"><i class="fas fa-key"></i> Senha</label>
                        <input type="password" id="password" class="form-control" placeholder="Digite sua senha" required>
                    </div>
                    <div class="form-group">
                        <label for="role"><i class="fas fa-user-tag"></i> Tipo de Acesso</label>
                        <select id="role" class="form-control" required>
                            <option value="">Selecione o tipo de acesso</option>
                            <option value="boss">Patrão/Administrador</option>
                            <option value="team">Chefe de Equipa</option>
                            <option value="purchase">Responsável de Compras</option>
                            <option value="office">Empregado de Escritório</option>
                        </select>
                    </div>
                    <button type="submit" class="login-submit">
                        <i class="fas fa-sign-in-alt"></i> Entrar no Sistema
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- ============ MODAL GESTÃO DE EMPREGADOS ============ -->
    <div class="modal-employee" id="employeeModal">
        <div class="modal-employee-content">
            <span class="close-employee-modal">&times;</span>
            <h2><i class="fas fa-user-plus"></i> Gestão de Empregados</h2>
            <div class="employee-form mt-3">
                <div class="form-row">
                    <div class="form-group-dashboard">
                        <label>Nome Completo</label>
                        <input type="text" id="employeeName" class="form-control" placeholder="Nome do empregado">
                    </div>
                    <div class="form-group-dashboard">
                        <label>Número de WhatsApp</label>
                        <input type="tel" id="employeeWhatsApp" class="form-control" placeholder="+351 912 345 678">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group-dashboard">
                        <label>Cargo</label>
                        <select id="employeePosition" class="form-control">
                            <option value="worker">Trabalhador</option>
                            <option value="assistant">Ajudante</option>
                            <option value="specialist">Especialista</option>
                            <option value="driver">Motorista</option>
                            <option value="chefe">Chefe de Equipa</option>
                        </select>
                    </div>
                    <div class="form-group-dashboard">
                        <label>Salário Base (€/mês)</label>
                        <input type="number" id="employeeSalary" class="form-control" placeholder="1200" min="0" step="50">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group-dashboard">
                        <label>Data de Início</label>
                        <input type="date" id="employeeStartDate" class="form-control">
                    </div>
                    <div class="form-group-dashboard">
                        <label>Estado</label>
                        <select id="employeeStatus" class="form-control">
                            <option value="active">Ativo</option>
                            <option value="inactive">Inativo</option>
                            <option value="ferias">Férias</option>
                            <option value="doente">Baixa Médica</option>
                        </select>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-dashboard btn-success" onclick="saveEmployee()">
                        <i class="fas fa-save"></i> Guardar Empregado
                    </button>
                    <button type="button" class="btn-dashboard btn-danger" onclick="closeEmployeeModal()">
                        <i class="fas fa-times"></i> Cancelar
                    </button>
                </div>
            </div>
            
            <div class="mt-4">
                <h3><i class="fas fa-list"></i> Empregados da Equipa</h3>
                <table class="data-table mt-2">
                    <thead>
                        <tr>
                            <th>Nome</th>
                            <th>WhatsApp</th>
                            <th>Cargo</th>
                            <th>Estado</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody id="employeesList">
                        <!-- Lista de empregados será carregada aqui -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- ============ MODAL EXTRATO MENSAL ============ -->
    <div class="modal-monthly-report" id="monthlyReportModal">
        <div class="modal-monthly-report-content">
            <span class="close-report-modal">&times;</span>
            <h2><i class="fas fa-file-invoice"></i> Extrato Mensal - Horas Trabalhadas</h2>
            
            <div class="form-row mt-3">
                <div class="form-group-dashboard">
                    <label>Mês/Ano</label>
                    <select id="reportMonth" class="form-control">
                        <option value="12-2024">Dezembro 2024</option>
                        <option value="11-2024">Novembro 2024</option>
                        <option value="10-2024">Outubro 2024</option>
                        <option value="09-2024">Setembro 2024</option>
                    </select>
                </div>
                <div class="form-group-dashboard">
                    <label>Empregado</label>
                    <select id="reportEmployee" class="form-control">
                        <option value="all">Todos os Empregados</option>
                    </select>
                </div>
            </div>
            
            <div class="monthly-report">
                <div class="report-header">
                    <h4 id="reportTitle">Extrato de Horas - Dezembro 2024</h4>
                    <span class="badge badge-success" id="totalHours">160 horas</span>
                </div>
                
                <table class="time-sheet-table" id="timeSheetTable">
                    <thead>
                        <tr>
                            <th>Data</th>
                            <th>Entrada</th>
                            <th>Saída</th>
                            <th>Horas</th>
                            <th>Extra</th>
                        </tr>
                    </thead>
                    <tbody id="timeSheetBody">
                        <!-- Dados do extrato serão carregados aqui -->
                    </tbody>
                </table>
                
                <div class="report-actions">
                    <button class="btn-dashboard btn-primary" onclick="printReport()">
                        <i class="fas fa-print"></i> Imprimir (Drucker)
                    </button>
                    <button class="btn-dashboard btn-success" onclick="sendReportEmail()">
                        <i class="fas fa-envelope"></i> Enviar por Email
                    </button>
                    <button class="btn-dashboard btn-whatsapp" onclick="sendReportWhatsApp()">
                        <i class="fab fa-whatsapp"></i> Enviar WhatsApp
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ============ MODAL DETALHES COMPRA ============ -->
    <div class="modal-purchase-details" id="purchaseDetailsModal">
        <div class="modal-purchase-content">
            <span class="close-purchase-modal">&times;</span>
            <h2><i class="fas fa-shopping-cart"></i> Detalhes da Compra</h2>
            
            <div class="mt-3">
                <div class="form-row">
                    <div class="form-group-dashboard">
                        <label>Estado da Compra</label>
                        <select id="purchaseStatus" class="form-control" onchange="updatePurchaseStatus()">
                            <option value="pending">Pendente</option>
                            <option value="approved">Aprovada</option>
                            <option value="ordered">Encomendada</option>
                            <option value="delivered">Entregue</option>
                            <option value="cancelled">Cancelada</option>
                        </select>
                    </div>
                    <div class="form-group-dashboard">
                        <label>Data de Conclusão</label>
                        <input type="date" id="completionDate" class="form-control">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group-dashboard">
                        <label>Fornecedor</label>
                        <input type="text" id="supplierName" class="form-control" placeholder="Nome do fornecedor">
                    </div>
                    <div class="form-group-dashboard">
                        <label>Valor Total (€)</label>
                        <input type="number" id="purchaseValue" class="form-control" placeholder="0.00" step="0.01" min="0">
                    </div>
                </div>
                
                <div class="form-group-dashboard">
                    <label>Observações</label>
                    <textarea id="purchaseNotes" class="form-control" rows="3" placeholder="Detalhes sobre a compra..."></textarea>
                </div>
                
                <div class="form-actions">
                    <button class="btn-dashboard btn-success" onclick="savePurchaseDetails()">
                        <i class="fas fa-save"></i> Guardar Alterações
                    </button>
                    <button class="btn-dashboard btn-danger" onclick="closePurchaseModal()">
                        <i class="fas fa-times"></i> Cancelar
                    </button>
                </div>
            </div>
            
            <div class="history-timeline mt-4">
                <h4><i class="fas fa-history"></i> Histórico da Compra</h4>
                <div id="purchaseHistory">
                    <!-- Histórico será carregado aqui -->
                </div>
            </div>
        </div>
    </div>

    <!-- ============ MODAL HISTÓRICO COMPLETO ============ -->
    <div class="modal-history" id="historyModal">
        <div class="modal-history-content">
            <span class="close-history-modal">&times;</span>
            <h2><i class="fas fa-history"></i> Histórico Completo - Todos os Registos</h2>
            
            <div class="form-row mt-3">
                <div class="form-group-dashboard">
                    <label>Período</label>
                    <select id="historyPeriod" class="form-control">
                        <option value="today">Hoje</option>
                        <option value="week">Esta Semana</option>
                        <option value="month">Este Mês</option>
                        <option value="custom">Personalizado</option>
                    </select>
                </div>
                <div class="form-group-dashboard">
                    <label>Tipo de Evento</label>
                    <select id="historyType" class="form-control">
                        <option value="all">Todos</option>
                        <option value="hours">Horas Trabalhadas</option>
                        <option value="material">Pedidos Material</option>
                        <option value="purchase">Compras</option>
                        <option value="employee">Alterações Empregados</option>
                    </select>
                </div>
            </div>
            
            <div class="activity-log mt-3">
                <div id="historyContent">
                    <!-- Histórico será carregado aqui -->
                </div>
            </div>
        </div>
    </div>

    <!-- ============ DASHBOARD DO PATRÃO ============ -->
    <div class="dashboard boss-dashboard" id="bossDashboard">
        <!-- Top Bar -->
        <div class="top-bar">
            <div class="container top-bar-content">
                <div class="dashboard-brand">
                    <i class="fas fa-crown"></i>
                    <h1>Painel do Patrão - Controlo Total</h1>
                </div>
                <div class="dashboard-info">
                    <div class="user-info">
                        <i class="fas fa-user-circle"></i>
                        <span id="bossUserName">Administrador MAFC</span>
                    </div>
                    <div id="bossCurrentTime" style="font-weight: 600;">10:45 AM</div>
                    <button class="logout-btn" id="bossLogoutBtn">
                        <i class="fas fa-sign-out-alt"></i> Sair
                    </button>
                </div>
            </div>
        </div>

        <!-- Menu Horizontal -->
        <nav class="horizontal-menu">
            <div class="container menu-container">
                <a href="#" class="menu-item active" data-section="overview">
                    <i class="fas fa-tachometer-alt"></i> Visão Geral
                </a>
                <a href="#" class="menu-item" data-section="teams">
                    <i class="fas fa-users"></i> 15 Equipas
                    <span class="menu-badge">15</span>
                </a>
                <a href="#" class="menu-item" data-section="works">
                    <i class="fas fa-hard-hat"></i> Obras Alemanha
                    <span class="menu-badge">8</span>
                </a>
                <a href="#" class="menu-item" data-section="hours">
                    <i class="fas fa-clock"></i> Controlo de Horas
                    <span class="menu-badge" id="bossHoursBadge">42</span>
                </a>
                <a href="#" class="menu-item" data-section="materials">
                    <i class="fas fa-boxes"></i> Pedidos Material
                    <span class="menu-badge" id="bossMaterialsBadge">12</span>
                </a>
                <a href="#" class="menu-item" data-section="purchases">
                    <i class="fas fa-shopping-cart"></i> Compras
                    <span class="menu-badge" id="bossPurchasesBadge">24</span>
                </a>
                <a href="#" class="menu-item" data-section="expenses">
                    <i class="fas fa-euro-sign"></i> Despesas
                </a>
                <a href="#" class="menu-item" data-section="reports">
                    <i class="fas fa-chart-bar"></i> Relatórios
                </a>
                <a href="#" class="menu-item" data-section="accounting">
                    <i class="fas fa-file-invoice-dollar"></i> Contabilidade
                </a>
                <a href="#" class="menu-item" data-section="history" onclick="openHistoryModal()">
                    <i class="fas fa-history"></i> Histórico
                </a>
            </div>
        </nav>

        <!-- Conteúdo -->
        <div class="dashboard-content">
            <!-- Seção Visão Geral -->
            <div class="dashboard-section active" id="overviewSection">
                <div class="stats-row">
                    <div class="stat-card-horizontal">
                        <div class="stat-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-info">
                            <h3>15</h3>
                            <p>Equipas Ativas</p>
                        </div>
                    </div>
                    <div class="stat-card-horizontal">
                        <div class="stat-icon">
                            <i class="fas fa-hard-hat"></i>
                        </div>
                        <div class="stat-info">
                            <h3>42</h3>
                            <p>Trabalhadores</p>
                        </div>
                    </div>
                    <div class="stat-card-horizontal">
                        <div class="stat-icon">
                            <i class="fas fa-euro-sign"></i>
                        </div>
                        <div class="stat-info">
                            <h3>8</h3>
                            <p>Obras Alemanha</p>
                        </div>
                    </div>
                    <div class="stat-card-horizontal">
                        <div class="stat-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="pendingRequestsCount">12</h3>
                            <p>Pedidos Pendentes</p>
                        </div>
                    </div>
                </div>

                <div class="content-grid">
                    <div class="content-card">
                        <div class="card-header">
                            <h3><i class="fas fa-map-marker-alt"></i> Equipas em Tempo Real - Alemanha</h3>
                            <button class="btn-dashboard btn-primary" onclick="refreshLocations()">
                                <i class="fas fa-sync-alt"></i> Atualizar
                            </button>
                        </div>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Equipa</th>
                                    <th>Localização</th>
                                    <th>Obra</th>
                                    <th>Estado</th>
                                    <th>GPS</th>
                                </tr>
                            </thead>
                            <tbody id="bossTeamsTable">
                                <!-- Equipas serão carregadas aqui -->
                            </tbody>
                        </table>
                    </div>

                    <div class="content-card">
                        <div class="card-header">
                            <h3><i class="fas fa-exclamation-circle"></i> Pedidos Urgentes</h3>
                            <button class="btn-dashboard btn-warning" onclick="viewAllRequests()">
                                <i class="fas fa-eye"></i> Ver Todos
                            </button>
                        </div>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Equipa</th>
                                    <th>Material</th>
                                    <th>Quantidade</th>
                                    <th>Urgência</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody id="urgentRequestsTable">
                                <!-- Pedidos urgentes serão carregados aqui -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div class="content-card mt-3">
                    <div class="card-header">
                        <h3><i class="fas fa-history"></i> Actividade Recente</h3>
                        <button class="btn-dashboard btn-info" onclick="openHistoryModal()">
                            <i class="fas fa-expand"></i> Ver Histórico Completo
                        </button>
                    </div>
                    <div class="activity-log" id="bossActivityLog">
                        <!-- Actividade recente será carregada aqui -->
                    </div>
                </div>
            </div>

            <!-- Seção Equipas -->
            <div class="dashboard-section" id="teamsSection">
                <div class="content-card">
                    <div class="card-header">
                        <h3><i class="fas fa-users"></i> Gestão das 15 Equipas</h3>
                        <button class="btn-dashboard btn-primary" onclick="addNewTeam()">
                            <i class="fas fa-plus"></i> Nova Equipa
                        </button>
                    </div>
                    <div class="form-row">
                        <div class="form-group-dashboard">
                            <input type="text" class="form-control" placeholder="Pesquisar equipa..." id="teamSearch">
                        </div>
                        <div class="form-group-dashboard">
                            <select class="form-control" id="teamFilter">
                                <option value="all">Todas as equipas</option>
                                <option value="germany">Alemanha</option>
                                <option value="portugal">Portugal</option>
                            </select>
                        </div>
                    </div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Equipa</th>
                                <th>Chefe</th>
                                <th>Localização</th>
                                <th>Obra</th>
                                <th>Trabalhadores</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="allTeamsTable">
                            <!-- Equipas serão carregadas aqui -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Seção Controlo de Horas -->
            <div class="dashboard-section" id="hoursSection">
                <div class="content-card">
                    <div class="card-header">
                        <h3><i class="fas fa-clock"></i> Controlo de Horas - Todas as Equipas</h3>
                        <button class="btn-dashboard btn-success" onclick="exportHours()">
                            <i class="fas fa-file-export"></i> Exportar
                        </button>
                    </div>
                    
                    <div class="time-tracker">
                        <div class="time-display" id="bossCurrentTimeFull">10:45:23</div>
                        <div class="time-buttons">
                            <button class="btn-dashboard btn-warning" onclick="simulateClockIn()">
                                <i class="fas fa-sign-in-alt"></i> Simular Entrada
                            </button>
                            <button class="btn-dashboard btn-danger" onclick="simulateClockOut()">
                                <i class="fas fa-sign-out-alt"></i> Simular Saída
                            </button>
                        </div>
                    </div>

                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Trabalhador</th>
                                <th>Equipa</th>
                                <th>Entrada</th>
                                <th>Saída</th>
                                <th>Total</th>
                                <th>Banco Horas</th>
                            </tr>
                        </thead>
                        <tbody id="hoursTable">
                            <!-- Horas serão carregadas aqui -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Seção Pedidos de Material -->
            <div class="dashboard-section" id="materialsSection">
                <div class="content-card">
                    <div class="card-header">
                        <h3><i class="fas fa-boxes"></i> Todos os Pedidos de Material</h3>
                        <div class="d-flex gap-2">
                            <button class="btn-dashboard btn-success" onclick="exportMaterialRequests()">
                                <i class="fas fa-file-excel"></i> Exportar
                            </button>
                            <button class="btn-dashboard btn-info" onclick="refreshMaterialRequests()">
                                <i class="fas fa-sync-alt"></i> Atualizar
                            </button>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group-dashboard">
                            <label>Filtrar por Estado</label>
                            <select class="form-control" id="filterMaterialStatus" onchange="filterMaterialRequests()">
                                <option value="all">Todos</option>
                                <option value="pending">Pendentes</option>
                                <option value="approved">Aprovados</option>
                                <option value="rejected">Recusados</option>
                                <option value="delivered">Entregues</option>
                            </select>
                        </div>
                        <div class="form-group-dashboard">
                            <label>Filtrar por Equipa</label>
                            <select class="form-control" id="filterMaterialTeam" onchange="filterMaterialRequests()">
                                <option value="all">Todas as Equipas</option>
                            </select>
                        </div>
                        <div class="form-group-dashboard">
                            <label>Período</label>
                            <select class="form-control" id="filterMaterialPeriod" onchange="filterMaterialRequests()">
                                <option value="today">Hoje</option>
                                <option value="week">Esta Semana</option>
                                <option value="month">Este Mês</option>
                                <option value="all">Todos</option>
                            </select>
                        </div>
                    </div>

                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Data</th>
                                <th>Equipa</th>
                                <th>Material</th>
                                <th>Quantidade</th>
                                <th>Urgência</th>
                                <th>Estado</th>
                                <th>Valor</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="allMaterialRequests">
                            <!-- Pedidos serão carregados aqui -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Seção Compras -->
            <div class="dashboard-section" id="purchasesSection">
                <div class="content-card">
                    <div class="card-header">
                        <h3><i class="fas fa-shopping-cart"></i> Todas as Compras - Histórico Completo</h3>
                        <div class="d-flex gap-2">
                            <button class="btn-dashboard btn-success" onclick="exportPurchases()">
                                <i class="fas fa-file-pdf"></i> Exportar PDF
                            </button>
                            <button class="btn-dashboard btn-primary" onclick="generatePurchaseReport()">
                                <i class="fas fa-chart-pie"></i> Relatório
                            </button>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group-dashboard">
                            <label>Estado</label>
                            <select class="form-control" id="filterPurchaseStatus" onchange="filterPurchases()">
                                <option value="all">Todos</option>
                                <option value="pending">Pendentes</option>
                                <option value="approved">Aprovadas</option>
                                <option value="ordered">Encomendadas</option>
                                <option value="delivered">Entregues</option>
                                <option value="cancelled">Canceladas</option>
                            </select>
                        </div>
                        <div class="form-group-dashboard">
                            <label>Fornecedor</label>
                            <select class="form-control" id="filterPurchaseSupplier" onchange="filterPurchases()">
                                <option value="all">Todos Fornecedores</option>
                            </select>
                        </div>
                        <div class="form-group-dashboard">
                            <label>Período</label>
                            <input type="month" class="form-control" id="filterPurchaseMonth" onchange="filterPurchases()">
                        </div>
                    </div>

                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Nº</th>
                                <th>Data</th>
                                <th>Equipa</th>
                                <th>Material</th>
                                <th>Fornecedor</th>
                                <th>Valor</th>
                                <th>Estado</th>
                                <th>Data Conclusão</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="allPurchasesTable">
                            <!-- Compras serão carregadas aqui -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Seção Contabilidade -->
            <div class="dashboard-section" id="accountingSection">
                <div class="content-card">
                    <div class="card-header">
                        <h3><i class="fas fa-file-invoice-dollar"></i> Contabilidade - Banco de Horas (>160h)</h3>
                        <button class="btn-dashboard btn-success" onclick="exportToAccounting()">
                            <i class="fas fa-file-excel"></i> Exportar Excel
                        </button>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group-dashboard">
                            <label>Mês de Referência</label>
                            <select class="form-control" id="accountingMonth" onchange="loadAccountingData()">
                                <option value="12">Dezembro 2024</option>
                                <option value="11">Novembro 2024</option>
                                <option value="10">Outubro 2024</option>
                            </select>
                        </div>
                        <div class="form-group-dashboard">
                            <label>Filtrar por Equipa</label>
                            <select class="form-control" id="accountingTeam" onchange="loadAccountingData()">
                                <option value="all">Todas as Equipas</option>
                            </select>
                        </div>
                    </div>

                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Trabalhador</th>
                                <th>Equipa</th>
                                <th>Horas Normais</th>
                                <th>Horas Extra</th>
                                <th>Total</th>
                                <th>Banco Horas</th>
                                <th>Valor</th>
                                <th>Estado Pagamento</th>
                            </tr>
                        </thead>
                        <tbody id="accountingTable">
                            <!-- Dados contabilidade serão carregados aqui -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Seção Histórico -->
            <div class="dashboard-section" id="historySection">
                <div class="content-card">
                    <div class="card-header">
                        <h3><i class="fas fa-history"></i> Histórico Completo - Todos os Registos</h3>
                        <button class="btn-dashboard btn-primary" onclick="openHistoryModal()">
                            <i class="fas fa-expand"></i> Ver em Tela Cheia
                        </button>
                    </div>
                    
                    <div class="activity-log">
                        <div id="historyContent">
                            <!-- Histórico será carregado aqui -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ============ DASHBOARD DO CHEFE DE EQUIPA ============ -->
    <div class="dashboard team-dashboard" id="teamDashboard">
        <!-- Top Bar -->
        <div class="top-bar">
            <div class="container top-bar-content">
                <div class="dashboard-brand">
                    <i class="fas fa-hard-hat"></i>
                    <h1>Chefe de Equipa - MAFC Team Control</h1>
                </div>
                <div class="dashboard-info">
                    <div class="user-info">
                        <i class="fas fa-user-hard-hat"></i>
                        <span id="teamUserName">Equipa 01 - Berlin</span>
                    </div>
                    <div id="teamCurrentTime" style="font-weight: 600;">10:45 AM</div>
                    <button class="logout-btn" id="teamLogoutBtn">
                        <i class="fas fa-sign-out-alt"></i> Sair
                    </button>
                </div>
            </div>
        </div>

        <!-- Menu Horizontal -->
        <nav class="horizontal-menu">
            <div class="container menu-container">
                <a href="#" class="menu-item active" data-section="teamOverview">
                    <i class="fas fa-home"></i> Visão da Equipa
                </a>
                <a href="#" class="menu-item" data-section="teamTime">
                    <i class="fas fa-clock"></i> Controlo de Horas
                </a>
                <a href="#" class="menu-item" data-section="teamMaterials">
                    <i class="fas fa-boxes"></i> Pedir Materiais
                </a>
                <a href="#" class="menu-item" data-section="teamEmployees">
                    <i class="fas fa-user-plus"></i> Gestão Empregados
                </a>
                <a href="#" class="menu-item" data-section="teamReports">
                    <i class="fas fa-file-alt"></i> Extrato Mensal
                </a>
                <a href="#" class="menu-item" data-section="teamLocation">
                    <i class="fas fa-map-marker-alt"></i> Localização
                </a>
            </div>
        </nav>

        <!-- Conteúdo -->
        <div class="dashboard-content">
            <!-- Visão da Equipa -->
            <div class="dashboard-section active" id="teamOverviewSection">
                <div class="stats-row">
                    <div class="stat-card-horizontal">
                        <div class="stat-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="teamWorkersCount">5</h3>
                            <p>Trabalhadores</p>
                        </div>
                    </div>
                    <div class="stat-card-horizontal">
                        <div class="stat-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="teamHoursToday">4.5</h3>
                            <p>Horas Hoje</p>
                        </div>
                    </div>
                    <div class="stat-card-horizontal">
                        <div class="stat-icon">
                            <i class="fas fa-box"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="teamPendingMaterials">3</h3>
                            <p>Pedidos Pendentes</p>
                        </div>
                    </div>
                    <div class="stat-card-horizontal">
                        <div class="stat-icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="teamStatus">Online</h3>
                            <p>Estado</p>
                        </div>
                    </div>
                </div>

                <div class="content-grid">
                    <div class="content-card">
                        <div class="card-header">
                            <h3><i class="fas fa-clock"></i> Registos de Hoje</h3>
                            <button class="btn-dashboard btn-primary" onclick="registerAllEntry()">
                                <i class="fas fa-users"></i> Entrada Todos
                            </button>
                        </div>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Trabalhador</th>
                                    <th>Entrada</th>
                                    <th>Saída</th>
                                    <th>Total</th>
                                    <th>WhatsApp</th>
                                </tr>
                            </thead>
                            <tbody id="teamTimeRecords">
                                <!-- Dados serão carregados aqui -->
                            </tbody>
                        </table>
                    </div>

                    <div class="content-card">
                        <div class="card-header">
                            <h3><i class="fas fa-box"></i> Pedidos Recentes</h3>
                            <button class="btn-dashboard btn-success" onclick="showMaterialRequestForm()">
                                <i class="fas fa-plus"></i> Novo Pedido
                            </button>
                        </div>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Material</th>
                                    <th>Quantidade</th>
                                    <th>Data</th>
                                    <th>Estado</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody id="teamMaterialRequests">
                                <!-- Dados serão carregados aqui -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Controlo de Horas -->
            <div class="dashboard-section" id="teamTimeSection">
                <div class="content-card">
                    <div class="card-header">
                        <h3><i class="fas fa-clock"></i> Controlo de Horas Individual</h3>
                        <div class="time-display" style="font-size: 2rem; color: var(--team);" id="teamClock">
                            08:45:23
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group-dashboard">
                            <label>Trabalhador</label>
                            <select id="workerSelect" class="form-control" onchange="loadWorkerWhatsApp()">
                                <option value="">Selecione um trabalhador</option>
                            </select>
                        </div>
                        <div class="form-group-dashboard">
                            <label>WhatsApp</label>
                            <input type="text" id="workerWhatsApp" class="form-control" readonly placeholder="Selecione um trabalhador">
                        </div>
                        <div class="form-group-dashboard">
                            <label>Ação</label>
                            <select id="timeAction" class="form-control">
                                <option value="start">Entrada (Stempel)</option>
                                <option value="end">Saída (Ausstempel)</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button class="btn-dashboard btn-success" onclick="registerIndividualTime()">
                            <i class="fas fa-check"></i> Registar Hora
                        </button>
                        <button class="btn-dashboard btn-primary" onclick="sendWhatsAppReminder()">
                            <i class="fab fa-whatsapp"></i> Lembrar por WhatsApp
                        </button>
                        <button class="btn-dashboard btn-warning" onclick="registerAllTeam('start')">
                            <i class="fas fa-users"></i> Entrada Toda Equipa
                        </button>
                    </div>

                    <h3 class="mt-3 mb-2"><i class="fas fa-history"></i> Histórico do Dia</h3>
                    <table class="data-table" id="dailyTimeRecords">
                        <thead>
                            <tr>
                                <th>Empregado</th>
                                <th>Entrada</th>
                                <th>Saída</th>
                                <th>Horas</th>
                                <th>Extra</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Histórico será carregado aqui -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Gestão de Empregados -->
            <div class="dashboard-section" id="teamEmployeesSection">
                <div class="content-card">
                    <div class="card-header">
                        <h3><i class="fas fa-user-plus"></i> Gestão de Empregados da Equipa</h3>
                        <button class="btn-dashboard btn-success" onclick="openEmployeeModal()">
                            <i class="fas fa-plus"></i> Adicionar Empregado
                        </button>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group-dashboard">
                            <input type="text" id="searchEmployee" class="form-control" placeholder="Pesquisar empregado..." onkeyup="searchEmployees()">
                        </div>
                        <div class="form-group-dashboard">
                            <select id="filterEmployeeStatus" class="form-control" onchange="searchEmployees()">
                                <option value="all">Todos os estados</option>
                                <option value="active">Ativos</option>
                                <option value="inactive">Inativos</option>
                            </select>
                        </div>
                    </div>

                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Nome</th>
                                <th>WhatsApp</th>
                                <th>Cargo</th>
                                <th>Salário</th>
                                <th>Estado</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="teamEmployeesTable">
                            <!-- Empregados serão carregados aqui -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Extrato Mensal -->
            <div class="dashboard-section" id="teamReportsSection">
                <div class="content-card">
                    <div class="card-header">
                        <h3><i class="fas fa-file-invoice"></i> Extrato Mensal de Horas</h3>
                        <button class="btn-dashboard btn-primary" onclick="generateMonthlyReport()">
                            <i class="fas fa-chart-bar"></i> Gerar Relatório
                        </button>
                    </div>

                    <div class="form-row">
                        <div class="form-group-dashboard">
                            <label>Mês/Ano</label>
                            <select id="teamReportMonth" class="form-control" onchange="generateMonthlyReport()">
                                <option value="12-2024">Dezembro 2024</option>
                                <option value="11-2024">Novembro 2024</option>
                                <option value="10-2024">Outubro 2024</option>
                            </select>
                        </div>
                        <div class="form-group-dashboard">
                            <label>Empregado</label>
                            <select id="teamReportEmployee" class="form-control" onchange="generateMonthlyReport()">
                                <option value="all">Todos os Empregados</option>
                            </select>
                        </div>
                    </div>

                    <div class="monthly-report">
                        <div class="report-header">
                            <h4 id="teamReportTitle">Selecione mês e empregado</h4>
                            <span class="badge badge-info" id="teamTotalHours">-- horas</span>
                        </div>
                        
                        <table class="time-sheet-table" id="teamTimeSheetTable">
                            <thead>
                                <tr>
                                    <th>Data</th>
                                    <th>Empregado</th>
                                    <th>Horas</th>
                                    <th>Extra</th>
                                    <th>Total</th>
                                </tr>
                            </thead>
                            <tbody id="teamTimeSheetBody">
                                <!-- Dados do extrato serão carregados aqui -->
                            </tbody>
                        </table>
                        
                        <div class="report-actions">
                            <button class="btn-dashboard btn-primary" onclick="openMonthlyReportModal()">
                                <i class="fas fa-expand"></i> Ver Extrato Completo
                            </button>
                            <button class="btn-dashboard btn-success" onclick="printTeamReport()">
                                <i class="fas fa-print"></i> Imprimir
                            </button>
                            <button class="btn-dashboard btn-whatsapp" onclick="sendTeamReportWhatsApp()">
                                <i class="fab fa-whatsapp"></i> WhatsApp
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Pedir Materiais -->
            <div class="dashboard-section" id="teamMaterialsSection">
                <div class="content-card">
                    <div class="card-header">
                        <h3><i class="fas fa-boxes"></i> Pedido de Material para Obra</h3>
                        <span class="badge badge-info">Envia automaticamente para Compras</span>
                    </div>

                    <div class="categories-grid">
                        <div class="category-card" onclick="selectCategory('construction')">
                            <i class="fas fa-brick"></i>
                            <h4>Materiais Construção</h4>
                            <p>Cimento, areia, brita...</p>
                        </div>
                        <div class="category-card" onclick="selectCategory('machines')">
                            <i class="fas fa-tractor"></i>
                            <h4>Máquinas</h4>
                            <p>Retroescavadoras, camiões...</p>
                        </div>
                        <div class="category-card" onclick="selectCategory('tools')">
                            <i class="fas fa-tools"></i>
                            <h4>Ferramentas</h4>
                            <p>Equipamentos especializados</p>
                        </div>
                        <div class="category-card" onclick="selectCategory('consumables')">
                            <i class="fas fa-gas-pump"></i>
                            <h4>Consumíveis</h4>
                            <p>Gasóleo, óleo, EPIs...</p>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group-dashboard">
                            <label>Categoria</label>
                            <select id="materialCategory" class="form-control" onchange="loadMaterials()">
                                <option value="construction">Materiais de Construção</option>
                                <option value="machines">Máquinas e Equipamentos</option>
                                <option value="tools">Ferramentas</option>
                                <option value="consumables">Consumíveis</option>
                            </select>
                        </div>
                        <div class="form-group-dashboard">
                            <label>Material</label>
                            <select id="materialSelect" class="form-control">
                                <option value="">Selecione um material</option>
                            </select>
                        </div>
                        <div class="form-group-dashboard">
                            <label>Quantidade</label>
                            <input type="number" id="materialQuantity" class="form-control" min="1" value="1">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group-dashboard">
                            <label>Unidade</label>
                            <select id="materialUnit" class="form-control">
                                <option value="sacos">sacos</option>
                                <option value="ton">toneladas</option>
                                <option value="m3">m³</option>
                                <option value="litros">litros</option>
                            </select>
                        </div>
                        <div class="form-group-dashboard">
                            <label>Urgência</label>
                            <select id="materialUrgency" class="form-control">
                                <option value="normal">Normal (1-2 semanas)</option>
                                <option value="urgent">Urgente (3-5 dias)</option>
                                <option value="critical">Crítico (24-48h)</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group-dashboard">
                        <label>Observações</label>
                        <textarea id="materialNotes" class="form-control" rows="3" placeholder="Detalhes sobre o material necessário..."></textarea>
                    </div>

                    <div class="form-actions">
                        <button class="btn-dashboard btn-success" onclick="submitMaterialRequest()">
                            <i class="fas fa-paper-plane"></i> Enviar para Compras
                        </button>
                        <button class="btn-dashboard btn-whatsapp" onclick="submitMaterialRequestWhatsApp()">
                            <i class="fab fa-whatsapp"></i> WhatsApp Compras
                        </button>
                        <button class="btn-dashboard btn-primary" onclick="addCustomMaterial()">
                            <i class="fas fa-plus"></i> Material Personalizado
                        </button>
                    </div>
                </div>
            </div>

            <!-- Localização -->
            <div class="dashboard-section" id="teamLocationSection">
                <div class="content-card">
                    <div class="card-header">
                        <h3><i class="fas fa-map-marker-alt"></i> Localização GPS da Equipa</h3>
                        <span class="badge badge-success">Patrão vê em tempo real</span>
                    </div>

                    <div class="gps-tracker">
                        <div class="gps-info">
                            <i class="fas fa-satellite" style="font-size: 2.5rem;"></i>
                            <div class="gps-coordinates">
                                <div>Latitude: <strong id="gpsLat">52.5200° N</strong></div>
                                <div>Longitude: <strong id="gpsLng">13.4050° E</strong></div>
                            </div>
                        </div>
                        <div class="text-center">
                            <p>Localização atual: <strong>Berlim, Kreuzberg - Obra de Saneamento</strong></p>
                            <div class="time-buttons">
                                <button class="btn-dashboard btn-success" onclick="updateGPSLocation()">
                                    <i class="fas fa-sync-alt"></i> Atualizar Localização
                                </button>
                                <button class="btn-dashboard btn-primary" onclick="sendLocationToBoss()">
                                    <i class="fas fa-paper-plane"></i> Enviar ao Patrão
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ============ DASHBOARD DE COMPRAS ============ -->
    <div class="dashboard purchase-dashboard" id="purchaseDashboard">
        <!-- Top Bar -->
        <div class="top-bar">
            <div class="container top-bar-content">
                <div class="dashboard-brand">
                    <i class="fas fa-shopping-cart"></i>
                    <h1>Responsável de Compras - MAFC</h1>
                </div>
                <div class="dashboard-info">
                    <div class="user-info">
                        <i class="fas fa-user-tie"></i>
                        <span id="purchaseUserName">Departamento Compras</span>
                    </div>
                    <div id="purchaseCurrentTime" style="font-weight: 600;">10:45 AM</div>
                    <button class="logout-btn" id="purchaseLogoutBtn">
                        <i class="fas fa-sign-out-alt"></i> Sair
                    </button>
                </div>
            </div>
        </div>

        <!-- Menu Horizontal -->
        <nav class="horizontal-menu">
            <div class="container menu-container">
                <a href="#" class="menu-item active" data-section="purchaseOverview">
                    <i class="fas fa-tachometer-alt"></i> Visão Geral
                </a>
                <a href="#" class="menu-item" data-section="pendingRequests">
                    <i class="fas fa-clipboard-list"></i> Pedidos Pendentes
                    <span class="menu-badge" id="pendingRequestsBadge">12</span>
                </a>
                <a href="#" class="menu-item" data-section="approvedPurchases">
                    <i class="fas fa-check-circle"></i> Compras Aprovadas
                    <span class="menu-badge" id="approvedPurchasesBadge">24</span>
                </a>
                <a href="#" class="menu-item" data-section="suppliers">
                    <i class="fas fa-truck"></i> Fornecedores
                </a>
                <a href="#" class="menu-item" data-section="budget">
                    <i class="fas fa-chart-pie"></i> Orçamento
                </a>
                <a href="#" class="menu-item" data-section="purchaseReports">
                    <i class="fas fa-file-invoice"></i> Faturas
                </a>
                <a href="#" class="menu-item" data-section="purchaseHistory" onclick="openPurchaseHistory()">
                    <i class="fas fa-history"></i> Histórico
                </a>
            </div>
        </nav>

        <!-- Conteúdo -->
        <div class="dashboard-content">
            <!-- Visão Geral Compras -->
            <div class="dashboard-section active" id="purchaseOverviewSection">
                <div class="stats-row">
                    <div class="stat-card-horizontal">
                        <div class="stat-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="pendingCount">12</h3>
                            <p>Pedidos Pendentes</p>
                        </div>
                    </div>
                    <div class="stat-card-horizontal">
                        <div class="stat-icon">
                            <i class="fas fa-check"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="approvedCount">24</h3>
                            <p>Compras Aprovadas</p>
                        </div>
                    </div>
                    <div class="stat-card-horizontal">
                        <div class="stat-icon">
                            <i class="fas fa-euro-sign"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="monthBudget">18.5K</h3>
                            <p>Orçamento Mês (€)</p>
                        </div>
                    </div>
                    <div class="stat-card-horizontal">
                        <div class="stat-icon">
                            <i class="fas fa-truck"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="suppliersCount">8</h3>
                            <p>Fornecedores Ativos</p>
                        </div>
                    </div>
                </div>

                <div class="content-grid">
                    <div class="content-card">
                        <div class="card-header">
                            <h3><i class="fas fa-exclamation-triangle"></i> Pedidos Urgentes</h3>
                            <button class="btn-dashboard btn-warning" onclick="processAllUrgent()">
                                <i class="fas fa-bolt"></i> Processar Todos
                            </button>
                        </div>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Equipa</th>
                                    <th>Material</th>
                                    <th>Quantidade</th>
                                    <th>Urgência</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody id="urgentPurchaseRequests">
                                <!-- Pedidos urgentes serão carregados aqui -->
                            </tbody>
                        </table>
                    </div>

                    <div class="content-card">
                        <div class="card-header">
                            <h3><i class="fas fa-shopping-cart"></i> Últimas Compras</h3>
                            <button class="btn-dashboard btn-primary" onclick="newPurchase()">
                                <i class="fas fa-plus"></i> Nova Compra
                            </button>
                        </div>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Nº Encomenda</th>
                                    <th>Fornecedor</th>
                                    <th>Material</th>
                                    <th>Valor</th>
                                    <th>Entrega</th>
                                    <th>WhatsApp</th>
                                </tr>
                            </thead>
                            <tbody id="recentPurchases">
                                <!-- Compras recentes serão carregadas aqui -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Pedidos Pendentes -->
            <div class="dashboard-section" id="pendingRequestsSection">
                <div class="content-card">
                    <div class="card-header">
                        <h3><i class="fas fa-clipboard-list"></i> Todos os Pedidos Pendentes</h3>
                        <div>
                            <button class="btn-dashboard btn-success" onclick="approveAll()">
                                <i class="fas fa-check-double"></i> Aprovar Todos
                            </button>
                            <button class="btn-dashboard btn-danger" onclick="rejectAll()">
                                <i class="fas fa-ban"></i> Recusar Todos
                            </button>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group-dashboard">
                            <label>Filtrar por Equipa</label>
                            <select id="filterByTeam" class="form-control" onchange="filterPendingRequests()">
                                <option value="all">Todas as Equipas</option>
                            </select>
                        </div>
                        <div class="form-group-dashboard">
                            <label>Filtrar por Urgência</label>
                            <select id="filterByUrgency" class="form-control" onchange="filterPendingRequests()">
                                <option value="all">Todas</option>
                                <option value="critical">Crítico</option>
                                <option value="urgent">Urgente</option>
                            </select>
                        </div>
                        <div class="form-group-dashboard">
                            <label>Pesquisar Material</label>
                            <input type="text" id="searchMaterial" class="form-control" placeholder="Nome do material..." onkeyup="filterPendingRequests()">
                        </div>
                    </div>

                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Data</th>
                                <th>Equipa</th>
                                <th>Material</th>
                                <th>Quantidade</th>
                                <th>Urgência</th>
                                <th>Pedido por</th>
                                <th>WhatsApp</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="allPendingRequests">
                            <!-- Pedidos pendentes serão carregados aqui -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Compras Aprovadas -->
            <div class="dashboard-section" id="approvedPurchasesSection">
                <div class="content-card">
                    <div class="card-header">
                        <h3><i class="fas fa-check-circle"></i> Compras Aprovadas e Encomendadas</h3>
                        <button class="btn-dashboard btn-primary" onclick="registerNewOrder()">
                            <i class="fas fa-plus"></i> Nova Encomenda
                        </button>
                    </div>

                    <div class="form-row">
                        <div class="form-group-dashboard">
                            <label>Fornecedor</label>
                            <select id="supplierSelect" class="form-control" onchange="filterApprovedPurchases()">
                                <option value="all">Todos Fornecedores</option>
                            </select>
                        </div>
                        <div class="form-group-dashboard">
                            <label>Estado</label>
                            <select id="orderStatus" class="form-control" onchange="filterApprovedPurchases()">
                                <option value="all">Todos</option>
                                <option value="ordered">Encomendado</option>
                                <option value="delivered">Entregue</option>
                                <option value="cancelled">Cancelado</option>
                            </select>
                        </div>
                    </div>

                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Nº Encomenda</th>
                                <th>Fornecedor</th>
                                <th>Material</th>
                                <th>Quantidade</th>
                                <th>Valor</th>
                                <th>Data Entrega</th>
                                <th>Estado</th>
                                <th>WhatsApp</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="approvedPurchasesTable">
                            <!-- Compras aprovadas serão carregadas aqui -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Histórico Compras -->
            <div class="dashboard-section" id="purchaseHistorySection">
                <div class="content-card">
                    <div class="card-header">
                        <h3><i class="fas fa-history"></i> Histórico Completo de Compras</h3>
                        <button class="btn-dashboard btn-success" onclick="exportPurchaseHistory()">
                            <i class="fas fa-file-excel"></i> Exportar
                        </button>
                    </div>

                    <div class="form-row">
                        <div class="form-group-dashboard">
                            <label>Período</label>
                            <select id="purchaseHistoryPeriod" class="form-control" onchange="loadPurchaseHistory()">
                                <option value="month">Este Mês</option>
                                <option value="quarter">Este Trimestre</option>
                                <option value="year">Este Ano</option>
                                <option value="all">Todo o Histórico</option>
                            </select>
                        </div>
                        <div class="form-group-dashboard">
                            <label>Fornecedor</label>
                            <select id="purchaseHistorySupplier" class="form-control" onchange="loadPurchaseHistory()">
                                <option value="all">Todos Fornecedores</option>
                            </select>
                        </div>
                    </div>

                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Data</th>
                                <th>Nº Encomenda</th>
                                <th>Fornecedor</th>
                                <th>Material</th>
                                <th>Valor</th>
                                <th>Estado</th>
                                <th>Data Conclusão</th>
                                <th>Registado por</th>
                            </tr>
                        </thead>
                        <tbody id="purchaseHistoryTable">
                            <!-- Histórico será carregado aqui -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- ============ DASHBOARD ESCRITÓRIO ============ -->
    <div class="dashboard office-dashboard" id="officeDashboard">
        <!-- Top Bar -->
        <div class="top-bar">
            <div class="container top-bar-content">
                <div class="dashboard-brand">
                    <i class="fas fa-building"></i>
                    <h1>Escritório - MAFC Team Control</h1>
                </div>
                <div class="dashboard-info">
                    <div class="user-info">
                        <i class="fas fa-user-tie"></i>
                        <span id="officeUserName">Empregado Escritório</span>
                    </div>
                    <div id="officeCurrentTime" style="font-weight: 600;">10:45 AM</div>
                    <button class="logout-btn" id="officeLogoutBtn">
                        <i class="fas fa-sign-out-alt"></i> Sair
                    </button>
                </div>
            </div>
        </div>

        <!-- Menu Horizontal -->
        <nav class="horizontal-menu">
            <div class="container menu-container">
                <a href="#" class="menu-item active" data-section="officeTime">
                    <i class="fas fa-clock"></i> Marcar Horas
                </a>
                <a href="#" class="menu-item" data-section="officeReports">
                    <i class="fas fa-file-alt"></i> Meu Extrato
                </a>
                <a href="#" class="menu-item" data-section="officeDocuments">
                    <i class="fas fa-folder"></i> Documentos
                </a>
                <a href="#" class="menu-item" data-section="officeRequests">
                    <i class="fas fa-hand-paper"></i> Pedidos
                </a>
            </div>
        </nav>

        <!-- Conteúdo -->
        <div class="dashboard-content">
            <!-- Marcar Horas -->
            <div class="dashboard-section active" id="officeTimeSection">
                <div class="content-card">
                    <div class="card-header">
                        <h3><i class="fas fa-clock"></i> Controlo de Horas - Escritório</h3>
                        <div class="time-display" style="font-size: 2rem; color: var(--office);" id="officeClock">
                            08:45:23
                        </div>
                    </div>

                    <div class="stats-row">
                        <div class="stat-card-horizontal">
                            <div class="stat-icon">
                                <i class="fas fa-sign-in-alt"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="officeTodayEntry">--:--</h3>
                                <p>Entrada Hoje</p>
                            </div>
                        </div>
                        <div class="stat-card-horizontal">
                            <div class="stat-icon">
                                <i class="fas fa-sign-out-alt"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="officeTodayExit">--:--</h3>
                                <p>Saída Hoje</p>
                            </div>
                        </div>
                        <div class="stat-card-horizontal">
                            <div class="stat-icon">
                                <i class="fas fa-business-time"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="officeMonthHours">0</h3>
                                <p>Horas Mês</p>
                            </div>
                        </div>
                        <div class="stat-card-horizontal">
                            <div class="stat-icon">
                                <i class="fas fa-coffee"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="officeStatus">Ausente</h3>
                                <p>Estado</p>
                            </div>
                        </div>
                    </div>

                    <div class="time-buttons mt-3">
                        <button class="btn-dashboard btn-success" style="padding: 1rem 2rem; font-size: 1.1rem;" onclick="officeClockIn()">
                            <i class="fas fa-sign-in-alt"></i> MARCAR ENTRADA
                        </button>
                        <button class="btn-dashboard btn-danger" style="padding: 1rem 2rem; font-size: 1.1rem;" onclick="officeClockOut()">
                            <i class="fas fa-sign-out-alt"></i> MARCAR SAÍDA
                        </button>
                        <button class="btn-dashboard btn-warning" style="padding: 1rem 2rem; font-size: 1.1rem;" onclick="officePause()">
                            <i class="fas fa-coffee"></i> PAUSA
                        </button>
                    </div>

                    <h3 class="mt-3 mb-2"><i class="fas fa-history"></i> Registos da Semana</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Data</th>
                                <th>Entrada</th>
                                <th>Saída</th>
                                <th>Pausa</th>
                                <th>Total</th>
                            </tr>
                        </thead>
                        <tbody id="officeWeekRecords">
                            <!-- Registos serão carregados aqui -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Meu Extrato -->
            <div class="dashboard-section" id="officeReportsSection">
                <div class="content-card">
                    <div class="card-header">
                        <h3><i class="fas fa-file-invoice"></i> Meu Extrato Mensal</h3>
                        <button class="btn-dashboard btn-primary" onclick="generateOfficeReport()">
                            <i class="fas fa-sync-alt"></i> Atualizar
                        </button>
                    </div>

                    <div class="form-row">
                        <div class="form-group-dashboard">
                            <label>Mês/Ano</label>
                            <select id="officeReportMonth" class="form-control" onchange="generateOfficeReport()">
                                <option value="12-2024">Dezembro 2024</option>
                                <option value="11-2024">Novembro 2024</option>
                                <option value="10-2024">Outubro 2024</option>
                            </select>
                        </div>
                    </div>

                    <div class="monthly-report">
                        <div class="report-header">
                            <h4 id="officeReportTitle">Extrato - Dezembro 2024</h4>
                            <span class="badge badge-success" id="officeTotalHours">160 horas</span>
                        </div>
                        
                        <table class="time-sheet-table">
                            <thead>
                                <tr>
                                    <th>Dia</th>
                                    <th>Entrada</th>
                                    <th>Saída</th>
                                    <th>Horas</th>
                                    <th>Extra</th>
                                </tr>
                            </thead>
                            <tbody id="officeReportBody">
                                <!-- Dados do extrato serão carregados aqui -->
                            </tbody>
                            <tfoot>
                                <tr style="background: var(--gray-100); font-weight: bold;">
                                    <td colspan="3">TOTAL DO MÊS</td>
                                    <td id="officeMonthTotal">160h</td>
                                    <td id="officeMonthExtra">12h</td>
                                </tr>
                            </tfoot>
                        </table>
                        
                        <div class="report-actions">
                            <button class="btn-dashboard btn-primary" onclick="printOfficeReport()">
                                <i class="fas fa-print"></i> Imprimir (Drucker)
                            </button>
                            <button class="btn-dashboard btn-success" onclick="emailOfficeReport()">
                                <i class="fas fa-envelope"></i> Email Contabilidade
                            </button>
                            <button class="btn-dashboard btn-whatsapp" onclick="whatsAppOfficeReport()">
                                <i class="fab fa-whatsapp"></i> WhatsApp
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ============ SISTEMA COMPLETO MAFC ============
        
        // Dados do Sistema
        const MAFCSystem = {
            // Credenciais de acesso
            credentials: {
                // PATRÃO/ADMIN - Acesso total de qualquer país
                boss: [
                    { code: 'mafc', password: '1234', name: 'Administrador MAFC' },
                    { code: 'patrao', password: 'admin123', name: 'Patrão Portugal' },
                    { code: 'admin', password: 'mafc2024', name: 'Administrador Geral' }
                ],
                
                // CHEFES DE EQUIPA (15 equipas)
                team: [
                    { code: 'equipa01', password: '1234', name: 'João Silva', team: 'Equipa 01 - Berlin' },
                    { code: 'equipa02', password: '1234', name: 'Carlos Mendes', team: 'Equipa 02 - Hamburg' },
                    { code: 'equipa03', password: '1234', name: 'Miguel Santos', team: 'Equipa 03 - Munich' }
                ],
                
                // RESPONSÁVEL DE COMPRAS
                purchase: [
                    { code: 'compras', password: '1234', name: 'Responsável Compras' },
                    { code: 'compras1', password: 'mafc123', name: 'Departamento Compras' }
                ],
                
                // ESCRITÓRIO
                office: [
                    { code: 'escritorio', password: '1234', name: 'Maria Silva', department: 'Administração' },
                    { code: 'contabilidade', password: '1234', name: 'Ana Costa', department: 'Contabilidade' }
                ]
            },
            
            // Dados das equipas
            teams: [
                { 
                    id: 1, 
                    name: 'Equipa 01 - Berlin', 
                    leader: 'João Silva', 
                    location: 'Berlim, Kreuzberg', 
                    country: 'germany',
                    workers: 5, 
                    status: 'working', 
                    gps: '52.5200° N, 13.4050° E',
                    currentWork: 'Saneamento Urbano',
                    startDate: '2024-01-15'
                },
                { 
                    id: 2, 
                    name: 'Equipa 02 - Hamburg', 
                    leader: 'Carlos Mendes', 
                    location: 'Hamburgo, Centro', 
                    country: 'germany',
                    workers: 3, 
                    status: 'working', 
                    gps: '53.5511° N, 9.9937° E',
                    currentWork: 'Pavimentação',
                    startDate: '2024-02-10'
                },
                { 
                    id: 3, 
                    name: 'Equipa 03 - Munich', 
                    leader: 'Miguel Santos', 
                    location: 'Munique, Centro', 
                    country: 'germany',
                    workers: 4, 
                    status: 'working', 
                    gps: '48.1351° N, 11.5820° E',
                    currentWork: 'Redes Fibra Óptica',
                    startDate: '2024-01-20'
                }
            ],
            
            // Empregados por equipa
            employees: {
                'Equipa 01 - Berlin': [
                    { id: 1, name: 'João Silva', whatsapp: '+351912345678', position: 'Chefe', salary: 2500, status: 'active', startDate: '2020-01-15' },
                    { id: 2, name: 'Carlos Mendes', whatsapp: '+351912345679', position: 'Trabalhador', salary: 1200, status: 'active', startDate: '2022-03-10' },
                    { id: 3, name: 'Miguel Santos', whatsapp: '+351912345680', position: 'Especialista', salary: 1800, status: 'active', startDate: '2021-06-22' }
                ],
                'Equipa 02 - Hamburg': [
                    { id: 4, name: 'António Oliveira', whatsapp: '+351912345681', position: 'Chefe', salary: 2500, status: 'active', startDate: '2019-11-05' },
                    { id: 5, name: 'Pedro Costa', whatsapp: '+351912345682', position: 'Trabalhador', salary: 1200, status: 'active', startDate: '2023-01-15' }
                ],
                'Equipa 03 - Munich': [
                    { id: 6, name: 'Ricardo Silva', whatsapp: '+351912345683', position: 'Chefe', salary: 2500, status: 'active', startDate: '2018-05-20' }
                ]
            },
            
            // Registos de horas
            timeRecords: {
                'Equipa 01 - Berlin': {},
                'Equipa 02 - Hamburg': {},
                'Equipa 03 - Munich': {},
                'Escritório': {}
            },
            
            // Materiais e categorias
            materials: {
                construction: [
                    { id: 1, name: 'Cimento', unit: 'sacos', averagePrice: 5 },
                    { id: 2, name: 'Areia', unit: 'm³', averagePrice: 25 },
                    { id: 3, name: 'Brita', unit: 'm³', averagePrice: 30 },
                    { id: 4, name: 'Tijolos', unit: 'unidades', averagePrice: 0.5 },
                    { id: 5, name: 'Vergalhões', unit: 'kg', averagePrice: 1.2 }
                ],
                machines: [
                    { id: 6, name: 'Retroescavadora', unit: 'horas', averagePrice: 60 },
                    { id: 7, name: 'Compactadora', unit: 'horas', averagePrice: 40 },
                    { id: 8, name: 'Betoneira', unit: 'horas', averagePrice: 25 }
                ],
                tools: [
                    { id: 9, name: 'Martelo Pneumático', unit: 'unidades', averagePrice: 250 },
                    { id: 10, name: 'Cortadora de Pavimento', unit: 'unidades', averagePrice: 180 },
                    { id: 11, name: 'Serra Circular', unit: 'unidades', averagePrice: 120 }
                ],
                consumables: [
                    { id: 12, name: 'Gasóleo', unit: 'litros', averagePrice: 1.6 },
                    { id: 13, name: 'Óleo Motor', unit: 'litros', averagePrice: 8 },
                    { id: 14, name: 'Luvas de Segurança', unit: 'pares', averagePrice: 3 },
                    { id: 15, name: 'Capacetes', unit: 'unidades', averagePrice: 15 }
                ]
            },
            
            // Fornecedores
            suppliers: [
                { id: 1, name: 'Fornecedor A', whatsapp: '+351912345700', email: 'fornecedora@mail.com', specialty: 'Materiais Construção' },
                { id: 2, name: 'Fornecedor B', whatsapp: '+351912345701', email: 'fornecedorb@mail.com', specialty: 'Máquinas' },
                { id: 3, name: 'Fornecedor C', whatsapp: '+351912345702', email: 'fornecedorc@mail.com', specialty: 'Ferramentas' }
            ],
            
            // Pedidos de material
            materialRequests: [],
            
            // Compras aprovadas
            purchases: [],
            
            // Histórico de atividades
            activityLog: [],
            
            // Último ID usado
            lastId: {
                employee: 15,
                materialRequest: 0,
                purchase: 0,
                activity: 0
            }
        };
        
        // Usuário atual
        let currentUser = null;
        let editingEmployeeId = null;
        let currentPurchaseId = null;
        
        // ============ FUNÇÕES DE LOGIN ============
        document.getElementById('openLogin').addEventListener('click', (e) => {
            e.preventDefault();
            document.getElementById('loginModal').style.display = 'flex';
        });
        
        document.querySelector('.close-modal').addEventListener('click', () => {
            document.getElementById('loginModal').style.display = 'none';
        });
        
        window.addEventListener('click', (e) => {
            if (e.target === document.getElementById('loginModal')) {
                document.getElementById('loginModal').style.display = 'none';
            }
        });
        
        document.getElementById('loginForm').addEventListener('submit', (e) => {
            e.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const role = document.getElementById('role').value;
            
            let userFound = null;
            
            // Verificar credenciais baseado no tipo de acesso
            if (role === 'boss') {
                userFound = MAFCSystem.credentials.boss.find(u => 
                    u.code === username && u.password === password
                );
            } else if (role === 'team') {
                userFound = MAFCSystem.credentials.team.find(u => 
                    u.code === username && u.password === password
                );
            } else if (role === 'purchase') {
                userFound = MAFCSystem.credentials.purchase.find(u => 
                    u.code === username && u.password === password
                );
            } else if (role === 'office') {
                userFound = MAFCSystem.credentials.office.find(u => 
                    u.code === username && u.password === password
                );
            }
            
            if (userFound) {
                currentUser = { ...userFound, role };
                loginSuccess();
            } else {
                alert('❌ Credenciais incorretas! Utilize:\n\nPATRÃO: mafc / 1234\nCHEFE: equipa01 / 1234\nCOMPRAS: compras / 1234\nESCRITÓRIO: escritorio / 1234');
            }
        });
        
        function loginSuccess() {
            document.getElementById('loginModal').style.display = 'none';
            document.getElementById('publicWebsite').style.display = 'none';
            
            // Registrar atividade
            logActivity('login', `${currentUser.name} entrou no sistema`, currentUser.role);
            
            // Mostrar dashboard apropriado
            if (currentUser.role === 'boss') {
                showBossDashboard();
            } else if (currentUser.role === 'team') {
                showTeamDashboard();
            } else if (currentUser.role === 'purchase') {
                showPurchaseDashboard();
            } else if (currentUser.role === 'office') {
                showOfficeDashboard();
            }
            
            // Inicializar dados
            initializeDashboard();
        }
        
        // ============ FUNÇÕES DE LOG DE ATIVIDADES ============
        function logActivity(type, description, userRole = null) {
            const activity = {
                id: ++MAFCSystem.lastId.activity,
                timestamp: new Date().toISOString(),
                type: type,
                description: description,
                user: currentUser ? currentUser.name : 'Sistema',
                userRole: userRole || (currentUser ? currentUser.role : 'system'),
                details: {}
            };
            
            MAFCSystem.activityLog.unshift(activity);
            
            // Manter apenas os últimos 1000 registos
            if (MAFCSystem.activityLog.length > 1000) {
                MAFCSystem.activityLog.pop();
            }
            
            // Atualizar painel do patrão se estiver ativo
            if (document.getElementById('bossDashboard').style.display === 'block') {
                updateBossActivityLog();
            }
            
            return activity;
        }
        
        // ============ DASHBOARD DO PATRÃO ============
        function showBossDashboard() {
            document.getElementById('bossDashboard').style.display = 'block';
            document.getElementById('bossUserName').textContent = currentUser.name;
            
            // Atualizar menu ativo
            updateActiveMenu('boss');
            
            // Carregar dados
            loadBossData();
            updateBossActivityLog();
        }
        
        function loadBossData() {
            // Carregar equipas
            const teamsTable = document.getElementById('bossTeamsTable');
            teamsTable.innerHTML = '';
            
            MAFCSystem.teams.forEach(team => {
                const statusBadge = team.status === 'working' ? 
                    '<span class="badge badge-success">A Trabalhar</span>' :
                    '<span class="badge badge-warning">Parado</span>';
                
                const row = `
                    <tr>
                        <td><strong>${team.name}</strong></td>
                        <td>${team.location}</td>
                        <td>${team.currentWork}</td>
                        <td>${statusBadge}</td>
                        <td>${team.gps.split(',')[0]}</td>
                    </tr>
                `;
                teamsTable.innerHTML += row;
            });
            
            // Carregar todas as equipas
            const allTeamsTable = document.getElementById('allTeamsTable');
            const teamFilter = document.getElementById('teamFilter');
            teamFilter.innerHTML = '<option value="all">Todas as equipas</option>';
            
            allTeamsTable.innerHTML = '';
            
            MAFCSystem.teams.forEach(team => {
                // Adicionar ao filtro
                const option = document.createElement('option');
                option.value = team.name;
                option.textContent = team.name;
                teamFilter.appendChild(option);
                
                const row = `
                    <tr>
                        <td>#${team.id.toString().padStart(3, '0')}</td>
                        <td><strong>${team.name}</strong></td>
                        <td>${team.leader}</td>
                        <td>${team.location}</td>
                        <td>${team.currentWork}</td>
                        <td>${team.workers} trabalhadores</td>
                        <td>
                            <button class="btn-dashboard btn-primary btn-sm" onclick="viewTeamDetails(${team.id})">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn-dashboard btn-warning btn-sm" onclick="editTeam(${team.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                        </td>
                    </tr>
                `;
                allTeamsTable.innerHTML += row;
            });
            
            // Carregar pedidos urgentes
            loadUrgentRequests();
            
            // Carregar todos os pedidos de material
            loadAllMaterialRequests();
            
            // Carregar todas as compras
            loadAllPurchases();
            
            // Carregar dados contabilidade
            loadAccountingData();
        }
        
        function updateBossActivityLog() {
            const activityLog = document.getElementById('bossActivityLog');
            if (!activityLog) return;
            
            const recentActivities = MAFCSystem.activityLog.slice(0, 10);
            activityLog.innerHTML = '';
            
            recentActivities.forEach(activity => {
                const date = new Date(activity.timestamp);
                const timeString = date.toLocaleTimeString('pt-PT', { hour: '2-digit', minute: '2-digit' });
                
                let icon = 'fa-info-circle';
                let color = 'var(--info)';
                
                switch(activity.type) {
                    case 'login': icon = 'fa-sign-in-alt'; color = 'var(--success)'; break;
                    case 'logout': icon = 'fa-sign-out-alt'; color = 'var(--danger)'; break;
                    case 'hours': icon = 'fa-clock'; color = 'var(--warning)'; break;
                    case 'material': icon = 'fa-box'; color = 'var(--accent)'; break;
                    case 'purchase': icon = 'fa-shopping-cart'; color = 'var(--purchase)'; break;
                    case 'employee': icon = 'fa-user'; color = 'var(--team)'; break;
                }
                
                const activityItem = `
                    <div class="activity-item">
                        <div class="activity-icon" style="background: ${color}20; color: ${color};">
                            <i class="fas ${icon}"></i>
                        </div>
                        <div style="flex: 1;">
                            <div style="font-weight: 600;">${activity.description}</div>
                            <div style="font-size: 0.85rem; color: var(--gray-600);">
                                <i class="far fa-clock"></i> ${timeString} | 
                                <i class="fas fa-user"></i> ${activity.user}
                            </div>
                        </div>
                    </div>
                `;
                
                activityLog.innerHTML += activityItem;
            });
        }
        
        function loadUrgentRequests() {
            const urgentTable = document.getElementById('urgentRequestsTable');
            const urgentRequests = MAFCSystem.materialRequests.filter(r => r.urgency === 'critical' && r.status === 'pending');
            
            urgentTable.innerHTML = '';
            
            if (urgentRequests.length === 0) {
                urgentTable.innerHTML = `
                    <tr>
                        <td colspan="5" class="text-center">Sem pedidos urgentes no momento</td>
                    </tr>
                `;
                return;
            }
            
            urgentRequests.forEach(request => {
                const row = `
                    <tr>
                        <td>${request.team}</td>
                        <td>${request.material}</td>
                        <td>${request.quantity} ${request.unit}</td>
                        <td><span class="badge badge-danger">CRÍTICO</span></td>
                        <td>
                            <button class="btn-dashboard btn-success btn-sm" onclick="approveRequest(${request.id})">
                                <i class="fas fa-check"></i>
                            </button>
                            <button class="btn-dashboard btn-danger btn-sm" onclick="rejectRequest(${request.id})">
                                <i class="fas fa-times"></i>
                            </button>
                        </td>
                    </tr>
                `;
                urgentTable.innerHTML += row;
            });
            
            // Atualizar contador
            document.getElementById('pendingRequestsCount').textContent = urgentRequests.length;
        }
        
        function loadAllMaterialRequests() {
            const table = document.getElementById('allMaterialRequests');
            const teamSelect = document.getElementById('filterMaterialTeam');
            
            // Limpar e preencher filtro de equipas
            teamSelect.innerHTML = '<option value="all">Todas as Equipas</option>';
            MAFCSystem.teams.forEach(team => {
                const option = document.createElement('option');
                option.value = team.name;
                option.textContent = team.name;
                teamSelect.appendChild(option);
            });
            
            updateMaterialRequestsTable();
        }
        
        function filterMaterialRequests() {
            updateMaterialRequestsTable();
        }
        
        function updateMaterialRequestsTable() {
            const table = document.getElementById('allMaterialRequests');
            const statusFilter = document.getElementById('filterMaterialStatus').value;
            const teamFilter = document.getElementById('filterMaterialTeam').value;
            const periodFilter = document.getElementById('filterMaterialPeriod').value;
            
            let filteredRequests = MAFCSystem.materialRequests;
            
            // Aplicar filtros
            if (statusFilter !== 'all') {
                filteredRequests = filteredRequests.filter(r => r.status === statusFilter);
            }
            
            if (teamFilter !== 'all') {
                filteredRequests = filteredRequests.filter(r => r.team === teamFilter);
            }
            
            // Filtrar por período
            const now = new Date();
            filteredRequests = filteredRequests.filter(request => {
                const requestDate = new Date(request.date);
                
                switch(periodFilter) {
                    case 'today':
                        return requestDate.toDateString() === now.toDateString();
                    case 'week':
                        const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
                        return requestDate >= weekAgo;
                    case 'month':
                        const monthAgo = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);
                        return requestDate >= monthAgo;
                    default:
                        return true;
                }
            });
            
            // Ordenar por data (mais recente primeiro)
            filteredRequests.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            table.innerHTML = '';
            
            if (filteredRequests.length === 0) {
                table.innerHTML = `
                    <tr>
                        <td colspan="8" class="text-center">Nenhum pedido encontrado</td>
                    </tr>
                `;
                return;
            }
            
            filteredRequests.forEach(request => {
                let statusBadge = '';
                let statusText = '';
                
                switch(request.status) {
                    case 'pending':
                        statusBadge = 'badge-warning';
                        statusText = 'Pendente';
                        break;
                    case 'approved':
                        statusBadge = 'badge-success';
                        statusText = 'Aprovado';
                        break;
                    case 'rejected':
                        statusBadge = 'badge-danger';
                        statusText = 'Recusado';
                        break;
                    case 'delivered':
                        statusBadge = 'badge-info';
                        statusText = 'Entregue';
                        break;
                }
                
                let urgencyBadge = '';
                switch(request.urgency) {
                    case 'critical': urgencyBadge = 'badge-danger'; break;
                    case 'urgent': urgencyBadge = 'badge-warning'; break;
                    default: urgencyBadge = 'badge-info';
                }
                
                const row = `
                    <tr>
                        <td>${request.date}</td>
                        <td>${request.team}</td>
                        <td>${request.material}</td>
                        <td>${request.quantity} ${request.unit}</td>
                        <td><span class="badge ${urgencyBadge}">${request.urgency}</span></td>
                        <td><span class="badge ${statusBadge}">${statusText}</span></td>
                        <td>${request.estimatedValue ? request.estimatedValue + '€' : '--'}</td>
                        <td>
                            <button class="btn-dashboard btn-info btn-sm" onclick="viewRequestDetails(${request.id})">
                                <i class="fas fa-eye"></i>
                            </button>
                            ${request.status === 'pending' ? `
                                <button class="btn-dashboard btn-success btn-sm" onclick="approveRequest(${request.id})">
                                    <i class="fas fa-check"></i>
                                </button>
                                <button class="btn-dashboard btn-danger btn-sm" onclick="rejectRequest(${request.id})">
                                    <i class="fas fa-times"></i>
                                </button>
                            ` : ''}
                        </td>
                    </tr>
                `;
                table.innerHTML += row;
            });
            
            // Atualizar badges
            const pendingCount = MAFCSystem.materialRequests.filter(r => r.status === 'pending').length;
            document.getElementById('bossMaterialsBadge').textContent = pendingCount;
        }
        
        function loadAllPurchases() {
            updatePurchasesTable();
        }
        
        function filterPurchases() {
            updatePurchasesTable();
        }
        
        function updatePurchasesTable() {
            const table = document.getElementById('allPurchasesTable');
            const statusFilter = document.getElementById('filterPurchaseStatus').value;
            const supplierFilter = document.getElementById('filterPurchaseSupplier').value;
            const monthFilter = document.getElementById('filterPurchaseMonth').value;
            
            let filteredPurchases = MAFCSystem.purchases;
            
            // Aplicar filtros
            if (statusFilter !== 'all') {
                filteredPurchases = filteredPurchases.filter(p => p.status === statusFilter);
            }
            
            if (supplierFilter !== 'all') {
                filteredPurchases = filteredPurchases.filter(p => p.supplier === supplierFilter);
            }
            
            if (monthFilter) {
                filteredPurchases = filteredPurchases.filter(p => {
                    const purchaseDate = new Date(p.date);
                    const filterDate = new Date(monthFilter + '-01');
                    return purchaseDate.getMonth() === filterDate.getMonth() && 
                           purchaseDate.getFullYear() === filterDate.getFullYear();
                });
            }
            
            // Ordenar por data (mais recente primeiro)
            filteredPurchases.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            table.innerHTML = '';
            
            if (filteredPurchases.length === 0) {
                table.innerHTML = `
                    <tr>
                        <td colspan="9" class="text-center">Nenhuma compra encontrada</td>
                    </tr>
                `;
                return;
            }
            
            // Preencher filtro de fornecedores
            const supplierSelect = document.getElementById('filterPurchaseSupplier');
            supplierSelect.innerHTML = '<option value="all">Todos Fornecedores</option>';
            const suppliers = [...new Set(MAFCSystem.purchases.map(p => p.supplier))];
            suppliers.forEach(supplier => {
                if (supplier) {
                    const option = document.createElement('option');
                    option.value = supplier;
                    option.textContent = supplier;
                    supplierSelect.appendChild(option);
                }
            });
            
            filteredPurchases.forEach(purchase => {
                let statusBadge = '';
                let statusText = '';
                
                switch(purchase.status) {
                    case 'pending':
                        statusBadge = 'badge-warning';
                        statusText = 'Pendente';
                        break;
                    case 'approved':
                        statusBadge = 'badge-success';
                        statusText = 'Aprovada';
                        break;
                    case 'ordered':
                        statusBadge = 'badge-info';
                        statusText = 'Encomendada';
                        break;
                    case 'delivered':
                        statusBadge = 'badge-primary';
                        statusText = 'Entregue';
                        break;
                    case 'cancelled':
                        statusBadge = 'badge-danger';
                        statusText = 'Cancelada';
                        break;
                }
                
                const row = `
                    <tr>
                        <td>#${purchase.id.toString().padStart(4, '0')}</td>
                        <td>${purchase.date}</td>
                        <td>${purchase.team}</td>
                        <td>${purchase.material}</td>
                        <td>${purchase.supplier || '--'}</td>
                        <td>${purchase.value ? purchase.value + '€' : '--'}</td>
                        <td><span class="badge ${statusBadge}">${statusText}</span></td>
                        <td>${purchase.completionDate || '--'}</td>
                        <td>
                            <button class="btn-dashboard btn-info btn-sm" onclick="viewPurchaseDetails(${purchase.id})">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn-dashboard btn-warning btn-sm" onclick="editPurchase(${purchase.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                        </td>
                    </tr>
                `;
                table.innerHTML += row;
            });
            
            // Atualizar badges
            const totalPurchases = MAFCSystem.purchases.length;
            document.getElementById('bossPurchasesBadge').textContent = totalPurchases;
        }
        
        function loadAccountingData() {
            const table = document.getElementById('accountingTable');
            const teamSelect = document.getElementById('accountingTeam');
            
            // Preencher filtro de equipas
            teamSelect.innerHTML = '<option value="all">Todas as Equipas</option>';
            MAFCSystem.teams.forEach(team => {
                const option = document.createElement('option');
                option.value = team.name;
                option.textContent = team.name;
                teamSelect.appendChild(option);
            });
            
            // Dados simulados para contabilidade
            const accountingData = [];
            
            // Gerar dados para cada empregado
            Object.entries(MAFCSystem.employees).forEach(([team, employees]) => {
                employees.forEach(emp => {
                    const normalHours = 160 + Math.floor(Math.random() * 20);
                    const extraHours = Math.floor(Math.random() * 30);
                    const totalHours = normalHours + extraHours;
                    const bankHours = Math.max(0, totalHours - 160);
                    const value = (normalHours * (emp.salary / 160)) + (extraHours * (emp.salary / 160) * 1.5);
                    
                    accountingData.push({
                        employee: emp.name,
                        team: team,
                        normalHours: normalHours,
                        extraHours: extraHours,
                        totalHours: totalHours,
                        bankHours: bankHours,
                        value: Math.round(value),
                        paymentStatus: bankHours > 0 ? 'Pendente' : 'Pago'
                    });
                });
            });
            
            table.innerHTML = '';
            
            accountingData.forEach(data => {
                const bankBadge = data.bankHours > 0 ? 
                    `<span class="badge badge-danger">+${data.bankHours}h</span>` :
                    `<span class="badge badge-success">OK</span>`;
                
                const paymentBadge = data.paymentStatus === 'Pago' ?
                    '<span class="badge badge-success">Pago</span>' :
                    '<span class="badge badge-warning">Pendente</span>';
                
                const row = `
                    <tr>
                        <td>${data.employee}</td>
                        <td>${data.team}</td>
                        <td>${data.normalHours}h</td>
                        <td>${data.extraHours}h</td>
                        <td>${data.totalHours}h</td>
                        <td>${bankBadge}</td>
                        <td>${data.value}€</td>
                        <td>${paymentBadge}</td>
                    </tr>
                `;
                table.innerHTML += row;
            });
        }
        
        // ============ FUNÇÕES DO CHEFE DE EQUIPA ============
        function showTeamDashboard() {
            document.getElementById('teamDashboard').style.display = 'block';
            document.getElementById('teamUserName').textContent = currentUser.team || currentUser.name;
            
            // Atualizar menu ativo
            updateActiveMenu('team');
            
            // Carregar dados da equipa
            loadTeamData();
        }
        
        function loadTeamData() {
            // Encontrar dados da equipa
            const teamData = MAFCSystem.teams.find(t => t.name === currentUser.team);
            
            if (teamData) {
                // Atualizar contadores
                const employees = MAFCSystem.employees[currentUser.team] || [];
                document.getElementById('teamWorkersCount').textContent = employees.length;
                document.getElementById('teamHoursToday').textContent = '4.5';
                
                // Contar pedidos pendentes da equipa
                const pendingMaterials = MAFCSystem.materialRequests.filter(r => 
                    r.team === currentUser.team && r.status === 'pending'
                ).length;
                document.getElementById('teamPendingMaterials').textContent = pendingMaterials;
                
                document.getElementById('teamStatus').textContent = teamData.status === 'working' ? 'Online' : 'Offline';
                
                // Atualizar GPS
                document.getElementById('gpsLat').textContent = teamData.gps.split(',')[0];
                document.getElementById('gpsLng').textContent = teamData.gps.split(',')[1];
                
                // Carregar lista de empregados
                loadEmployeesList();
                
                // Carregar registos do dia
                loadDailyTimeRecords();
                
                // Carregar pedidos de material da equipa
                loadTeamMaterialRequests();
                
                // Carregar materiais para o formulário
                loadMaterialsByCategory('construction');
            }
        }
        
        function loadEmployeesList() {
            const employees = MAFCSystem.employees[currentUser.team] || [];
            const workerSelect = document.getElementById('workerSelect');
            const teamEmployeesTable = document.getElementById('teamEmployeesTable');
            const teamReportEmployee = document.getElementById('teamReportEmployee');
            
            // Limpar selects
            workerSelect.innerHTML = '<option value="">Selecione um trabalhador</option>';
            teamReportEmployee.innerHTML = '<option value="all">Todos os Empregados</option>';
            
            // Limpar tabela
            teamEmployeesTable.innerHTML = '';
            
            employees.forEach(emp => {
                // Adicionar ao select de trabalhadores
                const option = document.createElement('option');
                option.value = emp.id;
                option.textContent = emp.name;
                workerSelect.appendChild(option);
                
                // Adicionar ao select de relatórios
                const reportOption = document.createElement('option');
                reportOption.value = emp.id;
                reportOption.textContent = emp.name;
                teamReportEmployee.appendChild(reportOption);
                
                // Adicionar à tabela
                const statusBadge = emp.status === 'active' ? 
                    '<span class="badge badge-success">Ativo</span>' :
                    emp.status === 'ferias' ? '<span class="badge badge-warning">Férias</span>' :
                    emp.status === 'doente' ? '<span class="badge badge-danger">Baixa</span>' :
                    '<span class="badge badge-secondary">Inativo</span>';
                
                const row = `
                    <tr>
                        <td>${emp.name}</td>
                        <td>${emp.whatsapp}</td>
                        <td>${emp.position}</td>
                        <td>${emp.salary}€</td>
                        <td>${statusBadge}</td>
                        <td>
                            <button class="btn-dashboard btn-warning btn-sm" onclick="editEmployee(${emp.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn-dashboard btn-danger btn-sm" onclick="deleteEmployee(${emp.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                            <button class="btn-dashboard btn-success btn-sm" onclick="viewEmployeeReport(${emp.id})">
                                <i class="fas fa-file-alt"></i>
                            </button>
                        </td>
                    </tr>
                `;
                teamEmployeesTable.innerHTML += row;
            });
        }
        
        function loadDailyTimeRecords() {
            const table = document.getElementById('teamTimeRecords');
            const dailyTable = document.getElementById('dailyTimeRecords');
            const employees = MAFCSystem.employees[currentUser.team] || [];
            
            table.innerHTML = '';
            dailyTable.innerHTML = '';
            
            const today = new Date().toLocaleDateString('pt-PT');
            const timeRecords = MAFCSystem.timeRecords[currentUser.team] || {};
            const todayRecords = timeRecords[today] || {};
            
            employees.forEach(emp => {
                const empToday = todayRecords[emp.id] || {};
                
                // Tabela principal
                const row = `
                    <tr>
                        <td>${emp.name}</td>
                        <td>${empToday.entry || '--:--'}</td>
                        <td>${empToday.exit || '--:--'}</td>
                        <td>${empToday.total || '0h'}</td>
                        <td>
                            <a href="https://wa.me/${emp.whatsapp.replace('+', '')}" target="_blank" class="btn-dashboard btn-whatsapp btn-sm">
                                <i class="fab fa-whatsapp"></i>
                            </a>
                        </td>
                    </tr>
                `;
                table.innerHTML += row;
                
                // Tabela de histórico do dia
                if (empToday.entry) {
                    const historyRow = `
                        <tr>
                            <td>${emp.name}</td>
                            <td>${empToday.entry}</td>
                            <td>${empToday.exit || '--:--'}</td>
                            <td>${empToday.total || '--'}</td>
                            <td>${empToday.extra || '0'}</td>
                        </tr>
                    `;
                    dailyTable.innerHTML += historyRow;
                }
            });
        }
        
        function loadTeamMaterialRequests() {
            const table = document.getElementById('teamMaterialRequests');
            const teamRequests = MAFCSystem.materialRequests.filter(r => r.team === currentUser.team);
            
            // Ordenar por data (mais recente primeiro)
            teamRequests.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            table.innerHTML = '';
            
            teamRequests.slice(0, 10).forEach(request => {
                let statusBadge = '';
                let statusText = '';
                
                switch(request.status) {
                    case 'pending':
                        statusBadge = 'badge-warning';
                        statusText = 'Pendente';
                        break;
                    case 'approved':
                        statusBadge = 'badge-success';
                        statusText = 'Aprovado';
                        break;
                    case 'rejected':
                        statusBadge = 'badge-danger';
                        statusText = 'Recusado';
                        break;
                    case 'delivered':
                        statusBadge = 'badge-info';
                        statusText = 'Entregue';
                        break;
                }
                
                const row = `
                    <tr>
                        <td>${request.material}</td>
                        <td>${request.quantity} ${request.unit}</td>
                        <td>${request.date}</td>
                        <td><span class="badge ${statusBadge}">${statusText}</span></td>
                        <td>
                            <button class="btn-dashboard btn-whatsapp btn-sm" onclick="followUpRequestWhatsApp(${request.id})">
                                <i class="fab fa-whatsapp"></i>
                            </button>
                        </td>
                    </tr>
                `;
                table.innerHTML += row;
            });
        }
        
        // ============ GESTÃO DE EMPREGADOS ============
        function openEmployeeModal() {
            editingEmployeeId = null;
            document.getElementById('employeeModal').style.display = 'flex';
            
            // Limpar formulário
            document.getElementById('employeeName').value = '';
            document.getElementById('employeeWhatsApp').value = '+351 ';
            document.getElementById('employeePosition').value = 'worker';
            document.getElementById('employeeSalary').value = '1200';
            document.getElementById('employeeStartDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('employeeStatus').value = 'active';
            
            // Carregar lista de empregados
            loadModalEmployeesList();
        }
        
        function closeEmployeeModal() {
            document.getElementById('employeeModal').style.display = 'none';
        }
        
        function loadModalEmployeesList() {
            const employeesList = document.getElementById('employeesList');
            const employees = MAFCSystem.employees[currentUser.team] || [];
            
            employeesList.innerHTML = '';
            
            employees.forEach(emp => {
                const statusBadge = emp.status === 'active' ? 
                    '<span class="badge badge-success">Ativo</span>' :
                    '<span class="badge badge-danger">Inativo</span>';
                
                const row = `
                    <tr>
                        <td>${emp.name}</td>
                        <td>${emp.whatsapp}</td>
                        <td>${emp.position}</td>
                        <td>${statusBadge}</td>
                        <td>
                            <button class="btn-dashboard btn-warning btn-sm" onclick="editEmployee(${emp.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn-dashboard btn-danger btn-sm" onclick="deleteEmployee(${emp.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
                employeesList.innerHTML += row;
            });
        }
        
        function saveEmployee() {
            const name = document.getElementById('employeeName').value;
            const whatsapp = document.getElementById('employeeWhatsApp').value;
            const position = document.getElementById('employeePosition').value;
            const salary = document.getElementById('employeeSalary').value;
            const startDate = document.getElementById('employeeStartDate').value;
            const status = document.getElementById('employeeStatus').value;
            
            if (!name || !whatsapp) {
                alert('Por favor, preencha pelo menos o nome e WhatsApp!');
                return;
            }
            
            if (!MAFCSystem.employees[currentUser.team]) {
                MAFCSystem.employees[currentUser.team] = [];
            }
            
            if (editingEmployeeId) {
                // Editar empregado existente
                const index = MAFCSystem.employees[currentUser.team].findIndex(e => e.id === editingEmployeeId);
                if (index !== -1) {
                    MAFCSystem.employees[currentUser.team][index] = {
                        ...MAFCSystem.employees[currentUser.team][index],
                        name,
                        whatsapp,
                        position,
                        salary: parseInt(salary),
                        startDate,
                        status
                    };
                    
                    logActivity('employee', `Empregado ${name} editado`, 'team');
                    alert(`✅ Empregado editado com sucesso!`);
                }
            } else {
                // Adicionar novo empregado
                const newId = MAFCSystem.employees[currentUser.team].length > 0 ? 
                    Math.max(...MAFCSystem.employees[currentUser.team].map(e => e.id)) + 1 : 1;
                
                MAFCSystem.employees[currentUser.team].push({
                    id: newId,
                    name,
                    whatsapp,
                    position,
                    salary: parseInt(salary),
                    startDate,
                    status
                });
                
                logActivity('employee', `Novo empregado ${name} adicionado`, 'team');
                alert(`✅ Empregado adicionado com sucesso!`);
                
                // Atualizar contador de trabalhadores na equipa
                const team = MAFCSystem.teams.find(t => t.name === currentUser.team);
                if (team) {
                    team.workers = MAFCSystem.employees[currentUser.team].length;
                }
            }
            
            // Atualizar listas
            loadEmployeesList();
            loadModalEmployeesList();
            loadDailyTimeRecords();
            
            // Fechar modal
            closeEmployeeModal();
        }
        
        function editEmployee(id) {
            const employees = MAFCSystem.employees[currentUser.team] || [];
            const employee = employees.find(e => e.id === id);
            
            if (employee) {
                editingEmployeeId = id;
                document.getElementById('employeeModal').style.display = 'flex';
                
                // Preencher formulário
                document.getElementById('employeeName').value = employee.name;
                document.getElementById('employeeWhatsApp').value = employee.whatsapp;
                document.getElementById('employeePosition').value = employee.position;
                document.getElementById('employeeSalary').value = employee.salary;
                document.getElementById('employeeStartDate').value = employee.startDate;
                document.getElementById('employeeStatus').value = employee.status;
                
                // Carregar lista de empregados
                loadModalEmployeesList();
            }
        }
        
        function deleteEmployee(id) {
            if (confirm('Tem certeza que deseja remover este empregado?')) {
                const employee = MAFCSystem.employees[currentUser.team].find(e => e.id === id);
                MAFCSystem.employees[currentUser.team] = MAFCSystem.employees[currentUser.team].filter(e => e.id !== id);
                
                logActivity('employee', `Empregado ${employee.name} removido`, 'team');
                alert('✅ Empregado removido com sucesso!');
                
                // Atualizar contador de trabalhadores na equipa
                const team = MAFCSystem.teams.find(t => t.name === currentUser.team);
                if (team) {
                    team.workers = MAFCSystem.employees[currentUser.team].length;
                }
                
                // Atualizar listas
                loadEmployeesList();
                loadModalEmployeesList();
                loadDailyTimeRecords();
            }
        }
        
        function searchEmployees() {
            const searchTerm = document.getElementById('searchEmployee').value.toLowerCase();
            const filterStatus = document.getElementById('filterEmployeeStatus').value;
            const employees = MAFCSystem.employees[currentUser.team] || [];
            
            const filtered = employees.filter(emp => {
                const matchesSearch = emp.name.toLowerCase().includes(searchTerm) || 
                                     emp.whatsapp.includes(searchTerm) ||
                                     emp.position.toLowerCase().includes(searchTerm);
                const matchesStatus = filterStatus === 'all' || emp.status === filterStatus;
                return matchesSearch && matchesStatus;
            });
            
            const table = document.getElementById('teamEmployeesTable');
            table.innerHTML = '';
            
            filtered.forEach(emp => {
                const statusBadge = emp.status === 'active' ? 
                    '<span class="badge badge-success">Ativo</span>' :
                    '<span class="badge badge-danger">Inativo</span>';
                
                const row = `
                    <tr>
                        <td>${emp.name}</td>
                        <td>${emp.whatsapp}</td>
                        <td>${emp.position}</td>
                        <td>${emp.salary}€</td>
                        <td>${statusBadge}</td>
                        <td>
                            <button class="btn-dashboard btn-warning btn-sm" onclick="editEmployee(${emp.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn-dashboard btn-danger btn-sm" onclick="deleteEmployee(${emp.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
                table.innerHTML += row;
            });
        }
        
        // ============ CONTROLO DE HORAS INDIVIDUAL ============
        function loadWorkerWhatsApp() {
            const workerSelect = document.getElementById('workerSelect');
            const selectedId = parseInt(workerSelect.value);
            const whatsappInput = document.getElementById('workerWhatsApp');
            
            if (selectedId) {
                const employees = MAFCSystem.employees[currentUser.team] || [];
                const employee = employees.find(e => e.id === selectedId);
                
                if (employee) {
                    whatsappInput.value = employee.whatsapp;
                } else {
                    whatsappInput.value = '';
                }
            } else {
                whatsappInput.value = '';
            }
        }
        
        function registerIndividualTime() {
            const workerSelect = document.getElementById('workerSelect');
            const timeAction = document.getElementById('timeAction');
            const selectedId = parseInt(workerSelect.value);
            
            if (!selectedId) {
                alert('Por favor, selecione um trabalhador!');
                return;
            }
            
            const employees = MAFCSystem.employees[currentUser.team] || [];
            const employee = employees.find(e => e.id === selectedId);
            
            if (!employee) {
                alert('Trabalhador não encontrado!');
                return;
            }
            
            const action = timeAction.value;
            const time = new Date();
            const timeString = time.toLocaleTimeString('pt-PT', { hour: '2-digit', minute: '2-digit' });
            const dateString = time.toLocaleDateString('pt-PT');
            
            // Inicializar registos se necessário
            if (!MAFCSystem.timeRecords[currentUser.team]) {
                MAFCSystem.timeRecords[currentUser.team] = {};
            }
            if (!MAFCSystem.timeRecords[currentUser.team][dateString]) {
                MAFCSystem.timeRecords[currentUser.team][dateString] = {};
            }
            
            if (action === 'start') {
                MAFCSystem.timeRecords[currentUser.team][dateString][selectedId] = {
                    ...MAFCSystem.timeRecords[currentUser.team][dateString][selectedId],
                    entry: timeString,
                    employeeName: employee.name
                };
                
                logActivity('hours', `${employee.name} marcou entrada às ${timeString}`, 'team');
                alert(`✅ Entrada registada para ${employee.name} às ${timeString}`);
                
                // Enviar WhatsApp de confirmação
                sendTimeConfirmationWhatsApp(employee.whatsapp, 'entrada', timeString);
            } else {
                const empRecord = MAFCSystem.timeRecords[currentUser.team][dateString][selectedId] || {};
                
                if (!empRecord.entry) {
                    alert('❌ Primeiro precisa registar a entrada!');
                    return;
                }
                
                // Calcular horas trabalhadas
                const entryTime = empRecord.entry;
                const [entryHours, entryMinutes] = entryTime.split(':').map(Number);
                const [exitHours, exitMinutes] = timeString.split(':').map(Number);
                
                let totalMinutes = (exitHours * 60 + exitMinutes) - (entryHours * 60 + entryMinutes);
                if (totalMinutes < 0) totalMinutes += 24 * 60;
                
                const hours = Math.floor(totalMinutes / 60);
                const minutes = totalMinutes % 60;
                const totalTime = `${hours}h${minutes > 0 ? `${minutes}m` : ''}`;
                
                // Calcular horas extra (acima de 8 horas)
                const normalHours = 8 * 60;
                const extraMinutes = Math.max(0, totalMinutes - normalHours);
                const extraHours = extraMinutes > 0 ? `${Math.floor(extraMinutes / 60)}h${extraMinutes % 60}m` : '0';
                
                MAFCSystem.timeRecords[currentUser.team][dateString][selectedId] = {
                    ...empRecord,
                    exit: timeString,
                    total: totalTime,
                    extra: extraHours
                };
                
                logActivity('hours', `${employee.name} marcou saída às ${timeString} (${totalTime} trabalhadas)`, 'team');
                alert(`✅ Saída registada para ${employee.name} às ${timeString}\n\nHoras trabalhadas: ${totalTime}\nHoras extra: ${extraHours}`);
                
                // Enviar WhatsApp de confirmação
                sendTimeConfirmationWhatsApp(employee.whatsapp, 'saída', timeString, totalTime, extraHours);
            }
            
            // Atualizar tabela
            loadDailyTimeRecords();
        }
        
        function sendTimeConfirmationWhatsApp(whatsapp, type, time, total = '', extra = '') {
            const message = type === 'entrada' ? 
                `✅ Entrada registada às ${time} - MAFC Team Control` :
                `✅ Saída registada às ${time}\nHoras: ${total}\nExtra: ${extra} - MAFC Team Control`;
            
            const whatsappUrl = `https://wa.me/${whatsapp.replace('+', '')}?text=${encodeURIComponent(message)}`;
            
            // Abrir WhatsApp em nova aba (simulação)
            window.open(whatsappUrl, '_blank');
        }
        
        function sendWhatsAppReminder() {
            const workerSelect = document.getElementById('workerSelect');
            const selectedId = parseInt(workerSelect.value);
            
            if (!selectedId) {
                alert('Por favor, selecione um trabalhador!');
                return;
            }
            
            const employees = MAFCSystem.employees[currentUser.team] || [];
            const employee = employees.find(e => e.id === selectedId);
            
            if (employee) {
                const message = `⏰ Lembrete: Por favor, registe as suas horas no sistema MAFC Team Control`;
                const whatsappUrl = `https://wa.me/${employee.whatsapp.replace('+', '')}?text=${encodeURIComponent(message)}`;
                window.open(whatsappUrl, '_blank');
            }
        }
        
        function registerAllTeam(action) {
            const employees = MAFCSystem.employees[currentUser.team] || [];
            const time = new Date().toLocaleTimeString('pt-PT', { hour: '2-digit', minute: '2-digit' });
            const dateString = new Date().toLocaleDateString('pt-PT');
            
            employees.forEach(emp => {
                if (emp.status === 'active') {
                    if (!MAFCSystem.timeRecords[currentUser.team]) {
                        MAFCSystem.timeRecords[currentUser.team] = {};
                    }
                    if (!MAFCSystem.timeRecords[currentUser.team][dateString]) {
                        MAFCSystem.timeRecords[currentUser.team][dateString] = {};
                    }
                    
                    if (action === 'start') {
                        MAFCSystem.timeRecords[currentUser.team][dateString][emp.id] = {
                            ...MAFCSystem.timeRecords[currentUser.team][dateString][emp.id],
                            entry: time,
                            employeeName: emp.name
                        };
                    }
                }
            });
            
            logActivity('hours', `Entrada registada para toda a equipa às ${time}`, 'team');
            alert(`✅ ${action === 'start' ? 'Entrada' : 'Saída'} registada para TODA A EQUIPA às ${time}`);
            loadDailyTimeRecords();
        }
        
        // ============ PEDIDOS DE MATERIAL ============
        function selectCategory(category) {
            document.querySelectorAll('.category-card').forEach(card => {
                card.style.borderColor = 'transparent';
            });
            
            event.currentTarget.style.borderColor = 'var(--team)';
            loadMaterialsByCategory(category);
        }
        
        function loadMaterialsByCategory(category) {
            const materials = MAFCSystem.materials[category] || [];
            const select = document.getElementById('materialSelect');
            
            select.innerHTML = '<option value="">Selecione um material</option>';
            materials.forEach(material => {
                const option = document.createElement('option');
                option.value = material.id;
                option.textContent = `${material.name} (${material.unit})`;
                select.appendChild(option);
            });
        }
        
        function submitMaterialRequest() {
            const category = document.getElementById('materialCategory').value;
            const materialSelect = document.getElementById('materialSelect');
            const materialId = materialSelect.value;
            const materialText = materialSelect.options[materialSelect.selectedIndex].text;
            const quantity = document.getElementById('materialQuantity').value;
            const unit = document.getElementById('materialUnit').value;
            const urgency = document.getElementById('materialUrgency').value;
            const notes = document.getElementById('materialNotes').value;
            
            if (!materialId || !quantity) {
                alert('Por favor, selecione um material e quantidade!');
                return;
            }
            
            // Encontrar material para obter preço estimado
            const material = MAFCSystem.materials[category].find(m => m.id == materialId);
            const estimatedValue = material ? material.averagePrice * quantity : null;
            
            // Criar pedido
            const request = {
                id: ++MAFCSystem.lastId.materialRequest,
                team: currentUser.team,
                material: materialText.split(' (')[0],
                category: category,
                quantity: quantity,
                unit: unit,
                urgency: urgency,
                notes: notes,
                date: new Date().toLocaleDateString('pt-PT'),
                timestamp: new Date().toISOString(),
                status: 'pending',
                requestedBy: currentUser.name,
                estimatedValue: estimatedValue
            };
            
            // Adicionar ao sistema
            MAFCSystem.materialRequests.push(request);
            
            // Registrar atividade
            logActivity('material', `${currentUser.name} pediu ${quantity} ${unit} de ${request.material}`, 'team');
            
            // Atualizar contador
            const pendingCount = document.getElementById('teamPendingMaterials');
            pendingCount.textContent = parseInt(pendingCount.textContent) + 1;
            
            // Adicionar à tabela
            const table = document.getElementById('teamMaterialRequests');
            const urgencyBadge = urgency === 'critical' ? 'badge-danger' : 
                                urgency === 'urgent' ? 'badge-warning' : 'badge-info';
            const urgencyText = urgency === 'critical' ? 'CRÍTICO' :
                               urgency === 'urgent' ? 'Urgente' : 'Normal';
            
            const row = `
                <tr>
                    <td>${request.material}</td>
                    <td>${quantity} ${unit}</td>
                    <td>${request.date}</td>
                    <td><span class="badge ${urgencyBadge}">${urgencyText}</span></td>
                    <td>
                        <button class="btn-dashboard btn-whatsapp btn-sm" onclick="followUpRequestWhatsApp(${request.id})">
                            <i class="fab fa-whatsapp"></i>
                        </button>
                    </td>
                </tr>
            `;
            
            table.innerHTML = row + table.innerHTML;
            
            alert(`✅ Pedido enviado para o Departamento de Compras!\n\nMaterial: ${materialText}\nQuantidade: ${quantity} ${unit}\nUrgência: ${urgencyText}`);
            
            // Limpar formulário
            document.getElementById('materialQuantity').value = 1;
            document.getElementById('materialNotes').value = '';
            
            // Atualizar painel do patrão se necessário
            if (document.getElementById('bossDashboard').style.display === 'block') {
                loadUrgentRequests();
                updateMaterialRequestsTable();
            }
        }
        
        function submitMaterialRequestWhatsApp() {
            // Primeiro enviar pelo sistema
            submitMaterialRequest();
            
            // Depois abrir WhatsApp para follow-up
            const materialSelect = document.getElementById('materialSelect');
            const materialText = materialSelect.options[materialSelect.selectedIndex].text;
            const quantity = document.getElementById('materialQuantity').value;
            const unit = document.getElementById('materialUnit').value;
            const urgency = document.getElementById('materialUrgency').value;
            
            const urgencyText = urgency === 'critical' ? 'URGENTE - CRÍTICO' :
                               urgency === 'urgent' ? 'Urgente' : 'Normal';
            
            const message = `🛒 PEDIDO DE MATERIAL - ${currentUser.team}\n\nMaterial: ${materialText}\nQuantidade: ${quantity} ${unit}\nUrgência: ${urgencyText}\n\nPedido enviado via sistema MAFC.`;
            
            // WhatsApp do departamento de compras
            const whatsappUrl = `https://wa.me/351123456789?text=${encodeURIComponent(message)}`;
            window.open(whatsappUrl, '_blank');
        }
        
        function followUpRequestWhatsApp(requestId) {
            const request = MAFCSystem.materialRequests.find(r => r.id === requestId);
            if (request) {
                const message = `📦 FOLLOW-UP PEDIDO #${requestId}\n\nEquipa: ${request.team}\nMaterial: ${request.material}\nQuantidade: ${request.quantity} ${request.unit}\nData: ${request.date}\n\nPor favor, atualize o estado deste pedido.`;
                
                const whatsappUrl = `https://wa.me/351123456789?text=${encodeURIComponent(message)}`;
                window.open(whatsappUrl, '_blank');
            }
        }
        
        // ============ DASHBOARD DE COMPRAS ============
        function showPurchaseDashboard() {
            document.getElementById('purchaseDashboard').style.display = 'block';
            document.getElementById('purchaseUserName').textContent = currentUser.name;
            
            // Atualizar menu ativo
            updateActiveMenu('purchase');
            
            // Carregar dados
            loadPurchaseData();
        }
        
        function loadPurchaseData() {
            // Atualizar contadores
            const pendingCount = MAFCSystem.materialRequests.filter(r => r.status === 'pending').length;
            const approvedCount = MAFCSystem.purchases.length;
            
            document.getElementById('pendingCount').textContent = pendingCount;
            document.getElementById('approvedCount').textContent = approvedCount;
            document.getElementById('monthBudget').textContent = '18.5K';
            document.getElementById('suppliersCount').textContent = MAFCSystem.suppliers.length;
            
            // Atualizar badges
            document.getElementById('pendingRequestsBadge').textContent = pendingCount;
            document.getElementById('approvedPurchasesBadge').textContent = approvedCount;
            
            // Carregar pedidos urgentes
            loadPurchaseUrgentRequests();
            
            // Carregar pedidos pendentes
            loadAllPendingRequests();
            
            // Carregar compras aprovadas
            loadApprovedPurchases();
            
            // Carregar histórico
            loadPurchaseHistory();
        }
        
        function loadPurchaseUrgentRequests() {
            const table = document.getElementById('urgentPurchaseRequests');
            const urgentRequests = MAFCSystem.materialRequests.filter(r => 
                (r.urgency === 'critical' || r.urgency === 'urgent') && r.status === 'pending'
            );
            
            table.innerHTML = '';
            
            if (urgentRequests.length === 0) {
                table.innerHTML = `
                    <tr>
                        <td colspan="5" class="text-center">Sem pedidos urgentes no momento</td>
                    </tr>
                `;
                return;
            }
            
            urgentRequests.forEach(request => {
                const urgencyBadge = request.urgency === 'critical' ? 'badge-danger' : 'badge-warning';
                const urgencyText = request.urgency === 'critical' ? 'CRÍTICO' : 'Urgente';
                
                const row = `
                    <tr>
                        <td>${request.team}</td>
                        <td>${request.material}</td>
                        <td>${request.quantity} ${request.unit}</td>
                        <td><span class="badge ${urgencyBadge}">${urgencyText}</span></td>
                        <td>
                            <button class="btn-dashboard btn-success btn-sm" onclick="approvePurchase(${request.id})">
                                <i class="fas fa-check"></i>
                            </button>
                            <button class="btn-dashboard btn-danger btn-sm" onclick="rejectPurchase(${request.id})">
                                <i class="fas fa-times"></i>
                            </button>
                            <button class="btn-dashboard btn-whatsapp btn-sm" onclick="contactSupplierWhatsApp(${request.id})">
                                <i class="fab fa-whatsapp"></i>
                            </button>
                        </td>
                    </tr>
                `;
                table.innerHTML += row;
            });
        }
        
        function loadAllPendingRequests() {
            const table = document.getElementById('allPendingRequests');
            const teamSelect = document.getElementById('filterByTeam');
            
            // Preencher filtro de equipas
            teamSelect.innerHTML = '<option value="all">Todas as Equipas</option>';
            const teams = [...new Set(MAFCSystem.materialRequests.map(r => r.team))];
            teams.forEach(team => {
                const option = document.createElement('option');
                option.value = team;
                option.textContent = team;
                teamSelect.appendChild(option);
            });
            
            updatePendingRequestsTable();
        }
        
        function filterPendingRequests() {
            updatePendingRequestsTable();
        }
        
        function updatePendingRequestsTable() {
            const table = document.getElementById('allPendingRequests');
            const teamFilter = document.getElementById('filterByTeam').value;
            const urgencyFilter = document.getElementById('filterByUrgency').value;
            const searchTerm = document.getElementById('searchMaterial').value.toLowerCase();
            
            let filteredRequests = MAFCSystem.materialRequests.filter(r => r.status === 'pending');
            
            // Aplicar filtros
            if (teamFilter !== 'all') {
                filteredRequests = filteredRequests.filter(r => r.team === teamFilter);
            }
            
            if (urgencyFilter !== 'all') {
                filteredRequests = filteredRequests.filter(r => r.urgency === urgencyFilter);
            }
            
            if (searchTerm) {
                filteredRequests = filteredRequests.filter(r => 
                    r.material.toLowerCase().includes(searchTerm) ||
                    r.team.toLowerCase().includes(searchTerm)
                );
            }
            
            // Ordenar por urgência (crítico primeiro) e depois data
            filteredRequests.sort((a, b) => {
                if (a.urgency === 'critical' && b.urgency !== 'critical') return -1;
                if (b.urgency === 'critical' && a.urgency !== 'critical') return 1;
                return new Date(b.date) - new Date(a.date);
            });
            
            table.innerHTML = '';
            
            if (filteredRequests.length === 0) {
                table.innerHTML = `
                    <tr>
                        <td colspan="8" class="text-center">Nenhum pedido pendente encontrado</td>
                    </tr>
                `;
                return;
            }
            
            filteredRequests.forEach(request => {
                const urgencyBadge = request.urgency === 'critical' ? 'badge-danger' : 
                                   request.urgency === 'urgent' ? 'badge-warning' : 'badge-info';
                const urgencyText = request.urgency === 'critical' ? 'CRÍTICO' :
                                   request.urgency === 'urgent' ? 'Urgente' : 'Normal';
                
                const row = `
                    <tr>
                        <td>${request.date}</td>
                        <td>${request.team}</td>
                        <td>${request.material}</td>
                        <td>${request.quantity} ${request.unit}</td>
                        <td><span class="badge ${urgencyBadge}">${urgencyText}</span></td>
                        <td>${request.requestedBy}</td>
                        <td>
                            <button class="btn-dashboard btn-whatsapp btn-sm" onclick="contactTeamWhatsApp('${request.team}')">
                                <i class="fab fa-whatsapp"></i>
                            </button>
                        </td>
                        <td>
                            <button class="btn-dashboard btn-success btn-sm" onclick="approvePurchase(${request.id})">
                                <i class="fas fa-check"></i> Aprovar
                            </button>
                            <button class="btn-dashboard btn-danger btn-sm" onclick="rejectPurchase(${request.id})">
                                <i class="fas fa-times"></i> Recusar
                            </button>
                        </td>
                    </tr>
                `;
                table.innerHTML += row;
            });
            
            // Atualizar contador
            document.getElementById('pendingCount').textContent = filteredRequests.length;
            document.getElementById('pendingRequestsBadge').textContent = filteredRequests.length;
        }
        
        function loadApprovedPurchases() {
            updateApprovedPurchasesTable();
        }
        
        function filterApprovedPurchases() {
            updateApprovedPurchasesTable();
        }
        
        function updateApprovedPurchasesTable() {
            const table = document.getElementById('approvedPurchasesTable');
            const supplierFilter = document.getElementById('supplierSelect').value;
            const statusFilter = document.getElementById('orderStatus').value;
            
            let filteredPurchases = MAFCSystem.purchases;
            
            // Aplicar filtros
            if (supplierFilter !== 'all') {
                filteredPurchases = filteredPurchases.filter(p => p.supplier === supplierFilter);
            }
            
            if (statusFilter !== 'all') {
                filteredPurchases = filteredPurchases.filter(p => p.status === statusFilter);
            }
            
            // Ordenar por data (mais recente primeiro)
            filteredPurchases.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            table.innerHTML = '';
            
            if (filteredPurchases.length === 0) {
                table.innerHTML = `
                    <tr>
                        <td colspan="9" class="text-center">Nenhuma compra encontrada</td>
                    </tr>
                `;
                return;
            }
            
            // Preencher filtro de fornecedores
            const supplierSelect = document.getElementById('supplierSelect');
            supplierSelect.innerHTML = '<option value="all">Todos Fornecedores</option>';
            const suppliers = [...new Set(MAFCSystem.purchases.map(p => p.supplier))];
            suppliers.forEach(supplier => {
                if (supplier) {
                    const option = document.createElement('option');
                    option.value = supplier;
                    option.textContent = supplier;
                    supplierSelect.appendChild(option);
                }
            });
            
            filteredPurchases.forEach(purchase => {
                let statusBadge = '';
                let statusText = '';
                
                switch(purchase.status) {
                    case 'pending':
                        statusBadge = 'badge-warning';
                        statusText = 'Pendente';
                        break;
                    case 'approved':
                        statusBadge = 'badge-success';
                        statusText = 'Aprovada';
                        break;
                    case 'ordered':
                        statusBadge = 'badge-info';
                        statusText = 'Encomendada';
                        break;
                    case 'delivered':
                        statusBadge = 'badge-primary';
                        statusText = 'Entregue';
                        break;
                    case 'cancelled':
                        statusBadge = 'badge-danger';
                        statusText = 'Cancelada';
                        break;
                }
                
                const row = `
                    <tr>
                        <td><strong>#${purchase.id.toString().padStart(4, '0')}</strong></td>
                        <td>${purchase.supplier || '--'}</td>
                        <td>${purchase.material}</td>
                        <td>${purchase.quantity} ${purchase.unit}</td>
                        <td>${purchase.value ? purchase.value + '€' : '--'}</td>
                        <td>${purchase.expectedDelivery || '--'}</td>
                        <td><span class="badge ${statusBadge}">${statusText}</span></td>
                        <td>
                            <button class="btn-dashboard btn-whatsapp btn-sm" onclick="contactSupplier('${purchase.supplier}')">
                                <i class="fab fa-whatsapp"></i>
                            </button>
                        </td>
                        <td>
                            <button class="btn-dashboard btn-info btn-sm" onclick="viewPurchaseDetails(${purchase.id})">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn-dashboard btn-warning btn-sm" onclick="editPurchase(${purchase.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                        </td>
                    </tr>
                `;
                table.innerHTML += row;
            });
        }
        
        function loadPurchaseHistory() {
            updatePurchaseHistoryTable();
        }
        
        function updatePurchaseHistoryTable() {
            const table = document.getElementById('purchaseHistoryTable');
            const periodFilter = document.getElementById('purchaseHistoryPeriod').value;
            const supplierFilter = document.getElementById('purchaseHistorySupplier').value;
            
            let filteredPurchases = MAFCSystem.purchases;
            
            // Aplicar filtro de período
            const now = new Date();
            filteredPurchases = filteredPurchases.filter(purchase => {
                const purchaseDate = new Date(purchase.date);
                
                switch(periodFilter) {
                    case 'month':
                        const monthAgo = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);
                        return purchaseDate >= monthAgo;
                    case 'quarter':
                        const quarterAgo = new Date(now.getTime() - 90 * 24 * 60 * 60 * 1000);
                        return purchaseDate >= quarterAgo;
                    case 'year':
                        const yearAgo = new Date(now.getTime() - 365 * 24 * 60 * 60 * 1000);
                        return purchaseDate >= yearAgo;
                    default:
                        return true;
                }
            });
            
            // Aplicar filtro de fornecedor
            if (supplierFilter !== 'all') {
                filteredPurchases = filteredPurchases.filter(p => p.supplier === supplierFilter);
            }
            
            // Ordenar por data (mais recente primeiro)
            filteredPurchases.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            table.innerHTML = '';
            
            if (filteredPurchases.length === 0) {
                table.innerHTML = `
                    <tr>
                        <td colspan="8" class="text-center">Nenhum registo encontrado</td>
                    </tr>
                `;
                return;
            }
            
            // Preencher filtro de fornecedores
            const supplierSelect = document.getElementById('purchaseHistorySupplier');
            supplierSelect.innerHTML = '<option value="all">Todos Fornecedores</option>';
            const suppliers = [...new Set(MAFCSystem.purchases.map(p => p.supplier))];
            suppliers.forEach(supplier => {
                if (supplier) {
                    const option = document.createElement('option');
                    option.value = supplier;
                    option.textContent = supplier;
                    supplierSelect.appendChild(option);
                }
            });
            
            filteredPurchases.forEach(purchase => {
                let statusBadge = '';
                let statusText = '';
                
                switch(purchase.status) {
                    case 'pending':
                        statusBadge = 'badge-warning';
                        statusText = 'Pendente';
                        break;
                    case 'approved':
                        statusBadge = 'badge-success';
                        statusText = 'Aprovada';
                        break;
                    case 'ordered':
                        statusBadge = 'badge-info';
                        statusText = 'Encomendada';
                        break;
                    case 'delivered':
                        statusBadge = 'badge-primary';
                        statusText = 'Entregue';
                        break;
                    case 'cancelled':
                        statusBadge = 'badge-danger';
                        statusText = 'Cancelada';
                        break;
                }
                
                const row = `
                    <tr>
                        <td>${purchase.date}</td>
                        <td>#${purchase.id.toString().padStart(4, '0')}</td>
                        <td>${purchase.supplier || '--'}</td>
                        <td>${purchase.material}</td>
                        <td>${purchase.value ? purchase.value + '€' : '--'}</td>
                        <td><span class="badge ${statusBadge}">${statusText}</span></td>
                        <td>${purchase.completionDate || '--'}</td>
                        <td>${purchase.processedBy || '--'}</td>
                    </tr>
                `;
                table.innerHTML += row;
            });
        }
        
        // ============ FUNÇÕES DE COMPRAS ============
        function approvePurchase(requestId) {
            const request = MAFCSystem.materialRequests.find(r => r.id === requestId);
            if (!request) {
                alert('Pedido não encontrado!');
                return;
            }
            
            // Criar compra a partir do pedido
            const purchase = {
                id: ++MAFCSystem.lastId.purchase,
                requestId: requestId,
                team: request.team,
                material: request.material,
                quantity: request.quantity,
                unit: request.unit,
                urgency: request.urgency,
                date: new Date().toLocaleDateString('pt-PT'),
                timestamp: new Date().toISOString(),
                status: 'approved',
                estimatedValue: request.estimatedValue,
                processedBy: currentUser.name
            };
            
            // Adicionar ao sistema
            MAFCSystem.purchases.push(purchase);
            
            // Atualizar status do pedido
            request.status = 'approved';
            request.approvedDate = new Date().toLocaleDateString('pt-PT');
            request.processedBy = currentUser.name;
            
            // Registrar atividade
            logActivity('purchase', `${currentUser.name} aprovou pedido de ${request.material} para ${request.team}`, 'purchase');
            
            alert(`✅ Pedido aprovado!\n\nMaterial: ${request.material}\nQuantidade: ${request.quantity} ${request.unit}\nEquipa: ${request.team}`);
            
            // Atualizar todas as tabelas
            updatePendingRequestsTable();
            updateApprovedPurchasesTable();
            updatePurchaseHistoryTable();
            
            // Atualizar painel do patrão se necessário
            if (document.getElementById('bossDashboard').style.display === 'block') {
                loadUrgentRequests();
                updateMaterialRequestsTable();
                updatePurchasesTable();
            }
            
            // Atualizar painel do chefe de equipa se necessário
            if (document.getElementById('teamDashboard').style.display === 'block') {
                loadTeamMaterialRequests();
            }
        }
        
        function rejectPurchase(requestId) {
            const request = MAFCSystem.materialRequests.find(r => r.id === requestId);
            if (!request) {
                alert('Pedido não encontrado!');
                return;
            }
            
            const reason = prompt('Motivo da recusa:');
            if (!reason) return;
            
            // Atualizar status do pedido
            request.status = 'rejected';
            request.rejectionReason = reason;
            request.rejectedDate = new Date().toLocaleDateString('pt-PT');
            request.processedBy = currentUser.name;
            
            // Registrar atividade
            logActivity('purchase', `${currentUser.name} recusou pedido de ${request.material} para ${request.team}`, 'purchase');
            
            alert(`❌ Pedido recusado!\n\nMotivo: ${reason}`);
            
            // Atualizar tabelas
            updatePendingRequestsTable();
            
            // Atualizar painel do patrão se necessário
            if (document.getElementById('bossDashboard').style.display === 'block') {
                loadUrgentRequests();
                updateMaterialRequestsTable();
            }
            
            // Atualizar painel do chefe de equipa se necessário
            if (document.getElementById('teamDashboard').style.display === 'block') {
                loadTeamMaterialRequests();
            }
        }
        
        function contactSupplierWhatsApp(requestId) {
            const request = MAFCSystem.materialRequests.find(r => r.id === requestId);
            if (request) {
                // Encontrar fornecedor apropriado
                let supplier = MAFCSystem.suppliers[0]; // Default
                
                // Tentar encontrar fornecedor por especialidade
                if (request.category === 'construction') {
                    supplier = MAFCSystem.suppliers.find(s => s.specialty === 'Materiais Construção') || supplier;
                } else if (request.category === 'machines') {
                    supplier = MAFCSystem.suppliers.find(s => s.specialty === 'Máquinas') || supplier;
                } else if (request.category === 'tools') {
                    supplier = MAFCSystem.suppliers.find(s => s.specialty === 'Ferramentas') || supplier;
                }
                
                const urgencyText = request.urgency === 'critical' ? 'URGENTE - CRÍTICO' :
                                   request.urgency === 'urgent' ? 'Urgente' : 'Normal';
                
                const message = `🛒 COTAÇÃO - MAFC & FILHO, LDA.\n\nNecessitamos de:\nMaterial: ${request.material}\nQuantidade: ${request.quantity} ${request.unit}\nUrgência: ${urgencyText}\n\nPor favor, envie orçamento e prazo de entrega.\n\nContacto: ${currentUser.name}`;
                
                const whatsappUrl = `https://wa.me/${supplier.whatsapp.replace('+', '')}?text=${encodeURIComponent(message)}`;
                window.open(whatsappUrl, '_blank');
            }
        }
        
        function contactTeamWhatsApp(teamName) {
            const message = `📞 DEPARTAMENTO DE COMPRAS - MAFC\n\nOlá ${teamName},\n\nRecebemos o seu pedido de material.\nEm breve entraremos em contacto com atualizações.\n\nObrigado!`;
            
            const whatsappUrl = `https://wa.me/351123456789?text=${encodeURIComponent(message)}`;
            window.open(whatsappUrl, '_blank');
        }
        
        function contactSupplier(supplierName) {
            const supplier = MAFCSystem.suppliers.find(s => s.name === supplierName);
            if (supplier) {
                const message = `📞 CONTATO - MAFC & FILHO, LDA.\n\nOlá ${supplierName},\n\nGostaríamos de falar sobre uma encomenda em curso.\n\nPor favor, entre em contacto.\n\n${currentUser.name}`;
                
                const whatsappUrl = `https://wa.me/${supplier.whatsapp.replace('+', '')}?text=${encodeURIComponent(message)}`;
                window.open(whatsappUrl, '_blank');
            } else {
                alert('Fornecedor não encontrado!');
            }
        }
        
        // ============ FUNÇÕES DO ESCRITÓRIO ============
        function showOfficeDashboard() {
            document.getElementById('officeDashboard').style.display = 'block';
            document.getElementById('officeUserName').textContent = currentUser.name;
            
            // Atualizar menu ativo
            updateActiveMenu('office');
            
            // Carregar dados
            loadOfficeData();
        }
        
        function loadOfficeData() {
            // Inicializar registos do escritório
            if (!MAFCSystem.timeRecords['Escritório']) {
                MAFCSystem.timeRecords['Escritório'] = {};
            }
            
            // Atualizar registos do dia
            updateOfficeTodayRecords();
            
            // Gerar relatório inicial
            generateOfficeReport();
        }
        
        function officeClockIn() {
            const time = new Date();
            const timeString = time.toLocaleTimeString('pt-PT', { hour: '2-digit', minute: '2-digit' });
            const dateString = time.toLocaleDateString('pt-PT');
            
            if (!MAFCSystem.timeRecords['Escritório'][dateString]) {
                MAFCSystem.timeRecords['Escritório'][dateString] = {};
            }
            
            MAFCSystem.timeRecords['Escritório'][dateString].entry = timeString;
            MAFCSystem.timeRecords['Escritório'][dateString].employee = currentUser.name;
            
            document.getElementById('officeTodayEntry').textContent = timeString;
            document.getElementById('officeStatus').textContent = 'Presente';
            
            logActivity('hours', `${currentUser.name} marcou entrada no escritório às ${timeString}`, 'office');
            alert(`✅ Entrada registada às ${timeString}`);
            updateOfficeTodayRecords();
            updateOfficeWeekRecords();
        }
        
        function officeClockOut() {
            const time = new Date();
            const timeString = time.toLocaleTimeString('pt-PT', { hour: '2-digit', minute: '2-digit' });
            const dateString = time.toLocaleDateString('pt-PT');
            
            if (!MAFCSystem.timeRecords['Escritório'][dateString] || !MAFCSystem.timeRecords['Escritório'][dateString].entry) {
                alert('❌ Primeiro precisa registar a entrada!');
                return;
            }
            
            const entryTime = MAFCSystem.timeRecords['Escritório'][dateString].entry;
            const [entryHours, entryMinutes] = entryTime.split(':').map(Number);
            const [exitHours, exitMinutes] = timeString.split(':').map(Number);
            
            let totalMinutes = (exitHours * 60 + exitMinutes) - (entryHours * 60 + entryMinutes);
            if (totalMinutes < 0) totalMinutes += 24 * 60;
            
            // Subtrair 1 hora de pausa
            totalMinutes = Math.max(0, totalMinutes - 60);
            
            const hours = Math.floor(totalMinutes / 60);
            const minutes = totalMinutes % 60;
            const totalTime = `${hours}h${minutes > 0 ? `${minutes}m` : ''}`;
            
            MAFCSystem.timeRecords['Escritório'][dateString].exit = timeString;
            MAFCSystem.timeRecords['Escritório'][dateString].total = totalTime;
            
            document.getElementById('officeTodayExit').textContent = timeString;
            document.getElementById('officeStatus').textContent = 'Ausente';
            
            logActivity('hours', `${currentUser.name} marcou saída do escritório às ${timeString} (${totalTime} trabalhadas)`, 'office');
            alert(`✅ Saída registada às ${timeString}\n\nHoras trabalhadas: ${totalTime} (com 1h de pausa)`);
            updateOfficeTodayRecords();
            updateOfficeWeekRecords();
        }
        
        function officePause() {
            logActivity('hours', `${currentUser.name} iniciou pausa`, 'office');
            alert('⏸️ Pausa registada\n\n1 hora de pausa será deduzida automaticamente no cálculo final.');
        }
        
        function updateOfficeTodayRecords() {
            const dateString = new Date().toLocaleDateString('pt-PT');
            const todayRecord = MAFCSystem.timeRecords['Escritório'][dateString] || {};
            
            document.getElementById('officeTodayEntry').textContent = todayRecord.entry || '--:--';
            document.getElementById('officeTodayExit').textContent = todayRecord.exit || '--:--';
            document.getElementById('officeStatus').textContent = todayRecord.entry ? 
                (todayRecord.exit ? 'Ausente' : 'Presente') : 'Ausente';
        }
        
        function updateOfficeWeekRecords() {
            const table = document.getElementById('officeWeekRecords');
            const today = new Date();
            
            table.innerHTML = '';
            
            // Gerar últimos 7 dias
            for (let i = 6; i >= 0; i--) {
                const date = new Date(today.getTime() - i * 24 * 60 * 60 * 1000);
                const dateString = date.toLocaleDateString('pt-PT');
                const dayName = date.toLocaleDateString('pt-PT', { weekday: 'short' });
                const dateFormatted = date.toLocaleDateString('pt-PT', { day: '2-digit', month: '2-digit' });
                
                const record = MAFCSystem.timeRecords['Escritório'][dateString] || {};
                
                const row = `
                    <tr>
                        <td>${dayName} ${dateFormatted}</td>
                        <td>${record.entry || '--:--'}</td>
                        <td>${record.exit || '--:--'}</td>
                        <td>1h</td>
                        <td>${record.total || '0h'}</td>
                    </tr>
                `;
                table.innerHTML += row;
            }
            
            // Calcular total da semana
            let weekTotal = 0;
            for (let i = 0; i < 7; i++) {
                const date = new Date(today.getTime() - i * 24 * 60 * 60 * 1000);
                const dateString = date.toLocaleDateString('pt-PT');
                const record = MAFCSystem.timeRecords['Escritório'][dateString] || {};
                
                if (record.total) {
                    const match = record.total.match(/(\d+)h/);
                    if (match) {
                        weekTotal += parseInt(match[1]);
                    }
                }
            }
            
            // Atualizar horas do mês
            document.getElementById('officeMonthHours').textContent = weekTotal * 4; // Estimativa
        }
        
        function generateOfficeReport() {
            const monthSelect = document.getElementById('officeReportMonth');
            const [month, year] = monthSelect.value.split('-');
            
            const monthNames = ['Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho', 
                               'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
            const monthName = monthNames[parseInt(month) - 1];
            
            document.getElementById('officeReportTitle').textContent = 
                `Extrato - ${currentUser.name} | ${monthName} ${year}`;
            
            // Gerar dados do extrato (simulado)
            const tableBody = document.getElementById('officeReportBody');
            tableBody.innerHTML = '';
            
            let totalHours = 0;
            let totalExtra = 0;
            
            // Simular 20 dias úteis
            for (let day = 1; day <= 20; day++) {
                const date = `${day.toString().padStart(2, '0')}/${month.padStart(2, '0')}/${year}`;
                const hours = 8 + Math.random() * 0.5; // 8-8.5 horas
                const extra = Math.random() > 0.8 ? Math.random() * 1.5 : 0; // 0-1.5 horas extra
                
                totalHours += hours;
                totalExtra += extra;
                
                const dayName = new Date(`${year}-${month}-${day.toString().padStart(2, '0')}`).toLocaleDateString('pt-PT', { weekday: 'short' });
                
                const row = `
                    <tr>
                        <td>${dayName} ${date}</td>
                        <td>08:${Math.floor(Math.random() * 30).toString().padStart(2, '0')}</td>
                        <td>17:${Math.floor(Math.random() * 30).toString().padStart(2, '0')}</td>
                        <td>${hours.toFixed(1)}h</td>
                        <td>${extra > 0 ? extra.toFixed(1) + 'h' : '0'}</td>
                    </tr>
                `;
                tableBody.innerHTML += row;
            }
            
            // Atualizar totais
            document.getElementById('officeMonthTotal').textContent = totalHours.toFixed(1) + 'h';
            document.getElementById('officeMonthExtra').textContent = totalExtra.toFixed(1) + 'h';
            document.getElementById('officeTotalHours').textContent = totalHours.toFixed(1) + ' horas';
            document.getElementById('officeMonthHours').textContent = Math.floor(totalHours);
        }
        
        function printOfficeReport() {
            alert('🖨️ Preparando para impressão...\n\nO extrato será enviado para a impressora padrão (Drucker).');
            // Em produção: window.print()
        }
        
        function emailOfficeReport() {
            const reportTitle = document.getElementById('officeReportTitle').textContent;
            const totalHours = document.getElementById('officeMonthTotal').textContent;
            const extraHours = document.getElementById('officeMonthExtra').textContent;
            
            const subject = encodeURIComponent(`Extrato Horas - ${currentUser.name}`);
            const body = encodeURIComponent(`Prezada Contabilidade,\n\nSegue extrato de horas:\n\n${reportTitle}\nTotal horas: ${totalHours}\nHoras extra: ${extraHours}\n\nAtenciosamente,\n${currentUser.name}`);
            
            window.open(`mailto:contabilidade@mafc-filho.pt?subject=${subject}&body=${body}`);
        }
        
        function whatsAppOfficeReport() {
            const reportTitle = document.getElementById('officeReportTitle').textContent;
            const totalHours = document.getElementById('officeMonthTotal').textContent;
            const extraHours = document.getElementById('officeMonthExtra').textContent;
            
            const message = `📊 ${reportTitle}\n\nTotal horas: ${totalHours}\nHoras extra: ${extraHours}\n\nEnviado por: ${currentUser.name}`;
            
            const whatsappUrl = `https://wa.me/351123456789?text=${encodeURIComponent(message)}`;
            window.open(whatsappUrl, '_blank');
        }
        
        // ============ FUNÇÕES DE DETALHES DE COMPRA ============
        function viewPurchaseDetails(purchaseId) {
            currentPurchaseId = purchaseId;
            const purchase = MAFCSystem.purchases.find(p => p.id === purchaseId);
            
            if (!purchase) {
                alert('Compra não encontrada!');
                return;
            }
            
            document.getElementById('purchaseDetailsModal').style.display = 'flex';
            
            // Preencher formulário
            document.getElementById('purchaseStatus').value = purchase.status || 'pending';
            document.getElementById('completionDate').value = purchase.completionDate || '';
            document.getElementById('supplierName').value = purchase.supplier || '';
            document.getElementById('purchaseValue').value = purchase.value || '';
            document.getElementById('purchaseNotes').value = purchase.notes || '';
            
            // Carregar histórico
            loadPurchaseHistoryDetails(purchaseId);
        }
        
        function closePurchaseModal() {
            document.getElementById('purchaseDetailsModal').style.display = 'none';
            currentPurchaseId = null;
        }
        
        function updatePurchaseStatus() {
            // Esta função é chamada quando o status muda
            const status = document.getElementById('purchaseStatus').value;
            const completionDate = document.getElementById('completionDate');
            
            // Mostrar campo de data de conclusão apenas para status "delivered"
            if (status === 'delivered') {
                completionDate.style.display = 'block';
                completionDate.previousElementSibling.style.display = 'block';
            } else {
                completionDate.style.display = 'none';
                completionDate.previousElementSibling.style.display = 'none';
            }
        }
        
        function savePurchaseDetails() {
            const purchase = MAFCSystem.purchases.find(p => p.id === currentPurchaseId);
            
            if (!purchase) {
                alert('Compra não encontrada!');
                return;
            }
            
            const oldStatus = purchase.status;
            const newStatus = document.getElementById('purchaseStatus').value;
            const completionDate = document.getElementById('completionDate').value;
            const supplier = document.getElementById('supplierName').value;
            const value = document.getElementById('purchaseValue').value;
            const notes = document.getElementById('purchaseNotes').value;
            
            // Atualizar compra
            purchase.status = newStatus;
            purchase.completionDate = completionDate || purchase.completionDate;
            purchase.supplier = supplier || purchase.supplier;
            purchase.value = value || purchase.value;
            purchase.notes = notes || purchase.notes;
            purchase.lastUpdated = new Date().toISOString();
            purchase.updatedBy = currentUser.name;
            
            // Se foi marcada como entregue, atualizar o pedido original
            if (newStatus === 'delivered' && oldStatus !== 'delivered') {
                const originalRequest = MAFCSystem.materialRequests.find(r => r.id === purchase.requestId);
                if (originalRequest) {
                    originalRequest.status = 'delivered';
                    originalRequest.deliveryDate = completionDate;
                }
                
                // Registrar atividade
                logActivity('purchase', `${currentUser.name} marcou compra #${purchase.id} como entregue`, 'purchase');
                alert(`✅ Compra marcada como entregue em ${completionDate}!`);
            } else if (oldStatus !== newStatus) {
                // Registrar mudança de status
                logActivity('purchase', `${currentUser.name} alterou status da compra #${purchase.id} de ${oldStatus} para ${newStatus}`, 'purchase');
                alert(`✅ Status da compra atualizado para ${newStatus}!`);
            } else {
                alert('✅ Alterações guardadas!');
            }
            
            // Adicionar ao histórico
            if (!purchase.history) purchase.history = [];
            purchase.history.push({
                timestamp: new Date().toISOString(),
                user: currentUser.name,
                action: 'updated',
                details: { status: newStatus, completionDate, supplier, value }
            });
            
            // Atualizar todas as tabelas
            updateApprovedPurchasesTable();
            updatePurchaseHistoryTable();
            
            // Atualizar painel do patrão se necessário
            if (document.getElementById('bossDashboard').style.display === 'block') {
                updateMaterialRequestsTable();
                updatePurchasesTable();
            }
            
            // Atualizar painel do chefe de equipa se necessário
            if (document.getElementById('teamDashboard').style.display === 'block') {
                loadTeamMaterialRequests();
            }
            
            // Fechar modal
            closePurchaseModal();
        }
        
        function loadPurchaseHistoryDetails(purchaseId) {
            const historyDiv = document.getElementById('purchaseHistory');
            const purchase = MAFCSystem.purchases.find(p => p.id === purchaseId);
            
            if (!purchase) {
                historyDiv.innerHTML = '<p>Sem histórico disponível</p>';
                return;
            }
            
            let historyHTML = '';
            
            // Histórico da compra
            if (purchase.history && purchase.history.length > 0) {
                purchase.history.forEach(entry => {
                    const date = new Date(entry.timestamp);
                    const timeString = date.toLocaleTimeString('pt-PT', { hour: '2-digit', minute: '2-digit' });
                    const dateString = date.toLocaleDateString('pt-PT');
                    
                    historyHTML += `
                        <div class="timeline-item">
                            <div class="timeline-date">${dateString} ${timeString}</div>
                            <div><strong>${entry.user}</strong>: ${entry.action}</div>
                            ${entry.details ? `<div style="font-size: 0.9rem; color: var(--gray-600);">${JSON.stringify(entry.details, null, 2)}</div>` : ''}
                        </div>
                    `;
                });
            }
            
            // Informação do pedido original
            const originalRequest = MAFCSystem.materialRequests.find(r => r.id === purchase.requestId);
            if (originalRequest) {
                historyHTML = `
                    <div class="timeline-item">
                        <div class="timeline-date">${originalRequest.date}</div>
                        <div><strong>${originalRequest.requestedBy}</strong>: Pedido criado</div>
                        <div style="font-size: 0.9rem; color: var(--gray-600);">
                            Material: ${originalRequest.material}<br>
                            Quantidade: ${originalRequest.quantity} ${originalRequest.unit}<br>
                            Urgência: ${originalRequest.urgency}
                        </div>
                    </div>
                ` + historyHTML;
            }
            
            historyDiv.innerHTML = historyHTML || '<p>Sem histórico disponível</p>';
        }
        
        // ============ FUNÇÕES DE HISTÓRICO COMPLETO ============
        function openHistoryModal() {
            document.getElementById('historyModal').style.display = 'flex';
            loadHistoryContent();
        }
        
        function closeHistoryModal() {
            document.getElementById('historyModal').style.display = 'none';
        }
        
        function loadHistoryContent() {
            const historyContent = document.getElementById('historyContent');
            const periodFilter = document.getElementById('historyPeriod').value;
            const typeFilter = document.getElementById('historyType').value;
            
            let filteredActivities = MAFCSystem.activityLog;
            
            // Filtrar por período
            const now = new Date();
            filteredActivities = filteredActivities.filter(activity => {
                const activityDate = new Date(activity.timestamp);
                
                switch(periodFilter) {
                    case 'today':
                        return activityDate.toDateString() === now.toDateString();
                    case 'week':
                        const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
                        return activityDate >= weekAgo;
                    case 'month':
                        const monthAgo = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);
                        return activityDate >= monthAgo;
                    default:
                        return true;
                }
            });
            
            // Filtrar por tipo
            if (typeFilter !== 'all') {
                filteredActivities = filteredActivities.filter(activity => activity.type === typeFilter);
            }
            
            historyContent.innerHTML = '';
            
            if (filteredActivities.length === 0) {
                historyContent.innerHTML = '<p class="text-center">Nenhuma atividade encontrada</p>';
                return;
            }
            
            filteredActivities.forEach(activity => {
                const date = new Date(activity.timestamp);
                const timeString = date.toLocaleTimeString('pt-PT', { hour: '2-digit', minute: '2-digit' });
                const dateString = date.toLocaleDateString('pt-PT');
                
                let icon = 'fa-info-circle';
                let color = 'var(--info)';
                let bgColor = 'var(--gray-200)';
                
                switch(activity.type) {
                    case 'login': 
                        icon = 'fa-sign-in-alt'; 
                        color = 'var(--success)'; 
                        bgColor = '#d5f4e6';
                        break;
                    case 'logout': 
                        icon = 'fa-sign-out-alt'; 
                        color = 'var(--danger)'; 
                        bgColor = '#f8d7da';
                        break;
                    case 'hours': 
                        icon = 'fa-clock'; 
                        color = 'var(--warning)'; 
                        bgColor = '#fff3cd';
                        break;
                    case 'material': 
                        icon = 'fa-box'; 
                        color = 'var(--accent)'; 
                        bgColor = '#fff3cd';
                        break;
                    case 'purchase': 
                        icon = 'fa-shopping-cart'; 
                        color = 'var(--purchase)'; 
                        bgColor = '#d5f4e6';
                        break;
                    case 'employee': 
                        icon = 'fa-user'; 
                        color = 'var(--team)'; 
                        bgColor = '#d1ecf1';
                        break;
                }
                
                let roleBadge = '';
                switch(activity.userRole) {
                    case 'boss': roleBadge = '<span class="badge" style="background: var(--boss); color: white;">Patrão</span>'; break;
                    case 'team': roleBadge = '<span class="badge" style="background: var(--team); color: white;">Chefe</span>'; break;
                    case 'purchase': roleBadge = '<span class="badge" style="background: var(--purchase); color: white;">Compras</span>'; break;
                    case 'office': roleBadge = '<span class="badge" style="background: var(--office); color: white;">Escritório</span>'; break;
                }
                
                const activityItem = `
                    <div class="activity-item">
                        <div class="activity-icon" style="background: ${bgColor}; color: ${color};">
                            <i class="fas ${icon}"></i>
                        </div>
                        <div style="flex: 1;">
                            <div style="font-weight: 600;">${activity.description}</div>
                            <div style="font-size: 0.85rem; color: var(--gray-600); display: flex; align-items: center; gap: 1rem; margin-top: 0.25rem;">
                                <span><i class="far fa-clock"></i> ${dateString} ${timeString}</span>
                                <span><i class="fas fa-user"></i> ${activity.user}</span>
                                ${roleBadge}
                            </div>
                        </div>
                    </div>
                `;
                
                historyContent.innerHTML += activityItem;
            });
        }
        
        // ============ FUNÇÕES COMUNS ============
        function updateActiveMenu(dashboard) {
            // Remover active de todos os menus do dashboard atual
            const currentDashboard = document.querySelector(`.${dashboard}-dashboard`);
            if (currentDashboard) {
                currentDashboard.querySelectorAll('.menu-item').forEach(item => {
                    item.classList.remove('active');
                });
                
                currentDashboard.querySelectorAll('.dashboard-section').forEach(section => {
                    section.classList.remove('active');
                });
                
                // Ativar primeira seção
                const firstMenuItem = currentDashboard.querySelector('.menu-item');
                if (firstMenuItem) {
                    firstMenuItem.classList.add('active');
                    const sectionId = firstMenuItem.getAttribute('data-section') + 'Section';
                    const section = document.getElementById(sectionId);
                    if (section) section.classList.add('active');
                }
            }
        }
        
        // Navegação do menu
        document.querySelectorAll('.menu-item').forEach(item => {
            item.addEventListener('click', function(e) {
                e.preventDefault();
                
                const dashboard = this.closest('.dashboard');
                const sectionId = this.getAttribute('data-section') + 'Section';
                
                // Remover active de todos os itens do mesmo dashboard
                dashboard.querySelectorAll('.menu-item').forEach(i => {
                    i.classList.remove('active');
                });
                
                // Adicionar active ao item clicado
                this.classList.add('active');
                
                // Esconder todas as seções do dashboard
                dashboard.querySelectorAll('.dashboard-section').forEach(section => {
                    section.classList.remove('active');
                });
                
                // Mostrar seção selecionada
                const section = document.getElementById(sectionId);
                if (section) section.classList.add('active');
            });
        });
        
        // ============ FUNÇÕES DO PATRÃO (OUTRAS) ============
        function refreshLocations() {
            alert('📍 Localizações atualizadas em tempo real!\n\nTodas as equipas na Alemanha foram localizadas.');
            logActivity('system', 'Localizações das equipas atualizadas', 'boss');
        }
        
        function viewAllRequests() {
            // Ativar seção de pedidos de material
            const bossDashboard = document.getElementById('bossDashboard');
            bossDashboard.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active');
                if (item.getAttribute('data-section') === 'materials') {
                    item.classList.add('active');
                }
            });
            
            bossDashboard.querySelectorAll('.dashboard-section').forEach(section => {
                section.classList.remove('active');
                if (section.id === 'materialsSection') {
                    section.classList.add('active');
                }
            });
        }
        
        function addNewTeam() {
            alert('👷 Adicionar nova equipa - Funcionalidade em desenvolvimento...');
        }
        
        function viewTeamDetails(teamId) {
            const team = MAFCSystem.teams.find(t => t.id === teamId);
            if (team) {
                const employees = MAFCSystem.employees[team.name] || [];
                let employeesList = '';
                employees.forEach(emp => {
                    employeesList += `• ${emp.name} (${emp.position})\n`;
                });
                
                alert(`🔍 Detalhes da Equipa:\n\nNome: ${team.name}\nChefe: ${team.leader}\nLocalização: ${team.location}\nPaís: ${team.country === 'germany' ? 'Alemanha' : 'Portugal'}\nObra: ${team.currentWork}\nTrabalhadores: ${team.workers}\n\nEmpregados:\n${employeesList}\nGPS: ${team.gps}\nEstado: ${team.status}`);
            }
        }
        
        function editTeam(teamId) {
            alert('✏️ Editar equipa - Funcionalidade em desenvolvimento...');
        }
        
        function exportHours() {
            alert('📊 Exportando registos de horas para Excel...\n\nFicheiro gerado: horas_trabalhadas_mafc.xlsx');
            logActivity('system', 'Exportados registos de horas', 'boss');
        }
        
        function simulateClockIn() {
            const time = new Date().toLocaleTimeString('pt-PT');
            alert(`⏰ Simulação de entrada registada às ${time}\n\nO patrão em Portugal pode ver em tempo real as entradas na Alemanha.`);
        }
        
        function simulateClockOut() {
            const time = new Date().toLocaleTimeString('pt-PT');
            alert(`⏰ Simulação de saída registada às ${time}\n\nHoras calculadas automaticamente para banco de horas.`);
        }
        
        function exportToAccounting() {
            alert('💰 Exportando dados para contabilidade...\n\nBanco de horas (>160h/mês) exportado para ficheiro contabilístico.');
            logActivity('system', 'Exportados dados contabilidade', 'boss');
        }
        
        function approveRequest(requestId) {
            // Esta função é usada pelo patrão para aprovar diretamente
            const request = MAFCSystem.materialRequests.find(r => r.id === requestId);
            if (request) {
                request.status = 'approved';
                request.approvedBy = currentUser.name;
                request.approvedDate = new Date().toLocaleDateString('pt-PT');
                
                logActivity('material', `${currentUser.name} (patrão) aprovou pedido de ${request.material}`, 'boss');
                alert(`✅ Pedido aprovado pelo patrão!\n\nO departamento de compras será notificado para processar a encomenda.`);
                
                // Atualizar tabelas
                loadUrgentRequests();
                updateMaterialRequestsTable();
            }
        }
        
        function rejectRequest(requestId) {
            const request = MAFCSystem.materialRequests.find(r => r.id === requestId);
            if (request) {
                const reason = prompt('Motivo da recusa:');
                if (reason) {
                    request.status = 'rejected';
                    request.rejectionReason = reason;
                    request.rejectedBy = currentUser.name;
                    request.rejectedDate = new Date().toLocaleDateString('pt-PT');
                    
                    logActivity('material', `${currentUser.name} (patrão) recusou pedido de ${request.material}`, 'boss');
                    alert(`❌ Pedido recusado pelo patrão!\n\nMotivo: ${reason}`);
                    
                    // Atualizar tabelas
                    loadUrgentRequests();
                    updateMaterialRequestsTable();
                }
            }
        }
        
        function viewRequestDetails(requestId) {
            const request = MAFCSystem.materialRequests.find(r => r.id === requestId);
            if (request) {
                let statusText = '';
                switch(request.status) {
                    case 'pending': statusText = 'Pendente'; break;
                    case 'approved': statusText = 'Aprovado'; break;
                    case 'rejected': statusText = 'Recusado'; break;
                    case 'delivered': statusText = 'Entregue'; break;
                }
                
                alert(`📋 Detalhes do Pedido #${requestId}:\n\nEquipa: ${request.team}\nMaterial: ${request.material}\nQuantidade: ${request.quantity} ${request.unit}\nUrgência: ${request.urgency}\nData: ${request.date}\nSolicitado por: ${request.requestedBy}\nEstado: ${statusText}\n${request.estimatedValue ? `Valor estimado: ${request.estimatedValue}€\n` : ''}${request.notes ? `Observações: ${request.notes}` : ''}`);
            }
        }
        
        function exportMaterialRequests() {
            alert('📊 Exportando pedidos de material para Excel...\n\nFicheiro gerado: pedidos_material_mafc.xlsx');
            logActivity('system', 'Exportados pedidos de material', 'boss');
        }
        
        function refreshMaterialRequests() {
            updateMaterialRequestsTable();
            alert('🔄 Pedidos de material atualizados!');
        }
        
        function exportPurchases() {
            alert('📄 Exportando histórico de compras para PDF...\n\nFicheiro gerado: historico_compras_mafc.pdf');
            logActivity('system', 'Exportado histórico de compras', 'boss');
        }
        
        function generatePurchaseReport() {
            alert('📈 Gerando relatório de compras...\n\nRelatório com estatísticas e gráficos será gerado.');
            logActivity('system', 'Gerado relatório de compras', 'boss');
        }
        
        // ============ FUNÇÕES DE COMPRAS (OUTRAS) ============
        function processAllUrgent() {
            const urgentRequests = MAFCSystem.materialRequests.filter(r => 
                (r.urgency === 'critical' || r.urgency === 'urgent') && r.status === 'pending'
            );
            
            if (urgentRequests.length === 0) {
                alert('Não há pedidos urgentes para processar!');
                return;
            }
            
            if (confirm(`Processar TODOS os ${urgentRequests.length} pedidos urgentes?`)) {
                urgentRequests.forEach(request => {
                    approvePurchase(request.id);
                });
                alert(`✅ ${urgentRequests.length} pedidos urgentes processados!`);
            }
        }
        
        function newPurchase() {
            alert('🛒 Criar nova compra manual - Funcionalidade em desenvolvimento...');
        }
        
        function approveAll() {
            const pendingRequests = MAFCSystem.materialRequests.filter(r => r.status === 'pending');
            
            if (pendingRequests.length === 0) {
                alert('Não há pedidos pendentes!');
                return;
            }
            
            if (confirm(`Aprovar TODOS os ${pendingRequests.length} pedidos pendentes?`)) {
                pendingRequests.forEach(request => {
                    approvePurchase(request.id);
                });
                alert(`✅ ${pendingRequests.length} pedidos aprovados!`);
            }
        }
        
        function rejectAll() {
            const pendingRequests = MAFCSystem.materialRequests.filter(r => r.status === 'pending');
            
            if (pendingRequests.length === 0) {
                alert('Não há pedidos pendentes!');
                return;
            }
            
            if (confirm(`Recusar TODOS os ${pendingRequests.length} pedidos pendentes?`)) {
                const reason = prompt('Motivo da recusa em massa:');
                if (reason) {
                    pendingRequests.forEach(request => {
                        request.status = 'rejected';
                        request.rejectionReason = reason;
                        request.rejectedDate = new Date().toLocaleDateString('pt-PT');
                        request.processedBy = currentUser.name;
                    });
                    
                    logActivity('purchase', `${currentUser.name} recusou ${pendingRequests.length} pedidos`, 'purchase');
                    alert(`❌ ${pendingRequests.length} pedidos recusados!\n\nMotivo: ${reason}`);
                    
                    // Atualizar tabelas
                    updatePendingRequestsTable();
                }
            }
        }
        
        function registerNewOrder() {
            alert('📝 Registar nova encomenda com fornecedor - Funcionalidade em desenvolvimento...');
        }
        
        function openPurchaseHistory() {
            // Ativar seção de histórico
            const purchaseDashboard = document.getElementById('purchaseDashboard');
            purchaseDashboard.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active');
                if (item.getAttribute('data-section') === 'purchaseHistory') {
                    item.classList.add('active');
                }
            });
            
            purchaseDashboard.querySelectorAll('.dashboard-section').forEach(section => {
                section.classList.remove('active');
                if (section.id === 'purchaseHistorySection') {
                    section.classList.add('active');
                }
            });
        }
        
        function exportPurchaseHistory() {
            alert('📊 Exportando histórico de compras para Excel...\n\nFicheiro gerado: historico_compras_detalhado.xlsx');
            logActivity('system', 'Exportado histórico detalhado de compras', 'purchase');
        }
        
        function editPurchase(purchaseId) {
            viewPurchaseDetails(purchaseId);
        }
        
        // ============ OUTRAS FUNÇÕES ============
        function showMaterialRequestForm() {
            // Ativar seção de pedidos de material
            const teamDashboard = document.getElementById('teamDashboard');
            teamDashboard.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active');
                if (item.getAttribute('data-section') === 'teamMaterials') {
                    item.classList.add('active');
                }
            });
            
            teamDashboard.querySelectorAll('.dashboard-section').forEach(section => {
                section.classList.remove('active');
                if (section.id === 'teamMaterialsSection') {
                    section.classList.add('active');
                }
            });
        }
        
        function addCustomMaterial() {
            const materialName = prompt('Nome do material personalizado:');
            if (materialName) {
                const unit = prompt('Unidade de medida (ex: unidades, kg, litros):');
                if (unit) {
                    // Adicionar ao select
                    const select = document.getElementById('materialSelect');
                    const option = document.createElement('option');
                    option.value = 'custom-' + Date.now();
                    option.textContent = `${materialName} (${unit})`;
                    select.appendChild(option);
                    select.value = option.value;
                    
                    alert(`✅ Material personalizado "${materialName}" adicionado!`);
                }
            }
        }
        
        function updateGPSLocation() {
            // Simular atualização de GPS
            const team = MAFCSystem.teams.find(t => t.name === currentUser.team);
            if (team) {
                // Adicionar pequena variação às coordenadas
                const lat = parseFloat(team.gps.split('°')[0]);
                const lng = parseFloat(team.gps.split(',')[1].split('°')[0]);
                
                const newLat = (lat + (Math.random() - 0.5) * 0.001).toFixed(4);
                const newLng = (lng + (Math.random() - 0.5) * 0.001).toFixed(4);
                
                team.gps = `${newLat}° N, ${newLng}° E`;
                
                document.getElementById('gpsLat').textContent = `${newLat}° N`;
                document.getElementById('gpsLng').textContent = `${newLng}° E`;
                
                logActivity('system', `Localização GPS da ${currentUser.team} atualizada`, 'team');
                alert('📍 Localização GPS atualizada!\n\nO patrão pode ver a nova localização em tempo real.');
            }
        }
        
        function sendLocationToBoss() {
            const team = MAFCSystem.teams.find(t => t.name === currentUser.team);
            if (team) {
                const message = `📍 LOCALIZAÇÃO DA EQUIPA\n\nEquipa: ${team.name}\nLocalização: ${team.location}\nGPS: ${team.gps}\nObra: ${team.currentWork}\nEstado: ${team.status === 'working' ? 'A trabalhar' : 'Parado'}\n\nEnviado por: ${currentUser.name}`;
                
                // Simular envio ao patrão
                logActivity('system', `${currentUser.name} enviou localização da equipa ao patrão`, 'team');
                alert('📤 Localização enviada ao patrão!\n\nO patrão recebeu a localização atual da equipa.');
            }
        }
        
        function viewEmployeeReport(employeeId) {
            const employees = MAFCSystem.employees[currentUser.team] || [];
            const employee = employees.find(e => e.id === employeeId);
            
            if (employee) {
                alert(`📊 Relatório do Empregado:\n\nNome: ${employee.name}\nWhatsApp: ${employee.whatsapp}\nCargo: ${employee.position}\nSalário: ${employee.salary}€/mês\nData de Início: ${employee.startDate}\nEstado: ${employee.status === 'active' ? 'Ativo' : 'Inativo'}\n\nHoras este mês: 160h (estimado)\nBanco de horas: +8h\n\nPróximo passo: Gerar extrato mensal completo.`);
            }
        }
        
        function generateMonthlyReport() {
            const monthSelect = document.getElementById('teamReportMonth');
            const employeeSelect = document.getElementById('teamReportEmployee');
            
            const [month, year] = monthSelect.value.split('-');
            const employeeId = employeeSelect.value === 'all' ? null : parseInt(employeeSelect.value);
            
            // Encontrar empregado
            let employeeName = 'Todos os Empregados';
            if (employeeId) {
                const employees = MAFCSystem.employees[currentUser.team] || [];
                const employee = employees.find(e => e.id === employeeId);
                if (employee) {
                    employeeName = employee.name;
                }
            }
            
            // Atualizar título
            const monthNames = ['Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho', 
                               'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
            const monthName = monthNames[parseInt(month) - 1];
            
            document.getElementById('teamReportTitle').textContent = 
                `Extrato - ${employeeName} | ${monthName} ${year}`;
            
            // Gerar dados do extrato (simulado)
            const timeSheetBody = document.getElementById('teamTimeSheetBody');
            timeSheetBody.innerHTML = '';
            
            let totalHours = 0;
            let totalExtra = 0;
            
            // Simular 20 dias de trabalho
            for (let day = 1; day <= 20; day++) {
                const date = `${day.toString().padStart(2, '0')}/${month.padStart(2, '0')}/${year}`;
                const hours = 8 + Math.random();
                const extra = Math.random() > 0.7 ? Math.random() * 2 : 0;
                
                totalHours += hours;
                totalExtra += extra;
                
                const row = `
                    <tr>
                        <td>${date}</td>
                        <td>${employeeName}</td>
                        <td>${hours.toFixed(1)}h</td>
                        <td>${extra > 0 ? extra.toFixed(1) + 'h' : '0'}</td>
                        <td>${(hours + extra).toFixed(1)}h</td>
                    </tr>
                `;
                timeSheetBody.innerHTML += row;
            }
            
            // Atualizar totais
            document.getElementById('teamTotalHours').textContent = 
                `${totalHours.toFixed(1)}h (${totalExtra.toFixed(1)} extra)`;
            
            // Atualizar também no modal
            if (document.getElementById('reportTitle')) {
                document.getElementById('reportTitle').textContent = 
                    `Extrato - ${employeeName} | ${monthName} ${year}`;
                document.getElementById('totalHours').textContent = 
                    `${totalHours.toFixed(1)} horas`;
                
                // Preencher tabela do modal
                const modalBody = document.getElementById('timeSheetBody');
                modalBody.innerHTML = timeSheetBody.innerHTML;
            }
        }
        
        function openMonthlyReportModal() {
            document.getElementById('monthlyReportModal').style.display = 'flex';
            generateMonthlyReport();
        }
        
        function closeMonthlyReportModal() {
            document.getElementById('monthlyReportModal').style.display = 'none';
        }
        
        function printTeamReport() {
            alert('🖨️ Preparando para impressão...\n\nO relatório será enviado para a impressora padrão (Drucker).');
            logActivity('system', 'Impresso relatório de horas', 'team');
        }
        
        function sendTeamReportWhatsApp() {
            const reportTitle = document.getElementById('teamReportTitle').textContent;
            const totalHours = document.getElementById('teamTotalHours').textContent;
            
            const message = `📊 ${reportTitle}\n\nTotal de horas: ${totalHours}\n\nEnviado do sistema MAFC Team Control`;
            
            // Aqui seria o WhatsApp da contabilidade
            const whatsappUrl = `https://wa.me/351123456789?text=${encodeURIComponent(message)}`;
            window.open(whatsappUrl, '_blank');
            logActivity('system', 'Enviado relatório por WhatsApp', 'team');
        }
        
        function printReport() {
            alert('🖨️ Preparando para impressão...\n\nO extrato será enviado para a impressora padrão (Drucker).');
        }
        
        function sendReportEmail() {
            const reportTitle = document.getElementById('reportTitle').textContent;
            const totalHours = document.getElementById('totalHours').textContent;
            
            const subject = encodeURIComponent(`Extrato Horas - ${reportTitle}`);
            const body = encodeURIComponent(`Segue em anexo o extrato de horas.\n\n${reportTitle}\nTotal horas: ${totalHours}\n\nEste é um email automático do sistema MAFC.`);
            
            window.open(`mailto:contabilidade@mafc-filho.pt?subject=${subject}&body=${body}`);
        }
        
        function sendReportWhatsApp() {
            const reportTitle = document.getElementById('reportTitle').textContent;
            const totalHours = document.getElementById('totalHours').textContent;
            
            const message = `📊 ${reportTitle}\n\nTotal de horas: ${totalHours}\n\nEnviado do sistema MAFC Team Control`;
            
            const whatsappUrl = `https://wa.me/351123456789?text=${encodeURIComponent(message)}`;
            window.open(whatsappUrl, '_blank');
        }
        
        // ============ INICIALIZAÇÃO DO SISTEMA ============
        function initializeDashboard() {
            // Atualizar relógios em tempo real
            updateClocks();
            setInterval(updateClocks, 1000);
            
            // Carregar materiais para chefe de equipa
            if (currentUser.role === 'team') {
                loadMaterialsByCategory('construction');
            }
            
            // Adicionar event listeners para fechar modais
            document.querySelectorAll('.close-employee-modal, .close-report-modal, .close-purchase-modal, .close-history-modal').forEach(closeBtn => {
                closeBtn.addEventListener('click', function() {
                    this.closest('.modal-employee, .modal-monthly-report, .modal-purchase-details, .modal-history').style.display = 'none';
                });
            });
            
            // Fechar modais ao clicar fora
            window.addEventListener('click', function(e) {
                if (e.target.classList.contains('modal-employee')) {
                    document.getElementById('employeeModal').style.display = 'none';
                }
                if (e.target.classList.contains('modal-monthly-report')) {
                    document.getElementById('monthlyReportModal').style.display = 'none';
                }
                if (e.target.classList.contains('modal-purchase-details')) {
                    document.getElementById('purchaseDetailsModal').style.display = 'none';
                }
                if (e.target.classList.contains('modal-history')) {
                    document.getElementById('historyModal').style.display = 'none';
                }
            });
            
            // Inicializar alguns dados de exemplo
            initializeSampleData();
        }
        
        function initializeSampleData() {
            // Adicionar alguns pedidos de material de exemplo
            if (MAFCSystem.materialRequests.length === 0) {
                const sampleRequests = [
                    {
                        id: ++MAFCSystem.lastId.materialRequest,
                        team: 'Equipa 01 - Berlin',
                        material: 'Cimento',
                        category: 'construction',
                        quantity: 50,
                        unit: 'sacos',
                        urgency: 'critical',
                        notes: 'Urgente para obra de saneamento',
                        date: '10/12/2024',
                        timestamp: new Date('2024-12-10').toISOString(),
                        status: 'pending',
                        requestedBy: 'João Silva',
                        estimatedValue: 250
                    },
                    {
                        id: ++MAFCSystem.lastId.materialRequest,
                        team: 'Equipa 02 - Hamburg',
                        material: 'Areia',
                        category: 'construction',
                        quantity: 10,
                        unit: 'm³',
                        urgency: 'urgent',
                        notes: 'Para pavimentação',
                        date: '09/12/2024',
                        timestamp: new Date('2024-12-09').toISOString(),
                        status: 'approved',
                        requestedBy: 'Carlos Mendes',
                        estimatedValue: 250,
                        approvedDate: '10/12/2024',
                        processedBy: 'Responsável Compras'
                    },
                    {
                        id: ++MAFCSystem.lastId.materialRequest,
                        team: 'Equipa 03 - Munich',
                        material: 'Gasóleo',
                        category: 'consumables',
                        quantity: 200,
                        unit: 'litros',
                        urgency: 'normal',
                        notes: 'Para máquinas da obra',
                        date: '08/12/2024',
                        timestamp: new Date('2024-12-08').toISOString(),
                        status: 'delivered',
                        requestedBy: 'Miguel Santos',
                        estimatedValue: 320,
                        approvedDate: '09/12/2024',
                        deliveryDate: '11/12/2024',
                        processedBy: 'Responsável Compras'
                    }
                ];
                
                MAFCSystem.materialRequests.push(...sampleRequests);
                
                // Adicionar compras de exemplo
                const samplePurchases = [
                    {
                        id: ++MAFCSystem.lastId.purchase,
                        requestId: 2,
                        team: 'Equipa 02 - Hamburg',
                        material: 'Areia',
                        quantity: 10,
                        unit: 'm³',
                        urgency: 'urgent',
                        date: '10/12/2024',
                        timestamp: new Date('2024-12-10').toISOString(),
                        status: 'ordered',
                        estimatedValue: 250,
                        supplier: 'Fornecedor A',
                        value: 245,
                        expectedDelivery: '15/12/2024',
                        processedBy: 'Responsável Compras',
                        history: [
                            {
                                timestamp: new Date('2024-12-10').toISOString(),
                                user: 'Responsável Compras',
                                action: 'approved',
                                details: { status: 'approved' }
                            },
                            {
                                timestamp: new Date('2024-12-11').toISOString(),
                                user: 'Responsável Compras',
                                action: 'ordered',
                                details: { supplier: 'Fornecedor A', value: 245 }
                            }
                        ]
                    },
                    {
                        id: ++MAFCSystem.lastId.purchase,
                        requestId: 3,
                        team: 'Equipa 03 - Munich',
                        material: 'Gasóleo',
                        quantity: 200,
                        unit: 'litros',
                        urgency: 'normal',
                        date: '09/12/2024',
                        timestamp: new Date('2024-12-09').toISOString(),
                        status: 'delivered',
                        estimatedValue: 320,
                        supplier: 'Fornecedor B',
                        value: 310,
                        expectedDelivery: '11/12/2024',
                        completionDate: '11/12/2024',
                        processedBy: 'Responsável Compras',
                        history: [
                            {
                                timestamp: new Date('2024-12-09').toISOString(),
                                user: 'Responsável Compras',
                                action: 'approved',
                                details: { status: 'approved' }
                            },
                            {
                                timestamp: new Date('2024-12-10').toISOString(),
                                user: 'Responsável Compras',
                                action: 'ordered',
                                details: { supplier: 'Fornecedor B', value: 310 }
                            },
                            {
                                timestamp: new Date('2024-12-11').toISOString(),
                                user: 'Responsável Compras',
                                action: 'delivered',
                                details: { status: 'delivered', completionDate: '11/12/2024' }
                            }
                        ]
                    }
                ];
                
                MAFCSystem.purchases.push(...samplePurchases);
                
                // Adicionar atividades de exemplo
                const sampleActivities = [
                    {
                        id: ++MAFCSystem.lastId.activity,
                        timestamp: new Date('2024-12-11T08:30:00').toISOString(),
                        type: 'login',
                        description: 'João Silva entrou no sistema',
                        user: 'João Silva',
                        userRole: 'team',
                        details: {}
                    },
                    {
                        id: ++MAFCSystem.lastId.activity,
                        timestamp: new Date('2024-12-11T08:45:00').toISOString(),
                        type: 'hours',
                        description: 'João Silva marcou entrada às 08:30',
                        user: 'João Silva',
                        userRole: 'team',
                        details: {}
                    },
                    {
                        id: ++MAFCSystem.lastId.activity,
                        timestamp: new Date('2024-12-11T09:15:00').toISOString(),
                        type: 'material',
                        description: 'Equipa 01 - Berlin pediu 50 sacos de Cimento',
                        user: 'João Silva',
                        userRole: 'team',
                        details: {}
                    },
                    {
                        id: ++MAFCSystem.lastId.activity,
                        timestamp: new Date('2024-12-11T10:00:00').toISOString(),
                        type: 'login',
                        description: 'Responsável Compras entrou no sistema',
                        user: 'Responsável Compras',
                        userRole: 'purchase',
                        details: {}
                    },
                    {
                        id: ++MAFCSystem.lastId.activity,
                        timestamp: new Date('2024-12-11T10:30:00').toISOString(),
                        type: 'purchase',
                        description: 'Responsável Compras aprovou pedido de Areia',
                        user: 'Responsável Compras',
                        userRole: 'purchase',
                        details: {}
                    }
                ];
                
                MAFCSystem.activityLog.push(...sampleActivities);
            }
        }
        
        function updateClocks() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('pt-PT');
            const timeShort = now.toLocaleTimeString('pt-PT', { hour: '2-digit', minute: '2-digit' });
            
            // Atualizar todos os relógios
            document.querySelectorAll('#bossCurrentTime, #teamCurrentTime, #purchaseCurrentTime, #officeCurrentTime').forEach(el => {
                if (el) el.textContent = timeShort;
            });
            
            // Atualizar relógios grandes
            document.querySelectorAll('#bossCurrentTimeFull, #teamClock, #officeClock').forEach(el => {
                if (el) el.textContent = timeString;
            });
        }
        
        // Logout
        document.querySelectorAll('.logout-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                if (confirm('Tem certeza que deseja sair do sistema?')) {
                    // Registrar atividade
                    if (currentUser) {
                        logActivity('logout', `${currentUser.name} saiu do sistema`, currentUser.role);
                    }
                    
                    // Esconder todos os dashboards
                    document.querySelectorAll('.dashboard').forEach(d => {
                        d.style.display = 'none';
                    });
                    
                    // Mostrar website público
                    document.getElementById('publicWebsite').style.display = 'block';
                    
                    // Fechar todos os modais
                    document.querySelectorAll('.modal, .modal-employee, .modal-monthly-report, .modal-purchase-details, .modal-history').forEach(modal => {
                        modal.style.display = 'none';
                    });
                    
                    // Limpar formulário de login
                    document.getElementById('loginForm').reset();
                    currentUser = null;
                    editingEmployeeId = null;
                    currentPurchaseId = null;
                }
            });
        });
        
        // Inicializar sistema
        updateClocks();
        initializeDashboard();
        
        // Adicionar event listeners para modais
        window.addEventListener('load', () => {
            // Fechar modais com ESC
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    document.querySelectorAll('.modal, .modal-employee, .modal-monthly-report, .modal-purchase-details, .modal-history').forEach(modal => {
                        modal.style.display = 'none';
                    });
                }
            });
        });
    </script>
</body>
</html>
