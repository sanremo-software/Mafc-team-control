<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MAFC & FILHO, LDA. - Sistema de Gestão</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ============ RESET E VARIÁVEIS ============ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #1a5f7a;
            --secondary: #2d9cdb;
            --accent: #ff9f1c;
            --dark: #003049;
            --light: #f8f9fa;
            --success: #27ae60;
            --warning: #f39c12;
            --danger: #e74c3c;
            --info: #17a2b8;
            --boss: #8e44ad;
            --team: #3498db;
            --purchase: #2ecc71;
            --office: #9b59b6;
            --construction: #e67e22;
            --gray: #6c757d;
            --light-gray: #e9ecef;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: var(--light);
            overflow-x: hidden;
        }

        .container {
            width: 90%;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* ============ PÁGINA PÚBLICA ============ */
        #publicWebsite {
            min-height: 100vh;
        }

        /* Header Público */
        .public-header {
            background: linear-gradient(135deg, var(--dark), var(--primary));
            color: white;
            padding: 1.5rem 0;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        }

        .nav-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo i {
            font-size: 2.8rem;
            color: var(--accent);
        }

        .logo-text h1 {
            font-size: 1.8rem;
            font-weight: 800;
        }

        .logo-text span {
            color: var(--accent);
            font-size: 1rem;
            display: block;
            margin-top: 5px;
        }

        .cta-buttons {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        /* Botões */
        .btn {
            padding: 12px 30px;
            border-radius: 50px;
            font-weight: 600;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            white-space: nowrap;
        }

        .btn-whatsapp {
            background: #25D366;
            color: white;
        }

        .btn-whatsapp:hover {
            background: #1da851;
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(37, 211, 102, 0.4);
        }

        .btn-email {
            background: var(--accent);
            color: var(--dark);
        }

        .btn-email:hover {
            background: #ffb143;
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(255, 159, 28, 0.3);
        }

        .btn-login {
            background: var(--primary);
            color: white;
        }

        .btn-login:hover {
            background: var(--dark);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(26, 95, 122, 0.3);
        }

        /* Hero Section */
        .hero {
            background: linear-gradient(rgba(0, 48, 73, 0.88), rgba(0, 48, 73, 0.92)), 
                        url('https://images.unsplash.com/photo-1504307651254-35680f356dfd?ixlib=rb-4.0.3&auto=format&fit=crop&w=1800&q=80');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            color: white;
            padding: 180px 0 120px;
            text-align: center;
            margin-top: 80px;
        }

        .hero h2 {
            font-size: 3.8rem;
            margin-bottom: 25px;
            font-weight: 900;
            text-transform: uppercase;
            text-shadow: 3px 3px 8px rgba(0,0,0,0.4);
            line-height: 1.2;
        }

        .hero p {
            font-size: 1.4rem;
            max-width: 850px;
            margin: 0 auto 50px;
            opacity: 0.95;
            line-height: 1.8;
        }

        .hero-buttons {
            display: flex;
            gap: 25px;
            justify-content: center;
            margin-top: 40px;
            flex-wrap: wrap;
        }

        /* Galeria de Projetos */
        .gallery {
            padding: 100px 0;
            background: white;
        }

        .section-title {
            text-align: center;
            font-size: 2.8rem;
            color: var(--dark);
            margin-bottom: 70px;
            position: relative;
            font-weight: 800;
        }

        .section-title:after {
            content: '';
            position: absolute;
            bottom: -20px;
            left: 50%;
            transform: translateX(-50%);
            width: 120px;
            height: 5px;
            background: var(--accent);
            border-radius: 10px;
        }

        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-top: 60px;
        }

        .gallery-item {
            border-radius: 15px;
            overflow: hidden;
            position: relative;
            height: 250px;
            cursor: pointer;
        }

        .gallery-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s;
        }

        .gallery-item:hover img {
            transform: scale(1.1);
        }

        .gallery-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent, rgba(0,0,0,0.8));
            color: white;
            padding: 20px;
            transform: translateY(100%);
            transition: transform 0.3s;
        }

        .gallery-item:hover .gallery-overlay {
            transform: translateY(0);
        }

        /* ============ MODAL LOGIN ============ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: white;
            width: 90%;
            max-width: 500px;
            border-radius: 20px;
            overflow: hidden;
            animation: modalSlideIn 0.4s;
            box-shadow: 0 25px 50px rgba(0,0,0,0.3);
        }

        @keyframes modalSlideIn {
            from { transform: translateY(-50px) scale(0.9); opacity: 0; }
            to { transform: translateY(0) scale(1); opacity: 1; }
        }

        .modal-header {
            background: linear-gradient(135deg, var(--dark), var(--primary));
            color: white;
            padding: 25px;
            text-align: center;
            position: relative;
        }

        .modal-header h2 {
            font-size: 2rem;
            font-weight: 700;
        }

        .close-modal {
            position: absolute;
            top: 20px;
            right: 25px;
            font-size: 1.8rem;
            cursor: pointer;
            color: white;
            transition: color 0.3s;
        }

        .close-modal:hover {
            color: var(--accent);
        }

        .modal-body {
            padding: 50px;
        }

        .form-group {
            margin-bottom: 30px;
        }

        .form-group label {
            display: block;
            margin-bottom: 10px;
            color: var(--dark);
            font-weight: 600;
            font-size: 1.1rem;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 15px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1.1rem;
            transition: all 0.3s;
            background: #f8f9fa;
        }

        .form-group input:focus, .form-group select:focus {
            border-color: var(--primary);
            outline: none;
            background: white;
            box-shadow: 0 0 0 3px rgba(26, 95, 122, 0.1);
        }

        .login-submit {
            background: linear-gradient(135deg, var(--primary), var(--dark));
            color: white;
            border: none;
            padding: 18px 40px;
            border-radius: 12px;
            font-size: 1.2rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .login-submit:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(26, 95, 122, 0.3);
            background: linear-gradient(135deg, var(--dark), var(--primary));
        }

        /* ============ DASHBOARDS ============ */
        .dashboard {
            display: none;
            min-height: 100vh;
            background: #f0f2f5;
        }

        /* Top Bar Horizontal */
        .top-bar {
            background: white;
            padding: 0;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            border-bottom: 5px solid;
        }

        /* Cores diferentes para cada dashboard */
        .boss-dashboard .top-bar {
            border-bottom-color: var(--boss);
            background: linear-gradient(135deg, #9b59b6, var(--boss));
        }

        .team-dashboard .top-bar {
            border-bottom-color: var(--team);
            background: linear-gradient(135deg, #3498db, #2980b9);
        }

        .purchase-dashboard .top-bar {
            border-bottom-color: var(--purchase);
            background: linear-gradient(135deg, #2ecc71, #27ae60);
        }

        .office-dashboard .top-bar {
            border-bottom-color: var(--office);
            background: linear-gradient(135deg, var(--office), #8e44ad);
        }

        .top-bar-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
        }

        .dashboard-brand {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .dashboard-brand i {
            font-size: 2.2rem;
            color: white;
        }

        .dashboard-brand h1 {
            color: white;
            font-size: 1.8rem;
            font-weight: 700;
        }

        .dashboard-info {
            display: flex;
            align-items: center;
            gap: 25px;
            color: white;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
            background: rgba(255,255,255,0.15);
            padding: 10px 20px;
            border-radius: 50px;
            backdrop-filter: blur(10px);
        }

        .user-info i {
            font-size: 1.4rem;
        }

        .logout-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid rgba(255,255,255,0.3);
            padding: 10px 25px;
            border-radius: 50px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
            backdrop-filter: blur(10px);
        }

        .logout-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
            border-color: white;
        }

        /* Menu Horizontal FIXO NO TOPO */
        .horizontal-menu {
            background: white;
            margin-top: 70px;
            padding: 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            position: fixed;
            width: 100%;
            z-index: 999;
            overflow-x: auto;
        }

        .menu-container {
            display: flex;
            gap: 5px;
            padding: 0;
            width: 100%;
        }

        .menu-item {
            padding: 20px 30px;
            color: #555;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 15px;
            font-weight: 600;
            white-space: nowrap;
            border-bottom: 4px solid transparent;
            transition: all 0.3s;
            position: relative;
        }

        .menu-item:hover {
            color: var(--primary);
            background: #f8f9fa;
        }

        .menu-item.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
            background: #f0f7ff;
        }

        .menu-item i {
            font-size: 1.2rem;
        }

        .menu-badge {
            background: var(--accent);
            color: white;
            font-size: 0.75rem;
            padding: 3px 8px;
            border-radius: 20px;
            margin-left: 8px;
            font-weight: 700;
        }

        /* Conteúdo do Dashboard - AFASTADO DO MENU FIXO */
        .dashboard-content {
            margin-top: 140px;
            padding: 20px 30px 80px 30px; /* Adicionado padding-bottom para o menu do fundo */
            background: #f0f2f5;
            min-height: calc(100vh - 140px);
        }

        /* MENU NO FUNDO */
        .bottom-menu {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: white;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.1);
            z-index: 1000;
            overflow-x: auto;
        }

        .bottom-menu-container {
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
        }

        .bottom-menu-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px 15px;
            color: #666;
            text-decoration: none;
            font-size: 0.85rem;
            text-align: center;
            min-width: 80px;
            border-radius: 10px;
            transition: all 0.3s;
        }

        .bottom-menu-item:hover {
            background: #f8f9fa;
            color: var(--primary);
        }

        .bottom-menu-item.active {
            color: var(--primary);
            background: #f0f7ff;
        }

        .bottom-menu-item i {
            font-size: 1.4rem;
            margin-bottom: 5px;
        }

        .bottom-menu-badge {
            position: absolute;
            top: 5px;
            right: 5px;
            background: var(--accent);
            color: white;
            font-size: 0.7rem;
            padding: 2px 5px;
            border-radius: 50%;
            min-width: 18px;
            text-align: center;
        }

        /* Dashboard Sections */
        .dashboard-section {
            display: none;
        }

        .dashboard-section.active {
            display: block;
        }

        /* Cards de Estatísticas */
        .stats-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .stat-card-horizontal {
            background: white;
            padding: 25px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            gap: 20px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.08);
            border-left: 6px solid;
            transition: transform 0.3s;
        }

        .stat-card-horizontal:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 30px rgba(0,0,0,0.12);
        }

        .boss-dashboard .stat-card-horizontal { border-left-color: var(--boss); }
        .team-dashboard .stat-card-horizontal { border-left-color: var(--team); }
        .purchase-dashboard .stat-card-horizontal { border-left-color: var(--purchase); }
        .office-dashboard .stat-card-horizontal { border-left-color: var(--office); }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            color: white;
        }

        .boss-dashboard .stat-icon { background: linear-gradient(135deg, var(--boss), #9b59b6); }
        .team-dashboard .stat-icon { background: linear-gradient(135deg, var(--team), #3498db); }
        .purchase-dashboard .stat-icon { background: linear-gradient(135deg, var(--purchase), #2ecc71); }
        .office-dashboard .stat-icon { background: linear-gradient(135deg, var(--office), #9b59b6); }

        .stat-info h3 {
            font-size: 2.2rem;
            color: var(--dark);
            margin-bottom: 5px;
            font-weight: 800;
        }

        .stat-info p {
            color: #666;
            font-weight: 600;
            font-size: 1rem;
        }

        /* Grids de Conteúdo */
        .content-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        /* Cards de Conteúdo */
        .content-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.08);
            transition: transform 0.3s;
        }

        .content-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 30px rgba(0,0,0,0.12);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .card-header h3 {
            color: var(--dark);
            font-size: 1.4rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .card-header h3 i {
            color: var(--primary);
        }

        /* Botões Dashboard */
        .btn-dashboard {
            padding: 12px 25px;
            border-radius: 10px;
            font-weight: 600;
            border: none;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
            font-size: 1rem;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--dark);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(26, 95, 122, 0.3);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover {
            background: #219653;
            transform: translateY(-3px);
        }

        .btn-warning {
            background: var(--warning);
            color: white;
        }

        .btn-warning:hover {
            background: #e67e22;
            transform: translateY(-3px);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background: #c0392b;
            transform: translateY(-3px);
        }

        .btn-info {
            background: var(--info);
            color: white;
        }

        .btn-info:hover {
            background: #138496;
            transform: translateY(-3px);
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 0.85rem;
        }

        /* Tabelas */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }

        .data-table th {
            background: var(--primary);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
            font-size: 1rem;
        }

        .data-table td {
            padding: 15px;
            border-bottom: 1px solid #f0f0f0;
        }

        .data-table tr:hover {
            background: #f8f9fa;
        }

        /* Badges */
        .badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 700;
            display: inline-block;
        }

        .badge-success { background: #d5f4e6; color: var(--success); }
        .badge-warning { background: #fff3cd; color: var(--warning); }
        .badge-danger { background: #f8d7da; color: var(--danger); }
        .badge-primary { background: #d1ecf1; color: var(--secondary); }
        .badge-info { background: #d1ecf1; color: #17a2b8; }
        .badge-secondary { background: #e2e3e5; color: #6c757d; }

        /* Formulários */
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group-dashboard {
            margin-bottom: 20px;
        }

        .form-group-dashboard label {
            display: block;
            margin-bottom: 8px;
            color: var(--dark);
            font-weight: 600;
            font-size: 1rem;
        }

        .form-group-dashboard input,
        .form-group-dashboard select,
        .form-group-dashboard textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s;
            background: #f8f9fa;
        }

        .form-group-dashboard input:focus,
        .form-group-dashboard select:focus,
        .form-group-dashboard textarea:focus {
            border-color: var(--primary);
            outline: none;
            background: white;
            box-shadow: 0 0 0 3px rgba(26, 95, 122, 0.1);
        }

        .form-actions {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #f0f0f0;
        }

        /* Time Tracker */
        .time-tracker {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 25px;
        }

        .time-display {
            font-size: 3.5rem;
            font-weight: 800;
            text-align: center;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .time-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        /* Material Categories */
        .categories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .category-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 3px solid transparent;
        }

        .category-card:hover {
            transform: translateY(-5px);
            border-color: var(--accent);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        .category-card i {
            font-size: 2.2rem;
            color: var(--primary);
            margin-bottom: 10px;
        }

        /* GPS Tracker */
        .gps-tracker {
            background: linear-gradient(135deg, #11998e, #38ef7d);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 25px;
        }

        .gps-info {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        .gps-coordinates {
            font-family: monospace;
            font-size: 1.2rem;
            background: rgba(255,255,255,0.15);
            padding: 12px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }

        /* ============ MODAIS ============ */
        .modal-employee, .modal-monthly-report, .modal-document, .modal-purchase-details {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.85);
            z-index: 2001;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .modal-employee-content, .modal-monthly-report-content, 
        .modal-document-content, .modal-purchase-details-content {
            background: white;
            width: 90%;
            max-width: 800px;
            border-radius: 15px;
            padding: 30px;
            position: relative;
            max-height: 85vh;
            overflow-y: auto;
        }

        .close-modal-btn {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 1.8rem;
            cursor: pointer;
            color: var(--dark);
            background: none;
            border: none;
        }

        .close-modal-btn:hover {
            color: var(--danger);
        }

        /* Extrato Mensal */
        .monthly-report {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }

        .report-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #eee;
        }

        .report-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        /* Tabela de Horários */
        .time-sheet-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .time-sheet-table th {
            background: #f8f9fa;
            padding: 12px;
            text-align: left;
            border-bottom: 2px solid #ddd;
        }

        .time-sheet-table td {
            padding: 12px;
            border-bottom: 1px solid #eee;
        }

        /* Sistema de Alertas */
        .alert {
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border-left: 5px solid var(--success);
        }

        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border-left: 5px solid var(--warning);
        }

        .alert-danger {
            background: #f8d7da;
            color: #721c24;
            border-left: 5px solid var(--danger);
        }

        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border-left: 5px solid var(--info);
        }

        /* Sistema de Filtros */
        .filter-bar {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Responsividade */
        @media (max-width: 1200px) {
            .content-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 992px) {
            .hero h2 {
                font-size: 2.8rem;
            }
            
            .section-title {
                font-size: 2.3rem;
            }
            
            .menu-container {
                overflow-x: auto;
                padding-bottom: 10px;
            }
            
            .menu-item {
                padding: 15px 20px;
                font-size: 0.95rem;
            }
            
            .dashboard-content {
                padding: 15px;
            }
            
            .bottom-menu-item {
                padding: 8px 10px;
                font-size: 0.8rem;
                min-width: 70px;
            }
        }

        @media (max-width: 768px) {
            .hero {
                padding: 150px 0 80px;
            }
            
            .hero h2 {
                font-size: 2.2rem;
            }
            
            .hero p {
                font-size: 1.2rem;
            }
            
            .stats-row {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .top-bar-content {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .dashboard-info {
                flex-direction: column;
                gap: 15px;
            }
            
            .menu-item {
                padding: 12px 15px;
            }
            
            .content-card {
                padding: 20px;
            }
            
            .time-display {
                font-size: 2.8rem;
            }
        }

        @media (max-width: 480px) {
            .hero h2 {
                font-size: 1.8rem;
            }
            
            .section-title {
                font-size: 1.8rem;
            }
            
            .btn {
                padding: 10px 20px;
                font-size: 0.9rem;
            }
            
            .dashboard-content {
                padding: 10px;
            }
            
            .modal-employee-content,
            .modal-monthly-report-content {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <!-- ============ PÁGINA PÚBLICA ============ -->
    <div id="publicWebsite">
        <!-- Header Público -->
        <header class="public-header">
            <div class="container nav-container">
                <div class="logo">
                    <i class="fas fa-hard-hat"></i>
                    <div class="logo-text">
                        <h1>MAFC & FILHO, LDA.</h1>
                        <span>Construção Civil & Obras Públicas | Desde 2001</span>
                    </div>
                </div>
                <div class="cta-buttons">
                    <a href="https://wa.me/351123456789?text=Olá MAFC,%20gostaria%20de%20solicitar%20um%20orçamento%20para%20uma%20obra" 
                       class="btn btn-whatsapp" target="_blank">
                        <i class="fab fa-whatsapp"></i> WhatsApp
                    </a>
                    <a href="mailto:orcamentos@mafc-filho.pt?subject=Solicitação de Orçamento&body=Olá MAFC,%0D%0A%0D%0AGostaria de solicitar um orçamento para:" 
                       class="btn btn-email">
                        <i class="fas fa-envelope"></i> Pedir Orçamento
                    </a>
                    <a href="#" class="btn btn-login" id="openLogin">
                        <i class="fas fa-sign-in-alt"></i> Acesso Sistema
                    </a>
                </div>
            </div>
        </header>

        <!-- Hero Section -->
        <section class="hero">
            <div class="container">
                <h2>Especialistas em Construção Civil e Obras Públicas</h2>
                <p>Mais de 20 anos de experiência em saneamento, abastecimento de água, redes de fibra óptica, pavimentação e infraestruturas. Operação em Portugal e Alemanha com 15 equipas especializadas.</p>
                <div class="hero-buttons">
                    <a href="#gallery" class="btn btn-email">
                        <i class="fas fa-hard-hat"></i> Ver Projetos
                    </a>
                    <a href="mailto:orcamentos@mafc-filho.pt" class="btn btn-whatsapp">
                        <i class="fas fa-calculator"></i> Orçamento Grátis
                    </a>
                </div>
            </div>
        </section>

        <!-- Galeria de Projetos -->
        <section class="gallery" id="gallery">
            <div class="container">
                <h2 class="section-title">Nossos Projetos</h2>
                <div class="gallery-grid">
                    <div class="gallery-item">
                        <img src="https://images.unsplash.com/photo-1541888946425-d81bb19240f5?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80" alt="Saneamento">
                        <div class="gallery-overlay">
                            <h3>Sistema de Saneamento</h3>
                            <p>Rede de águas pluviais em Berlim</p>
                        </div>
                    </div>
                    <div class="gallery-item">
                        <img src="https://images.unsplash.com/photo-1504917595217-d4dc5ebe6122?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80" alt="Fibra Óptica">
                        <div class="gallery-overlay">
                            <h3>Redes de Fibra Óptica</h3>
                            <p>Infraestrutura de telecomunicações</p>
                        </div>
                    </div>
                    <div class="gallery-item">
                        <img src="https://images.unsplash.com/photo-1519501025264-65ba15a82390?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80" alt="Pavimentação">
                        <div class="gallery-overlay">
                            <h3>Pavimentação Urbana</h3>
                            <p>Reabilitação de vias públicas</p>
                        </div>
                    </div>
                    <div class="gallery-item">
                        <img src="https://images.unsplash.com/photo-1541625602330-2277a4c46182?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80" alt="Infraestruturas">
                        <div class="gallery-overlay">
                            <h3>Infraestruturas EDP</h3>
                            <p>Instalação elétrica e gás natural</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer class="public-footer" style="background: var(--dark); color: white; padding: 80px 0 40px;">
            <div class="container">
                <div class="footer-content">
                    <div>
                        <h3>MAFC & FILHO, LDA.</h3>
                        <p>Constituída em 2001, somos especialistas em construção civil e obras públicas com operação em Portugal e Alemanha.</p>
                    </div>
                </div>
                <div class="copyright">
                    <p>&copy; 2001-2024 MAFC & FILHO, LDA. - Todos os direitos reservados.</p>
                </div>
            </div>
        </footer>
    </div>

    <!-- ============ MODAL DE LOGIN ============ -->
    <div class="modal" id="loginModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-lock"></i> Acesso ao Sistema MAFC</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="loginForm">
                    <div class="form-group">
                        <label for="username"><i class="fas fa-user"></i> Código de Acesso</label>
                        <input type="text" id="username" placeholder="Digite seu código" required>
                    </div>
                    <div class="form-group">
                        <label for="password"><i class="fas fa-key"></i> Senha</label>
                        <input type="password" id="password" placeholder="Digite sua senha" required>
                    </div>
                    <div class="form-group">
                        <label for="role"><i class="fas fa-user-tag"></i> Tipo de Acesso</label>
                        <select id="role" required>
                            <option value="">Selecione o tipo de acesso</option>
                            <option value="boss">Administração Geral</option>
                            <option value="team">Chefe de Equipa</option>
                            <option value="purchase">Responsável de Compras</option>
                            <option value="office">Escritório</option>
                        </select>
                    </div>
                    <button type="submit" class="login-submit">
                        <i class="fas fa-sign-in-alt"></i> Entrar no Sistema
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- ============ MODAL GESTÃO DE PESSOAL ============ -->
    <div class="modal-employee" id="employeeModal">
        <div class="modal-employee-content">
            <button class="close-modal-btn">&times;</button>
            <h2><i class="fas fa-user-plus"></i> Gestão de Pessoal</h2>
            <div class="employee-form">
                <div class="form-row">
                    <div class="form-group-dashboard">
                        <label>Nome Completo</label>
                        <input type="text" id="employeeName" placeholder="Nome completo">
                    </div>
                    <div class="form-group-dashboard">
                        <label>Número de WhatsApp</label>
                        <input type="tel" id="employeeWhatsApp" placeholder="+351 912 345 678" value="+351 ">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group-dashboard">
                        <label>Cargo/Função</label>
                        <select id="employeePosition">
                            <option value="administrativo">Administrativo</option>
                            <option value="contabilidade">Contabilidade</option>
                            <option value="rh">Recursos Humanos</option>
                            <option value="gestor">Gestor</option>
                            <option value="assistente">Assistente</option>
                        </select>
                    </div>
                    <div class="form-group-dashboard">
                        <label>Departamento</label>
                        <select id="employeeDepartment">
                            <option value="escritorio">Escritório</option>
                            <option value="contabilidade">Contabilidade</option>
                            <option value="rh">RH</option>
                            <option value="administracao">Administração</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group-dashboard">
                        <label>Data de Início</label>
                        <input type="date" id="employeeStartDate" value="<?php echo date('Y-m-d'); ?>">
                    </div>
                    <div class="form-group-dashboard">
                        <label>Estado</label>
                        <select id="employeeStatus">
                            <option value="active">Ativo</option>
                            <option value="inactive">Inativo</option>
                            <option value="ferias">Férias</option>
                            <option value="baixa">Baixa Médica</option>
                        </select>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-dashboard btn-success" onclick="saveEmployee()">
                        <i class="fas fa-save"></i> Guardar
                    </button>
                    <button type="button" class="btn-dashboard btn-danger" onclick="closeModal('employeeModal')">
                        <i class="fas fa-times"></i> Cancelar
                    </button>
                </div>
            </div>
            
            <div style="margin-top: 30px;">
                <h3><i class="fas fa-list"></i> Lista de Pessoal</h3>
                <div class="filter-bar">
                    <input type="text" id="searchEmployeeList" placeholder="Pesquisar nome..." onkeyup="filterEmployeeList()">
                    <select id="filterEmployeeDept" onchange="filterEmployeeList()">
                        <option value="all">Todos Departamentos</option>
                        <option value="escritorio">Escritório</option>
                        <option value="contabilidade">Contabilidade</option>
                    </select>
                </div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Nome</th>
                            <th>WhatsApp</th>
                            <th>Cargo</th>
                            <th>Departamento</th>
                            <th>Estado</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody id="employeesList">
                        <!-- Lista de empregados será carregada aqui -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- ============ MODAL DOCUMENTO ============ -->
    <div class="modal-document" id="documentModal">
        <div class="modal-document-content">
            <button class="close-modal-btn">&times;</button>
            <h2><i class="fas fa-file-alt"></i> Novo Documento</h2>
            <div class="document-form">
                <div class="form-row">
                    <div class="form-group-dashboard">
                        <label>Tipo de Documento</label>
                        <select id="documentType">
                            <option value="contrato">Contrato</option>
                            <option value="fatura">Fatura</option>
                            <option value="relatorio">Relatório</option>
                            <option value="outro">Outro</option>
                        </select>
                    </div>
                    <div class="form-group-dashboard">
                        <label>Número/Referência</label>
                        <input type="text" id="documentNumber" placeholder="Ex: CON-2024-001">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group-dashboard">
                        <label>Título</label>
                        <input type="text" id="documentTitle" placeholder="Título do documento">
                    </div>
                    <div class="form-group-dashboard">
                        <label>Data</label>
                        <input type="date" id="documentDate" value="<?php echo date('Y-m-d'); ?>">
                    </div>
                </div>
                <div class="form-group-dashboard">
                    <label>Descrição</label>
                    <textarea id="documentDescription" rows="3" placeholder="Descrição do documento..."></textarea>
                </div>
                <div class="form-group-dashboard">
                    <label>Ficheiro (opcional)</label>
                    <input type="file" id="documentFile">
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-dashboard btn-success" onclick="saveDocument()">
                        <i class="fas fa-save"></i> Guardar Documento
                    </button>
                    <button type="button" class="btn-dashboard btn-whatsapp" onclick="sendDocumentWhatsApp()">
                        <i class="fab fa-whatsapp"></i> Partilhar WhatsApp
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ============ MODAL DETALHES COMPRA ============ -->
    <div class="modal-purchase-details" id="purchaseDetailsModal">
        <div class="modal-purchase-details-content">
            <button class="close-modal-btn">&times;</button>
            <div id="purchaseDetailsContent">
                <!-- Conteúdo será carregado dinamicamente -->
            </div>
        </div>
    </div>

    <!-- ============ MODAL FORNECEDORES ============ -->
    <div class="modal-employee" id="supplierModal">
        <div class="modal-employee-content">
            <button class="close-modal-btn">&times;</button>
            <h2><i class="fas fa-truck"></i> Gestão de Fornecedores</h2>
            <div class="employee-form">
                <div class="form-row">
                    <div class="form-group-dashboard">
                        <label>Nome do Fornecedor</label>
                        <input type="text" id="supplierName" placeholder="Nome da empresa">
                    </div>
                    <div class="form-group-dashboard">
                        <label>NIF/NIPC</label>
                        <input type="text" id="supplierNIF" placeholder="Número de identificação fiscal">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group-dashboard">
                        <label>Contacto</label>
                        <input type="tel" id="supplierContact" placeholder="Telefone/WhatsApp">
                    </div>
                    <div class="form-group-dashboard">
                        <label>Email</label>
                        <input type="email" id="supplierEmail" placeholder="email@fornecedor.pt">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group-dashboard">
                        <label>Tipo de Materiais</label>
                        <select id="supplierType" multiple>
                            <option value="construcao">Materiais de Construção</option>
                            <option value="ferramentas">Ferramentas</option>
                            <option value="equipamentos">Equipamentos</option>
                            <option value="consumiveis">Consumíveis</option>
                            <option value="seguranca">EPIs e Segurança</option>
                        </select>
                    </div>
                    <div class="form-group-dashboard">
                        <label>Observações</label>
                        <textarea id="supplierNotes" rows="3" placeholder="Informações adicionais..."></textarea>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-dashboard btn-success" onclick="saveSupplier()">
                        <i class="fas fa-save"></i> Guardar Fornecedor
                    </button>
                    <button type="button" class="btn-dashboard btn-danger" onclick="closeModal('supplierModal')">
                        <i class="fas fa-times"></i> Cancelar
                    </button>
                </div>
            </div>
            
            <div style="margin-top: 30px;">
                <h3><i class="fas fa-list"></i> Lista de Fornecedores</h3>
                <div class="filter-bar">
                    <input type="text" id="searchSupplierList" placeholder="Pesquisar fornecedor..." onkeyup="filterSupplierList()">
                    <select id="filterSupplierType" onchange="filterSupplierList()">
                        <option value="all">Todos Tipos</option>
                        <option value="construcao">Construção</option>
                        <option value="ferramentas">Ferramentas</option>
                        <option value="equipamentos">Equipamentos</option>
                    </select>
                </div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Nome</th>
                            <th>NIF</th>
                            <th>Contacto</th>
                            <th>Tipo</th>
                            <th>Email</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody id="suppliersList">
                        <!-- Lista de fornecedores será carregada aqui -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- ============ DASHBOARD DO PATRÃO/ADMIN ============ -->
    <div class="dashboard boss-dashboard" id="bossDashboard">
        <!-- Top Bar -->
        <div class="top-bar">
            <div class="container top-bar-content">
                <div class="dashboard-brand">
                    <i class="fas fa-crown"></i>
                    <h1>Painel Administrativo - MAFC</h1>
                </div>
                <div class="dashboard-info">
                    <div class="user-info">
                        <i class="fas fa-user-circle"></i>
                        <span id="bossUserName">Administrador</span>
                    </div>
                    <div id="bossCurrentTime" style="font-weight: 600;">10:45 AM</div>
                    <button class="logout-btn" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i> Sair
                    </button>
                </div>
            </div>
        </div>

        <!-- Conteúdo -->
        <div class="dashboard-content">
            <!-- Visão Geral -->
            <div class="dashboard-section active" id="bossOverviewSection">
                <div class="stats-row">
                    <div class="stat-card-horizontal">
                        <div class="stat-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="totalEmployees">45</h3>
                            <p>Total Colaboradores</p>
                        </div>
                    </div>
                    <div class="stat-card-horizontal">
                        <div class="stat-icon">
                            <i class="fas fa-hard-hat"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="activeTeams">15</h3>
                            <p>Equipas Ativas</p>
                        </div>
                    </div>
                    <div class="stat-card-horizontal">
                        <div class="stat-icon">
                            <i class="fas fa-euro-sign"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="monthExpenses">€85.2K</h3>
                            <p>Despesas Mês</p>
                        </div>
                    </div>
                    <div class="stat-card-horizontal">
                        <div class="stat-icon">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="pendingItems">24</h3>
                            <p>Pendentes</p>
                        </div>
                    </div>
                </div>

                <div class="content-grid">
                    <!-- Alertas Recentes -->
                    <div class="content-card">
                        <div class="card-header">
                            <h3><i class="fas fa-bell"></i> Alertas Recentes</h3>
                            <button class="btn-dashboard btn-primary" onclick="markAllAlertsRead()">
                                <i class="fas fa-check-double"></i> Marcar Lidas
                            </button>
                        </div>
                        <div id="bossAlerts">
                            <!-- Alertas serão carregados aqui -->
                        </div>
                    </div>

                    <!-- Atividade Recente -->
                    <div class="content-card">
                        <div class="card-header">
                            <h3><i class="fas fa-history"></i> Atividade do Sistema</h3>
                            <button class="btn-dashboard btn-info" onclick="refreshActivity()">
                                <i class="fas fa-sync-alt"></i> Atualizar
                            </button>
                        </div>
                        <div style="max-height: 300px; overflow-y: auto;">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Data/Hora</th>
                                        <th>Utilizador</th>
                                        <th>Ação</th>
                                        <th>Detalhes</th>
                                    </tr>
                                </thead>
                                <tbody id="bossActivityLog">
                                    <!-- Log de atividades será carregado aqui -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Equipas -->
            <div class="dashboard-section" id="bossTeamsSection">
                <div class="content-card">
                    <div class="card-header">
                        <h3><i class="fas fa-users"></i> Gestão de Equipas</h3>
                        <button class="btn-dashboard btn-primary" onclick="addNewTeam()">
                            <i class="fas fa-plus"></i> Nova Equipa
                        </button>
                    </div>
                    
                    <div class="filter-bar">
                        <input type="text" id="searchTeam" placeholder="Pesquisar equipa..." onkeyup="filterTeams()">
                        <select id="filterTeamLocation" onchange="filterTeams()">
                            <option value="all">Todas Localizações</option>
                            <option value="germany">Alemanha</option>
                            <option value="portugal">Portugal</option>
                        </select>
                        <select id="filterTeamStatus" onchange="filterTeams()">
                            <option value="all">Todos Estados</option>
                            <option value="active">Ativas</option>
                            <option value="inactive">Inativas</option>
                        </select>
                    </div>

                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Equipa</th>
                                <th>Localização</th>
                                <th>Chefe</th>
                                <th>Membros</th>
                                <th>Obra Atual</th>
                                <th>Estado</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="bossTeamsTable">
                            <!-- Equipas serão carregadas aqui -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Compras -->
            <div class="dashboard-section" id="bossPurchasesSection">
                <div class="content-card">
                    <div class="card-header">
                        <h3><i class="fas fa-shopping-cart"></i> Controle de Compras</h3>
                        <button class="btn-dashboard btn-info" onclick="generatePurchaseReport()">
                            <i class="fas fa-file-excel"></i> Exportar Excel
                        </button>
                    </div>

                    <div class="filter-bar">
                        <select id="filterPurchaseStatus" onchange="filterPurchases()">
                            <option value="all">Todos Estados</option>
                            <option value="pending">Pendentes</option>
                            <option value="approved">Aprovadas</option>
                            <option value="completed">Completadas</option>
                            <option value="cancelled">Canceladas</option>
                        </select>
                        <input type="date" id="filterPurchaseDateFrom" onchange="filterPurchases()">
                        <input type="date" id="filterPurchaseDateTo" onchange="filterPurchases()">
                        <input type="text" id="searchPurchase" placeholder="Pesquisar..." onkeyup="filterPurchases()">
                    </div>

                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Nº Pedido</th>
                                <th>Equipa</th>
                                <th>Material</th>
                                <th>Quantidade</th>
                                <th>Valor</th>
                                <th>Data Pedido</th>
                                <th>Estado</th>
                                <th>Responsável</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="bossPurchasesTable">
                            <!-- Compras serão carregadas aqui -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Auditoria -->
            <div class="dashboard-section" id="bossAuditSection">
                <div class="content-card">
                    <div class="card-header">
                        <h3><i class="fas fa-shield-alt"></i> Log de Auditoria</h3>
                        <button class="btn-dashboard btn-danger" onclick="clearAuditLog()">
                            <i class="fas fa-trash"></i> Limpar Log
                        </button>
                    </div>

                    <div class="filter-bar">
                        <input type="date" id="auditDateFrom" onchange="filterAudit()">
                        <input type="date" id="auditDateTo" onchange="filterAudit()">
                        <select id="auditUserFilter" onchange="filterAudit()">
                            <option value="all">Todos Utilizadores</option>
                        </select>
                        <select id="auditActionFilter" onchange="filterAudit()">
                            <option value="all">Todas Ações</option>
                            <option value="login">Login</option>
                            <option value="logout">Logout</option>
                            <option value="create">Criação</option>
                            <option value="update">Atualização</option>
                            <option value="delete">Eliminação</option>
                        </select>
                    </div>

                    <div style="max-height: 500px; overflow-y: auto;">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Data/Hora</th>
                                    <th>Utilizador</th>
                                    <th>IP</th>
                                    <th>Ação</th>
                                    <th>Detalhes</th>
                                    <th>Módulo</th>
                                </tr>
                            </thead>
                            <tbody id="bossAuditTable">
                                <!-- Log de auditoria será carregado aqui -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Finanças -->
            <div class="dashboard-section" id="bossFinancesSection">
                <div class="content-card">
                    <div class="card-header">
                        <h3><i class="fas fa-euro-sign"></i> Gestão Financeira</h3>
                        <button class="btn-dashboard btn-success" onclick="generateFinancialReport()">
                            <i class="fas fa-file-pdf"></i> Relatório Mensal
                        </button>
                    </div>
                    <!-- Conteúdo de finanças -->
                </div>
            </div>

            <!-- Relatórios -->
            <div class="dashboard-section" id="bossReportsSection">
                <div class="content-card">
                    <div class="card-header">
                        <h3><i class="fas fa-chart-bar"></i> Relatórios e Estatísticas</h3>
                        <button class="btn-dashboard btn-primary" onclick="exportAllReports()">
                            <i class="fas fa-download"></i> Exportar Todos
                        </button>
                    </div>
                    <!-- Conteúdo de relatórios -->
                </div>
            </div>

            <!-- Controlo Horas -->
            <div class="dashboard-section" id="bossHoursSection">
                <div class="content-card">
                    <div class="card-header">
                        <h3><i class="fas fa-clock"></i> Controlo de Horas</h3>
                        <button class="btn-dashboard btn-info" onclick="generateHoursReport()">
                            <i class="fas fa-file-excel"></i> Exportar Horas
                        </button>
                    </div>
                    <!-- Conteúdo de controlo de horas -->
                </div>
            </div>
        </div>

        <!-- MENU NO FUNDO PARA PATRÃO -->
        <nav class="bottom-menu">
            <div class="bottom-menu-container">
                <a href="#" class="bottom-menu-item active" data-section="bossOverview">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Visão Geral</span>
                </a>
                <a href="#" class="bottom-menu-item" data-section="bossTeams">
                    <i class="fas fa-users"></i>
                    <span>Equipas</span>
                    <span class="bottom-menu-badge" id="teamsCountBottom">15</span>
                </a>
                <a href="#" class="bottom-menu-item" data-section="bossHours">
                    <i class="fas fa-clock"></i>
                    <span>Controlo Horas</span>
                    <span class="bottom-menu-badge" id="pendingHoursBottom">42</span>
                </a>
                <a href="#" class="bottom-menu-item" data-section="bossPurchases">
                    <i class="fas fa-shopping-cart"></i>
                    <span>Compras</span>
                    <span class="bottom-menu-badge" id="pendingPurchasesBottom">12</span>
                </a>
                <a href="#" class="bottom-menu-item" data-section="bossFinances">
                    <i class="fas fa-euro-sign"></i>
                    <span>Finanças</span>
                </a>
                <a href="#" class="bottom-menu-item" data-section="bossReports">
                    <i class="fas fa-chart-bar"></i>
                    <span>Relatórios</span>
                </a>
                <a href="#" class="bottom-menu-item" data-section="bossAudit">
                    <i class="fas fa-shield-alt"></i>
                    <span>Auditoria</span>
                </a>
            </div>
        </nav>
    </div>

    <!-- ============ DASHBOARD ESCRITÓRIO ============ -->
    <div class="dashboard office-dashboard" id="officeDashboard">
        <!-- Top Bar -->
        <div class="top-bar">
            <div class="container top-bar-content">
                <div class="dashboard-brand">
                    <i class="fas fa-building"></i>
                    <h1>Escritório - MAFC</h1>
                </div>
                <div class="dashboard-info">
                    <div class="user-info">
                        <i class="fas fa-user-tie"></i>
                        <span id="officeUserName">Escritório</span>
                    </div>
                    <div id="officeCurrentTime" style="font-weight: 600;">10:45 AM</div>
                    <button class="logout-btn" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i> Sair
                    </button>
                </div>
            </div>
        </div>

        <!-- Conteúdo -->
        <div class="dashboard-content">
            <!-- Dashboard Escritório -->
            <div class="dashboard-section active" id="officeDashboardSection">
                <div class="stats-row">
                    <div class="stat-card-horizontal">
                        <div class="stat-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="officePeopleCount">8</h3>
                            <p>Pessoal</p>
                        </div>
                    </div>
                    <div class="stat-card-horizontal">
                        <div class="stat-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="officeTodayHours">7.5</h3>
                            <p>Horas Hoje</p>
                        </div>
                    </div>
                    <div class="stat-card-horizontal">
                        <div class="stat-icon">
                            <i class="fas fa-file-alt"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="officeDocumentsCount">24</h3>
                            <p>Documentos</p>
                        </div>
                    </div>
                    <div class="stat-card-horizontal">
                        <div class="stat-icon">
                            <i class="fas fa-print"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="officePrintsToday">5</h3>
                            <p>Impressões</p>
                        </div>
                    </div>
                </div>

                <div class="content-grid">
                    <!-- Marcações Recentes -->
                    <div class="content-card">
                        <div class="card-header">
                            <h3><i class="fas fa-clock"></i> Marcações Hoje</h3>
                            <button class="btn-dashboard btn-primary" onclick="refreshTodayMarks()">
                                <i class="fas fa-sync-alt"></i> Atualizar
                            </button>
                        </div>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Nome</th>
                                    <th>Entrada</th>
                                    <th>Saída</th>
                                    <th>Total</th>
                                    <th>WhatsApp</th>
                                </tr>
                            </thead>
                            <tbody id="officeTodayMarks">
                                <!-- Marcações serão carregadas aqui -->
                            </tbody>
                        </table>
                    </div>

                    <!-- Documentos Recentes -->
                    <div class="content-card">
                        <div class="card-header">
                            <h3><i class="fas fa-file-alt"></i> Documentos Recentes</h3>
                            <button class="btn-dashboard btn-success" onclick="openDocumentModal()">
                                <i class="fas fa-plus"></i> Novo
                            </button>
                        </div>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Tipo</th>
                                    <th>Referência</th>
                                    <th>Data</th>
                                    <th>Estado</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody id="officeRecentDocs">
                                <!-- Documentos serão carregados aqui -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Sistema de Marcação de Horas para Todos os Funcionários -->
                <div class="content-card" style="margin-top: 30px;">
                    <div class="card-header">
                        <h3><i class="fas fa-clock"></i> Marcação de Horas - Todos os Funcionários</h3>
                        <button class="btn-dashboard btn-success" onclick="openBulkTimeModal()">
                            <i class="fas fa-users"></i> Marcar Todos
                        </button>
                    </div>

                    <div class="time-tracker">
                        <div class="time-display" id="officeClock">08:45:23</div>
                        <div class="time-buttons">
                            <button class="btn-dashboard btn-success" onclick="markAllEntry()">
                                <i class="fas fa-sign-in-alt"></i> Entrada Geral
                            </button>
                            <button class="btn-dashboard btn-warning" onclick="markAllBreak()">
                                <i class="fas fa-coffee"></i> Pausa Geral
                            </button>
                            <button class="btn-dashboard btn-danger" onclick="markAllExit()">
                                <i class="fas fa-sign-out-alt"></i> Saída Geral
                            </button>
                        </div>
                    </div>

                    <div style="margin-top: 20px;">
                        <h4><i class="fas fa-list-check"></i> Estado Atual das Marcações</h4>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Nome</th>
                                    <th>Entrada</th>
                                    <th>Saída</th>
                                    <th>Pausa</th>
                                    <th>Total</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody id="allEmployeesTime">
                                <!-- Todos os funcionários serão listados aqui -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Gestão de Pessoal -->
            <div class="dashboard-section" id="officePeopleSection">
                <div class="content-card">
                    <div class="card-header">
                        <h3><i class="fas fa-user-plus"></i> Gestão de Pessoal</h3>
                        <button class="btn-dashboard btn-success" onclick="openEmployeeModal()">
                            <i class="fas fa-plus"></i> Adicionar Pessoa
                        </button>
                    </div>

                    <div class="filter-bar">
                        <input type="text" id="officeSearchPerson" placeholder="Pesquisar nome..." onkeyup="searchOfficePeople()">
                        <select id="officeFilterDept" onchange="searchOfficePeople()">
                            <option value="all">Todos Departamentos</option>
                            <option value="escritorio">Escritório</option>
                            <option value="contabilidade">Contabilidade</option>
                            <option value="rh">RH</option>
                        </select>
                        <select id="officeFilterStatus" onchange="searchOfficePeople()">
                            <option value="all">Todos Estados</option>
                            <option value="active">Ativos</option>
                            <option value="inactive">Inativos</option>
                        </select>
                    </div>

                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Nome</th>
                                <th>WhatsApp</th>
                                <th>Cargo</th>
                                <th>Departamento</th>
                                <th>Estado</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="officePeopleTable">
                            <!-- Pessoal será carregado aqui -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Marcar Horas Individual -->
            <div class="dashboard-section" id="officeTimeSection">
                <div class="content-card">
                    <div class="card-header">
                        <h3><i class="fas fa-clock"></i> Marcação Individual de Horas</h3>
                        <div class="time-display" style="font-size: 2.5rem; color: var(--office);" id="officeClockIndividual">
                            08:45:23
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group-dashboard">
                            <label>Selecione a Pessoa</label>
                            <select id="officePersonSelect" onchange="loadPersonWhatsApp()">
                                <option value="">Selecione uma pessoa</option>
                            </select>
                        </div>
                        <div class="form-group-dashboard">
                            <label>WhatsApp</label>
                            <input type="text" id="officePersonWhatsApp" readonly placeholder="Selecione uma pessoa">
                        </div>
                        <div class="form-group-dashboard">
                            <label>Tipo de Marcação</label>
                            <select id="officeTimeType">
                                <option value="entry">Entrada</option>
                                <option value="exit">Saída</option>
                                <option value="break_start">Início Pausa</option>
                                <option value="break_end">Fim Pausa</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button class="btn-dashboard btn-success" onclick="registerOfficeTime()">
                            <i class="fas fa-check"></i> Registar Marcação
                        </button>
                        <button class="btn-dashboard btn-whatsapp" onclick="sendTimeWhatsApp()">
                            <i class="fab fa-whatsapp"></i> Notificar WhatsApp
                        </button>
                        <button class="btn-dashboard btn-warning" onclick="registerAllOfficeEntry()">
                            <i class="fas fa-users"></i> Entrada Geral
                        </button>
                    </div>

                    <div style="margin-top: 30px;">
                        <h3><i class="fas fa-history"></i> Marcações do Dia</h3>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Nome</th>
                                    <th>Entrada</th>
                                    <th>Saída</th>
                                    <th>Pausa</th>
                                    <th>Total</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody id="officeDailyMarks">
                                <!-- Marcações diárias serão carregadas aqui -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Meu Extrato com Impressão para Contabilidade -->
            <div class="dashboard-section" id="officeReportsSection">
                <div class="content-card">
                    <div class="card-header">
                        <h3><i class="fas fa-file-invoice"></i> Extrato Mensal para Contabilidade</h3>
                        <button class="btn-dashboard btn-primary" onclick="generateOfficeReport()">
                            <i class="fas fa-sync-alt"></i> Gerar Extrato
                        </button>
                    </div>

                    <div class="form-row">
                        <div class="form-group-dashboard">
                            <label>Mês/Ano</label>
                            <select id="officeReportMonth">
                                <option value="12-2024">Dezembro 2024</option>
                                <option value="11-2024">Novembro 2024</option>
                                <option value="10-2024">Outubro 2024</option>
                                <option value="09-2024">Setembro 2024</option>
                            </select>
                        </div>
                        <div class="form-group-dashboard">
                            <label>Pessoa</label>
                            <select id="officeReportPerson">
                                <option value="all">Todas as Pessoas</option>
                            </select>
                        </div>
                        <div class="form-group-dashboard">
                            <label>Formato</label>
                            <select id="reportFormat">
                                <option value="pdf">PDF</option>
                                <option value="excel">Excel</option>
                                <option value="print">Imprimir</option>
                            </select>
                        </div>
                    </div>

                    <div class="monthly-report">
                        <div class="report-header">
                            <h4 id="officeReportTitle">Selecione mês e pessoa</h4>
                            <span class="badge badge-info" id="officeTotalHours">-- horas</span>
                        </div>
                        
                        <table class="time-sheet-table" id="officeTimeSheet">
                            <thead>
                                <tr>
                                    <th>Data</th>
                                    <th>Nome</th>
                                    <th>Entrada</th>
                                    <th>Saída</th>
                                    <th>Horas Normais</th>
                                    <th>Horas Extra</th>
                                    <th>Total</th>
                                </tr>
                            </thead>
                            <tbody id="officeReportBody">
                                <!-- Dados do extrato serão carregados aqui -->
                            </tbody>
                        </table>
                        
                        <div class="report-actions">
                            <button class="btn-dashboard btn-primary" onclick="printOfficeReportForAccounting()">
                                <i class="fas fa-print"></i> Imprimir para Contabilidade
                            </button>
                            <button class="btn-dashboard btn-success" onclick="exportToExcel()">
                                <i class="fas fa-file-excel"></i> Exportar Excel
                            </button>
                            <button class="btn-dashboard btn-info" onclick="generatePDF()">
                                <i class="fas fa-file-pdf"></i> Gerar PDF
                            </button>
                            <button class="btn-dashboard btn-whatsapp" onclick="sendToAccountingWhatsApp()">
                                <i class="fab fa-whatsapp"></i> Enviar para Contabilidade
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Documentos -->
            <div class="dashboard-section" id="officeDocumentsSection">
                <div class="content-card">
                    <div class="card-header">
                        <h3><i class="fas fa-folder"></i> Gestão de Documentos</h3>
                        <button class="btn-dashboard btn-success" onclick="openDocumentModal()">
                            <i class="fas fa-plus"></i> Novo Documento
                        </button>
                    </div>

                    <div class="filter-bar">
                        <select id="documentFilterType" onchange="filterDocuments()">
                            <option value="all">Todos Tipos</option>
                            <option value="contrato">Contratos</option>
                            <option value="fatura">Faturas</option>
                            <option value="relatorio">Relatórios</option>
                        </select>
                        <input type="date" id="documentFilterDateFrom" onchange="filterDocuments()">
                        <input type="date" id="documentFilterDateTo" onchange="filterDocuments()">
                        <input type="text" id="documentSearch" placeholder="Pesquisar..." onkeyup="filterDocuments()">
                    </div>

                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Referência</th>
                                <th>Tipo</th>
                                <th>Título</th>
                                <th>Data</th>
                                <th>Criado por</th>
                                <th>WhatsApp</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="officeDocumentsTable">
                            <!-- Documentos serão carregados aqui -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Drucker (Impressão) -->
            <div class="dashboard-section" id="officeDruckerSection">
                <div class="content-card">
                    <div class="card-header">
                        <h3><i class="fas fa-print"></i> Sistema de Impressão (Drucker)</h3>
                        <button class="btn-dashboard btn-info" onclick="testPrinter()">
                            <i class="fas fa-cog"></i> Testar Impressora
                        </button>
                    </div>

                    <div class="form-row">
                        <div class="form-group-dashboard">
                            <label>Tipo de Documento</label>
                            <select id="printDocumentType">
                                <option value="extrato">Extrato de Horas</option>
                                <option value="relatorio">Relatório</option>
                                <option value="documento">Documento Geral</option>
                                <option value="fatura">Fatura</option>
                                <option value="contrato">Contrato</option>
                            </select>
                        </div>
                        <div class="form-group-dashboard">
                            <label>Número de Cópias</label>
                            <input type="number" id="printCopies" value="1" min="1" max="10">
                        </div>
                    </div>

                    <div class="form-group-dashboard">
                        <label>Selecione o Documento para Imprimir</label>
                        <select id="printDocumentSelect">
                            <option value="">Selecione um documento</option>
                        </select>
                    </div>

                    <div class="form-group-dashboard">
                        <label>Configurações de Impressão</label>
                        <div style="display: flex; gap: 20px; margin-top: 10px;">
                            <label style="display: flex; align-items: center; gap: 5px;">
                                <input type="checkbox" id="printColor" checked> Colorido
                            </label>
                            <label style="display: flex; align-items: center; gap: 5px;">
                                <input type="checkbox" id="printDuplex"> Frente e Verso
                            </label>
                            <label style="display: flex; align-items: center; gap: 5px;">
                                <input type="checkbox" id="printCollate" checked> Reunir
                            </label>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button class="btn-dashboard btn-primary" onclick="printDocument()">
                            <i class="fas fa-print"></i> IMPRIMIR
                        </button>
                        <button class="btn-dashboard btn-success" onclick="previewPrint()">
                            <i class="fas fa-eye"></i> Pré-visualizar
                        </button>
                        <button class="btn-dashboard btn-warning" onclick="printQueue()">
                            <i class="fas fa-list"></i> Fila de Impressão
                        </button>
                    </div>

                    <div style="margin-top: 30px;">
                        <h3><i class="fas fa-history"></i> Histórico de Impressões</h3>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Data/Hora</th>
                                    <th>Documento</th>
                                    <th>Utilizador</th>
                                    <th>Cópias</th>
                                    <th>Estado</th>
                                </tr>
                            </thead>
                            <tbody id="printHistory">
                                <!-- Histórico será carregado aqui -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- MENU NO FUNDO PARA ESCRITÓRIO -->
        <nav class="bottom-menu">
            <div class="bottom-menu-container">
                <a href="#" class="bottom-menu-item active" data-section="officeDashboard">
                    <i class="fas fa-home"></i>
                    <span>Dashboard</span>
                </a>
                <a href="#" class="bottom-menu-item" data-section="officePeople">
                    <i class="fas fa-user-plus"></i>
                    <span>Pessoal</span>
                </a>
                <a href="#" class="bottom-menu-item" data-section="officeTime">
                    <i class="fas fa-clock"></i>
                    <span>Marcar Horas</span>
                </a>
                <a href="#" class="bottom-menu-item" data-section="officeReports">
                    <i class="fas fa-file-alt"></i>
                    <span>Meu Extrato</span>
                </a>
                <a href="#" class="bottom-menu-item" data-section="officeDocuments">
                    <i class="fas fa-folder"></i>
                    <span>Documentos</span>
                </a>
                <a href="#" class="bottom-menu-item" data-section="officeDrucker">
                    <i class="fas fa-print"></i>
                    <span>Drucker</span>
                </a>
            </div>
        </nav>
    </div>

    <!-- ============ DASHBOARD CHEFE DE EQUIPA ============ -->
    <div class="dashboard team-dashboard" id="teamDashboard">
        <!-- Top Bar -->
        <div class="top-bar">
            <div class="container top-bar-content">
                <div class="dashboard-brand">
                    <i class="fas fa-hard-hat"></i>
                    <h1>Chefe de Equipa - MAFC</h1>
                </div>
                <div class="dashboard-info">
                    <div class="user-info">
                        <i class="fas fa-user-hard-hat"></i>
                        <span id="teamUserName">Equipa</span>
                    </div>
                    <div id="teamCurrentTime" style="font-weight: 600;">10:45 AM</div>
                    <button class="logout-btn" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i> Sair
                    </button>
                </div>
            </div>
        </div>

        <!-- Conteúdo -->
        <div class="dashboard-content">
            <!-- Visão Geral Equipa -->
            <div class="dashboard-section active" id="teamOverviewSection">
                <div class="stats-row">
                    <div class="stat-card-horizontal">
                        <div class="stat-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="teamMembersCount">5</h3>
                            <p>Membros</p>
                        </div>
                    </div>
                    <div class="stat-card-horizontal">
                        <div class="stat-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="teamHoursToday">8.5</h3>
                            <p>Horas Hoje</p>
                        </div>
                    </div>
                    <div class="stat-card-horizontal">
                        <div class="stat-icon">
                            <i class="fas fa-box"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="teamPendingRequests">3</h3>
                            <p>Pedidos Pendentes</p>
                        </div>
                    </div>
                    <div class="stat-card-horizontal">
                        <div class="stat-icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="teamStatus">Online</h3>
                            <p>Estado</p>
                        </div>
                    </div>
                </div>

                <!-- Sistema de Pedidos de Material -->
                <div class="content-card" style="margin-top: 30px;">
                    <div class="card-header">
                        <h3><i class="fas fa-boxes"></i> Novo Pedido de Material</h3>
                        <span class="badge badge-info">Envia automaticamente para Compras</span>
                    </div>

                    <div class="form-row">
                        <div class="form-group-dashboard">
                            <label>Categoria</label>
                            <select id="materialCategory" onchange="loadMaterials()">
                                <option value="construction">Materiais de Construção</option>
                                <option value="machines">Máquinas e Equipamentos</option>
                                <option value="tools">Ferramentas</option>
                                <option value="consumables">Consumíveis</option>
                                <option value="safety">EPIs e Segurança</option>
                            </select>
                        </div>
                        <div class="form-group-dashboard">
                            <label>Material</label>
                            <select id="materialSelect">
                                <option value="">Selecione um material</option>
                            </select>
                        </div>
                        <div class="form-group-dashboard">
                            <label>Quantidade</label>
                            <input type="number" id="materialQuantity" min="1" value="1">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group-dashboard">
                            <label>Unidade</label>
                            <select id="materialUnit">
                                <option value="sacos">sacos</option>
                                <option value="ton">toneladas</option>
                                <option value="m3">m³</option>
                                <option value="litros">litros</option>
                                <option value="unidades">unidades</option>
                                <option value="caixas">caixas</option>
                            </select>
                        </div>
                        <div class="form-group-dashboard">
                            <label>Urgência</label>
                            <select id="materialUrgency">
                                <option value="normal">Normal (1-2 semanas)</option>
                                <option value="urgent">Urgente (3-5 dias)</option>
                                <option value="critical">Crítico (24-48h)</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group-dashboard">
                        <label>Observações/Detalhes</label>
                        <textarea id="materialNotes" rows="3" placeholder="Detalhes sobre o material necessário..."></textarea>
                    </div>

                    <div class="form-actions">
                        <button class="btn-dashboard btn-success" onclick="submitMaterialRequest()">
                            <i class="fas fa-paper-plane"></i> Enviar para Compras
                        </button>
                        <button class="btn-dashboard btn-whatsapp" onclick="submitMaterialRequestWhatsApp()">
                            <i class="fab fa-whatsapp"></i> WhatsApp Compras
                        </button>
                    </div>
                </div>

                <!-- Lista de Equipas Disponíveis -->
                <div class="content-card" style="margin-top: 30px;">
                    <div class="card-header">
                        <h3><i class="fas fa-users"></i> Equipas da Empresa</h3>
                        <span class="badge badge-info" id="totalTeamsCount">15 equipas</span>
                    </div>
                    
                    <div class="filter-bar">
                        <select id="filterTeamLocationList" onchange="filterTeamList()">
                            <option value="all">Todas Localizações</option>
                            <option value="germany">Alemanha</option>
                            <option value="portugal">Portugal</option>
                        </select>
                        <select id="filterTeamStatusList" onchange="filterTeamList()">
                            <option value="all">Todos Estados</option>
                            <option value="active">Ativas</option>
                            <option value="inactive">Inativas</option>
                        </select>
                    </div>

                    <div style="max-height: 300px; overflow-y: auto;">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Equipa</th>
                                    <th>Localização</th>
                                    <th>Chefe</th>
                                    <th>Membros</th>
                                    <th>Obra Atual</th>
                                    <th>Estado</th>
                                </tr>
                            </thead>
                            <tbody id="teamListTable">
                                <!-- Lista de equipas será carregada aqui -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Pedidos de Material -->
            <div class="dashboard-section" id="teamMaterialsSection">
                <div class="content-card">
                    <div class="card-header">
                        <h3><i class="fas fa-clipboard-list"></i> Histórico de Pedidos</h3>
                        <button class="btn-dashboard btn-primary" onclick="refreshMaterialRequests()">
                            <i class="fas fa-sync-alt"></i> Atualizar
                        </button>
                    </div>

                    <div class="filter-bar">
                        <select id="filterRequestStatus" onchange="filterMaterialRequests()">
                            <option value="all">Todos Estados</option>
                            <option value="pending">Pendentes</option>
                            <option value="approved">Aprovados</option>
                            <option value="completed">Completados</option>
                            <option value="cancelled">Cancelados</option>
                        </select>
                        <input type="date" id="filterRequestDateFrom" onchange="filterMaterialRequests()">
                        <input type="date" id="filterRequestDateTo" onchange="filterMaterialRequests()">
                    </div>

                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Nº Pedido</th>
                                <th>Material</th>
                                <th>Quantidade</th>
                                <th>Data Pedido</th>
                                <th>Urgência</th>
                                <th>Estado</th>
                                <th>Responsável Compras</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="teamMaterialRequestsTable">
                            <!-- Pedidos serão carregados aqui -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Controlo Horas da Equipa -->
            <div class="dashboard-section" id="teamTimeSection">
                <div class="content-card">
                    <div class="card-header">
                        <h3><i class="fas fa-clock"></i> Controlo de Horas da Equipa</h3>
                        <div class="time-display" style="font-size: 2rem; color: var(--team);">
                            <span id="teamCurrentTimeDisplay">08:45</span>
                        </div>
                    </div>

                    <div class="time-tracker">
                        <div class="time-buttons">
                            <button class="btn-dashboard btn-success" onclick="markTeamEntry()">
                                <i class="fas fa-sign-in-alt"></i> Entrada da Equipa
                            </button>
                            <button class="btn-dashboard btn-warning" onclick="markTeamBreak()">
                                <i class="fas fa-coffee"></i> Pausa da Equipa
                            </button>
                            <button class="btn-dashboard btn-danger" onclick="markTeamExit()">
                                <i class="fas fa-sign-out-alt"></i> Saída da Equipa
                            </button>
                        </div>
                    </div>

                    <div style="margin-top: 20px;">
                        <h4><i class="fas fa-users"></i> Membros da Equipa</h4>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Nome</th>
                                    <th>Entrada</th>
                                    <th>Saída</th>
                                    <th>Pausa</th>
                                    <th>Total</th>
                                    <th>Estado</th>
                                </tr>
                            </thead>
                            <tbody id="teamMembersTime">
                                <!-- Membros da equipa serão listados aqui -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Meus Pedidos -->
            <div class="dashboard-section" id="teamRequestsSection">
                <div class="content-card">
                    <div class="card-header">
                        <h3><i class="fas fa-clipboard-list"></i> Meus Pedidos</h3>
                        <button class="btn-dashboard btn-info" onclick="exportMyRequests()">
                            <i class="fas fa-download"></i> Exportar
                        </button>
                    </div>
                    <!-- Conteúdo dos meus pedidos -->
                </div>
            </div>

            <!-- Relatórios -->
            <div class="dashboard-section" id="teamReportsSection">
                <div class="content-card">
                    <div class="card-header">
                        <h3><i class="fas fa-file-alt"></i> Relatórios da Equipa</h3>
                        <button class="btn-dashboard btn-primary" onclick="generateTeamReport()">
                            <i class="fas fa-file-pdf"></i> Gerar Relatório
                        </button>
                    </div>
                    <!-- Conteúdo de relatórios -->
                </div>
            </div>
        </div>

        <!-- MENU NO FUNDO PARA CHEFE DE EQUIPA -->
        <nav class="bottom-menu">
            <div class="bottom-menu-container">
                <a href="#" class="bottom-menu-item active" data-section="teamOverview">
                    <i class="fas fa-home"></i>
                    <span>Visão Geral</span>
                </a>
                <a href="#" class="bottom-menu-item" data-section="teamTime">
                    <i class="fas fa-clock"></i>
                    <span>Controlo Horas</span>
                </a>
                <a href="#" class="bottom-menu-item" data-section="teamMaterials">
                    <i class="fas fa-boxes"></i>
                    <span>Pedir Materiais</span>
                    <span class="bottom-menu-badge" id="pendingRequestsBottom">3</span>
                </a>
                <a href="#" class="bottom-menu-item" data-section="teamRequests">
                    <i class="fas fa-clipboard-list"></i>
                    <span>Meus Pedidos</span>
                </a>
                <a href="#" class="bottom-menu-item" data-section="teamReports">
                    <i class="fas fa-file-alt"></i>
                    <span>Relatórios</span>
                </a>
            </div>
        </nav>
    </div>

    <!-- ============ DASHBOARD COMPRAS ============ -->
    <div class="dashboard purchase-dashboard" id="purchaseDashboard">
        <!-- Top Bar -->
        <div class="top-bar">
            <div class="container top-bar-content">
                <div class="dashboard-brand">
                    <i class="fas fa-shopping-cart"></i>
                    <h1>Compras - MAFC</h1>
                </div>
                <div class="dashboard-info">
                    <div class="user-info">
                        <i class="fas fa-user-tie"></i>
                        <span id="purchaseUserName">Compras</span>
                    </div>
                    <div id="purchaseCurrentTime" style="font-weight: 600;">10:45 AM</div>
                    <button class="logout-btn" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i> Sair
                    </button>
                </div>
            </div>
        </div>

        <!-- Conteúdo -->
        <div class="dashboard-content">
            <!-- Dashboard Compras -->
            <div class="dashboard-section active" id="purchaseDashboardSection">
                <div class="stats-row">
                    <div class="stat-card-horizontal">
                        <div class="stat-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="purchasePendingCount">12</h3>
                            <p>Pendentes</p>
                        </div>
                    </div>
                    <div class="stat-card-horizontal">
                        <div class="stat-icon">
                            <i class="fas fa-check"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="purchaseApprovedCount">8</h3>
                            <p>Aprovados</p>
                        </div>
                    </div>
                    <div class="stat-card-horizontal">
                        <div class="stat-icon">
                            <i class="fas fa-check-double"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="purchaseCompletedCount">24</h3>
                            <p>Concluídos</p>
                        </div>
                    </div>
                    <div class="stat-card-horizontal">
                        <div class="stat-icon">
                            <i class="fas fa-euro-sign"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="purchaseMonthValue">€18.5K</h3>
                            <p>Valor Mês</p>
                        </div>
                    </div>
                </div>

                <!-- Alertas Urgentes -->
                <div class="content-card">
                    <div class="card-header">
                        <h3><i class="fas fa-exclamation-triangle"></i> Pedidos Urgentes</h3>
                        <button class="btn-dashboard btn-warning" onclick="processUrgentRequests()">
                            <i class="fas fa-bolt"></i> Processar Todos
                        </button>
                    </div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Nº Pedido</th>
                                <th>Equipa</th>
                                <th>Material</th>
                                <th>Quantidade</th>
                                <th>Urgência</th>
                                <th>Tempo Pendente</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="purchaseUrgentTable">
                            <!-- Pedidos urgentes serão carregados aqui -->
                        </tbody>
                    </table>
                </div>

                <!-- Gestão de Fornecedores -->
                <div class="content-card" style="margin-top: 30px;">
                    <div class="card-header">
                        <h3><i class="fas fa-truck"></i> Fornecedores de Materiais de Construção</h3>
                        <button class="btn-dashboard btn-success" onclick="openSupplierModal()">
                            <i class="fas fa-plus"></i> Adicionar Fornecedor
                        </button>
                    </div>

                    <div class="filter-bar">
                        <input type="text" id="searchSupplier" placeholder="Pesquisar fornecedor..." onkeyup="filterSuppliers()">
                        <select id="filterSupplierType" onchange="filterSuppliers()">
                            <option value="all">Todos Tipos</option>
                            <option value="construcao">Materiais de Construção</option>
                            <option value="ferramentas">Ferramentas</option>
                            <option value="equipamentos">Equipamentos</option>
                        </select>
                    </div>

                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Nome</th>
                                <th>NIF</th>
                                <th>Contacto</th>
                                <th>Tipo</th>
                                <th>Email</th>
                                <th>Avaliação</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="suppliersTable">
                            <!-- Fornecedores serão carregados aqui -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Pendentes -->
            <div class="dashboard-section" id="purchasePendingSection">
                <div class="content-card">
                    <div class="card-header">
                        <h3><i class="fas fa-clock"></i> Pedidos Pendentes de Aprovação</h3>
                        <button class="btn-dashboard btn-success" onclick="approveAllPending()">
                            <i class="fas fa-check-double"></i> Aprovar Todos
                        </button>
                    </div>

                    <div class="filter-bar">
                        <select id="filterPendingUrgency" onchange="filterPendingPurchases()">
                            <option value="all">Todas Urgências</option>
                            <option value="critical">Crítico</option>
                            <option value="urgent">Urgente</option>
                            <option value="normal">Normal</option>
                        </select>
                        <select id="filterPendingTeam" onchange="filterPendingPurchases()">
                            <option value="all">Todas Equipas</option>
                        </select>
                        <input type="text" id="searchPending" placeholder="Pesquisar material..." onkeyup="filterPendingPurchases()">
                    </div>

                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Nº Pedido</th>
                                <th>Data</th>
                                <th>Equipa</th>
                                <th>Material</th>
                                <th>Quantidade</th>
                                <th>Urgência</th>
                                <th>Pedido por</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="purchasePendingTable">
                            <!-- Pedidos pendentes serão carregados aqui -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Aprovados -->
            <div class="dashboard-section" id="purchaseApprovedSection">
                <div class="content-card">
                    <div class="card-header">
                        <h3><i class="fas fa-check-circle"></i> Pedidos Aprovados para Execução</h3>
                        <button class="btn-dashboard btn-primary" onclick="newPurchaseOrder()">
                            <i class="fas fa-plus"></i> Nova Ordem Compra
                        </button>
                    </div>

                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Nº Pedido</th>
                                <th>Material</th>
                                <th>Quantidade</th>
                                <th>Fornecedor</th>
                                <th>Valor</th>
                                <th>Data Aprovação</th>
                                <th>Prazo Entrega</th>
                                <th>Estado</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="purchaseApprovedTable">
                            <!-- Pedidos aprovados serão carregados aqui -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Concluídos/Resolvidos -->
            <div class="dashboard-section" id="purchaseCompletedSection">
                <div class="content-card">
                    <div class="card-header">
                        <h3><i class="fas fa-check-double"></i> Compras Concluídas/Resolvidas</h3>
                        <button class="btn-dashboard btn-info" onclick="exportCompletedPurchases()">
                            <i class="fas fa-file-excel"></i> Exportar Excel
                        </button>
                    </div>

                    <div class="filter-bar">
                        <select id="filterCompletedMonth" onchange="filterCompletedPurchases()">
                            <option value="all">Todos os Meses</option>
                            <option value="12">Dezembro 2024</option>
                            <option value="11">Novembro 2024</option>
                        </select>
                        <select id="filterCompletedSupplier" onchange="filterCompletedPurchases()">
                            <option value="all">Todos Fornecedores</option>
                        </select>
                        <input type="text" id="searchCompleted" placeholder="Pesquisar..." onkeyup="filterCompletedPurchases()">
                    </div>

                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Nº Ordem</th>
                                <th>Material</th>
                                <th>Quantidade</th>
                                <th>Fornecedor</th>
                                <th>Valor Total</th>
                                <th>Data Compra</th>
                                <th>Data Entrega</th>
                                <th>Equipa</th>
                                <th>Nº Fatura</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="purchaseCompletedTable">
                            <!-- Compras concluídas serão carregadas aqui -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Fornecedores -->
            <div class="dashboard-section" id="purchaseSuppliersSection">
                <div class="content-card">
                    <div class="card-header">
                        <h3><i class="fas fa-truck"></i> Gestão de Fornecedores</h3>
                        <button class="btn-dashboard btn-success" onclick="openSupplierModal()">
                            <i class="fas fa-plus"></i> Novo Fornecedor
                        </button>
                    </div>
                    <!-- Conteúdo de fornecedores será carregado dinamicamente -->
                </div>
            </div>

            <!-- Relatórios -->
            <div class="dashboard-section" id="purchaseReportsSection">
                <div class="content-card">
                    <div class="card-header">
                        <h3><i class="fas fa-chart-bar"></i> Relatórios de Compras</h3>
                        <button class="btn-dashboard btn-primary" onclick="generatePurchaseReports()">
                            <i class="fas fa-download"></i> Gerar Relatórios
                        </button>
                    </div>
                    <!-- Conteúdo de relatórios -->
                </div>
            </div>
        </div>

        <!-- MENU NO FUNDO PARA COMPRAS -->
        <nav class="bottom-menu">
            <div class="bottom-menu-container">
                <a href="#" class="bottom-menu-item active" data-section="purchaseDashboard">
                    <i class="fas fa-home"></i>
                    <span>Dashboard</span>
                </a>
                <a href="#" class="bottom-menu-item" data-section="purchasePending">
                    <i class="fas fa-clock"></i>
                    <span>Pendentes</span>
                    <span class="bottom-menu-badge" id="pendingPurchasesCountBottom">12</span>
                </a>
                <a href="#" class="bottom-menu-item" data-section="purchaseApproved">
                    <i class="fas fa-check-circle"></i>
                    <span>Aprovados</span>
                </a>
                <a href="#" class="bottom-menu-item" data-section="purchaseCompleted">
                    <i class="fas fa-check-double"></i>
                    <span>Concluídos</span>
                </a>
                <a href="#" class="bottom-menu-item" data-section="purchaseSuppliers">
                    <i class="fas fa-truck"></i>
                    <span>Fornecedores</span>
                </a>
                <a href="#" class="bottom-menu-item" data-section="purchaseReports">
                    <i class="fas fa-chart-bar"></i>
                    <span>Relatórios</span>
                </a>
            </div>
        </nav>
    </div>

    <script>
        // ============ SISTEMA COMPLETO MAFC ============
        
        // Sistema de armazenamento
        const MAFCSystem = {
            currentUser: null,
            editingEmployeeId: null,
            editingPurchaseId: null,
            editingSupplierId: null,
            
            // Credenciais CORRIGIDAS - Responsável de Compras agora funciona
            credentials: {
                boss: [
                    { code: 'mafc', password: '1234', name: 'Administrador' },
                    { code: 'admin', password: 'admin123', name: 'Gestor Geral' }
                ],
                team: [
                    { code: 'equipa01', password: '1234', name: 'João Silva', team: 'Equipa 01 - Berlin' },
                    { code: 'equipa02', password: '1234', name: 'Carlos Mendes', team: 'Equipa 02 - Hamburg' },
                    { code: 'equipa03', password: '1234', name: 'António Santos', team: 'Equipa 03 - Lisboa' },
                    { code: 'equipa04', password: '1234', name: 'Miguel Costa', team: 'Equipa 04 - Porto' },
                    { code: 'equipa05', password: '1234', name: 'Ricardo Oliveira', team: 'Equipa 05 - Frankfurt' },
                    { code: 'equipa06', password: '1234', name: 'Pedro Martins', team: 'Equipa 06 - Munique' },
                    { code: 'equipa07', password: '1234', name: 'Francisco Lima', team: 'Equipa 07 - Colônia' },
                    { code: 'equipa08', password: '1234', name: 'Jorge Silva', team: 'Equipa 08 - Estugarda' },
                    { code: 'equipa09', password: '1234', name: 'Rui Pereira', team: 'Equipa 09 - Düsseldorf' },
                    { code: 'equipa10', password: '1234', name: 'Luís Fernandes', team: 'Equipa 10 - Essen' },
                    { code: 'equipa11', password: '1234', name: 'Hugo Rodrigues', team: 'Equipa 11 - Dortmund' },
                    { code: 'equipa12', password: '1234', name: 'Bruno Sousa', team: 'Equipa 12 - Bremen' },
                    { code: 'equipa13', password: '1234', name: 'Paulo Gomes', team: 'Equipa 13 - Hanôver' },
                    { code: 'equipa14', password: '1234', name: 'Vítor Lopes', team: 'Equipa 14 - Nuremberga' },
                    { code: 'equipa15', password: '1234', name: 'André Marques', team: 'Equipa 15 - Leipzig' }
                ],
                purchase: [
                    { code: 'compras01', password: '1234', name: 'Responsável Compras' }, // Código corrigido
                    { code: 'compras', password: '1234', name: 'Ana Compras' } // Código alternativo
                ],
                office: [
                    { code: 'escritorio', password: '1234', name: 'Maria Silva' },
                    { code: 'contabilidade', password: '1234', name: 'Ana Costa' }
                ]
            },
            
            // Dados do sistema
            officePeople: [],
            timeRecords: {},
            materialRequests: [],
            purchases: [],
            documents: [],
            auditLog: [],
            activityLog: [],
            teams: [],
            suppliers: [],
            
            // Inicializar dados
            init: function() {
                // Carregar do localStorage ou inicializar dados padrão
                this.loadFromStorage();
                
                // Inicializar dados padrão se necessário
                if (this.officePeople.length === 0) {
                    this.officePeople = [
                        { id: 1, name: 'Maria Silva', whatsapp: '+351912345678', position: 'Administrativa', department: 'escritorio', status: 'active', startDate: '2023-01-15' },
                        { id: 2, name: 'Ana Costa', whatsapp: '+351912345679', position: 'Contabilista', department: 'contabilidade', status: 'active', startDate: '2022-03-10' },
                        { id: 3, name: 'João Silva', whatsapp: '+351912345680', position: 'Chefe Equipa', department: 'obra', status: 'active', startDate: '2021-05-20', team: 'Equipa 01 - Berlin' },
                        { id: 4, name: 'Carlos Mendes', whatsapp: '+351912345681', position: 'Chefe Equipa', department: 'obra', status: 'active', startDate: '2021-06-15', team: 'Equipa 02 - Hamburg' }
                    ];
                }
                
                if (this.teams.length === 0) {
                    // Criar 15 equipas como solicitado
                    this.teams = [];
                    const teamLocations = ['Berlim', 'Hamburgo', 'Lisboa', 'Porto', 'Frankfurt', 'Munique', 'Colônia', 'Estugarda', 'Düsseldorf', 'Essen', 'Dortmund', 'Bremen', 'Hanôver', 'Nuremberga', 'Leipzig'];
                    const teamStatus = ['active', 'active', 'active', 'active', 'active', 'active', 'active', 'active', 'active', 'active', 'active', 'active', 'active', 'active', 'inactive'];
                    
                    for (let i = 1; i <= 15; i++) {
                        const locationIndex = i - 1;
                        this.teams.push({
                            id: i,
                            name: `Equipa ${i.toString().padStart(2, '0')} - ${teamLocations[locationIndex]}`,
                            location: teamLocations[locationIndex],
                            leader: `Chefe ${i}`,
                            members: Math.floor(Math.random() * 5) + 3,
                            currentWork: `Projeto ${i}`,
                            status: teamStatus[locationIndex],
                            country: locationIndex < 4 ? 'Portugal' : 'Alemanha'
                        });
                    }
                }
                
                if (this.suppliers.length === 0) {
                    this.suppliers = [
                        { id: 1, name: 'Cimentos de Portugal', nif: '500000001', contact: '+351219876543', email: 'vendas@cimentos.pt', type: ['construcao'], notes: 'Fornecedor principal de cimento' },
                        { id: 2, name: 'Ferragens Lda.', nif: '500000002', contact: '+351219876544', email: 'compras@ferragens.pt', type: ['ferramentas', 'equipamentos'], notes: 'Ferramentas e equipamentos' },
                        { id: 3, name: 'Madeiras Nobres SA', nif: '500000003', contact: '+351219876545', email: 'info@madeiras.pt', type: ['construcao'], notes: 'Madeiras para construção' }
                    ];
                }
                
                this.saveToStorage();
            },
            
            // Salvar no localStorage
            saveToStorage: function() {
                const data = {
                    officePeople: this.officePeople,
                    timeRecords: this.timeRecords,
                    materialRequests: this.materialRequests,
                    purchases: this.purchases,
                    documents: this.documents,
                    auditLog: this.auditLog,
                    activityLog: this.activityLog,
                    teams: this.teams,
                    suppliers: this.suppliers
                };
                localStorage.setItem('mafcSystem', JSON.stringify(data));
            },
            
            // Carregar do localStorage
            loadFromStorage: function() {
                const data = JSON.parse(localStorage.getItem('mafcSystem'));
                if (data) {
                    this.officePeople = data.officePeople || [];
                    this.timeRecords = data.timeRecords || {};
                    this.materialRequests = data.materialRequests || [];
                    this.purchases = data.purchases || [];
                    this.documents = data.documents || [];
                    this.auditLog = data.auditLog || [];
                    this.activityLog = data.activityLog || [];
                    this.teams = data.teams || [];
                    this.suppliers = data.suppliers || [];
                }
            },
            
            // Log de auditoria
            logAudit: function(action, details, module = 'system') {
                const logEntry = {
                    id: Date.now(),
                    timestamp: new Date().toISOString(),
                    user: this.currentUser ? this.currentUser.name : 'system',
                    userRole: this.currentUser ? this.currentUser.role : 'system',
                    ip: '127.0.0.1',
                    action: action,
                    details: details,
                    module: module
                };
                
                this.auditLog.unshift(logEntry);
                this.activityLog.unshift({
                    ...logEntry,
                    displayTime: new Date().toLocaleTimeString('pt-PT')
                });
                
                // Manter apenas últimos 1000 registos
                if (this.auditLog.length > 1000) this.auditLog.pop();
                if (this.activityLog.length > 100) this.activityLog.pop();
                
                this.saveToStorage();
            },
            
            // Log de atividade
            logActivity: function(action, details) {
                this.logAudit(action, details, 'activity');
            }
        };
        
        // ============ INICIALIZAÇÃO ============
        document.addEventListener('DOMContentLoaded', function() {
            MAFCSystem.init();
            updateClocks();
            setInterval(updateClocks, 1000);
            
            // Event listeners
            document.getElementById('openLogin').addEventListener('click', function(e) {
                e.preventDefault();
                document.getElementById('loginModal').style.display = 'flex';
            });
            
            document.querySelector('.close-modal').addEventListener('click', function() {
                document.getElementById('loginModal').style.display = 'none';
            });
            
            window.addEventListener('click', function(e) {
                if (e.target === document.getElementById('loginModal')) {
                    document.getElementById('loginModal').style.display = 'none';
                }
            });
            
            // Login form
            document.getElementById('loginForm').addEventListener('submit', function(e) {
                e.preventDefault();
                handleLogin();
            });
            
            // Menu navigation - MENU DO FUNDO
            document.querySelectorAll('.bottom-menu-item').forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    const dashboard = this.closest('.dashboard');
                    const sectionId = this.getAttribute('data-section') + 'Section';
                    
                    // Remover active de todos os items do mesmo dashboard
                    dashboard.querySelectorAll('.bottom-menu-item').forEach(i => {
                        i.classList.remove('active');
                    });
                    
                    // Adicionar active ao item clicado
                    this.classList.add('active');
                    
                    // Esconder todas as seções do dashboard
                    dashboard.querySelectorAll('.dashboard-section').forEach(section => {
                        section.classList.remove('active');
                    });
                    
                    // Mostrar seção selecionada
                    const section = document.getElementById(sectionId);
                    if (section) section.classList.add('active');
                    
                    // Carregar dados da seção se necessário
                    loadSectionData(sectionId);
                });
            });
            
            // Fechar modais
            document.querySelectorAll('.close-modal-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const modal = this.closest('.modal-employee, .modal-document, .modal-monthly-report, .modal-purchase-details, .modal-supplier');
                    if (modal) modal.style.display = 'none';
                });
            });
            
            // Fechar modais ao clicar fora
            window.addEventListener('click', function(e) {
                if (e.target.classList.contains('modal-employee')) {
                    document.getElementById('employeeModal').style.display = 'none';
                }
                if (e.target.classList.contains('modal-document')) {
                    document.getElementById('documentModal').style.display = 'none';
                }
                if (e.target.classList.contains('modal-purchase-details')) {
                    document.getElementById('purchaseDetailsModal').style.display = 'none';
                }
                if (e.target.classList.contains('modal-supplier')) {
                    document.getElementById('supplierModal').style.display = 'none';
                }
            });
        });
        
        // ============ FUNÇÕES DE LOGIN ============
        function handleLogin() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const role = document.getElementById('role').value;
            
            let userFound = null;
            
            // Verificar credenciais
            if (role && MAFCSystem.credentials[role]) {
                userFound = MAFCSystem.credentials[role].find(u => 
                    u.code === username && u.password === password
                );
            }
            
            if (userFound) {
                MAFCSystem.currentUser = { ...userFound, role };
                MAFCSystem.logAudit('login', `Login realizado como ${role}`);
                loginSuccess();
            } else {
                alert('Credenciais incorretas! Utilize:\n\nADMIN: mafc / 1234\nEQUIPAS: equipa01 a equipa15 / 1234\nCOMPRAS: compras01 / 1234\nESCRITÓRIO: escritorio / 1234');
            }
        }
        
        function loginSuccess() {
            document.getElementById('loginModal').style.display = 'none';
            document.getElementById('publicWebsite').style.display = 'none';
            
            // Mostrar dashboard apropriado
            switch(MAFCSystem.currentUser.role) {
                case 'boss':
                    showBossDashboard();
                    break;
                case 'team':
                    showTeamDashboard();
                    break;
                case 'purchase':
                    showPurchaseDashboard();
                    break;
                case 'office':
                    showOfficeDashboard();
                    break;
            }
            
            // Inicializar dashboard
            initializeDashboard();
        }
        
        function logout() {
            if (confirm('Tem certeza que deseja sair do sistema?')) {
                MAFCSystem.logAudit('logout', 'Logout realizado');
                
                // Esconder todos os dashboards
                document.querySelectorAll('.dashboard').forEach(d => {
                    d.style.display = 'none';
                });
                
                // Mostrar website público
                document.getElementById('publicWebsite').style.display = 'block';
                
                // Fechar todos os modais
                document.querySelectorAll('.modal, .modal-employee, .modal-document, .modal-purchase-details, .modal-supplier').forEach(modal => {
                    modal.style.display = 'none';
                });
                
                // Limpar formulário de login
                document.getElementById('loginForm').reset();
                MAFCSystem.currentUser = null;
            }
        }
        
        // ============ DASHBOARD DO PATRÃO/ADMIN ============
        function showBossDashboard() {
            document.getElementById('bossDashboard').style.display = 'block';
            document.getElementById('bossUserName').textContent = MAFCSystem.currentUser.name;
            loadBossData();
        }
        
        function loadBossData() {
            // Atualizar contadores
            document.getElementById('totalEmployees').textContent = MAFCSystem.officePeople.length;
            document.getElementById('activeTeams').textContent = MAFCSystem.teams.filter(t => t.status === 'active').length;
            
            // Atualizar badges do menu do fundo
            document.getElementById('teamsCountBottom').textContent = MAFCSystem.teams.filter(t => t.status === 'active').length;
            
            // Calcular horas pendentes
            const today = new Date().toLocaleDateString('pt-PT');
            const todayRecords = MAFCSystem.timeRecords[today] || {};
            let pendingHoursCount = 0;
            Object.values(todayRecords).forEach(record => {
                if (!record.exit || !record.entry) pendingHoursCount++;
            });
            document.getElementById('pendingHoursBottom').textContent = pendingHoursCount;
            
            // Calcular despesas do mês
            const currentMonth = new Date().getMonth() + 1;
            const monthPurchases = MAFCSystem.purchases.filter(p => {
                const purchaseDate = new Date(p.approvalDate || p.date);
                return purchaseDate.getMonth() + 1 === currentMonth;
            });
            const monthExpenses = monthPurchases.reduce((sum, p) => sum + (p.totalValue || 0), 0);
            document.getElementById('monthExpenses').textContent = `€${(monthExpenses/1000).toFixed(1)}K`;
            
            // Pedidos pendentes
            const pendingPurchases = MAFCSystem.materialRequests.filter(r => r.status === 'pending').length;
            document.getElementById('pendingItems').textContent = pendingPurchases;
            document.getElementById('pendingPurchasesBottom').textContent = pendingPurchases;
            
            // Atualizar alertas
            updateBossAlerts();
            
            // Atualizar log de atividades
            updateActivityLog();
            
            // Carregar tabelas
            loadBossTeamsTable();
            loadBossPurchasesTable();
            loadBossAuditTable();
        }
        
        function updateBossAlerts() {
            const alertsDiv = document.getElementById('bossAlerts');
            alertsDiv.innerHTML = '';
            
            // Alertas de pedidos urgentes
            const urgentRequests = MAFCSystem.materialRequests.filter(r => 
                r.status === 'pending' && r.urgency === 'critical'
            );
            
            if (urgentRequests.length > 0) {
                const alert = document.createElement('div');
                alert.className = 'alert alert-danger';
                alert.innerHTML = `
                    <i class="fas fa-exclamation-triangle"></i>
                    <div>
                        <strong>${urgentRequests.length} pedidos críticos pendentes</strong>
                        <p>Necessitam de atenção imediata</p>
                    </div>
                    <button class="btn-dashboard btn-sm btn-danger" onclick="processUrgentAlerts()">Ver</button>
                `;
                alertsDiv.appendChild(alert);
            }
            
            // Alertas de compras atrasadas
            const latePurchases = MAFCSystem.purchases.filter(p => 
                p.status === 'approved' && p.deliveryDate && 
                new Date(p.deliveryDate) < new Date()
            );
            
            if (latePurchases.length > 0) {
                const alert = document.createElement('div');
                alert.className = 'alert alert-warning';
                alert.innerHTML = `
                    <i class="fas fa-clock"></i>
                    <div>
                        <strong>${latePurchases.length} compras atrasadas</strong>
                        <p>Verificar estado com fornecedores</p>
                    </div>
                    <button class="btn-dashboard btn-sm btn-warning" onclick="viewLatePurchases()">Ver</button>
                `;
                alertsDiv.appendChild(alert);
            }
        }
        
        function updateActivityLog() {
            const tbody = document.getElementById('bossActivityLog');
            tbody.innerHTML = '';
            
            MAFCSystem.activityLog.slice(0, 10).forEach(log => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${new Date(log.timestamp).toLocaleString('pt-PT')}</td>
                    <td>${log.user}</td>
                    <td>${log.action}</td>
                    <td>${log.details}</td>
                `;
                tbody.appendChild(row);
            });
        }
        
        function loadBossTeamsTable() {
            const tbody = document.getElementById('bossTeamsTable');
            tbody.innerHTML = '';
            
            MAFCSystem.teams.forEach(team => {
                const row = document.createElement('tr');
                const statusBadge = team.status === 'active' ? 
                    '<span class="badge badge-success">Ativa</span>' :
                    '<span class="badge badge-danger">Inativa</span>';
                
                row.innerHTML = `
                    <td>#${team.id.toString().padStart(3, '0')}</td>
                    <td><strong>${team.name}</strong></td>
                    <td>${team.location}</td>
                    <td>${team.leader || '--'}</td>
                    <td>${team.members || 0}</td>
                    <td>${team.currentWork || '--'}</td>
                    <td>${statusBadge}</td>
                    <td>
                        <button class="btn-dashboard btn-sm btn-info" onclick="viewTeamDetails(${team.id})">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn-dashboard btn-sm btn-warning" onclick="editTeam(${team.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        function loadBossPurchasesTable() {
            const tbody = document.getElementById('bossPurchasesTable');
            tbody.innerHTML = '';
            
            // Combinar pedidos e compras
            const allPurchases = [...MAFCSystem.materialRequests, ...MAFCSystem.purchases]
                .sort((a, b) => new Date(b.date || b.requestDate) - new Date(a.date || a.requestDate));
            
            allPurchases.slice(0, 50).forEach(purchase => {
                const isRequest = !purchase.orderNumber;
                const statusMap = {
                    'pending': '<span class="badge badge-warning">Pendente</span>',
                    'approved': '<span class="badge badge-info">Aprovado</span>',
                    'completed': '<span class="badge badge-success">Concluído</span>',
                    'cancelled': '<span class="badge badge-danger">Cancelado</span>'
                };
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${isRequest ? `#PED-${purchase.id}` : `#ORD-${purchase.orderNumber}`}</td>
                    <td>${purchase.team || '--'}</td>
                    <td>${purchase.material || '--'}</td>
                    <td>${purchase.quantity || '--'} ${purchase.unit || ''}</td>
                    <td>${purchase.totalValue ? `€${purchase.totalValue}` : '--'}</td>
                    <td>${new Date(purchase.date || purchase.requestDate).toLocaleDateString('pt-PT')}</td>
                    <td>${statusMap[purchase.status] || '--'}</td>
                    <td>${purchase.responsible || '--'}</td>
                    <td>
                        <button class="btn-dashboard btn-sm btn-info" onclick="viewPurchaseDetails(${purchase.id}, ${isRequest})">
                            <i class="fas fa-eye"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        function loadBossAuditTable() {
            const tbody = document.getElementById('bossAuditTable');
            tbody.innerHTML = '';
            
            MAFCSystem.auditLog.slice(0, 100).forEach(log => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${new Date(log.timestamp).toLocaleString('pt-PT')}</td>
                    <td>${log.user} (${log.userRole})</td>
                    <td>${log.ip}</td>
                    <td>${log.action}</td>
                    <td>${log.details}</td>
                    <td>${log.module}</td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // ============ DASHBOARD ESCRITÓRIO ============
        function showOfficeDashboard() {
            document.getElementById('officeDashboard').style.display = 'block';
            document.getElementById('officeUserName').textContent = MAFCSystem.currentUser.name;
            loadOfficeData();
        }
        
        function loadOfficeData() {
            // Atualizar contadores
            document.getElementById('officePeopleCount').textContent = MAFCSystem.officePeople.length;
            
            // Calcular horas hoje
            const today = new Date().toLocaleDateString('pt-PT');
            let todayHours = 0;
            if (MAFCSystem.timeRecords[today]) {
                Object.values(MAFCSystem.timeRecords[today]).forEach(record => {
                    if (record.totalHours) todayHours += record.totalHours;
                });
            }
            document.getElementById('officeTodayHours').textContent = todayHours.toFixed(1);
            
            // Documentos
            document.getElementById('officeDocumentsCount').textContent = MAFCSystem.documents.length;
            
            // Carregar pessoas no select
            loadOfficePeopleSelect();
            
            // Carregar todas as pessoas para marcação de horas
            loadAllEmployeesTime();
            
            // Carregar tabelas
            loadOfficeTodayMarks();
            loadOfficePeopleTable();
            loadOfficeDocumentsTable();
        }
        
        function loadAllEmployeesTime() {
            const tbody = document.getElementById('allEmployeesTime');
            tbody.innerHTML = '';
            
            const today = new Date().toLocaleDateString('pt-PT');
            const todayRecords = MAFCSystem.timeRecords[today] || {};
            
            MAFCSystem.officePeople.forEach(person => {
                if (person.status === 'active') {
                    const record = todayRecords[person.id] || {};
                    const status = record.entry ? (record.exit ? '✅ Concluído' : '⏳ Em trabalho') : '⏰ Pendente';
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${person.name}</td>
                        <td>${record.entry || '--:--'}</td>
                        <td>${record.exit || '--:--'}</td>
                        <td>${record.break || '--'}</td>
                        <td>${record.totalHours ? record.totalHours + 'h' : '--'}</td>
                        <td>
                            <button class="btn-dashboard btn-sm btn-success" onclick="markEmployeeTime(${person.id}, 'entry')">
                                <i class="fas fa-sign-in-alt"></i>
                            </button>
                            <button class="btn-dashboard btn-sm btn-warning" onclick="markEmployeeTime(${person.id}, 'break')">
                                <i class="fas fa-coffee"></i>
                            </button>
                            <button class="btn-dashboard btn-sm btn-danger" onclick="markEmployeeTime(${person.id}, 'exit')">
                                <i class="fas fa-sign-out-alt"></i>
                            </button>
                        </td>
                    `;
                    tbody.appendChild(row);
                }
            });
        }
        
        function markEmployeeTime(personId, type) {
            const person = MAFCSystem.officePeople.find(p => p.id === personId);
            if (!person) return;
            
            const now = new Date();
            const timeString = now.toLocaleTimeString('pt-PT', { hour: '2-digit', minute: '2-digit' });
            const dateString = now.toLocaleDateString('pt-PT');
            
            // Inicializar registos do dia se necessário
            if (!MAFCSystem.timeRecords[dateString]) {
                MAFCSystem.timeRecords[dateString] = {};
            }
            if (!MAFCSystem.timeRecords[dateString][personId]) {
                MAFCSystem.timeRecords[dateString][personId] = {
                    personName: person.name,
                    personId: personId
                };
            }
            
            const record = MAFCSystem.timeRecords[dateString][personId];
            
            switch(type) {
                case 'entry':
                    record.entry = timeString;
                    MAFCSystem.logActivity('time_entry', `${person.name} - Entrada: ${timeString}`);
                    break;
                case 'exit':
                    record.exit = timeString;
                    // Calcular horas totais
                    if (record.entry) {
                        const entryTime = record.entry.split(':').map(Number);
                        const exitTime = timeString.split(':').map(Number);
                        let totalMinutes = (exitTime[0] * 60 + exitTime[1]) - (entryTime[0] * 60 + entryTime[1]);
                        if (totalMinutes < 0) totalMinutes += 24 * 60;
                        
                        // Subtrair pausa se existir
                        if (record.break === '60') {
                            totalMinutes -= 60;
                        }
                        
                        record.totalHours = (totalMinutes / 60).toFixed(1);
                    }
                    MAFCSystem.logActivity('time_exit', `${person.name} - Saída: ${timeString}`);
                    break;
                case 'break':
                    record.break = '60'; // 60 minutos de pausa
                    MAFCSystem.logActivity('break', `${person.name} - Pausa de 60min`);
                    break;
            }
            
            MAFCSystem.saveToStorage();
            
            // Enviar notificação WhatsApp
            const messages = {
                'entry': `✅ ${person.name} - Entrada registada às ${timeString} - MAFC`,
                'exit': `✅ ${person.name} - Saída registada às ${timeString} - MAFC`,
                'break': `⏸️ ${person.name} - Pausa registada às ${timeString} - MAFC`
            };
            
            const message = messages[type];
            if (message && person.whatsapp) {
                const url = `https://wa.me/${person.whatsapp.replace('+', '')}?text=${encodeURIComponent(message)}`;
                window.open(url, '_blank');
            }
            
            alert(`${person.name} - ${type === 'entry' ? 'Entrada' : type === 'exit' ? 'Saída' : 'Pausa'} registada às ${timeString}`);
            loadAllEmployeesTime();
            loadOfficeTodayMarks();
        }
        
        function markAllEntry() {
            if (confirm('Registar entrada para TODOS os funcionários ativos?')) {
                const now = new Date();
                const timeString = now.toLocaleTimeString('pt-PT', { hour: '2-digit', minute: '2-digit' });
                const dateString = now.toLocaleDateString('pt-PT');
                
                if (!MAFCSystem.timeRecords[dateString]) {
                    MAFCSystem.timeRecords[dateString] = {};
                }
                
                MAFCSystem.officePeople.forEach(person => {
                    if (person.status === 'active') {
                        if (!MAFCSystem.timeRecords[dateString][person.id]) {
                            MAFCSystem.timeRecords[dateString][person.id] = {
                                personName: person.name,
                                personId: person.id
                            };
                        }
                        MAFCSystem.timeRecords[dateString][person.id].entry = timeString;
                    }
                });
                
                MAFCSystem.saveToStorage();
                MAFCSystem.logActivity('bulk_time_entry', 'Entrada registada para todos os funcionários');
                alert(`Entrada registada para TODOS os funcionários às ${timeString}`);
                loadAllEmployeesTime();
                loadOfficeTodayMarks();
            }
        }
        
        function markAllExit() {
            if (confirm('Registar saída para TODOS os funcionários ativos?')) {
                const now = new Date();
                const timeString = now.toLocaleTimeString('pt-PT', { hour: '2-digit', minute: '2-digit' });
                const dateString = now.toLocaleDateString('pt-PT');
                
                if (!MAFCSystem.timeRecords[dateString]) {
                    MAFCSystem.timeRecords[dateString] = {};
                }
                
                MAFCSystem.officePeople.forEach(person => {
                    if (person.status === 'active') {
                        if (!MAFCSystem.timeRecords[dateString][person.id]) {
                            MAFCSystem.timeRecords[dateString][person.id] = {
                                personName: person.name,
                                personId: person.id
                            };
                        }
                        const record = MAFCSystem.timeRecords[dateString][person.id];
                        record.exit = timeString;
                        
                        // Calcular horas totais
                        if (record.entry) {
                            const entryTime = record.entry.split(':').map(Number);
                            const exitTime = timeString.split(':').map(Number);
                            let totalMinutes = (exitTime[0] * 60 + exitTime[1]) - (entryTime[0] * 60 + entryTime[1]);
                            if (totalMinutes < 0) totalMinutes += 24 * 60;
                            
                            if (record.break === '60') {
                                totalMinutes -= 60;
                            }
                            
                            record.totalHours = (totalMinutes / 60).toFixed(1);
                        }
                    }
                });
                
                MAFCSystem.saveToStorage();
                MAFCSystem.logActivity('bulk_time_exit', 'Saída registada para todos os funcionários');
                alert(`Saída registada para TODOS os funcionários às ${timeString}`);
                loadAllEmployeesTime();
                loadOfficeTodayMarks();
            }
        }
        
        function markAllBreak() {
            if (confirm('Registar pausa para TODOS os funcionários ativos?')) {
                const dateString = new Date().toLocaleDateString('pt-PT');
                
                if (!MAFCSystem.timeRecords[dateString]) {
                    MAFCSystem.timeRecords[dateString] = {};
                }
                
                MAFCSystem.officePeople.forEach(person => {
                    if (person.status === 'active') {
                        if (!MAFCSystem.timeRecords[dateString][person.id]) {
                            MAFCSystem.timeRecords[dateString][person.id] = {
                                personName: person.name,
                                personId: person.id
                            };
                        }
                        MAFCSystem.timeRecords[dateString][person.id].break = '60';
                    }
                });
                
                MAFCSystem.saveToStorage();
                MAFCSystem.logActivity('bulk_break', 'Pausa registada para todos os funcionários');
                alert('Pausa registada para TODOS os funcionários (60 minutos)');
                loadAllEmployeesTime();
                loadOfficeTodayMarks();
            }
        }
        
        function loadOfficePeopleSelect() {
            const select = document.getElementById('officePersonSelect');
            const reportSelect = document.getElementById('officeReportPerson');
            
            select.innerHTML = '<option value="">Selecione uma pessoa</option>';
            reportSelect.innerHTML = '<option value="all">Todas as Pessoas</option>';
            
            MAFCSystem.officePeople.forEach(person => {
                if (person.status === 'active') {
                    const option1 = document.createElement('option');
                    option1.value = person.id;
                    option1.textContent = person.name;
                    select.appendChild(option1);
                    
                    const option2 = document.createElement('option');
                    option2.value = person.id;
                    option2.textContent = person.name;
                    reportSelect.appendChild(option2);
                }
            });
        }
        
        function loadOfficeTodayMarks() {
            const tbody = document.getElementById('officeTodayMarks');
            tbody.innerHTML = '';
            
            const today = new Date().toLocaleDateString('pt-PT');
            const todayRecords = MAFCSystem.timeRecords[today] || {};
            
            MAFCSystem.officePeople.forEach(person => {
                if (person.status === 'active') {
                    const record = todayRecords[person.id] || {};
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${person.name}</td>
                        <td>${record.entry || '--:--'}</td>
                        <td>${record.exit || '--:--'}</td>
                        <td>${record.break || '--'}</td>
                        <td>${record.totalHours ? record.totalHours + 'h' : '--'}</td>
                        <td>
                            <a href="https://wa.me/${person.whatsapp.replace('+', '')}" target="_blank" class="btn-dashboard btn-sm btn-whatsapp">
                                <i class="fab fa-whatsapp"></i>
                            </a>
                        </td>
                    `;
                    tbody.appendChild(row);
                }
            });
        }
        
        function loadOfficePeopleTable() {
            const tbody = document.getElementById('officePeopleTable');
            tbody.innerHTML = '';
            
            MAFCSystem.officePeople.forEach(person => {
                const statusBadge = {
                    'active': 'badge-success',
                    'inactive': 'badge-danger',
                    'ferias': 'badge-warning',
                    'baixa': 'badge-info'
                }[person.status] || 'badge-secondary';
                
                const statusText = {
                    'active': 'Ativo',
                    'inactive': 'Inativo',
                    'ferias': 'Férias',
                    'baixa': 'Baixa'
                }[person.status] || person.status;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${person.name}</td>
                    <td>${person.whatsapp}</td>
                    <td>${person.position}</td>
                    <td>${person.department}</td>
                    <td><span class="badge ${statusBadge}">${statusText}</span></td>
                    <td>
                        <button class="btn-dashboard btn-sm btn-warning" onclick="editOfficePerson(${person.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn-dashboard btn-sm btn-info" onclick="viewPersonHours(${person.id})">
                            <i class="fas fa-clock"></i>
                        </button>
                        <a href="https://wa.me/${person.whatsapp.replace('+', '')}" target="_blank" class="btn-dashboard btn-sm btn-whatsapp">
                            <i class="fab fa-whatsapp"></i>
                        </a>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        function loadOfficeDocumentsTable() {
            const tbody = document.getElementById('officeDocumentsTable');
            tbody.innerHTML = '';
            
            MAFCSystem.documents.slice(0, 50).forEach(doc => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${doc.number}</td>
                    <td><span class="badge badge-info">${doc.type}</span></td>
                    <td>${doc.title}</td>
                    <td>${new Date(doc.date).toLocaleDateString('pt-PT')}</td>
                    <td>${doc.createdBy}</td>
                    <td>
                        <a href="https://wa.me/?text=${encodeURIComponent(`Documento: ${doc.title}\nRef: ${doc.number}`)}" target="_blank" class="btn-dashboard btn-sm btn-whatsapp">
                            <i class="fab fa-whatsapp"></i>
                        </a>
                    </td>
                    <td>
                        <button class="btn-dashboard btn-sm btn-info" onclick="viewDocument(${doc.id})">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn-dashboard btn-sm btn-primary" onclick="printDocumentById(${doc.id})">
                            <i class="fas fa-print"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // ============ GESTÃO DE PESSOAL (ESCRITÓRIO) ============
        function openEmployeeModal() {
            MAFCSystem.editingEmployeeId = null;
            document.getElementById('employeeModal').style.display = 'flex';
            
            // Limpar formulário
            document.getElementById('employeeName').value = '';
            document.getElementById('employeeWhatsApp').value = '+351 ';
            document.getElementById('employeePosition').value = 'administrativo';
            document.getElementById('employeeDepartment').value = 'escritorio';
            document.getElementById('employeeStartDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('employeeStatus').value = 'active';
            
            // Carregar lista
            loadEmployeeList();
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
        
        function loadEmployeeList() {
            const tbody = document.getElementById('employeesList');
            tbody.innerHTML = '';
            
            MAFCSystem.officePeople.forEach(person => {
                const statusBadge = person.status === 'active' ? 
                    '<span class="badge badge-success">Ativo</span>' :
                    '<span class="badge badge-danger">Inativo</span>';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${person.name}</td>
                    <td>${person.whatsapp}</td>
                    <td>${person.position}</td>
                    <td>${person.department}</td>
                    <td>${statusBadge}</td>
                    <td>
                        <button class="btn-dashboard btn-sm btn-warning" onclick="editEmployee(${person.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn-dashboard btn-sm btn-danger" onclick="deleteEmployee(${person.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        function saveEmployee() {
            const name = document.getElementById('employeeName').value;
            const whatsapp = document.getElementById('employeeWhatsApp').value;
            const position = document.getElementById('employeePosition').value;
            const department = document.getElementById('employeeDepartment').value;
            const startDate = document.getElementById('employeeStartDate').value;
            const status = document.getElementById('employeeStatus').value;
            
            if (!name || !whatsapp) {
                alert('Por favor, preencha pelo menos o nome e WhatsApp!');
                return;
            }
            
            if (MAFCSystem.editingEmployeeId) {
                // Editar
                const index = MAFCSystem.officePeople.findIndex(p => p.id === MAFCSystem.editingEmployeeId);
                if (index !== -1) {
                    MAFCSystem.officePeople[index] = {
                        ...MAFCSystem.officePeople[index],
                        name, whatsapp, position, department, startDate, status
                    };
                    MAFCSystem.logActivity('update', `Atualizou pessoa: ${name}`);
                }
            } else {
                // Adicionar novo
                const newId = MAFCSystem.officePeople.length > 0 ? 
                    Math.max(...MAFCSystem.officePeople.map(p => p.id)) + 1 : 1;
                
                MAFCSystem.officePeople.push({
                    id: newId,
                    name, whatsapp, position, department, startDate, status
                });
                MAFCSystem.logActivity('create', `Adicionou pessoa: ${name}`);
            }
            
            MAFCSystem.saveToStorage();
            alert('Pessoa guardada com sucesso!');
            
            // Atualizar interfaces
            loadEmployeeList();
            loadOfficePeopleSelect();
            loadOfficePeopleTable();
            loadOfficeTodayMarks();
            loadAllEmployeesTime();
            
            if (MAFCSystem.currentUser.role === 'boss') {
                loadBossData();
            }
            
            closeModal('employeeModal');
        }
        
        function editEmployee(id) {
            const person = MAFCSystem.officePeople.find(p => p.id === id);
            if (person) {
                MAFCSystem.editingEmployeeId = id;
                document.getElementById('employeeModal').style.display = 'flex';
                
                // Preencher formulário
                document.getElementById('employeeName').value = person.name;
                document.getElementById('employeeWhatsApp').value = person.whatsapp;
                document.getElementById('employeePosition').value = person.position;
                document.getElementById('employeeDepartment').value = person.department;
                document.getElementById('employeeStartDate').value = person.startDate;
                document.getElementById('employeeStatus').value = person.status;
                
                loadEmployeeList();
            }
        }
        
        function deleteEmployee(id) {
            if (confirm('Tem certeza que deseja remover esta pessoa?')) {
                const person = MAFCSystem.officePeople.find(p => p.id === id);
                if (person) {
                    MAFCSystem.officePeople = MAFCSystem.officePeople.filter(p => p.id !== id);
                    MAFCSystem.logActivity('delete', `Removeu pessoa: ${person.name}`);
                    MAFCSystem.saveToStorage();
                    
                    alert('Pessoa removida com sucesso!');
                    loadEmployeeList();
                    loadOfficePeopleSelect();
                    loadOfficePeopleTable();
                    loadAllEmployeesTime();
                }
            }
        }
        
        function filterEmployeeList() {
            const search = document.getElementById('searchEmployeeList').value.toLowerCase();
            const dept = document.getElementById('filterEmployeeDept').value;
            
            const tbody = document.getElementById('employeesList');
            const rows = tbody.getElementsByTagName('tr');
            
            for (let row of rows) {
                const cells = row.getElementsByTagName('td');
                const name = cells[0].textContent.toLowerCase();
                const department = cells[3].textContent.toLowerCase();
                
                const matchesSearch = name.includes(search);
                const matchesDept = dept === 'all' || department.includes(dept);
                
                row.style.display = matchesSearch && matchesDept ? '' : 'none';
            }
        }
        
        function searchOfficePeople() {
            const search = document.getElementById('officeSearchPerson').value.toLowerCase();
            const dept = document.getElementById('officeFilterDept').value;
            const status = document.getElementById('officeFilterStatus').value;
            
            const tbody = document.getElementById('officePeopleTable');
            const rows = tbody.getElementsByTagName('tr');
            
            for (let row of rows) {
                const cells = row.getElementsByTagName('td');
                const name = cells[0].textContent.toLowerCase();
                const department = cells[3].textContent.toLowerCase();
                const statusText = cells[4].textContent.toLowerCase();
                
                const matchesSearch = name.includes(search);
                const matchesDept = dept === 'all' || department.includes(dept);
                const matchesStatus = status === 'all' || statusText.includes(status);
                
                row.style.display = matchesSearch && matchesDept && matchesStatus ? '' : 'none';
            }
        }
        
        // ============ MARCAÇÃO DE HORAS INDIVIDUAL (ESCRITÓRIO) ============
        function loadPersonWhatsApp() {
            const select = document.getElementById('officePersonSelect');
            const whatsappInput = document.getElementById('officePersonWhatsApp');
            const personId = parseInt(select.value);
            
            if (personId) {
                const person = MAFCSystem.officePeople.find(p => p.id === personId);
                whatsappInput.value = person ? person.whatsapp : '';
            } else {
                whatsappInput.value = '';
            }
        }
        
        function registerOfficeTime() {
            const select = document.getElementById('officePersonSelect');
            const timeType = document.getElementById('officeTimeType').value;
            const personId = parseInt(select.value);
            
            if (!personId) {
                alert('Selecione uma pessoa primeiro!');
                return;
            }
            
            const person = MAFCSystem.officePeople.find(p => p.id === personId);
            if (!person) {
                alert('Pessoa não encontrada!');
                return;
            }
            
            const now = new Date();
            const timeString = now.toLocaleTimeString('pt-PT', { hour: '2-digit', minute: '2-digit' });
            const dateString = now.toLocaleDateString('pt-PT');
            
            // Inicializar registos do dia se necessário
            if (!MAFCSystem.timeRecords[dateString]) {
                MAFCSystem.timeRecords[dateString] = {};
            }
            if (!MAFCSystem.timeRecords[dateString][personId]) {
                MAFCSystem.timeRecords[dateString][personId] = {
                    personName: person.name,
                    personId: personId
                };
            }
            
            const record = MAFCSystem.timeRecords[dateString][personId];
            
            switch(timeType) {
                case 'entry':
                    record.entry = timeString;
                    MAFCSystem.logActivity('time_entry', `${person.name} - Entrada: ${timeString}`);
                    break;
                case 'exit':
                    record.exit = timeString;
                    // Calcular horas totais
                    if (record.entry) {
                        const entryTime = record.entry.split(':').map(Number);
                        const exitTime = timeString.split(':').map(Number);
                        let totalMinutes = (exitTime[0] * 60 + exitTime[1]) - (entryTime[0] * 60 + entryTime[1]);
                        if (totalMinutes < 0) totalMinutes += 24 * 60;
                        
                        // Subtrair pausa se existir
                        if (record.break === '60') {
                            totalMinutes -= 60;
                        }
                        
                        record.totalHours = (totalMinutes / 60).toFixed(1);
                    }
                    MAFCSystem.logActivity('time_exit', `${person.name} - Saída: ${timeString}`);
                    break;
                case 'break_start':
                    record.break = 'Iniciada';
                    MAFCSystem.logActivity('break_start', `${person.name} - Início pausa`);
                    break;
                case 'break_end':
                    record.break = '60'; // 60 minutos completos
                    MAFCSystem.logActivity('break_end', `${person.name} - Fim pausa`);
                    break;
            }
            
            MAFCSystem.saveToStorage();
            
            // Enviar notificação WhatsApp
            const messages = {
                'entry': `✅ ${person.name} - Entrada registada às ${timeString} - MAFC Escritório`,
                'exit': `✅ ${person.name} - Saída registada às ${timeString} - MAFC Escritório`,
                'break_start': `⏸️ ${person.name} - Pausa iniciada às ${timeString} - MAFC Escritório`,
                'break_end': `⏸️ ${person.name} - Pausa terminada às ${timeString} - MAFC Escritório`
            };
            
            const message = messages[timeType];
            if (message && person.whatsapp) {
                const url = `https://wa.me/${person.whatsapp.replace('+', '')}?text=${encodeURIComponent(message)}`;
                window.open(url, '_blank');
            }
            
            alert(`${person.name} - ${timeType === 'entry' ? 'Entrada' : timeType === 'exit' ? 'Saída' : 'Pausa'} registada às ${timeString}`);
            loadOfficeTodayMarks();
            loadOfficeDailyMarks();
            loadAllEmployeesTime();
        }
        
        function sendTimeNotification(whatsapp, type, time) {
            const messages = {
                'entry': `✅ Entrada registada às ${time} - MAFC Escritório`,
                'exit': `✅ Saída registada às ${time} - MAFC Escritório`,
                'break_start': `⏸️ Pausa iniciada às ${time} - MAFC Escritório`,
                'break_end': `⏸️ Pausa terminada às ${time} - MAFC Escritório`
            };
            
            const message = messages[type];
            if (message) {
                const url = `https://wa.me/${whatsapp.replace('+', '')}?text=${encodeURIComponent(message)}`;
                window.open(url, '_blank');
            }
        }
        
        function loadOfficeDailyMarks() {
            const tbody = document.getElementById('officeDailyMarks');
            tbody.innerHTML = '';
            
            const today = new Date().toLocaleDateString('pt-PT');
            const todayRecords = MAFCSystem.timeRecords[today] || {};
            
            Object.values(todayRecords).forEach(record => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${record.personName}</td>
                    <td>${record.entry || '--:--'}</td>
                    <td>${record.exit || '--:--'}</td>
                    <td>${record.break || '--'}</td>
                    <td>${record.totalHours ? record.totalHours + 'h' : '--'}</td>
                    <td>
                        <button class="btn-dashboard btn-sm btn-warning" onclick="editTimeRecord('${today}', ${record.personId})">
                            <i class="fas fa-edit"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // ============ EXTRATO MENSAL COM IMPRESSÃO PARA CONTABILIDADE ============
        function generateOfficeReport() {
            const monthSelect = document.getElementById('officeReportMonth');
            const personSelect = document.getElementById('officeReportPerson');
            
            const [month, year] = monthSelect.value.split('-');
            const personId = personSelect.value === 'all' ? null : parseInt(personSelect.value);
            
            // Encontrar pessoa
            let personName = 'Todas as Pessoas';
            if (personId) {
                const person = MAFCSystem.officePeople.find(p => p.id === personId);
                if (person) personName = person.name;
            }
            
            // Atualizar título
            const monthNames = ['Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho', 
                               'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
            const monthName = monthNames[parseInt(month) - 1];
            
            document.getElementById('officeReportTitle').textContent = 
                `Extrato de Horas - ${personName} | ${monthName} ${year}`;
            
            // Gerar extrato
            const tbody = document.getElementById('officeReportBody');
            tbody.innerHTML = '';
            
            let totalHours = 0;
            let totalNormalHours = 0;
            let totalExtraHours = 0;
            
            // Filtrar registos do mês
            const monthRecords = {};
            Object.keys(MAFCSystem.timeRecords).forEach(dateStr => {
                const date = new Date(dateStr.split('/').reverse().join('-'));
                if (date.getMonth() + 1 == month && date.getFullYear() == year) {
                    Object.keys(MAFCSystem.timeRecords[dateStr]).forEach(pid => {
                        const record = MAFCSystem.timeRecords[dateStr][pid];
                        if (!personId || record.personId == personId) {
                            if (!monthRecords[dateStr]) monthRecords[dateStr] = [];
                            monthRecords[dateStr].push(record);
                        }
                    });
                }
            });
            
            // Ordenar por data e adicionar à tabela
            Object.keys(monthRecords).sort().forEach(dateStr => {
                monthRecords[dateStr].forEach(record => {
                    const hours = parseFloat(record.totalHours) || 0;
                    const normalHours = Math.min(hours, 8);
                    const extraHours = hours > 8 ? hours - 8 : 0;
                    
                    totalHours += hours;
                    totalNormalHours += normalHours;
                    totalExtraHours += extraHours;
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${dateStr}</td>
                        <td>${record.personName}</td>
                        <td>${record.entry || '--:--'}</td>
                        <td>${record.exit || '--:--'}</td>
                        <td>${normalHours.toFixed(2)}h</td>
                        <td>${extraHours > 0 ? extraHours.toFixed(2) + 'h' : '0h'}</td>
                        <td>${hours.toFixed(2)}h</td>
                    `;
                    tbody.appendChild(row);
                });
            });
            
            // Adicionar linha de totais
            const totalRow = document.createElement('tr');
            totalRow.style.fontWeight = 'bold';
            totalRow.style.background = '#f8f9fa';
            totalRow.innerHTML = `
                <td colspan="4"><strong>TOTAIS</strong></td>
                <td><strong>${totalNormalHours.toFixed(2)}h</strong></td>
                <td><strong>${totalExtraHours.toFixed(2)}h</strong></td>
                <td><strong>${totalHours.toFixed(2)}h</strong></td>
            `;
            tbody.appendChild(totalRow);
            
            // Atualizar totais
            document.getElementById('officeTotalHours').textContent = 
                `${totalHours.toFixed(2)}h (${totalNormalHours.toFixed(2)} normais + ${totalExtraHours.toFixed(2)} extra)`;
        }
        
        function printOfficeReportForAccounting() {
            const reportTitle = document.getElementById('officeReportTitle').textContent;
            const totalHours = document.getElementById('officeTotalHours').textContent;
            const tableContent = document.getElementById('officeReportBody').innerHTML;
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                    <head>
                        <title>${reportTitle} - Contabilidade</title>
                        <style>
                            @media print {
                                body { font-family: Arial, sans-serif; margin: 0; padding: 20px; }
                                h1 { color: #333; text-align: center; margin-bottom: 30px; }
                                .header-info { display: flex; justify-content: space-between; margin-bottom: 30px; }
                                .company-info { font-size: 14px; }
                                .report-info { text-align: right; font-size: 14px; }
                                table { width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 12px; }
                                th, td { border: 1px solid #000; padding: 8px; text-align: left; }
                                th { background-color: #f2f2f2; font-weight: bold; }
                                .total-row { background-color: #e8e8e8; font-weight: bold; }
                                .footer { margin-top: 50px; text-align: center; font-size: 12px; }
                                .signatures { display: flex; justify-content: space-between; margin-top: 80px; }
                                .signature-line { width: 200px; border-top: 1px solid #000; text-align: center; padding-top: 5px; }
                                .stamp { margin-top: 40px; text-align: center; }
                                @page { margin: 20mm; }
                            }
                            @media screen {
                                body { font-family: Arial, sans-serif; margin: 20px; padding: 20px; background: #f5f5f5; }
                                .print-area { background: white; padding: 30px; border-radius: 10px; box-shadow: 0 0 20px rgba(0,0,0,0.1); }
                                h1 { color: #333; text-align: center; }
                                table { width: 100%; border-collapse: collapse; margin: 20px 0; }
                                th, td { border: 1px solid #ddd; padding: 10px; }
                                th { background: #f2f2f2; }
                                .print-button { text-align: center; margin: 30px; }
                                button { padding: 10px 30px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
                            }
                        </style>
                    </head>
                    <body>
                        <div class="print-area">
                            <div class="header-info">
                                <div class="company-info">
                                    <h2>MAFC & FILHO, LDA.</h2>
                                    <p>Construção Civil & Obras Públicas</p>
                                    <p>NIF: 500000000</p>
                                    <p>Tel: +351 123 456 789</p>
                                </div>
                                <div class="report-info">
                                    <h3>${reportTitle}</h3>
                                    <p>Emitido em: ${new Date().toLocaleString('pt-PT')}</p>
                                    <p>Emitido por: ${MAFCSystem.currentUser.name}</p>
                                    <p>Departamento: Escritório</p>
                                </div>
                            </div>
                            
                            <table>
                                <thead>
                                    <tr>
                                        <th>Data</th>
                                        <th>Nome</th>
                                        <th>Entrada</th>
                                        <th>Saída</th>
                                        <th>Horas Normais</th>
                                        <th>Horas Extra</th>
                                        <th>Total</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${tableContent}
                                </tbody>
                            </table>
                            
                            <div class="footer">
                                <p><strong>Total de horas: ${totalHours}</strong></p>
                                <p>Documento válido para efeitos de contabilidade e processamento de salários</p>
                                
                                <div class="signatures">
                                    <div class="signature-line">
                                        Responsável Escritório<br>
                                        ${MAFCSystem.currentUser.name}
                                    </div>
                                    <div class="signature-line">
                                        Recebido por Contabilidade<br>
                                        ________________________________
                                    </div>
                                </div>
                                
                                <div class="stamp">
                                    <p>Carimbo e assinatura</p>
                                    <p>________________________________</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="print-button">
                            <button onclick="window.print()">IMPRIMIR PARA CONTABILIDADE</button>
                            <button onclick="window.close()" style="background: #6c757d; margin-left: 10px;">FECHAR</button>
                        </div>
                        
                        <script>
                            window.onload = function() {
                                // Auto-print option
                                const shouldPrint = confirm('Deseja imprimir automaticamente para a contabilidade?');
                                if (shouldPrint) {
                                    window.print();
                                }
                            }
                        <\/script>
                    </body>
                </html>
            `);
            printWindow.document.close();
            
            MAFCSystem.logActivity('print_accounting_report', `Imprimiu extrato para contabilidade: ${reportTitle}`);
        }
        
        function exportToExcel() {
            const reportTitle = document.getElementById('officeReportTitle').textContent;
            alert(`Exportando ${reportTitle} para Excel...\n\nEm produção, isto geraria um ficheiro Excel para a contabilidade.`);
            MAFCSystem.logActivity('export_excel', `Exportou extrato para Excel: ${reportTitle}`);
        }
        
        function generatePDF() {
            const reportTitle = document.getElementById('officeReportTitle').textContent;
            alert(`Gerando PDF de ${reportTitle}...\n\nEm produção, isto geraria um PDF para a contabilidade.`);
            MAFCSystem.logActivity('generate_pdf', `Gerou PDF do extrato: ${reportTitle}`);
        }
        
        function sendToAccountingWhatsApp() {
            const reportTitle = document.getElementById('officeReportTitle').textContent;
            const totalHours = document.getElementById('officeTotalHours').textContent;
            
            const message = `📊 EXTRATO DE HORAS PARA CONTABILIDADE\n\n${reportTitle}\n\nTotal: ${totalHours}\n\nEmitido por: ${MAFCSystem.currentUser.name}\nData: ${new Date().toLocaleString('pt-PT')}\n\nMAFC & FILHO, LDA.`;
            window.open(`https://wa.me/?text=${encodeURIComponent(message)}`, '_blank');
            
            MAFCSystem.logActivity('whatsapp_accounting', `Enviou extrato por WhatsApp para contabilidade: ${reportTitle}`);
        }
        
        // ============ CHEFE DE EQUIPA ============
        function showTeamDashboard() {
            document.getElementById('teamDashboard').style.display = 'block';
            document.getElementById('teamUserName').textContent = MAFCSystem.currentUser.team || MAFCSystem.currentUser.name;
            loadTeamData();
        }
        
        function loadTeamData() {
            // Implementar carregamento de dados da equipa
            document.getElementById('teamMembersCount').textContent = '5';
            document.getElementById('teamHoursToday').textContent = '8.5';
            
            // Pedidos pendentes
            const pendingRequests = MAFCSystem.materialRequests.filter(r => 
                r.team === (MAFCSystem.currentUser.team || 'Equipa') && 
                r.status === 'pending'
            ).length;
            document.getElementById('teamPendingRequests').textContent = pendingRequests;
            document.getElementById('pendingRequestsBottom').textContent = pendingRequests;
            
            // Carregar lista de equipas
            loadTeamListTable();
            
            // Carregar materiais
            loadMaterials();
            
            // Atualizar hora atual
            updateTeamTimeDisplay();
        }
        
        function loadTeamListTable() {
            const tbody = document.getElementById('teamListTable');
            tbody.innerHTML = '';
            
            // Atualizar contador de equipas
            document.getElementById('totalTeamsCount').textContent = `${MAFCSystem.teams.length} equipas`;
            
            MAFCSystem.teams.forEach(team => {
                const statusBadge = team.status === 'active' ? 
                    '<span class="badge badge-success">Ativa</span>' :
                    '<span class="badge badge-danger">Inativa</span>';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${team.name}</td>
                    <td>${team.location}</td>
                    <td>${team.leader}</td>
                    <td>${team.members} membros</td>
                    <td>${team.currentWork}</td>
                    <td>${statusBadge}</td>
                `;
                tbody.appendChild(row);
            });
        }
        
        function updateTeamTimeDisplay() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('pt-PT', { hour: '2-digit', minute: '2-digit' });
            document.getElementById('teamCurrentTimeDisplay').textContent = timeString;
        }
        
        function markTeamEntry() {
            if (confirm(`Registar entrada para a ${MAFCSystem.currentUser.team}?`)) {
                const timeString = new Date().toLocaleTimeString('pt-PT', { hour: '2-digit', minute: '2-digit' });
                MAFCSystem.logActivity('team_entry', `${MAFCSystem.currentUser.team} - Entrada às ${timeString}`);
                alert(`✅ Entrada registada para ${MAFCSystem.currentUser.team} às ${timeString}`);
            }
        }
        
        function markTeamExit() {
            if (confirm(`Registar saída para a ${MAFCSystem.currentUser.team}?`)) {
                const timeString = new Date().toLocaleTimeString('pt-PT', { hour: '2-digit', minute: '2-digit' });
                MAFCSystem.logActivity('team_exit', `${MAFCSystem.currentUser.team} - Saída às ${timeString}`);
                alert(`✅ Saída registada para ${MAFCSystem.currentUser.team} às ${timeString}`);
            }
        }
        
        function markTeamBreak() {
            if (confirm(`Registar pausa para a ${MAFCSystem.currentUser.team}?`)) {
                MAFCSystem.logActivity('team_break', `${MAFCSystem.currentUser.team} - Pausa registada`);
                alert(`⏸️ Pausa registada para ${MAFCSystem.currentUser.team}`);
            }
        }
        
        function loadMaterials() {
            const category = document.getElementById('materialCategory').value;
            const select = document.getElementById('materialSelect');
            
            // Materiais por categoria
            const materials = {
                construction: [
                    { id: 1, name: 'Cimento', unit: 'sacos' },
                    { id: 2, name: 'Areia', unit: 'm³' },
                    { id: 3, name: 'Brita', unit: 'm³' },
                    { id: 4, name: 'Tijolos', unit: 'unidades' },
                    { id: 5, name: 'Argamassa', unit: 'sacos' },
                    { id: 6, name: 'Tinta', unit: 'litros' }
                ],
                machines: [
                    { id: 7, name: 'Retroescavadora', unit: 'horas' },
                    { id: 8, name: 'Compactador', unit: 'horas' },
                    { id: 9, name: 'Betoneira', unit: 'horas' },
                    { id: 10, name: 'Grua', unit: 'horas' }
                ],
                tools: [
                    { id: 11, name: 'Martelo Pneumático', unit: 'unidades' },
                    { id: 12, name: 'Furadeira', unit: 'unidades' },
                    { id: 13, name: 'Serra Circular', unit: 'unidades' },
                    { id: 14, name: 'Nível Laser', unit: 'unidades' }
                ],
                consumables: [
                    { id: 15, name: 'Gasóleo', unit: 'litros' },
                    { id: 16, name: 'Óleo Hidráulico', unit: 'litros' },
                    { id: 17, name: 'Parafusos', unit: 'caixas' },
                    { id: 18, name: 'Pregos', unit: 'kg' }
                ],
                safety: [
                    { id: 19, name: 'Capacetes', unit: 'unidades' },
                    { id: 20, name: 'Luvas', unit: 'pares' },
                    { id: 21, name: 'Botas', unit: 'pares' },
                    { id: 22, name: 'Colete Refletor', unit: 'unidades' }
                ]
            };
            
            select.innerHTML = '<option value="">Selecione um material</option>';
            (materials[category] || []).forEach(mat => {
                const option = document.createElement('option');
                option.value = mat.id;
                option.textContent = `${mat.name} (${mat.unit})`;
                select.appendChild(option);
            });
        }
        
        function submitMaterialRequest() {
            const category = document.getElementById('materialCategory').value;
            const materialSelect = document.getElementById('materialSelect');
            const materialId = materialSelect.value;
            const materialText = materialSelect.options[materialSelect.selectedIndex].text;
            const quantity = document.getElementById('materialQuantity').value;
            const unit = document.getElementById('materialUnit').value;
            const urgency = document.getElementById('materialUrgency').value;
            const notes = document.getElementById('materialNotes').value;
            
            if (!materialId || !quantity) {
                alert('Por favor, selecione um material e quantidade!');
                return;
            }
            
            const requestId = Date.now();
            const request = {
                id: requestId,
                team: MAFCSystem.currentUser.team || 'Equipa',
                material: materialText.split(' (')[0],
                quantity: quantity,
                unit: unit,
                urgency: urgency,
                notes: notes,
                requestDate: new Date().toISOString(),
                status: 'pending',
                requestedBy: MAFCSystem.currentUser.name,
                category: category
            };
            
            MAFCSystem.materialRequests.unshift(request);
            MAFCSystem.saveToStorage();
            MAFCSystem.logActivity('material_request', `Pediu material: ${request.material} (${quantity} ${unit})`);
            
            // Notificar admin via log
            MAFCSystem.logAudit('new_material_request', 
                `Nova requisição de material: ${request.material} - ${request.team}`, 
                'compras'
            );
            
            alert(`✅ Pedido enviado para Compras!\n\nNº Pedido: #PED-${requestId}\nMaterial: ${request.material}\nQuantidade: ${quantity} ${unit}\nUrgência: ${urgency}`);
            
            // Limpar formulário
            document.getElementById('materialQuantity').value = 1;
            document.getElementById('materialNotes').value = '';
            
            // Atualizar contador
            const pendingElement = document.getElementById('teamPendingRequests');
            if (pendingElement) {
                pendingElement.textContent = parseInt(pendingElement.textContent) + 1;
            }
            
            // Atualizar badge do menu
            document.getElementById('pendingRequestsBottom').textContent = 
                parseInt(document.getElementById('pendingRequestsBottom').textContent) + 1;
            
            // Atualizar tabela se estiver visível
            if (document.getElementById('teamMaterialRequestsTable')) {
                loadTeamMaterialRequests();
            }
        }
        
        function submitMaterialRequestWhatsApp() {
            // Primeiro enviar pelo sistema
            submitMaterialRequest();
            
            // Depois abrir WhatsApp
            const materialSelect = document.getElementById('materialSelect');
            const materialText = materialSelect.options[materialSelect.selectedIndex].text;
            const quantity = document.getElementById('materialQuantity').value;
            const unit = document.getElementById('materialUnit').value;
            const urgency = document.getElementById('materialUrgency').value;
            
            const message = `🛒 NOVO PEDIDO DE MATERIAL - ${MAFCSystem.currentUser.team}\n\nMaterial: ${materialText}\nQuantidade: ${quantity} ${unit}\nUrgência: ${urgency}\n\nPedido enviado via sistema MAFC por ${MAFCSystem.currentUser.name}.`;
            
            window.open(`https://wa.me/351123456789?text=${encodeURIComponent(message)}`, '_blank');
        }
        
        function loadTeamMaterialRequests() {
            const tbody = document.getElementById('teamMaterialRequestsTable');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            const teamRequests = MAFCSystem.materialRequests.filter(r => 
                r.team === (MAFCSystem.currentUser.team || 'Equipa')
            );
            
            teamRequests.forEach(request => {
                const statusMap = {
                    'pending': { class: 'badge-warning', text: 'Pendente' },
                    'approved': { class: 'badge-info', text: 'Aprovado' },
                    'completed': { class: 'badge-success', text: 'Concluído' },
                    'cancelled': { class: 'badge-danger', text: 'Cancelado' }
                };
                
                const status = statusMap[request.status] || statusMap.pending;
                const urgencyMap = {
                    'critical': 'badge-danger',
                    'urgent': 'badge-warning',
                    'normal': 'badge-info'
                };
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>#PED-${request.id}</td>
                    <td>${request.material}</td>
                    <td>${request.quantity} ${request.unit}</td>
                    <td>${new Date(request.requestDate).toLocaleDateString('pt-PT')}</td>
                    <td><span class="badge ${urgencyMap[request.urgency]}">${request.urgency}</span></td>
                    <td><span class="badge ${status.class}">${status.text}</span></td>
                    <td>${request.responsible || '--'}</td>
                    <td>
                        <button class="btn-dashboard btn-sm btn-info" onclick="viewRequestDetails(${request.id})">
                            <i class="fas fa-eye"></i>
                        </button>
                        ${request.status === 'pending' ? `
                            <button class="btn-dashboard btn-sm btn-warning" onclick="editMaterialRequest(${request.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                        ` : ''}
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // ============ DASHBOARD COMPRAS ============
        function showPurchaseDashboard() {
            document.getElementById('purchaseDashboard').style.display = 'block';
            document.getElementById('purchaseUserName').textContent = MAFCSystem.currentUser.name;
            loadPurchaseData();
        }
        
        function loadPurchaseData() {
            // Contadores
            const pending = MAFCSystem.materialRequests.filter(r => r.status === 'pending').length;
            const approved = MAFCSystem.purchases.filter(p => p.status === 'approved').length;
            const completed = MAFCSystem.purchases.filter(p => p.status === 'completed').length;
            
            document.getElementById('purchasePendingCount').textContent = pending;
            document.getElementById('purchaseApprovedCount').textContent = approved;
            document.getElementById('purchaseCompletedCount').textContent = completed;
            document.getElementById('pendingPurchasesCountBottom').textContent = pending;
            
            // Valor do mês
            const currentMonth = new Date().getMonth() + 1;
            const monthPurchases = MAFCSystem.purchases.filter(p => {
                const date = new Date(p.purchaseDate || p.approvalDate);
                return date.getMonth() + 1 === currentMonth && p.totalValue;
            });
            const monthValue = monthPurchases.reduce((sum, p) => sum + p.totalValue, 0);
            document.getElementById('purchaseMonthValue').textContent = `€${(monthValue/1000).toFixed(1)}K`;
            
            // Carregar tabelas
            loadPurchaseUrgentTable();
            loadPurchasePendingTable();
            loadPurchaseApprovedTable();
            loadPurchaseCompletedTable();
            loadSuppliersTable();
        }
        
        function loadPurchaseUrgentTable() {
            const tbody = document.getElementById('purchaseUrgentTable');
            tbody.innerHTML = '';
            
            const urgentRequests = MAFCSystem.materialRequests.filter(r => 
                r.status === 'pending' && r.urgency === 'critical'
            ).slice(0, 10);
            
            urgentRequests.forEach(request => {
                const timeDiff = Date.now() - new Date(request.requestDate).getTime();
                const hoursDiff = Math.floor(timeDiff / (1000 * 60 * 60));
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>#PED-${request.id}</td>
                    <td>${request.team}</td>
                    <td>${request.material}</td>
                    <td>${request.quantity} ${request.unit}</td>
                    <td><span class="badge badge-danger">CRÍTICO</span></td>
                    <td>${hoursDiff > 24 ? `${Math.floor(hoursDiff/24)}d` : `${hoursDiff}h`}</td>
                    <td>
                        <button class="btn-dashboard btn-sm btn-success" onclick="approvePurchaseRequest(${request.id})">
                            <i class="fas fa-check"></i>
                        </button>
                        <button class="btn-dashboard btn-sm btn-whatsapp" onclick="contactSupplierForRequest(${request.id})">
                            <i class="fab fa-whatsapp"></i>
                        </button>
                        <button class="btn-dashboard btn-sm btn-info" onclick="viewRequestDetails(${request.id})">
                            <i class="fas fa-eye"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        function loadPurchasePendingTable() {
            const tbody = document.getElementById('purchasePendingTable');
            tbody.innerHTML = '';
            
            MAFCSystem.materialRequests.filter(r => r.status === 'pending').forEach(request => {
                const urgencyMap = {
                    'critical': 'badge-danger',
                    'urgent': 'badge-warning',
                    'normal': 'badge-info'
                };
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>#PED-${request.id}</td>
                    <td>${new Date(request.requestDate).toLocaleDateString('pt-PT')}</td>
                    <td>${request.team}</td>
                    <td>${request.material}</td>
                    <td>${request.quantity} ${request.unit}</td>
                    <td><span class="badge ${urgencyMap[request.urgency]}">${request.urgency}</span></td>
                    <td>${request.requestedBy}</td>
                    <td>
                        <button class="btn-dashboard btn-sm btn-success" onclick="approvePurchaseRequest(${request.id})">
                            <i class="fas fa-check"></i> Aprovar
                        </button>
                        <button class="btn-dashboard btn-sm btn-danger" onclick="rejectPurchaseRequest(${request.id})">
                            <i class="fas fa-times"></i> Recusar
                        </button>
                        <button class="btn-dashboard btn-sm btn-info" onclick="viewRequestDetails(${request.id})">
                            <i class="fas fa-eye"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        function approvePurchaseRequest(requestId) {
            const request = MAFCSystem.materialRequests.find(r => r.id === requestId);
            if (!request) return;
            
            const supplier = prompt('Nome do fornecedor:');
            const estimatedCost = prompt('Custo estimado (€):');
            const deliveryDays = prompt('Prazo de entrega (dias):');
            
            if (supplier && estimatedCost && deliveryDays) {
                // Atualizar pedido
                request.status = 'approved';
                request.approvalDate = new Date().toISOString();
                request.approvedBy = MAFCSystem.currentUser.name;
                request.supplier = supplier;
                request.estimatedCost = parseFloat(estimatedCost);
                request.deliveryDays = parseInt(deliveryDays);
                
                // Criar ordem de compra
                const orderNumber = `ORD-${Date.now().toString().slice(-6)}`;
                const purchase = {
                    id: Date.now(),
                    orderNumber: orderNumber,
                    requestId: requestId,
                    material: request.material,
                    quantity: request.quantity,
                    unit: request.unit,
                    supplier: supplier,
                    estimatedCost: parseFloat(estimatedCost),
                    totalValue: parseFloat(estimatedCost) * parseInt(request.quantity),
                    purchaseDate: new Date().toISOString(),
                    deliveryDate: new Date(Date.now() + deliveryDays * 24 * 60 * 60 * 1000).toISOString(),
                    status: 'approved',
                    team: request.team,
                    requestedBy: request.requestedBy,
                    approvedBy: MAFCSystem.currentUser.name
                };
                
                MAFCSystem.purchases.unshift(purchase);
                MAFCSystem.saveToStorage();
                
                MAFCSystem.logActivity('purchase_approve', `Aprovou pedido #${requestId} - ${orderNumber}`);
                MAFCSystem.logAudit('purchase_approved', 
                    `Ordem de compra criada: ${orderNumber} - ${request.material}`, 
                    'compras'
                );
                
                alert(`✅ Pedido aprovado!\n\nNº Ordem: ${orderNumber}\nFornecedor: ${supplier}\nValor estimado: €${estimatedCost}\nPrazo: ${deliveryDays} dias`);
                
                // Atualizar interfaces
                loadPurchaseData();
                if (MAFCSystem.currentUser.role === 'boss') {
                    loadBossData();
                }
            }
        }
        
        function markPurchaseCompleted(purchaseId) {
            const purchase = MAFCSystem.purchases.find(p => p.id === purchaseId);
            if (!purchase) return;
            
            const invoiceNumber = prompt('Número da fatura:');
            const finalCost = prompt('Custo final (€):');
            const deliveryDate = prompt('Data de entrega (YYYY-MM-DD):', new Date().toISOString().split('T')[0]);
            
            if (invoiceNumber && finalCost && deliveryDate) {
                purchase.status = 'completed';
                purchase.invoiceNumber = invoiceNumber;
                purchase.finalCost = parseFloat(finalCost);
                purchase.actualDeliveryDate = deliveryDate;
                purchase.completedBy = MAFCSystem.currentUser.name;
                purchase.completionDate = new Date().toISOString();
                
                // Atualizar pedido correspondente
                const request = MAFCSystem.materialRequests.find(r => r.id === purchase.requestId);
                if (request) {
                    request.status = 'completed';
                    request.completionDate = new Date().toISOString();
                }
                
                MAFCSystem.saveToStorage();
                MAFCSystem.logActivity('purchase_complete', `Concluiu compra ${purchase.orderNumber}`);
                
                alert(`✅ Compra marcada como concluída!\n\nFatura: ${invoiceNumber}\nCusto final: €${finalCost}\nEntrega: ${deliveryDate}`);
                
                loadPurchaseData();
                if (MAFCSystem.currentUser.role === 'boss') {
                    loadBossData();
                }
            }
        }
        
        function loadPurchaseApprovedTable() {
            const tbody = document.getElementById('purchaseApprovedTable');
            tbody.innerHTML = '';
            
            MAFCSystem.purchases.filter(p => p.status === 'approved').forEach(purchase => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${purchase.orderNumber}</td>
                    <td>${purchase.material}</td>
                    <td>${purchase.quantity} ${purchase.unit}</td>
                    <td>${purchase.supplier}</td>
                    <td>€${purchase.totalValue || purchase.estimatedCost}</td>
                    <td>${new Date(purchase.purchaseDate).toLocaleDateString('pt-PT')}</td>
                    <td>${new Date(purchase.deliveryDate).toLocaleDateString('pt-PT')}</td>
                    <td><span class="badge badge-info">Aprovado</span></td>
                    <td>
                        <button class="btn-dashboard btn-sm btn-success" onclick="markPurchaseCompleted(${purchase.id})">
                            <i class="fas fa-check-double"></i> Concluir
                        </button>
                        <button class="btn-dashboard btn-sm btn-whatsapp" onclick="contactSupplier('${purchase.supplier}')">
                            <i class="fab fa-whatsapp"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        function loadPurchaseCompletedTable() {
            const tbody = document.getElementById('purchaseCompletedTable');
            tbody.innerHTML = '';
            
            MAFCSystem.purchases.filter(p => p.status === 'completed').forEach(purchase => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${purchase.orderNumber}</td>
                    <td>${purchase.material}</td>
                    <td>${purchase.quantity} ${purchase.unit}</td>
                    <td>${purchase.supplier}</td>
                    <td>€${purchase.finalCost || purchase.totalValue}</td>
                    <td>${new Date(purchase.purchaseDate).toLocaleDateString('pt-PT')}</td>
                    <td>${new Date(purchase.actualDeliveryDate).toLocaleDateString('pt-PT')}</td>
                    <td>${purchase.team}</td>
                    <td>${purchase.invoiceNumber || '--'}</td>
                    <td>
                        <button class="btn-dashboard btn-sm btn-info" onclick="viewPurchaseDetails(${purchase.id})">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn-dashboard btn-sm btn-primary" onclick="printPurchaseOrder(${purchase.id})">
                            <i class="fas fa-print"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        function approveAllPending() {
            if (confirm('Tem certeza que deseja aprovar TODOS os pedidos pendentes?')) {
                const pendingRequests = MAFCSystem.materialRequests.filter(r => r.status === 'pending');
                pendingRequests.forEach(request => {
                    request.status = 'approved';
                    request.approvalDate = new Date().toISOString();
                    request.approvedBy = MAFCSystem.currentUser.name;
                    
                    // Criar ordem de compra simplificada
                    const purchase = {
                        id: Date.now() + Math.random(),
                        orderNumber: `ORD-AUTO-${Date.now().toString().slice(-6)}`,
                        requestId: request.id,
                        material: request.material,
                        quantity: request.quantity,
                        unit: request.unit,
                        supplier: 'Fornecedor Padrão',
                        estimatedCost: 100,
                        totalValue: 100 * parseInt(request.quantity),
                        purchaseDate: new Date().toISOString(),
                        deliveryDate: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString(),
                        status: 'approved',
                        team: request.team,
                        requestedBy: request.requestedBy,
                        approvedBy: MAFCSystem.currentUser.name
                    };
                    
                    MAFCSystem.purchases.unshift(purchase);
                });
                
                MAFCSystem.saveToStorage();
                MAFCSystem.logAudit('bulk_approve', `Aprovou ${pendingRequests.length} pedidos em massa`, 'compras');
                
                alert(`✅ ${pendingRequests.length} pedidos aprovados automaticamente!`);
                loadPurchaseData();
            }
        }
        
        // ============ GESTÃO DE FORNECEDORES ============
        function openSupplierModal() {
            MAFCSystem.editingSupplierId = null;
            document.getElementById('supplierModal').style.display = 'flex';
            
            // Limpar formulário
            document.getElementById('supplierName').value = '';
            document.getElementById('supplierNIF').value = '';
            document.getElementById('supplierContact').value = '';
            document.getElementById('supplierEmail').value = '';
            document.getElementById('supplierType').value = '';
            document.getElementById('supplierNotes').value = '';
            
            // Carregar lista
            loadSuppliersList();
        }
        
        function loadSuppliersList() {
            const tbody = document.getElementById('suppliersList');
            tbody.innerHTML = '';
            
            MAFCSystem.suppliers.forEach(supplier => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${supplier.name}</td>
                    <td>${supplier.nif}</td>
                    <td>${supplier.contact}</td>
                    <td>${Array.isArray(supplier.type) ? supplier.type.join(', ') : supplier.type}</td>
                    <td>${supplier.email}</td>
                    <td>
                        <button class="btn-dashboard btn-sm btn-warning" onclick="editSupplier(${supplier.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn-dashboard btn-sm btn-danger" onclick="deleteSupplier(${supplier.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        function saveSupplier() {
            const name = document.getElementById('supplierName').value;
            const nif = document.getElementById('supplierNIF').value;
            const contact = document.getElementById('supplierContact').value;
            const email = document.getElementById('supplierEmail').value;
            const typeSelect = document.getElementById('supplierType');
            const type = Array.from(typeSelect.selectedOptions).map(option => option.value);
            const notes = document.getElementById('supplierNotes').value;
            
            if (!name || !nif || !contact) {
                alert('Por favor, preencha pelo menos o nome, NIF e contacto!');
                return;
            }
            
            if (MAFCSystem.editingSupplierId) {
                // Editar
                const index = MAFCSystem.suppliers.findIndex(s => s.id === MAFCSystem.editingSupplierId);
                if (index !== -1) {
                    MAFCSystem.suppliers[index] = {
                        ...MAFCSystem.suppliers[index],
                        name, nif, contact, email, type, notes
                    };
                    MAFCSystem.logActivity('update', `Atualizou fornecedor: ${name}`);
                }
            } else {
                // Adicionar novo
                const newId = MAFCSystem.suppliers.length > 0 ? 
                    Math.max(...MAFCSystem.suppliers.map(s => s.id)) + 1 : 1;
                
                MAFCSystem.suppliers.push({
                    id: newId,
                    name, nif, contact, email, type, notes
                });
                MAFCSystem.logActivity('create', `Adicionou fornecedor: ${name}`);
            }
            
            MAFCSystem.saveToStorage();
            alert('Fornecedor guardado com sucesso!');
            
            // Atualizar interfaces
            loadSuppliersList();
            loadSuppliersTable();
            
            closeModal('supplierModal');
        }
        
        function editSupplier(id) {
            const supplier = MAFCSystem.suppliers.find(s => s.id === id);
            if (supplier) {
                MAFCSystem.editingSupplierId = id;
                document.getElementById('supplierModal').style.display = 'flex';
                
                // Preencher formulário
                document.getElementById('supplierName').value = supplier.name;
                document.getElementById('supplierNIF').value = supplier.nif;
                document.getElementById('supplierContact').value = supplier.contact;
                document.getElementById('supplierEmail').value = supplier.email;
                document.getElementById('supplierNotes').value = supplier.notes;
                
                // Definir tipos selecionados
                const typeSelect = document.getElementById('supplierType');
                Array.from(typeSelect.options).forEach(option => {
                    option.selected = Array.isArray(supplier.type) ? 
                        supplier.type.includes(option.value) : false;
                });
                
                loadSuppliersList();
            }
        }
        
        function deleteSupplier(id) {
            if (confirm('Tem certeza que deseja remover este fornecedor?')) {
                const supplier = MAFCSystem.suppliers.find(s => s.id === id);
                if (supplier) {
                    MAFCSystem.suppliers = MAFCSystem.suppliers.filter(s => s.id !== id);
                    MAFCSystem.logActivity('delete', `Removeu fornecedor: ${supplier.name}`);
                    MAFCSystem.saveToStorage();
                    
                    alert('Fornecedor removido com sucesso!');
                    loadSuppliersList();
                    loadSuppliersTable();
                }
            }
        }
        
        function loadSuppliersTable() {
            const tbody = document.getElementById('suppliersTable');
            tbody.innerHTML = '';
            
            MAFCSystem.suppliers.forEach(supplier => {
                const rating = '★★★★☆'; // Avaliação simulada
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${supplier.name}</td>
                    <td>${supplier.nif}</td>
                    <td>${supplier.contact}</td>
                    <td>${Array.isArray(supplier.type) ? supplier.type.join(', ') : supplier.type}</td>
                    <td>${supplier.email}</td>
                    <td><span style="color: gold;">${rating}</span></td>
                    <td>
                        <button class="btn-dashboard btn-sm btn-info" onclick="viewSupplierDetails(${supplier.id})">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn-dashboard btn-sm btn-whatsapp" onclick="contactSupplier('${supplier.name}')">
                            <i class="fab fa-whatsapp"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        function filterSuppliers() {
            const search = document.getElementById('searchSupplier').value.toLowerCase();
            const type = document.getElementById('filterSupplierType').value;
            
            const tbody = document.getElementById('suppliersTable');
            const rows = tbody.getElementsByTagName('tr');
            
            for (let row of rows) {
                const cells = row.getElementsByTagName('td');
                const name = cells[0].textContent.toLowerCase();
                const supplierType = cells[3].textContent.toLowerCase();
                
                const matchesSearch = name.includes(search);
                const matchesType = type === 'all' || supplierType.includes(type);
                
                row.style.display = matchesSearch && matchesType ? '' : 'none';
            }
        }
        
        function filterSupplierList() {
            const search = document.getElementById('searchSupplierList').value.toLowerCase();
            const type = document.getElementById('filterSupplierType').value;
            
            const tbody = document.getElementById('suppliersList');
            const rows = tbody.getElementsByTagName('tr');
            
            for (let row of rows) {
                const cells = row.getElementsByTagName('td');
                const name = cells[0].textContent.toLowerCase();
                const supplierType = cells[3].textContent.toLowerCase();
                
                const matchesSearch = name.includes(search);
                const matchesType = type === 'all' || supplierType.includes(type);
                
                row.style.display = matchesSearch && matchesType ? '' : 'none';
            }
        }
        
        // ============ FUNÇÕES GERAIS ============
        function updateClocks() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('pt-PT');
            const timeShort = now.toLocaleTimeString('pt-PT', { hour: '2-digit', minute: '2-digit' });
            
            // Atualizar todos os relógios
            ['boss', 'team', 'purchase', 'office'].forEach(role => {
                const element = document.getElementById(`${role}CurrentTime`);
                if (element) element.textContent = timeShort;
            });
            
            // Relógios grandes
            ['officeClock', 'officeClockIndividual'].forEach(id => {
                const element = document.getElementById(id);
                if (element) element.textContent = timeString;
            });
            
            // Atualizar hora da equipa
            if (document.getElementById('teamCurrentTimeDisplay')) {
                document.getElementById('teamCurrentTimeDisplay').textContent = timeShort;
            }
        }
        
        function initializeDashboard() {
            // Inicializar dados específicos do dashboard atual
            switch(MAFCSystem.currentUser.role) {
                case 'office':
                    loadOfficeData();
                    break;
                case 'boss':
                    loadBossData();
                    break;
                case 'purchase':
                    loadPurchaseData();
                    break;
                case 'team':
                    loadTeamData();
                    break;
            }
        }
        
        function loadSectionData(sectionId) {
            // Carregar dados específicos da seção quando ativada
            switch(sectionId) {
                case 'teamMaterialsSection':
                    loadTeamMaterialRequests();
                    break;
                case 'purchasePendingSection':
                    loadPurchasePendingTable();
                    break;
                case 'purchaseApprovedSection':
                    loadPurchaseApprovedTable();
                    break;
                case 'purchaseCompletedSection':
                    loadPurchaseCompletedTable();
                    break;
                case 'purchaseSuppliersSection':
                    loadSuppliersTable();
                    break;
            }
        }
        
        // ============ FUNÇÕES DE UTILIDADE ============
        function refreshTodayMarks() {
            loadOfficeTodayMarks();
            loadAllEmployeesTime();
            alert('Marcações de hoje atualizadas!');
        }
        
        function registerAllOfficeEntry() {
            markAllEntry();
        }
        
        function sendTimeWhatsApp() {
            const select = document.getElementById('officePersonSelect');
            const personId = parseInt(select.value);
            
            if (!personId) {
                alert('Selecione uma pessoa primeiro!');
                return;
            }
            
            const person = MAFCSystem.officePeople.find(p => p.id === personId);
            if (person) {
                const message = `⏰ Lembrete MAFC\n\nPor favor, registe as suas horas no sistema.\n\nObrigado!`;
                window.open(`https://wa.me/${person.whatsapp.replace('+', '')}?text=${encodeURIComponent(message)}`, '_blank');
            }
        }
        
        function processUrgentAlerts() {
            alert('Redirecionando para pedidos urgentes...');
            // Em produção, redirecionaria para a seção de pedidos urgentes
        }
        
        function viewLatePurchases() {
            alert('Mostrando compras atrasadas...');
        }
        
        function contactSupplier(supplierName) {
            const message = `📞 MAFC Compras\n\nOlá ${supplierName},\n\nGostaríamos de saber o estado da nossa encomenda.\n\nObrigado!`;
            window.open(`https://wa.me/?text=${encodeURIComponent(message)}`, '_blank');
        }
        
        function contactSupplierForRequest(requestId) {
            const request = MAFCSystem.materialRequests.find(r => r.id === requestId);
            if (request) {
                const message = `📞 MAFC Compras - Pedido Urgente\n\nMaterial: ${request.material}\nQuantidade: ${request.quantity} ${request.unit}\nEquipa: ${request.team}\nUrgência: ${request.urgency}\n\nPrecisamos deste material urgentemente!`;
                window.open(`https://wa.me/?text=${encodeURIComponent(message)}`, '_blank');
            }
        }
        
        // ============ INICIALIZAÇÃO FINAL ============
        // Garantir que os modais fechem com ESC
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                document.querySelectorAll('.modal, .modal-employee, .modal-document, .modal-purchase-details, .modal-supplier').forEach(modal => {
                    modal.style.display = 'none';
                });
            }
        });
        
        // Documentos
        function openDocumentModal() {
            document.getElementById('documentModal').style.display = 'flex';
            
            // Limpar formulário
            document.getElementById('documentType').value = 'contrato';
            document.getElementById('documentNumber').value = '';
            document.getElementById('documentTitle').value = '';
            document.getElementById('documentDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('documentDescription').value = '';
            document.getElementById('documentFile').value = '';
        }
        
        function saveDocument() {
            const type = document.getElementById('documentType').value;
            const number = document.getElementById('documentNumber').value;
            const title = document.getElementById('documentTitle').value;
            const date = document.getElementById('documentDate').value;
            const description = document.getElementById('documentDescription').value;
            
            if (!number || !title) {
                alert('Por favor, preencha pelo menos o número e título!');
                return;
            }
            
            const newId = MAFCSystem.documents.length > 0 ? 
                Math.max(...MAFCSystem.documents.map(d => d.id)) + 1 : 1;
            
            MAFCSystem.documents.unshift({
                id: newId,
                type: type,
                number: number,
                title: title,
                date: date,
                description: description,
                createdBy: MAFCSystem.currentUser.name,
                createdAt: new Date().toISOString()
            });
            
            MAFCSystem.saveToStorage();
            MAFCSystem.logActivity('create', `Criou documento: ${number} - ${title}`);
            
            alert('Documento guardado com sucesso!');
            loadOfficeDocumentsTable();
            closeModal('documentModal');
        }
        
        // DRUCKER/IMPRESSÃO
        function printDocument() {
            const docType = document.getElementById('printDocumentType').value;
            const copies = document.getElementById('printCopies').value;
            const color = document.getElementById('printColor').checked;
            const duplex = document.getElementById('printDuplex').checked;
            
            // Simular impressão
            alert(`🖨️ Impressão iniciada!\n\nTipo: ${docType}\nCópias: ${copies}\nCor: ${color ? 'Sim' : 'Não'}\nFrente/verso: ${duplex ? 'Sim' : 'Não'}\n\nDocumento enviado para a impressora.`);
            
            // Registrar no histórico
            const printEntry = {
                id: Date.now(),
                timestamp: new Date().toISOString(),
                document: docType,
                user: MAFCSystem.currentUser.name,
                copies: copies,
                status: 'completed'
            };
            
            // Adicionar ao início do histórico
            const historyBody = document.getElementById('printHistory');
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${new Date(printEntry.timestamp).toLocaleString('pt-PT')}</td>
                <td>${printEntry.document}</td>
                <td>${printEntry.user}</td>
                <td>${printEntry.copies}</td>
                <td><span class="badge badge-success">Concluída</span></td>
            `;
            historyBody.insertBefore(row, historyBody.firstChild);
            
            MAFCSystem.logActivity('print', `Imprimiu documento: ${docType} (${copies} cópias)`);
        }
        
        function testPrinter() {
            alert('🔧 Testando impressora...\n\nEnviando página de teste para a impressora padrão.\n\nVerifique se a impressora está ligada e com papel.');
        }
        
        function previewPrint() {
            alert('👁️ Pré-visualização de impressão\n\nMostrando como ficará o documento impresso.');
        }
        
        function printQueue() {
            alert('📋 Fila de impressão\n\nMostrando todos os trabalhos na fila de impressão.');
        }
    </script>
</body>
</html>
